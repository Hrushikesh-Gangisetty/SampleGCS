{"snapshots":{"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/GcsMap.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/GcsMap.kt","baseContent":"package com.example.aerogcsclone.uimain\n\nimport androidx.compose.foundation.layout.fillMaxSize\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Modifier\nimport com.example.aerogcsclone.Telemetry.TelemetryState\nimport com.google.android.gms.maps.CameraUpdateFactory\nimport com.google.android.gms.maps.model.LatLng\nimport com.google.maps.android.compose.*\n\n@Composable\nfun GcsMap(telemetryState: TelemetryState) {\n    var points by remember { mutableStateOf(listOf<LatLng>()) }\n    var polygonClosed by remember { mutableStateOf(false) }\n\n    val cameraPositionState = rememberCameraPositionState()\n\n    // Update camera when telemetry changes (live location)\n    LaunchedEffect(telemetryState.latitude, telemetryState.longitude) {\n        val lat = telemetryState.latitude\n        val lon = telemetryState.longitude\n        if (lat != null && lon != null) {\n            val newPosition = LatLng(lat, lon)\n            cameraPositionState.animate(\n                update = CameraUpdateFactory.newLatLngZoom(newPosition, 16f),\n                durationMs = 1000\n            )\n        }\n    }\n\n    GoogleMap(\n        modifier = Modifier.fillMaxSize(),\n        cameraPositionState = cameraPositionState,\n        onMapClick = { latLng ->\n            if (!polygonClosed) {\n                points = points + latLng\n            }\n        }\n    ) {\n        // Live drone marker\n        val lat = telemetryState.latitude\n        val lon = telemetryState.longitude\n        if (lat != null && lon != null) {\n            Marker(\n                state = MarkerState(position = LatLng(lat, lon)),\n                title = \"Drone Location\"\n            )\n        }\n\n        // User-drawn markers\n        points.forEachIndexed { index, point ->\n            Marker(\n                state = MarkerState(position = point),\n                title = \"Marker ${index + 1}\",\n                onClick = {\n                    if (points.size > 1 && !polygonClosed) {\n                        val last = points.last()\n\n                        if (point == points.first() && points.size > 2) {\n                            points = points + point\n                            polygonClosed = true\n                        } else if (point != last) {\n                            points = points + point\n                        }\n                    }\n                    true\n                }\n            )\n        }\n\n        // Draw polyline (open or closed)\n        if (points.size > 1) {\n            Polyline(\n                points = points,\n                width = 4f\n            )\n        }\n    }\n}\n","baseTimestamp":1757909204070,"deltas":[{"timestamp":1757914278117,"changes":[{"type":"DELETE","lineNumber":11,"oldContent":"fun GcsMap(telemetryState: TelemetryState) {"},{"type":"DELETE","lineNumber":12,"oldContent":"    var points by remember { mutableStateOf(listOf<LatLng>()) }"},{"type":"INSERT","lineNumber":11,"content":"fun GcsMap("},{"type":"INSERT","lineNumber":12,"content":"    telemetryState: TelemetryState,"},{"type":"INSERT","lineNumber":13,"content":"    points: List<LatLng> = emptyList(),"},{"type":"INSERT","lineNumber":14,"content":"    onMapClick: (LatLng) -> Unit = {}"},{"type":"INSERT","lineNumber":15,"content":") {"},{"type":"INSERT","lineNumber":16,"content":"    var internalPoints by remember { mutableStateOf(points) }"},{"type":"INSERT","lineNumber":34,"content":"    // Keep internalPoints in sync when parent points change"},{"type":"INSERT","lineNumber":35,"content":"    LaunchedEffect(points) {"},{"type":"INSERT","lineNumber":36,"content":"        internalPoints = points"},{"type":"INSERT","lineNumber":37,"content":"    }"},{"type":"INSERT","lineNumber":38,"content":""},{"type":"DELETE","lineNumber":35,"oldContent":"                points = points + latLng"},{"type":"INSERT","lineNumber":44,"content":"                // Notify parent"},{"type":"INSERT","lineNumber":45,"content":"                onMapClick(latLng)"},{"type":"INSERT","lineNumber":46,"content":"                // update internal copy for immediate UI feedback"},{"type":"INSERT","lineNumber":47,"content":"                internalPoints = internalPoints + latLng"},{"type":"DELETE","lineNumber":50,"oldContent":"        points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":62,"content":"        internalPoints.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":54,"oldContent":"                onClick = {"},{"type":"DELETE","lineNumber":55,"oldContent":"                    if (points.size > 1 && !polygonClosed) {"},{"type":"DELETE","lineNumber":56,"oldContent":"                        val last = points.last()"},{"type":"DELETE","lineNumber":57,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"                        if (point == points.first() && points.size > 2) {"},{"type":"DELETE","lineNumber":59,"oldContent":"                            points = points + point"},{"type":"DELETE","lineNumber":60,"oldContent":"                            polygonClosed = true"},{"type":"DELETE","lineNumber":61,"oldContent":"                        } else if (point != last) {"},{"type":"DELETE","lineNumber":62,"oldContent":"                            points = points + point"},{"type":"DELETE","lineNumber":63,"oldContent":"                        }"},{"type":"DELETE","lineNumber":64,"oldContent":"                    }"},{"type":"DELETE","lineNumber":65,"oldContent":"                    true"},{"type":"DELETE","lineNumber":66,"oldContent":"                }"},{"type":"MODIFY","lineNumber":70,"content":"        if (internalPoints.size > 1) {","oldContent":"        if (points.size > 1) {"},{"type":"MODIFY","lineNumber":72,"content":"                points = internalPoints,","oldContent":"                points = points,"}]},{"timestamp":1757915700671,"changes":[{"type":"DELETE","lineNumber":11,"oldContent":"fun GcsMap("},{"type":"DELETE","lineNumber":12,"oldContent":"    telemetryState: TelemetryState,"},{"type":"DELETE","lineNumber":13,"oldContent":"    points: List<LatLng> = emptyList(),"},{"type":"INSERT","lineNumber":11,"content":"fun GcsMap(telemetryState: TelemetryState) {"},{"type":"INSERT","lineNumber":12,"content":"    var points by remember { mutableStateOf(listOf<LatLng>()) }"},{"type":"DELETE","lineNumber":15,"oldContent":"    onMapClick: (LatLng) -> Unit = {}"},{"type":"DELETE","lineNumber":17,"oldContent":") {"},{"type":"DELETE","lineNumber":19,"oldContent":"    var internalPoints by remember { mutableStateOf(points) }"},{"type":"DELETE","lineNumber":38,"oldContent":"    // Keep internalPoints in sync when parent points change"},{"type":"DELETE","lineNumber":40,"oldContent":"    LaunchedEffect(points) {"},{"type":"DELETE","lineNumber":41,"oldContent":"        internalPoints = points"},{"type":"INSERT","lineNumber":35,"content":"                points = points + latLng"},{"type":"DELETE","lineNumber":43,"oldContent":"    }"},{"type":"DELETE","lineNumber":45,"oldContent":""},{"type":"DELETE","lineNumber":52,"oldContent":"                // Notify parent"},{"type":"DELETE","lineNumber":54,"oldContent":"                onMapClick(latLng)"},{"type":"DELETE","lineNumber":56,"oldContent":"                // update internal copy for immediate UI feedback"},{"type":"DELETE","lineNumber":58,"oldContent":"                internalPoints = internalPoints + latLng"},{"type":"INSERT","lineNumber":50,"content":"        points.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":65,"oldContent":"        internalPoints.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":54,"content":"                onClick = {"},{"type":"INSERT","lineNumber":55,"content":"                    if (points.size > 1 && !polygonClosed) {"},{"type":"INSERT","lineNumber":56,"content":"                        val last = points.last()"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":58,"content":"                        if (point == points.first() && points.size > 2) {"},{"type":"INSERT","lineNumber":59,"content":"                            points = points + point"},{"type":"INSERT","lineNumber":60,"content":"                            polygonClosed = true"},{"type":"INSERT","lineNumber":61,"content":"                        } else if (point != last) {"},{"type":"INSERT","lineNumber":62,"content":"                            points = points + point"},{"type":"INSERT","lineNumber":63,"content":"                        }"},{"type":"INSERT","lineNumber":64,"content":"                    }"},{"type":"INSERT","lineNumber":65,"content":"                    true"},{"type":"INSERT","lineNumber":66,"content":"                }"},{"type":"DELETE","lineNumber":69,"oldContent":"        if (internalPoints.size > 1) {"},{"type":"INSERT","lineNumber":70,"content":"        // Draw polyline (open or closed)"},{"type":"DELETE","lineNumber":71,"oldContent":"                points = internalPoints,"},{"type":"INSERT","lineNumber":72,"content":"            Polyline("}]},{"timestamp":1757915709340,"changes":[{"type":"MODIFY","lineNumber":11,"content":"fun GcsMap(","oldContent":"fun GcsMap(telemetryState: TelemetryState) {"},{"type":"INSERT","lineNumber":12,"content":"    telemetryState: TelemetryState,"},{"type":"INSERT","lineNumber":13,"content":"    mapType: MapType"},{"type":"INSERT","lineNumber":14,"content":") {"},{"type":"DELETE","lineNumber":31,"oldContent":"                points = points + latLng"},{"type":"INSERT","lineNumber":36,"content":"        properties = MapProperties(mapType = mapType), // ✅ Map type applied"},{"type":"INSERT","lineNumber":39,"content":"                points = points + latLng"},{"type":"DELETE","lineNumber":42,"oldContent":"        points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":49,"content":"                title = \"Drone Location\""},{"type":"INSERT","lineNumber":50,"content":"            )"},{"type":"INSERT","lineNumber":51,"content":"        }"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"INSERT","lineNumber":53,"content":"        // User-drawn markers"},{"type":"INSERT","lineNumber":54,"content":"        points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":55,"content":"            Marker("},{"type":"INSERT","lineNumber":56,"content":"                state = MarkerState(position = point),"},{"type":"INSERT","lineNumber":57,"content":"                title = \"Marker ${index + 1}\","},{"type":"DELETE","lineNumber":48,"oldContent":"                title = \"Drone Location\""},{"type":"DELETE","lineNumber":51,"oldContent":"            )"},{"type":"DELETE","lineNumber":54,"oldContent":"        }"},{"type":"DELETE","lineNumber":56,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"        // User-drawn markers"},{"type":"DELETE","lineNumber":60,"oldContent":"            Marker("},{"type":"DELETE","lineNumber":62,"oldContent":"                state = MarkerState(position = point),"},{"type":"DELETE","lineNumber":64,"oldContent":"                title = \"Marker ${index + 1}\","},{"type":"DELETE","lineNumber":79,"oldContent":""}]},{"timestamp":1757915781162,"changes":[{"type":"MODIFY","lineNumber":13,"content":"<<<<<<< Updated upstream","oldContent":"    var points by remember { mutableStateOf(listOf<LatLng>()) }"},{"type":"MODIFY","lineNumber":16,"content":"    var points by remember { mutableStateOf(listOf<LatLng>()) }","oldContent":"    var polygonClosed by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":17,"content":"======="},{"type":"INSERT","lineNumber":18,"content":"    points: List<LatLng> = emptyList(),"},{"type":"INSERT","lineNumber":19,"content":"    onMapClick: (LatLng) -> Unit = {}"},{"type":"INSERT","lineNumber":20,"content":") {"},{"type":"INSERT","lineNumber":21,"content":"    var internalPoints by remember { mutableStateOf(points) }"},{"type":"INSERT","lineNumber":22,"content":">>>>>>> Stashed changes"},{"type":"INSERT","lineNumber":23,"content":"    var polygonClosed by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":40,"content":"    // Keep internalPoints in sync when parent points change"},{"type":"INSERT","lineNumber":41,"content":"    LaunchedEffect(points) {"},{"type":"INSERT","lineNumber":42,"content":"        internalPoints = points"},{"type":"INSERT","lineNumber":43,"content":"    }"},{"type":"INSERT","lineNumber":44,"content":""},{"type":"INSERT","lineNumber":48,"content":"        properties = MapProperties(mapType = mapType), // ✅ Map type applied"},{"type":"DELETE","lineNumber":38,"oldContent":"        properties = MapProperties(mapType = mapType), // ✅ Map type applied"},{"type":"INSERT","lineNumber":51,"content":"                // Notify parent"},{"type":"INSERT","lineNumber":52,"content":"                onMapClick(latLng)"},{"type":"INSERT","lineNumber":53,"content":"                // update internal copy for immediate UI feedback"},{"type":"INSERT","lineNumber":54,"content":"                internalPoints = internalPoints + latLng"},{"type":"DELETE","lineNumber":42,"oldContent":"                points = points + latLng"},{"type":"DELETE","lineNumber":49,"oldContent":"                onClick = {"},{"type":"DELETE","lineNumber":50,"oldContent":"                    if (points.size > 1 && !polygonClosed) {"},{"type":"DELETE","lineNumber":52,"oldContent":"                        val last = points.last()"},{"type":"DELETE","lineNumber":54,"oldContent":""},{"type":"DELETE","lineNumber":57,"oldContent":"                        if (point == points.first() && points.size > 2) {"},{"type":"DELETE","lineNumber":59,"oldContent":"                            points = points + point"},{"type":"DELETE","lineNumber":60,"oldContent":"        points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":69,"content":"        internalPoints.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":62,"oldContent":"                            polygonClosed = true"},{"type":"DELETE","lineNumber":65,"oldContent":"                        } else if (point != last) {"},{"type":"DELETE","lineNumber":66,"oldContent":"                            points = points + point"},{"type":"DELETE","lineNumber":67,"oldContent":"                        }"},{"type":"DELETE","lineNumber":68,"oldContent":"                    }"},{"type":"DELETE","lineNumber":69,"oldContent":"                    true"},{"type":"DELETE","lineNumber":70,"oldContent":"                }"},{"type":"DELETE","lineNumber":75,"oldContent":"        if (points.size > 1) {"},{"type":"INSERT","lineNumber":77,"content":"        if (internalPoints.size > 1) {"},{"type":"DELETE","lineNumber":77,"oldContent":"                points = points,"},{"type":"INSERT","lineNumber":79,"content":"                points = internalPoints,"}]},{"timestamp":1757915853667,"changes":[{"type":"DELETE","lineNumber":11,"oldContent":"fun GcsMap("},{"type":"DELETE","lineNumber":12,"oldContent":"    telemetryState: TelemetryState,"},{"type":"DELETE","lineNumber":13,"oldContent":"<<<<<<< Updated upstream"},{"type":"DELETE","lineNumber":14,"oldContent":"    mapType: MapType"},{"type":"DELETE","lineNumber":15,"oldContent":"    var polygonClosed by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":11,"content":"fun GcsMap(telemetryState: TelemetryState) {"},{"type":"DELETE","lineNumber":17,"oldContent":"======="},{"type":"INSERT","lineNumber":13,"content":"    var polygonClosed by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":19,"oldContent":"    points: List<LatLng> = emptyList(),"},{"type":"DELETE","lineNumber":21,"oldContent":"    onMapClick: (LatLng) -> Unit = {}"},{"type":"DELETE","lineNumber":23,"oldContent":") {"},{"type":"DELETE","lineNumber":25,"oldContent":"    var internalPoints by remember { mutableStateOf(points) }"},{"type":"DELETE","lineNumber":27,"oldContent":">>>>>>> Stashed changes"},{"type":"DELETE","lineNumber":29,"oldContent":"    var polygonClosed by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":35,"content":"                points = points + latLng"},{"type":"DELETE","lineNumber":46,"oldContent":"    // Keep internalPoints in sync when parent points change"},{"type":"DELETE","lineNumber":48,"oldContent":"    LaunchedEffect(points) {"},{"type":"DELETE","lineNumber":50,"oldContent":"        internalPoints = points"},{"type":"DELETE","lineNumber":51,"oldContent":"    }"},{"type":"DELETE","lineNumber":53,"oldContent":""},{"type":"DELETE","lineNumber":58,"oldContent":"        properties = MapProperties(mapType = mapType), // ✅ Map type applied"},{"type":"DELETE","lineNumber":60,"oldContent":"                // Notify parent"},{"type":"DELETE","lineNumber":62,"oldContent":"                onMapClick(latLng)"},{"type":"DELETE","lineNumber":63,"oldContent":"                // update internal copy for immediate UI feedback"},{"type":"DELETE","lineNumber":65,"oldContent":"                internalPoints = internalPoints + latLng"},{"type":"INSERT","lineNumber":50,"content":"        points.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":72,"oldContent":"        internalPoints.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":54,"content":"                onClick = {"},{"type":"INSERT","lineNumber":55,"content":"                    if (points.size > 1 && !polygonClosed) {"},{"type":"INSERT","lineNumber":56,"content":"                        val last = points.last()"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":58,"content":"                        if (point == points.first() && points.size > 2) {"},{"type":"INSERT","lineNumber":59,"content":"                            points = points + point"},{"type":"INSERT","lineNumber":60,"content":"                            polygonClosed = true"},{"type":"INSERT","lineNumber":61,"content":"                        } else if (point != last) {"},{"type":"INSERT","lineNumber":62,"content":"                            points = points + point"},{"type":"INSERT","lineNumber":63,"content":"                        }"},{"type":"INSERT","lineNumber":64,"content":"                    }"},{"type":"INSERT","lineNumber":65,"content":"                    true"},{"type":"INSERT","lineNumber":66,"content":"                }"},{"type":"INSERT","lineNumber":71,"content":"        if (points.size > 1) {"},{"type":"DELETE","lineNumber":78,"oldContent":"        if (internalPoints.size > 1) {"},{"type":"INSERT","lineNumber":73,"content":"                points = points,"},{"type":"DELETE","lineNumber":80,"oldContent":"                points = internalPoints,"},{"type":"INSERT","lineNumber":79,"content":""}]},{"timestamp":1758019569277,"changes":[{"type":"INSERT","lineNumber":2,"content":"import android.util.Log"},{"type":"INSERT","lineNumber":3,"content":"import androidx.compose.foundation.layout.Box"},{"type":"DELETE","lineNumber":3,"oldContent":"import androidx.compose.runtime.*"},{"type":"INSERT","lineNumber":5,"content":"import androidx.compose.material3.Text"},{"type":"INSERT","lineNumber":6,"content":"import androidx.compose.runtime.Composable"},{"type":"INSERT","lineNumber":7,"content":"import androidx.compose.ui.Alignment"},{"type":"INSERT","lineNumber":9,"content":"import androidx.compose.ui.graphics.Color"},{"type":"INSERT","lineNumber":10,"content":"import androidx.compose.ui.unit.sp"},{"type":"INSERT","lineNumber":15,"content":"import com.google.maps.android.compose.MapType"},{"type":"DELETE","lineNumber":11,"oldContent":"fun GcsMap(telemetryState: TelemetryState) {"},{"type":"DELETE","lineNumber":12,"oldContent":"    var polygonClosed by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":13,"oldContent":"    var points by remember { mutableStateOf(listOf<LatLng>()) }"},{"type":"INSERT","lineNumber":18,"content":"fun GcsMap("},{"type":"INSERT","lineNumber":19,"content":"    telemetryState: TelemetryState,"},{"type":"INSERT","lineNumber":20,"content":"    points: List<LatLng> = emptyList(),"},{"type":"INSERT","lineNumber":21,"content":"    onMapClick: (LatLng) -> Unit = {},"},{"type":"INSERT","lineNumber":22,"content":"    cameraPositionState: CameraPositionState? = null,"},{"type":"INSERT","lineNumber":23,"content":"    mapType: MapType = MapType.NORMAL,"},{"type":"INSERT","lineNumber":24,"content":"    autoCenter: Boolean = true // new flag to control automatic recentering"},{"type":"INSERT","lineNumber":25,"content":") {"},{"type":"INSERT","lineNumber":26,"content":"    val cameraState = cameraPositionState ?: rememberCameraPositionState()"},{"type":"DELETE","lineNumber":15,"oldContent":"    val cameraPositionState = rememberCameraPositionState()"},{"type":"INSERT","lineNumber":28,"content":"    // Defensive: Use default position if telemetry is missing"},{"type":"INSERT","lineNumber":29,"content":"    val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":30,"content":"    val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":31,"content":"    val hasTelemetry = lat != null && lon != null"},{"type":"INSERT","lineNumber":32,"content":"    val defaultLatLng = LatLng(19.0760, 72.8777) // Mumbai as fallback"},{"type":"DELETE","lineNumber":17,"oldContent":"    // Update camera when telemetry changes (live location)"},{"type":"DELETE","lineNumber":18,"oldContent":"    LaunchedEffect(telemetryState.latitude, telemetryState.longitude) {"},{"type":"DELETE","lineNumber":19,"oldContent":"        val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":20,"oldContent":"        val lon = telemetryState.longitude"},{"type":"DELETE","lineNumber":21,"oldContent":"        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":22,"oldContent":"            val newPosition = LatLng(lat, lon)"},{"type":"DELETE","lineNumber":23,"oldContent":"            cameraPositionState.animate("},{"type":"DELETE","lineNumber":24,"oldContent":"                update = CameraUpdateFactory.newLatLngZoom(newPosition, 16f),"},{"type":"DELETE","lineNumber":25,"oldContent":"                points = points + latLng"},{"type":"DELETE","lineNumber":26,"oldContent":"                durationMs = 1000"},{"type":"DELETE","lineNumber":27,"oldContent":"            )"},{"type":"INSERT","lineNumber":34,"content":"    Log.d(\"GcsMap\", \"Rendering map: lat=$lat lon=$lon points=${points.size} connected=${telemetryState.connected}\")"},{"type":"INSERT","lineNumber":35,"content":""},{"type":"INSERT","lineNumber":36,"content":"    if (autoCenter) {"},{"type":"INSERT","lineNumber":37,"content":"        if (hasTelemetry) {"},{"type":"INSERT","lineNumber":38,"content":"            cameraState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat!!, lon!!), 16f))"},{"type":"INSERT","lineNumber":39,"content":"        } else {"},{"type":"INSERT","lineNumber":40,"content":"            cameraState.move(CameraUpdateFactory.newLatLngZoom(defaultLatLng, 10f))"},{"type":"DELETE","lineNumber":31,"oldContent":"    GoogleMap("},{"type":"DELETE","lineNumber":32,"oldContent":"        modifier = Modifier.fillMaxSize(),"},{"type":"DELETE","lineNumber":33,"oldContent":"        cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":34,"oldContent":"        onMapClick = { latLng ->"},{"type":"DELETE","lineNumber":35,"oldContent":"            if (!polygonClosed) {"},{"type":"INSERT","lineNumber":44,"content":"    Box(modifier = Modifier.fillMaxSize()) {"},{"type":"INSERT","lineNumber":45,"content":"        GoogleMap("},{"type":"INSERT","lineNumber":46,"content":"            modifier = Modifier.fillMaxSize(),"},{"type":"INSERT","lineNumber":47,"content":"            cameraPositionState = cameraState,"},{"type":"INSERT","lineNumber":48,"content":"            properties = MapProperties(mapType = mapType),"},{"type":"INSERT","lineNumber":49,"content":"            onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"INSERT","lineNumber":50,"content":"        ) {"},{"type":"INSERT","lineNumber":51,"content":"            // Live drone marker"},{"type":"INSERT","lineNumber":52,"content":"            if (hasTelemetry) {"},{"type":"INSERT","lineNumber":53,"content":"                Marker(state = MarkerState(position = LatLng(lat!!, lon!!)), title = \"Drone Location\")"},{"type":"DELETE","lineNumber":37,"oldContent":"        }"},{"type":"DELETE","lineNumber":38,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":39,"oldContent":"        points.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":40,"oldContent":"        // Live drone marker"},{"type":"DELETE","lineNumber":41,"oldContent":"                onClick = {"},{"type":"DELETE","lineNumber":42,"oldContent":"        val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":43,"oldContent":"                    if (points.size > 1 && !polygonClosed) {"},{"type":"DELETE","lineNumber":44,"oldContent":"        val lon = telemetryState.longitude"},{"type":"DELETE","lineNumber":45,"oldContent":"                        val last = points.last()"},{"type":"DELETE","lineNumber":46,"oldContent":"        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"DELETE","lineNumber":48,"oldContent":"            Marker("},{"type":"DELETE","lineNumber":49,"oldContent":"                        if (point == points.first() && points.size > 2) {"},{"type":"DELETE","lineNumber":50,"oldContent":"                            points = points + point"},{"type":"DELETE","lineNumber":51,"oldContent":"                state = MarkerState(position = LatLng(lat, lon)),"},{"type":"DELETE","lineNumber":52,"oldContent":"                            polygonClosed = true"},{"type":"DELETE","lineNumber":53,"oldContent":"                        } else if (point != last) {"},{"type":"DELETE","lineNumber":54,"oldContent":"                title = \"Drone Location\""},{"type":"DELETE","lineNumber":55,"oldContent":"                            points = points + point"},{"type":"DELETE","lineNumber":56,"oldContent":"                        }"},{"type":"DELETE","lineNumber":57,"oldContent":"                    }"},{"type":"DELETE","lineNumber":58,"oldContent":"            )"},{"type":"DELETE","lineNumber":59,"oldContent":"                    true"},{"type":"INSERT","lineNumber":55,"content":"            // User-drawn markers"},{"type":"INSERT","lineNumber":56,"content":"            points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":57,"content":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":58,"content":"            }"},{"type":"INSERT","lineNumber":59,"content":"            // Draw polyline connecting waypoints"},{"type":"INSERT","lineNumber":60,"content":"            if (points.size > 1) {"},{"type":"INSERT","lineNumber":61,"content":"                Polyline(points = points, width = 4f)"},{"type":"INSERT","lineNumber":62,"content":"            }"},{"type":"INSERT","lineNumber":63,"content":"            // If 4 or more points, draw a simple grid over bounding box"},{"type":"INSERT","lineNumber":64,"content":"            if (points.size >= 4) {"},{"type":"INSERT","lineNumber":65,"content":"                val lats = points.map { it.latitude }"},{"type":"INSERT","lineNumber":66,"content":"                val lons = points.map { it.longitude }"},{"type":"INSERT","lineNumber":67,"content":"                val minLat = lats.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":68,"content":"                val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":69,"content":"                val minLon = lons.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":70,"content":"                val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":71,"content":"                val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"INSERT","lineNumber":72,"content":"                val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"INSERT","lineNumber":73,"content":"                lonSteps.forEach { lonVal ->"},{"type":"INSERT","lineNumber":74,"content":"                    val line = listOf(LatLng(minLat, lonVal), LatLng(maxLat, lonVal))"},{"type":"INSERT","lineNumber":75,"content":"                    Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"INSERT","lineNumber":77,"content":"                latSteps.forEach { latVal ->"},{"type":"INSERT","lineNumber":78,"content":"                    val line = listOf(LatLng(latVal, minLon), LatLng(latVal, maxLon))"},{"type":"INSERT","lineNumber":79,"content":"                    Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"INSERT","lineNumber":80,"content":"                }"},{"type":"INSERT","lineNumber":81,"content":"            }"},{"type":"DELETE","lineNumber":62,"oldContent":""},{"type":"DELETE","lineNumber":63,"oldContent":"        // User-drawn markers"},{"type":"DELETE","lineNumber":64,"oldContent":"            Marker("},{"type":"DELETE","lineNumber":65,"oldContent":"                state = MarkerState(position = point),"},{"type":"DELETE","lineNumber":66,"oldContent":"        if (points.size > 1) {"},{"type":"DELETE","lineNumber":67,"oldContent":"                title = \"Marker ${index + 1}\","},{"type":"DELETE","lineNumber":68,"oldContent":"                points = points,"},{"type":"DELETE","lineNumber":69,"oldContent":"            )"},{"type":"INSERT","lineNumber":83,"content":"        if (!hasTelemetry) {"},{"type":"INSERT","lineNumber":84,"content":"            Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {"},{"type":"INSERT","lineNumber":85,"content":"                Text(\"No telemetry data. Waiting for drone position...\", fontSize = 18.sp, color = Color.Red)"},{"type":"INSERT","lineNumber":86,"content":"            }"},{"type":"DELETE","lineNumber":71,"oldContent":""},{"type":"DELETE","lineNumber":72,"oldContent":"        // Draw polyline (open or closed)"},{"type":"DELETE","lineNumber":73,"oldContent":"            Polyline("},{"type":"DELETE","lineNumber":74,"oldContent":""},{"type":"DELETE","lineNumber":75,"oldContent":"                width = 4f"},{"type":"DELETE","lineNumber":76,"oldContent":"            )"},{"type":"DELETE","lineNumber":77,"oldContent":"        }"}]},{"timestamp":1758086730253,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import android.util.Log"},{"type":"MODIFY","lineNumber":3,"content":"import androidx.compose.runtime.Composable","oldContent":"import androidx.compose.foundation.layout.Box"},{"type":"MODIFY","lineNumber":5,"content":"import androidx.compose.ui.graphics.Color","oldContent":"import androidx.compose.material3.Text"},{"type":"DELETE","lineNumber":8,"oldContent":"import androidx.compose.runtime.Composable"},{"type":"DELETE","lineNumber":10,"oldContent":"import androidx.compose.ui.Alignment"},{"type":"DELETE","lineNumber":13,"oldContent":"import androidx.compose.ui.graphics.Color"},{"type":"DELETE","lineNumber":14,"oldContent":""},{"type":"DELETE","lineNumber":15,"oldContent":"import androidx.compose.ui.unit.sp"},{"type":"DELETE","lineNumber":16,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":17,"oldContent":""},{"type":"INSERT","lineNumber":12,"content":"@Composable"},{"type":"DELETE","lineNumber":29,"oldContent":"    // Defensive: Use default position if telemetry is missing"},{"type":"DELETE","lineNumber":30,"oldContent":"        }"},{"type":"INSERT","lineNumber":22,"content":""},{"type":"INSERT","lineNumber":23,"content":"    // Update camera when telemetry changes (live location) only if autoCenter is true"},{"type":"DELETE","lineNumber":32,"oldContent":"    }"},{"type":"INSERT","lineNumber":26,"content":"    if (autoCenter && lat != null && lon != null) {"},{"type":"INSERT","lineNumber":27,"content":"        // animate only when autoCenter is requested"},{"type":"INSERT","lineNumber":28,"content":"        cameraState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f))"},{"type":"INSERT","lineNumber":29,"content":"    }"},{"type":"DELETE","lineNumber":35,"oldContent":"    val hasTelemetry = lat != null && lon != null"},{"type":"DELETE","lineNumber":36,"oldContent":"    val defaultLatLng = LatLng(19.0760, 72.8777) // Mumbai as fallback"},{"type":"DELETE","lineNumber":37,"oldContent":"    Log.d(\"GcsMap\", \"Rendering map: lat=$lat lon=$lon points=${points.size} connected=${telemetryState.connected}\")"},{"type":"INSERT","lineNumber":31,"content":"    GoogleMap("},{"type":"INSERT","lineNumber":32,"content":"        modifier = Modifier.fillMaxSize(),"},{"type":"INSERT","lineNumber":33,"content":"        cameraPositionState = cameraState,"},{"type":"INSERT","lineNumber":34,"content":"        properties = MapProperties(mapType = mapType),"},{"type":"INSERT","lineNumber":35,"content":"        onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"INSERT","lineNumber":36,"content":"    ) {"},{"type":"INSERT","lineNumber":37,"content":"        // Live drone marker"},{"type":"INSERT","lineNumber":38,"content":"        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":39,"content":"            Marker(state = MarkerState(position = LatLng(lat, lon)), title = \"Drone Location\")"},{"type":"INSERT","lineNumber":40,"content":"        }"},{"type":"DELETE","lineNumber":39,"oldContent":"    if (autoCenter) {"},{"type":"INSERT","lineNumber":42,"content":"        // User-drawn markers"},{"type":"INSERT","lineNumber":43,"content":"        points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":44,"content":"            Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":45,"content":"        }"},{"type":"INSERT","lineNumber":46,"content":""},{"type":"INSERT","lineNumber":47,"content":"        // Draw polyline connecting waypoints"},{"type":"INSERT","lineNumber":48,"content":"        if (points.size > 1) {"},{"type":"INSERT","lineNumber":49,"content":"            Polyline(points = points, width = 4f)"},{"type":"INSERT","lineNumber":50,"content":"        }"},{"type":"INSERT","lineNumber":51,"content":""},{"type":"INSERT","lineNumber":52,"content":"        // If 4 or more points, draw a simple grid over bounding box"},{"type":"INSERT","lineNumber":53,"content":"        if (points.size >= 4) {"},{"type":"INSERT","lineNumber":54,"content":"            val lats = points.map { it.latitude }"},{"type":"INSERT","lineNumber":55,"content":"            val lons = points.map { it.longitude }"},{"type":"INSERT","lineNumber":56,"content":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":57,"content":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":58,"content":"            val minLon = lons.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":59,"content":"            val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":60,"content":""},{"type":"INSERT","lineNumber":61,"content":"            // draw two vertical and two horizontal lines (3x3 grid)"},{"type":"INSERT","lineNumber":62,"content":"            val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"INSERT","lineNumber":63,"content":"            val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"INSERT","lineNumber":64,"content":""},{"type":"INSERT","lineNumber":65,"content":"            // vertical lines"},{"type":"INSERT","lineNumber":66,"content":"            lonSteps.forEach { lonVal ->"},{"type":"INSERT","lineNumber":67,"content":"                val line = listOf(LatLng(minLat, lonVal), LatLng(maxLat, lonVal))"},{"type":"INSERT","lineNumber":68,"content":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":41,"oldContent":"        if (hasTelemetry) {"},{"type":"DELETE","lineNumber":42,"oldContent":"            cameraState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat!!, lon!!), 16f))"},{"type":"DELETE","lineNumber":43,"oldContent":"        } else {"},{"type":"DELETE","lineNumber":44,"oldContent":"            cameraState.move(CameraUpdateFactory.newLatLngZoom(defaultLatLng, 10f))"},{"type":"DELETE","lineNumber":45,"oldContent":"    Box(modifier = Modifier.fillMaxSize()) {"},{"type":"DELETE","lineNumber":46,"oldContent":"        GoogleMap("},{"type":"DELETE","lineNumber":47,"oldContent":"            modifier = Modifier.fillMaxSize(),"},{"type":"DELETE","lineNumber":48,"oldContent":"            cameraPositionState = cameraState,"},{"type":"DELETE","lineNumber":49,"oldContent":"            properties = MapProperties(mapType = mapType),"},{"type":"DELETE","lineNumber":50,"oldContent":"            onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"DELETE","lineNumber":51,"oldContent":"        ) {"},{"type":"DELETE","lineNumber":52,"oldContent":"            // Live drone marker"},{"type":"DELETE","lineNumber":53,"oldContent":"            if (hasTelemetry) {"},{"type":"DELETE","lineNumber":54,"oldContent":"                Marker(state = MarkerState(position = LatLng(lat!!, lon!!)), title = \"Drone Location\")"},{"type":"DELETE","lineNumber":55,"oldContent":"            // User-drawn markers"},{"type":"DELETE","lineNumber":56,"oldContent":"            points.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":57,"oldContent":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":70,"content":"            // horizontal lines"},{"type":"INSERT","lineNumber":71,"content":"            latSteps.forEach { latVal ->"},{"type":"INSERT","lineNumber":72,"content":"                val line = listOf(LatLng(latVal, minLon), LatLng(latVal, maxLon))"},{"type":"INSERT","lineNumber":73,"content":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":59,"oldContent":"            // Draw polyline connecting waypoints"},{"type":"DELETE","lineNumber":60,"oldContent":"            if (points.size > 1) {"},{"type":"DELETE","lineNumber":61,"oldContent":"                }"},{"type":"DELETE","lineNumber":62,"oldContent":"                Polyline(points = points, width = 4f)"},{"type":"DELETE","lineNumber":64,"oldContent":"            }"},{"type":"DELETE","lineNumber":65,"oldContent":"            // If 4 or more points, draw a simple grid over bounding box"},{"type":"DELETE","lineNumber":66,"oldContent":"            if (points.size >= 4) {"},{"type":"DELETE","lineNumber":67,"oldContent":"                val lats = points.map { it.latitude }"},{"type":"DELETE","lineNumber":68,"oldContent":"                val lons = points.map { it.longitude }"},{"type":"DELETE","lineNumber":69,"oldContent":"                val minLat = lats.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":70,"oldContent":"                val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":71,"oldContent":"                val minLon = lons.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":72,"oldContent":"                val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":73,"oldContent":"        }"},{"type":"DELETE","lineNumber":74,"oldContent":"                val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"DELETE","lineNumber":75,"oldContent":"                val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"DELETE","lineNumber":76,"oldContent":"                lonSteps.forEach { lonVal ->"},{"type":"DELETE","lineNumber":77,"oldContent":"                    val line = listOf(LatLng(minLat, lonVal), LatLng(maxLat, lonVal))"},{"type":"DELETE","lineNumber":78,"oldContent":"                    Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":79,"oldContent":"                latSteps.forEach { latVal ->"},{"type":"DELETE","lineNumber":80,"oldContent":"                    val line = listOf(LatLng(latVal, minLon), LatLng(latVal, maxLon))"},{"type":"DELETE","lineNumber":82,"oldContent":"                    Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":84,"oldContent":"                }"},{"type":"DELETE","lineNumber":85,"oldContent":"            }"},{"type":"DELETE","lineNumber":86,"oldContent":"            }"},{"type":"DELETE","lineNumber":87,"oldContent":"                Text(\"No telemetry data. Waiting for drone position...\", fontSize = 18.sp, color = Color.Red)"},{"type":"DELETE","lineNumber":88,"oldContent":"            Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {"},{"type":"DELETE","lineNumber":89,"oldContent":"        if (!hasTelemetry) {"}]},{"timestamp":1758166955446,"changes":[{"type":"INSERT","lineNumber":0,"content":""},{"type":"DELETE","lineNumber":2,"oldContent":"import androidx.compose.runtime.Composable"},{"type":"MODIFY","lineNumber":3,"content":"import android.graphics.Bitmap","oldContent":"import androidx.compose.foundation.layout.Box"},{"type":"INSERT","lineNumber":4,"content":"import android.graphics.BitmapFactory"},{"type":"INSERT","lineNumber":5,"content":"import androidx.compose.foundation.layout.fillMaxSize"},{"type":"INSERT","lineNumber":6,"content":"import androidx.compose.runtime.*"},{"type":"INSERT","lineNumber":7,"content":"import androidx.compose.ui.Modifier"},{"type":"INSERT","lineNumber":8,"content":"import androidx.compose.ui.geometry.Offset"},{"type":"DELETE","lineNumber":5,"oldContent":"import androidx.compose.material3.Text"},{"type":"INSERT","lineNumber":10,"content":"import androidx.compose.ui.platform.LocalContext"},{"type":"INSERT","lineNumber":11,"content":"import com.example.aerogcsclone.R"},{"type":"DELETE","lineNumber":9,"oldContent":"@Composable"},{"type":"INSERT","lineNumber":15,"content":"import com.google.android.gms.maps.model.BitmapDescriptorFactory"},{"type":"DELETE","lineNumber":11,"oldContent":"import com.google.maps.android.compose.MapType"},{"type":"INSERT","lineNumber":18,"content":"@Composable"},{"type":"DELETE","lineNumber":15,"oldContent":""},{"type":"DELETE","lineNumber":17,"oldContent":"    // Update camera when telemetry changes (live location) only if autoCenter is true"},{"type":"DELETE","lineNumber":21,"oldContent":"    if (autoCenter && lat != null && lon != null) {"},{"type":"DELETE","lineNumber":22,"oldContent":"    autoCenter: Boolean = true // new flag to control automatic recentering"},{"type":"DELETE","lineNumber":23,"oldContent":"        // animate only when autoCenter is requested"},{"type":"INSERT","lineNumber":25,"content":"    autoCenter: Boolean = true"},{"type":"DELETE","lineNumber":25,"oldContent":"        cameraState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f))"},{"type":"INSERT","lineNumber":27,"content":"    val context = LocalContext.current"},{"type":"INSERT","lineNumber":29,"content":""},{"type":"INSERT","lineNumber":30,"content":"    val visitedPositions = remember { mutableStateListOf<LatLng>() }"},{"type":"INSERT","lineNumber":31,"content":""},{"type":"INSERT","lineNumber":32,"content":"    // Load quadcopter drawable from res/drawable/ic_quadcopter.png and scale to dp-based size"},{"type":"INSERT","lineNumber":33,"content":"    val droneIcon = remember {"},{"type":"INSERT","lineNumber":34,"content":"        runCatching {"},{"type":"INSERT","lineNumber":35,"content":"            val bmp = BitmapFactory.decodeResource(context.resources, R.drawable.d_image_prev_ui)"},{"type":"INSERT","lineNumber":36,"content":"            val sizeDp = 64f"},{"type":"INSERT","lineNumber":37,"content":"            val sizePx = (sizeDp * context.resources.displayMetrics.density).toInt().coerceAtLeast(24)"},{"type":"INSERT","lineNumber":38,"content":"            val scaled = Bitmap.createScaledBitmap(bmp, sizePx, sizePx, true)"},{"type":"INSERT","lineNumber":39,"content":"            BitmapDescriptorFactory.fromBitmap(scaled)"},{"type":"INSERT","lineNumber":40,"content":"        }.getOrNull()"},{"type":"DELETE","lineNumber":28,"oldContent":"    GoogleMap("},{"type":"INSERT","lineNumber":42,"content":""},{"type":"INSERT","lineNumber":44,"content":"    val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":45,"content":"    if (autoCenter && lat != null && lon != null) {"},{"type":"INSERT","lineNumber":46,"content":"        cameraState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f))"},{"type":"INSERT","lineNumber":47,"content":"    }"},{"type":"INSERT","lineNumber":48,"content":""},{"type":"INSERT","lineNumber":49,"content":"    LaunchedEffect(lat, lon) {"},{"type":"INSERT","lineNumber":50,"content":"        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":51,"content":"            val pos = LatLng(lat, lon)"},{"type":"INSERT","lineNumber":52,"content":"            if (visitedPositions.isEmpty() || visitedPositions.last() != pos) {"},{"type":"INSERT","lineNumber":53,"content":"                visitedPositions.add(pos)"},{"type":"INSERT","lineNumber":54,"content":"                val maxLen = 2000"},{"type":"INSERT","lineNumber":55,"content":"                if (visitedPositions.size > maxLen) {"},{"type":"INSERT","lineNumber":56,"content":"                    val removeCount = visitedPositions.size - maxLen"},{"type":"INSERT","lineNumber":57,"content":"                    repeat(removeCount) { visitedPositions.removeAt(0) }"},{"type":"INSERT","lineNumber":58,"content":"                }"},{"type":"INSERT","lineNumber":59,"content":"            }"},{"type":"INSERT","lineNumber":60,"content":"        }"},{"type":"INSERT","lineNumber":61,"content":"    }"},{"type":"INSERT","lineNumber":62,"content":""},{"type":"INSERT","lineNumber":63,"content":"    GoogleMap("},{"type":"DELETE","lineNumber":32,"oldContent":"    val lon = telemetryState.longitude"},{"type":"DELETE","lineNumber":34,"oldContent":""},{"type":"DELETE","lineNumber":37,"oldContent":"        // Live drone marker"},{"type":"INSERT","lineNumber":69,"content":"        // Drone marker using quadcopter image; centered via anchor Offset(0.5f, 0.5f)"},{"type":"DELETE","lineNumber":39,"oldContent":""},{"type":"DELETE","lineNumber":40,"oldContent":"            Marker(state = MarkerState(position = LatLng(lat, lon)), title = \"Drone Location\")"},{"type":"INSERT","lineNumber":71,"content":"            Marker("},{"type":"INSERT","lineNumber":72,"content":"                state = MarkerState(position = LatLng(lat, lon)),"},{"type":"INSERT","lineNumber":73,"content":"                title = \"Drone\","},{"type":"INSERT","lineNumber":74,"content":"                icon = droneIcon ?: BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_AZURE),"},{"type":"INSERT","lineNumber":75,"content":"                anchor = Offset(0.5f, 0.5f)"},{"type":"INSERT","lineNumber":76,"content":"            )"},{"type":"DELETE","lineNumber":42,"oldContent":"            }"},{"type":"DELETE","lineNumber":43,"oldContent":"        // User-drawn markers"},{"type":"INSERT","lineNumber":78,"content":""},{"type":"INSERT","lineNumber":79,"content":"        // Waypoint markers and planned route (blue)"},{"type":"DELETE","lineNumber":47,"oldContent":""},{"type":"DELETE","lineNumber":48,"oldContent":"        // Draw polyline connecting waypoints"},{"type":"DELETE","lineNumber":50,"oldContent":"            Polyline(points = points, width = 4f)"},{"type":"INSERT","lineNumber":84,"content":"            Polyline(points = points, width = 4f, color = Color.Blue)"},{"type":"DELETE","lineNumber":53,"oldContent":"        // If 4 or more points, draw a simple grid over bounding box"},{"type":"INSERT","lineNumber":87,"content":"        // Red polyline showing the drone's traveled path"},{"type":"INSERT","lineNumber":88,"content":"        if (visitedPositions.size > 1) {"},{"type":"INSERT","lineNumber":89,"content":"            Polyline(points = visitedPositions.toList(), width = 6f, color = Color.Red)"},{"type":"INSERT","lineNumber":90,"content":"        }"},{"type":"INSERT","lineNumber":91,"content":""},{"type":"INSERT","lineNumber":92,"content":"        // Optional grid overlay"},{"type":"DELETE","lineNumber":60,"oldContent":"            }"},{"type":"DELETE","lineNumber":63,"oldContent":"            // draw two vertical and two horizontal lines (3x3 grid)"},{"type":"DELETE","lineNumber":66,"oldContent":"        }"},{"type":"DELETE","lineNumber":68,"oldContent":"            // vertical lines"},{"type":"DELETE","lineNumber":72,"oldContent":"            // horizontal lines"},{"type":"INSERT","lineNumber":107,"content":"            }"},{"type":"INSERT","lineNumber":111,"content":"            }"},{"type":"INSERT","lineNumber":112,"content":"        }"},{"type":"INSERT","lineNumber":115,"content":""}]},{"timestamp":1758607494365,"changes":[{"type":"DELETE","lineNumber":0,"oldContent":""},{"type":"DELETE","lineNumber":5,"oldContent":"import androidx.compose.ui.graphics.Color"},{"type":"DELETE","lineNumber":8,"oldContent":"import com.example.aerogcsclone.Telemetry.TelemetryState"},{"type":"DELETE","lineNumber":10,"oldContent":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"DELETE","lineNumber":12,"oldContent":"import com.google.android.gms.maps.model.LatLng"},{"type":"INSERT","lineNumber":8,"content":"import androidx.compose.ui.graphics.Color"},{"type":"DELETE","lineNumber":14,"oldContent":"import com.google.maps.android.compose.*"},{"type":"INSERT","lineNumber":11,"content":"import com.example.aerogcsclone.Telemetry.TelemetryState"},{"type":"INSERT","lineNumber":12,"content":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"INSERT","lineNumber":13,"content":"import com.google.android.gms.maps.model.LatLng"},{"type":"INSERT","lineNumber":14,"content":"import com.google.android.gms.maps.model.BitmapDescriptorFactory"},{"type":"INSERT","lineNumber":15,"content":"import com.google.maps.android.compose.*"},{"type":"INSERT","lineNumber":17,"content":"@Composable"},{"type":"DELETE","lineNumber":19,"oldContent":"import com.google.android.gms.maps.model.BitmapDescriptorFactory"},{"type":"DELETE","lineNumber":21,"oldContent":"@Composable"},{"type":"INSERT","lineNumber":24,"content":"    autoCenter: Boolean = true,"},{"type":"INSERT","lineNumber":25,"content":"    // Grid survey parameters"},{"type":"INSERT","lineNumber":26,"content":"    surveyPolygon: List<LatLng> = emptyList(),"},{"type":"INSERT","lineNumber":27,"content":"    gridLines: List<Pair<LatLng, LatLng>> = emptyList(),"},{"type":"INSERT","lineNumber":28,"content":"    gridWaypoints: List<LatLng> = emptyList()"},{"type":"DELETE","lineNumber":26,"oldContent":"    autoCenter: Boolean = true"},{"type":"DELETE","lineNumber":27,"oldContent":"    val cameraState = cameraPositionState ?: rememberCameraPositionState()"},{"type":"DELETE","lineNumber":29,"oldContent":"    }"},{"type":"INSERT","lineNumber":31,"content":"    val cameraState = cameraPositionState ?: rememberCameraPositionState()"},{"type":"DELETE","lineNumber":31,"oldContent":"    val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":33,"oldContent":"        modifier = Modifier.fillMaxSize(),"},{"type":"DELETE","lineNumber":35,"oldContent":"        cameraPositionState = cameraState,"},{"type":"MODIFY","lineNumber":35,"content":"    // Load quadcopter drawable from res/drawable and scale to dp-based size","oldContent":"    // Load quadcopter drawable from res/drawable/ic_quadcopter.png and scale to dp-based size"},{"type":"DELETE","lineNumber":38,"oldContent":"        properties = MapProperties(mapType = mapType),"},{"type":"DELETE","lineNumber":41,"oldContent":"        onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"DELETE","lineNumber":43,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":46,"oldContent":"        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":49,"oldContent":"        }"},{"type":"INSERT","lineNumber":44,"content":"    }"},{"type":"INSERT","lineNumber":46,"content":"    val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":52,"oldContent":"        points.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":54,"oldContent":"            Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"DELETE","lineNumber":56,"oldContent":"        }"},{"type":"DELETE","lineNumber":60,"oldContent":"        if (points.size > 1) {"},{"type":"DELETE","lineNumber":63,"oldContent":"        }"},{"type":"DELETE","lineNumber":65,"oldContent":""},{"type":"DELETE","lineNumber":68,"oldContent":"        if (points.size >= 4) {"},{"type":"DELETE","lineNumber":70,"oldContent":"            val lats = points.map { it.latitude }"},{"type":"DELETE","lineNumber":72,"oldContent":"            val lons = points.map { it.longitude }"},{"type":"DELETE","lineNumber":74,"oldContent":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":76,"oldContent":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":78,"oldContent":"            val minLon = lons.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":81,"oldContent":"            val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":83,"oldContent":""},{"type":"DELETE","lineNumber":85,"oldContent":"            val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"DELETE","lineNumber":86,"oldContent":"            val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"INSERT","lineNumber":67,"content":"        modifier = Modifier.fillMaxSize(),"},{"type":"INSERT","lineNumber":68,"content":"        cameraPositionState = cameraState,"},{"type":"INSERT","lineNumber":69,"content":"        properties = MapProperties(mapType = mapType),"},{"type":"INSERT","lineNumber":70,"content":"        onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"INSERT","lineNumber":71,"content":"    ) {"},{"type":"DELETE","lineNumber":89,"oldContent":"            lonSteps.forEach { lonVal ->"},{"type":"DELETE","lineNumber":90,"oldContent":"                val line = listOf(LatLng(minLat, lonVal), LatLng(maxLat, lonVal))"},{"type":"INSERT","lineNumber":73,"content":"        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":92,"oldContent":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":95,"oldContent":"            latSteps.forEach { latVal ->"},{"type":"DELETE","lineNumber":97,"oldContent":"                val line = listOf(LatLng(latVal, minLon), LatLng(latVal, maxLon))"},{"type":"DELETE","lineNumber":99,"oldContent":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":101,"oldContent":"    }"},{"type":"DELETE","lineNumber":102,"oldContent":"}"},{"type":"INSERT","lineNumber":80,"content":"        }"},{"type":"DELETE","lineNumber":104,"oldContent":""},{"type":"DELETE","lineNumber":105,"oldContent":"        // Waypoint markers and planned route (blue)"},{"type":"INSERT","lineNumber":82,"content":"        // Regular waypoint markers and planned route (blue)"},{"type":"INSERT","lineNumber":83,"content":"        if (points.isNotEmpty() && surveyPolygon.isEmpty()) {"},{"type":"INSERT","lineNumber":84,"content":"            points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":85,"content":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":86,"content":"            }"},{"type":"INSERT","lineNumber":87,"content":"            if (points.size > 1) {"},{"type":"INSERT","lineNumber":88,"content":"                Polyline(points = points, width = 4f, color = Color.Blue)"},{"type":"INSERT","lineNumber":89,"content":"            }"},{"type":"INSERT","lineNumber":91,"content":""},{"type":"INSERT","lineNumber":92,"content":"        // Survey polygon outline (purple)"},{"type":"INSERT","lineNumber":93,"content":"        if (surveyPolygon.isNotEmpty()) {"},{"type":"INSERT","lineNumber":94,"content":"            surveyPolygon.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":95,"content":"                Marker("},{"type":"INSERT","lineNumber":96,"content":"                    state = MarkerState(position = point),"},{"type":"INSERT","lineNumber":97,"content":"                    title = \"P${index + 1}\","},{"type":"INSERT","lineNumber":98,"content":"                    icon = BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_VIOLET)"},{"type":"INSERT","lineNumber":99,"content":"                )"},{"type":"INSERT","lineNumber":101,"content":"            "},{"type":"INSERT","lineNumber":102,"content":"            if (surveyPolygon.size > 2) {"},{"type":"INSERT","lineNumber":103,"content":"                // Close the polygon by connecting last point to first"},{"type":"INSERT","lineNumber":104,"content":"                val closedPolygon = surveyPolygon + surveyPolygon.first()"},{"type":"INSERT","lineNumber":105,"content":"                Polyline(points = closedPolygon, width = 3f, color = Color.Magenta)"},{"type":"INSERT","lineNumber":106,"content":"            } else if (surveyPolygon.size == 2) {"},{"type":"INSERT","lineNumber":107,"content":"                Polyline(points = surveyPolygon, width = 3f, color = Color.Magenta)"},{"type":"MODIFY","lineNumber":109,"content":"        }","oldContent":"        // Optional grid overlay"},{"type":"MODIFY","lineNumber":111,"content":"        // Grid lines (green)","oldContent":"            Polyline(points = points, width = 4f, color = Color.Blue)"},{"type":"INSERT","lineNumber":112,"content":"        gridLines.forEach { (start, end) ->"},{"type":"INSERT","lineNumber":113,"content":"            Polyline("},{"type":"INSERT","lineNumber":114,"content":"                points = listOf(start, end),"},{"type":"INSERT","lineNumber":115,"content":"                width = 2f,"},{"type":"INSERT","lineNumber":116,"content":"                color = Color.Green"},{"type":"INSERT","lineNumber":117,"content":"            )"},{"type":"DELETE","lineNumber":113,"oldContent":"            Polyline(points = visitedPositions.toList(), width = 6f, color = Color.Red)"},{"type":"DELETE","lineNumber":114,"oldContent":"        if (visitedPositions.size > 1) {"},{"type":"INSERT","lineNumber":119,"content":""},{"type":"INSERT","lineNumber":120,"content":"        // Grid waypoints (small orange markers)"},{"type":"INSERT","lineNumber":121,"content":"        gridWaypoints.forEachIndexed { index, waypoint ->"},{"type":"INSERT","lineNumber":122,"content":"            Marker("},{"type":"INSERT","lineNumber":123,"content":"                state = MarkerState(position = waypoint),"},{"type":"INSERT","lineNumber":124,"content":"                title = \"G${index + 1}\","},{"type":"INSERT","lineNumber":125,"content":"                icon = BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_ORANGE),"},{"type":"INSERT","lineNumber":126,"content":"                anchor = Offset(0.5f, 0.5f)"},{"type":"INSERT","lineNumber":127,"content":"            )"},{"type":"INSERT","lineNumber":128,"content":"        }"},{"type":"INSERT","lineNumber":129,"content":""},{"type":"INSERT","lineNumber":131,"content":"        if (visitedPositions.size > 1) {"},{"type":"INSERT","lineNumber":132,"content":"            Polyline(points = visitedPositions.toList(), width = 6f, color = Color.Red)"},{"type":"INSERT","lineNumber":133,"content":"        }"},{"type":"INSERT","lineNumber":134,"content":""},{"type":"INSERT","lineNumber":135,"content":"        // Optional grid overlay for regular waypoints"},{"type":"INSERT","lineNumber":136,"content":"        if (points.size >= 4 && surveyPolygon.isEmpty()) {"},{"type":"INSERT","lineNumber":137,"content":"            val lats = points.map { it.latitude }"},{"type":"INSERT","lineNumber":138,"content":"            val lons = points.map { it.longitude }"},{"type":"INSERT","lineNumber":139,"content":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":140,"content":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":141,"content":"            val minLon = lons.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":142,"content":"            val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":143,"content":""},{"type":"INSERT","lineNumber":144,"content":"            val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"INSERT","lineNumber":145,"content":"            val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"INSERT","lineNumber":146,"content":""},{"type":"INSERT","lineNumber":147,"content":"            lonSteps.forEach { lonVal ->"},{"type":"INSERT","lineNumber":148,"content":"                val line = listOf(LatLng(minLat, lonVal), LatLng(maxLat, lonVal))"},{"type":"INSERT","lineNumber":149,"content":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"INSERT","lineNumber":150,"content":"            }"},{"type":"INSERT","lineNumber":151,"content":"            latSteps.forEach { latVal ->"},{"type":"INSERT","lineNumber":152,"content":"                val line = listOf(LatLng(latVal, minLon), LatLng(latVal, maxLon))"},{"type":"INSERT","lineNumber":153,"content":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"INSERT","lineNumber":154,"content":"            }"},{"type":"INSERT","lineNumber":155,"content":"        }"},{"type":"INSERT","lineNumber":156,"content":"    }"},{"type":"INSERT","lineNumber":157,"content":"}"},{"type":"INSERT","lineNumber":158,"content":""}]},{"timestamp":1758607845289,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"import androidx.compose.ui.graphics.Color"},{"type":"MODIFY","lineNumber":8,"content":"import androidx.compose.ui.graphics.Color","oldContent":"import com.example.aerogcsclone.Telemetry.TelemetryState"},{"type":"INSERT","lineNumber":9,"content":"import androidx.compose.ui.platform.LocalContext"},{"type":"INSERT","lineNumber":10,"content":"import com.example.aerogcsclone.R"},{"type":"INSERT","lineNumber":11,"content":"import com.example.aerogcsclone.Telemetry.TelemetryState"},{"type":"DELETE","lineNumber":12,"oldContent":"import androidx.compose.ui.platform.LocalContext"},{"type":"DELETE","lineNumber":15,"oldContent":"import com.example.aerogcsclone.R"},{"type":"MODIFY","lineNumber":24,"content":"    autoCenter: Boolean = true,","oldContent":"    autoCenter: Boolean = true,"},{"type":"DELETE","lineNumber":26,"oldContent":") {"},{"type":"INSERT","lineNumber":29,"content":") {"},{"type":"MODIFY","lineNumber":32,"content":"","oldContent":""},{"type":"DELETE","lineNumber":40,"oldContent":"    }"},{"type":"DELETE","lineNumber":43,"oldContent":"    val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":44,"content":"    }"},{"type":"INSERT","lineNumber":46,"content":"    val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":57,"oldContent":"        modifier = Modifier.fillMaxSize(),"},{"type":"DELETE","lineNumber":59,"oldContent":"        cameraPositionState = cameraState,"},{"type":"DELETE","lineNumber":60,"oldContent":"        properties = MapProperties(mapType = mapType),"},{"type":"DELETE","lineNumber":62,"oldContent":"        onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"DELETE","lineNumber":63,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":65,"oldContent":"        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":70,"oldContent":"        }"},{"type":"DELETE","lineNumber":72,"oldContent":"        // Regular waypoint markers and planned route (blue)"},{"type":"INSERT","lineNumber":66,"content":"    GoogleMap("},{"type":"INSERT","lineNumber":67,"content":"        modifier = Modifier.fillMaxSize(),"},{"type":"INSERT","lineNumber":68,"content":"        cameraPositionState = cameraState,"},{"type":"INSERT","lineNumber":69,"content":"        properties = MapProperties(mapType = mapType),"},{"type":"INSERT","lineNumber":70,"content":"        onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"INSERT","lineNumber":71,"content":"    ) {"},{"type":"INSERT","lineNumber":72,"content":"        // Drone marker using quadcopter image; centered via anchor Offset(0.5f, 0.5f)"},{"type":"INSERT","lineNumber":73,"content":"        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":74,"content":"            Marker("},{"type":"INSERT","lineNumber":75,"content":"                state = MarkerState(position = LatLng(lat, lon)),"},{"type":"INSERT","lineNumber":76,"content":"                title = \"Drone\","},{"type":"INSERT","lineNumber":77,"content":"                icon = droneIcon ?: BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_AZURE),"},{"type":"INSERT","lineNumber":78,"content":"                anchor = Offset(0.5f, 0.5f)"},{"type":"INSERT","lineNumber":79,"content":"            )"},{"type":"INSERT","lineNumber":80,"content":"        }"},{"type":"INSERT","lineNumber":81,"content":""},{"type":"INSERT","lineNumber":82,"content":"        // Regular waypoint markers and planned route (blue)"},{"type":"DELETE","lineNumber":76,"oldContent":"    GoogleMap("},{"type":"DELETE","lineNumber":81,"oldContent":"        // Drone marker using quadcopter image; centered via anchor Offset(0.5f, 0.5f)"},{"type":"INSERT","lineNumber":90,"content":"        }"},{"type":"DELETE","lineNumber":84,"oldContent":"            Marker("},{"type":"DELETE","lineNumber":87,"oldContent":"                state = MarkerState(position = LatLng(lat, lon)),"},{"type":"DELETE","lineNumber":89,"oldContent":"                title = \"Drone\","},{"type":"DELETE","lineNumber":92,"oldContent":"                icon = droneIcon ?: BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_AZURE),"},{"type":"DELETE","lineNumber":95,"oldContent":"                anchor = Offset(0.5f, 0.5f)"},{"type":"DELETE","lineNumber":97,"oldContent":"            )"},{"type":"DELETE","lineNumber":98,"oldContent":"            "},{"type":"INSERT","lineNumber":100,"content":"            }"},{"type":"INSERT","lineNumber":101,"content":""},{"type":"DELETE","lineNumber":101,"oldContent":""},{"type":"DELETE","lineNumber":105,"oldContent":"        }"},{"type":"DELETE","lineNumber":108,"oldContent":"            }"},{"type":"DELETE","lineNumber":113,"oldContent":"        }"},{"type":"DELETE","lineNumber":117,"oldContent":"        // Red polyline showing the drone's traveled path"},{"type":"DELETE","lineNumber":119,"oldContent":""},{"type":"DELETE","lineNumber":121,"oldContent":"}"},{"type":"DELETE","lineNumber":122,"oldContent":"    }"},{"type":"DELETE","lineNumber":123,"oldContent":""},{"type":"INSERT","lineNumber":119,"content":""},{"type":"DELETE","lineNumber":126,"oldContent":"            }"},{"type":"DELETE","lineNumber":128,"oldContent":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":130,"oldContent":"                val line = listOf(LatLng(latVal, minLon), LatLng(latVal, maxLon))"},{"type":"DELETE","lineNumber":132,"oldContent":"            latSteps.forEach { latVal ->"},{"type":"DELETE","lineNumber":134,"oldContent":"            }"},{"type":"DELETE","lineNumber":136,"oldContent":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"DELETE","lineNumber":138,"oldContent":"                val line = listOf(LatLng(minLat, lonVal), LatLng(maxLat, lonVal))"},{"type":"DELETE","lineNumber":140,"oldContent":"            lonSteps.forEach { lonVal ->"},{"type":"DELETE","lineNumber":143,"oldContent":""},{"type":"DELETE","lineNumber":144,"oldContent":"            val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"DELETE","lineNumber":145,"oldContent":"            val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"INSERT","lineNumber":130,"content":"        // Red polyline showing the drone's traveled path"},{"type":"DELETE","lineNumber":147,"oldContent":""},{"type":"DELETE","lineNumber":149,"oldContent":"            val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":151,"oldContent":"            val minLon = lons.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":153,"oldContent":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":155,"oldContent":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":157,"oldContent":"            val lons = points.map { it.longitude }"},{"type":"INSERT","lineNumber":138,"content":"            val lons = points.map { it.longitude }"},{"type":"INSERT","lineNumber":139,"content":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":140,"content":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":141,"content":"            val minLon = lons.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":142,"content":"            val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":143,"content":""},{"type":"INSERT","lineNumber":144,"content":"            val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"INSERT","lineNumber":145,"content":"            val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"INSERT","lineNumber":146,"content":""},{"type":"INSERT","lineNumber":147,"content":"            lonSteps.forEach { lonVal ->"},{"type":"INSERT","lineNumber":148,"content":"                val line = listOf(LatLng(minLat, lonVal), LatLng(maxLat, lonVal))"},{"type":"INSERT","lineNumber":149,"content":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"INSERT","lineNumber":150,"content":"            }"},{"type":"INSERT","lineNumber":151,"content":"            latSteps.forEach { latVal ->"},{"type":"INSERT","lineNumber":152,"content":"                val line = listOf(LatLng(latVal, minLon), LatLng(latVal, maxLon))"},{"type":"INSERT","lineNumber":153,"content":"                Polyline(points = line, width = 2f, color = Color.Gray)"},{"type":"INSERT","lineNumber":154,"content":"            }"},{"type":"INSERT","lineNumber":155,"content":"        }"},{"type":"INSERT","lineNumber":156,"content":"    }"},{"type":"INSERT","lineNumber":157,"content":"}"},{"type":"INSERT","lineNumber":158,"content":""}]},{"timestamp":1758609916072,"changes":[{"type":"INSERT","lineNumber":7,"content":"import androidx.compose.ui.geometry.Offset"},{"type":"DELETE","lineNumber":9,"oldContent":"import androidx.compose.ui.geometry.Offset"},{"type":"MODIFY","lineNumber":12,"content":"import com.google.android.gms.maps.CameraUpdateFactory","oldContent":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"INSERT","lineNumber":23,"content":"    mapType: MapType = MapType.NORMAL,"},{"type":"DELETE","lineNumber":24,"oldContent":"    autoCenter: Boolean = true,"},{"type":"MODIFY","lineNumber":29,"content":") {","oldContent":") {"},{"type":"INSERT","lineNumber":31,"content":"    val cameraState = cameraPositionState ?: rememberCameraPositionState()"},{"type":"DELETE","lineNumber":32,"oldContent":""},{"type":"DELETE","lineNumber":42,"oldContent":"    }"},{"type":"DELETE","lineNumber":45,"oldContent":"    val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":44,"content":"    }"},{"type":"INSERT","lineNumber":46,"content":"    val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":60,"oldContent":"    GoogleMap("},{"type":"DELETE","lineNumber":62,"oldContent":"        modifier = Modifier.fillMaxSize(),"},{"type":"DELETE","lineNumber":64,"oldContent":"        cameraPositionState = cameraState,"},{"type":"DELETE","lineNumber":66,"oldContent":"        properties = MapProperties(mapType = mapType),"},{"type":"INSERT","lineNumber":64,"content":"    }"},{"type":"INSERT","lineNumber":65,"content":""},{"type":"INSERT","lineNumber":66,"content":"    GoogleMap("},{"type":"INSERT","lineNumber":67,"content":"        modifier = Modifier.fillMaxSize(),"},{"type":"INSERT","lineNumber":68,"content":"        cameraPositionState = cameraState,"},{"type":"INSERT","lineNumber":69,"content":"        properties = MapProperties(mapType = mapType),"},{"type":"DELETE","lineNumber":70,"oldContent":"    }"},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"DELETE","lineNumber":75,"oldContent":"        if (points.isNotEmpty() && surveyPolygon.isEmpty()) {"},{"type":"DELETE","lineNumber":77,"oldContent":"            points.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":80,"oldContent":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"DELETE","lineNumber":82,"oldContent":"            }"},{"type":"DELETE","lineNumber":84,"oldContent":"            if (points.size > 1) {"},{"type":"DELETE","lineNumber":86,"oldContent":"                Polyline(points = points, width = 4f, color = Color.Blue)"},{"type":"INSERT","lineNumber":83,"content":"        if (points.isNotEmpty() && surveyPolygon.isEmpty()) {"},{"type":"INSERT","lineNumber":84,"content":"            points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":85,"content":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":87,"content":"            if (points.size > 1) {"},{"type":"INSERT","lineNumber":88,"content":"                Polyline(points = points, width = 4f, color = Color.Blue)"},{"type":"INSERT","lineNumber":89,"content":"            }"},{"type":"INSERT","lineNumber":90,"content":"        }"},{"type":"DELETE","lineNumber":94,"oldContent":"        }"},{"type":"DELETE","lineNumber":100,"oldContent":"            if (surveyPolygon.size > 2) {"},{"type":"MODIFY","lineNumber":102,"content":"            if (surveyPolygon.size > 2) {","oldContent":"                // Close the polygon by connecting last point to first"},{"type":"INSERT","lineNumber":103,"content":"                // Close the polygon by connecting last point to first"},{"type":"DELETE","lineNumber":117,"oldContent":""},{"type":"INSERT","lineNumber":119,"content":""},{"type":"DELETE","lineNumber":123,"oldContent":"        // Red polyline showing the drone's traveled path"},{"type":"INSERT","lineNumber":127,"content":"            )"},{"type":"INSERT","lineNumber":128,"content":"        }"},{"type":"INSERT","lineNumber":129,"content":""},{"type":"INSERT","lineNumber":130,"content":"        // Red polyline showing the drone's traveled path"},{"type":"INSERT","lineNumber":131,"content":"        if (visitedPositions.size > 1) {"},{"type":"INSERT","lineNumber":132,"content":"            Polyline(points = visitedPositions.toList(), width = 6f, color = Color.Red)"},{"type":"INSERT","lineNumber":133,"content":"        }"},{"type":"INSERT","lineNumber":134,"content":""},{"type":"INSERT","lineNumber":135,"content":"        // Optional grid overlay for regular waypoints"},{"type":"INSERT","lineNumber":136,"content":"        if (points.size >= 4 && surveyPolygon.isEmpty()) {"},{"type":"INSERT","lineNumber":137,"content":"            val lats = points.map { it.latitude }"},{"type":"DELETE","lineNumber":130,"oldContent":"            )"},{"type":"DELETE","lineNumber":133,"oldContent":"        }"},{"type":"DELETE","lineNumber":136,"oldContent":""},{"type":"DELETE","lineNumber":140,"oldContent":"        if (visitedPositions.size > 1) {"},{"type":"DELETE","lineNumber":143,"oldContent":"            Polyline(points = visitedPositions.toList(), width = 6f, color = Color.Red)"},{"type":"DELETE","lineNumber":146,"oldContent":"        }"},{"type":"DELETE","lineNumber":149,"oldContent":""},{"type":"DELETE","lineNumber":152,"oldContent":"        // Optional grid overlay for regular waypoints"},{"type":"DELETE","lineNumber":155,"oldContent":"        if (points.size >= 4 && surveyPolygon.isEmpty()) {"},{"type":"DELETE","lineNumber":158,"oldContent":"            val lats = points.map { it.latitude }"}]},{"timestamp":1758686783310,"changes":[{"type":"INSERT","lineNumber":11,"content":"import com.example.aerogcsclone.Telemetry.TelemetryState"},{"type":"DELETE","lineNumber":12,"oldContent":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"INSERT","lineNumber":28,"content":"    gridWaypoints: List<LatLng> = emptyList(),"},{"type":"INSERT","lineNumber":29,"content":"    heading: Float? = null"},{"type":"DELETE","lineNumber":29,"oldContent":") {"},{"type":"DELETE","lineNumber":43,"oldContent":"    }"},{"type":"MODIFY","lineNumber":45,"content":"    }","oldContent":"    val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":47,"content":"    val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":63,"content":"            }"},{"type":"INSERT","lineNumber":64,"content":"        }"},{"type":"DELETE","lineNumber":64,"oldContent":"            }"},{"type":"DELETE","lineNumber":67,"oldContent":"        }"},{"type":"DELETE","lineNumber":69,"oldContent":"        onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"INSERT","lineNumber":71,"content":"        onMapClick = { latLng -> onMapClick(latLng) }"},{"type":"DELETE","lineNumber":78,"oldContent":"                anchor = Offset(0.5f, 0.5f)"},{"type":"MODIFY","lineNumber":79,"content":"                anchor = Offset(0.5f, 0.5f),","oldContent":"        if (points.isNotEmpty() && surveyPolygon.isEmpty()) {"},{"type":"INSERT","lineNumber":80,"content":"                rotation = heading ?: 0f"},{"type":"INSERT","lineNumber":82,"content":"        }"},{"type":"INSERT","lineNumber":83,"content":""},{"type":"INSERT","lineNumber":84,"content":"        // Regular waypoint markers and planned route (blue)"},{"type":"INSERT","lineNumber":85,"content":"        if (points.isNotEmpty() && surveyPolygon.isEmpty()) {"},{"type":"DELETE","lineNumber":83,"oldContent":"        }"},{"type":"INSERT","lineNumber":88,"content":"            }"},{"type":"DELETE","lineNumber":85,"oldContent":""},{"type":"DELETE","lineNumber":87,"oldContent":"        // Regular waypoint markers and planned route (blue)"},{"type":"DELETE","lineNumber":89,"oldContent":"            }"},{"type":"INSERT","lineNumber":103,"content":""},{"type":"DELETE","lineNumber":103,"oldContent":""},{"type":"DELETE","lineNumber":118,"oldContent":""},{"type":"INSERT","lineNumber":121,"content":""},{"type":"DELETE","lineNumber":126,"oldContent":"            )"},{"type":"INSERT","lineNumber":129,"content":"            )"},{"type":"DELETE","lineNumber":129,"oldContent":"            val lons = points.map { it.longitude }"},{"type":"DELETE","lineNumber":131,"oldContent":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":134,"oldContent":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":136,"oldContent":"            val minLon = lons.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":139,"oldContent":"            val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":141,"oldContent":""},{"type":"INSERT","lineNumber":140,"content":"            val lons = points.map { it.longitude }"},{"type":"INSERT","lineNumber":141,"content":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":142,"content":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":143,"content":"            val minLon = lons.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":144,"content":"            val maxLon = lons.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":145,"content":""}]},{"timestamp":1758691151619,"changes":[{"type":"MODIFY","lineNumber":30,"content":") {","oldContent":") {"},{"type":"DELETE","lineNumber":63,"oldContent":"    }"},{"type":"MODIFY","lineNumber":65,"content":"    }","oldContent":""},{"type":"INSERT","lineNumber":66,"content":""},{"type":"DELETE","lineNumber":82,"oldContent":"            points.forEachIndexed { index, point ->"},{"type":"DELETE","lineNumber":84,"oldContent":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"DELETE","lineNumber":87,"oldContent":"            if (points.size > 1) {"},{"type":"DELETE","lineNumber":89,"oldContent":"                Polyline(points = points, width = 4f, color = Color.Blue)"},{"type":"INSERT","lineNumber":86,"content":"            points.forEachIndexed { index, point ->"},{"type":"INSERT","lineNumber":87,"content":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":89,"content":"            if (points.size > 1) {"},{"type":"INSERT","lineNumber":90,"content":"                key(points) {"},{"type":"INSERT","lineNumber":91,"content":"                    Polyline(points = points, width = 4f, color = Color.Blue)"},{"type":"INSERT","lineNumber":92,"content":"                }"},{"type":"INSERT","lineNumber":105,"content":""},{"type":"DELETE","lineNumber":105,"oldContent":""},{"type":"DELETE","lineNumber":121,"oldContent":"        // Grid waypoints (small orange markers)"},{"type":"INSERT","lineNumber":124,"content":"        // Grid waypoints (small orange markers)"},{"type":"DELETE","lineNumber":129,"oldContent":"        }"},{"type":"INSERT","lineNumber":132,"content":"        }"},{"type":"DELETE","lineNumber":137,"oldContent":"            val lons = points.map { it.longitude }"},{"type":"INSERT","lineNumber":140,"content":"        if (points.size >= 4 && surveyPolygon.isEmpty()) {"},{"type":"INSERT","lineNumber":141,"content":"            val lats = points.map { it.latitude }"},{"type":"INSERT","lineNumber":142,"content":"            val lons = points.map { it.longitude }"},{"type":"DELETE","lineNumber":141,"oldContent":"        if (points.size >= 4 && surveyPolygon.isEmpty()) {"},{"type":"DELETE","lineNumber":143,"oldContent":"            val lats = points.map { it.latitude }"},{"type":"DELETE","lineNumber":145,"oldContent":"            val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"},{"type":"INSERT","lineNumber":148,"content":"            val latSteps = listOf(minLat, (minLat + maxLat) / 2.0, maxLat)"}]},{"timestamp":1758692383051,"changes":[{"type":"INSERT","lineNumber":29,"content":"    heading: Float? = null"},{"type":"DELETE","lineNumber":30,"oldContent":") {"},{"type":"INSERT","lineNumber":64,"content":"        }"},{"type":"DELETE","lineNumber":66,"oldContent":"        }"},{"type":"DELETE","lineNumber":84,"oldContent":"            points.forEachIndexed { index, point ->"},{"type":"MODIFY","lineNumber":86,"content":"            points.forEachIndexed { index, point ->","oldContent":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":87,"content":"                Marker(state = MarkerState(position = point), title = \"WP ${index + 1}\")"},{"type":"INSERT","lineNumber":88,"content":"            }"},{"type":"DELETE","lineNumber":90,"oldContent":"            }"},{"type":"MODIFY","lineNumber":93,"content":"            }","oldContent":"            }"},{"type":"INSERT","lineNumber":105,"content":""},{"type":"DELETE","lineNumber":107,"oldContent":""},{"type":"DELETE","lineNumber":124,"oldContent":"        gridWaypoints.forEachIndexed { index, waypoint ->"},{"type":"DELETE","lineNumber":125,"oldContent":"        // Grid waypoints (small orange markers)"},{"type":"DELETE","lineNumber":126,"oldContent":"            Marker("},{"type":"DELETE","lineNumber":127,"oldContent":"                state = MarkerState(position = waypoint),"},{"type":"DELETE","lineNumber":128,"oldContent":"                title = \"G${index + 1}\","},{"type":"DELETE","lineNumber":129,"oldContent":"                icon = BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_ORANGE),"},{"type":"DELETE","lineNumber":130,"oldContent":"                anchor = Offset(0.5f, 0.5f)"},{"type":"DELETE","lineNumber":131,"oldContent":"            )"},{"type":"DELETE","lineNumber":132,"oldContent":""},{"type":"INSERT","lineNumber":124,"content":"        // Grid waypoints (first: S/green, last: E/red, others: orange)"},{"type":"INSERT","lineNumber":125,"content":"        if (gridWaypoints.isNotEmpty()) {"},{"type":"INSERT","lineNumber":126,"content":"            gridWaypoints.forEachIndexed { index, waypoint ->"},{"type":"INSERT","lineNumber":127,"content":"                val isFirst = index == 0"},{"type":"INSERT","lineNumber":128,"content":"                val isLast = index == gridWaypoints.lastIndex"},{"type":"INSERT","lineNumber":129,"content":"                val (title, color) = when {"},{"type":"INSERT","lineNumber":130,"content":"                    isFirst -> \"S\" to BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_GREEN)"},{"type":"INSERT","lineNumber":131,"content":"                    isLast -> \"E\" to BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_RED)"},{"type":"INSERT","lineNumber":132,"content":"                    else -> \"G${index + 1}\" to BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_ORANGE)"},{"type":"INSERT","lineNumber":133,"content":"                }"},{"type":"INSERT","lineNumber":134,"content":"                Marker("},{"type":"INSERT","lineNumber":135,"content":"                    state = MarkerState(position = waypoint),"},{"type":"INSERT","lineNumber":136,"content":"                    title = title,"},{"type":"INSERT","lineNumber":137,"content":"                    icon = color,"},{"type":"INSERT","lineNumber":138,"content":"                    anchor = Offset(0.5f, 0.5f)"},{"type":"INSERT","lineNumber":139,"content":"                )"},{"type":"INSERT","lineNumber":140,"content":"            }"},{"type":"INSERT","lineNumber":142,"content":""},{"type":"DELETE","lineNumber":140,"oldContent":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":142,"oldContent":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":152,"content":"            val minLat = lats.minOrNull() ?: 0.0"},{"type":"INSERT","lineNumber":153,"content":"            val maxLat = lats.maxOrNull() ?: 0.0"},{"type":"DELETE","lineNumber":148,"oldContent":"            val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"},{"type":"INSERT","lineNumber":158,"content":"            val lonSteps = listOf(minLon, (minLon + maxLon) / 2.0, maxLon)"}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/SharedViewModel.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/SharedViewModel.kt","baseContent":"package com.example.aerogcsclone.Telemetry\n\nimport androidx.compose.runtime.getValue\nimport androidx.compose.runtime.mutableStateOf\nimport androidx.compose.runtime.setValue\nimport androidx.lifecycle.ViewModel\nimport androidx.lifecycle.viewModelScope\nimport kotlinx.coroutines.flow.Flow\nimport kotlinx.coroutines.flow.StateFlow\nimport kotlinx.coroutines.flow.combine\nimport kotlinx.coroutines.launch\n\nclass SharedViewModel : ViewModel() {\n\n    var ipAddress by mutableStateOf(\"10.0.2.2\")\n    var port by mutableStateOf(\"5762\")\n\n    private var repo: MavlinkTelemetryRepository? = null\n\n    private val _telemetryState = mutableStateOf(TelemetryState())\n    val telemetryState: StateFlow<TelemetryState> = _telemetryState\n\n    val isConnected: Flow<ERROR> = telemetryState.combine(repo?.state) { state, repoState ->\n        state.connected || repoState?.connected == true\n    }\n\n\n    fun connect() {\n        viewModelScope.launch {\n            val portInt = port.toIntOrNull()\n            if (portInt != null) {\n                val newRepo = MavlinkTelemetryRepository(ipAddress, portInt)\n                repo = newRepo\n                newRepo.start()\n                newRepo.state.collect {\n                    _telemetryState.value = it\n                }\n            }\n        }\n    }\n}\n","baseTimestamp":1757400233339,"deltas":[{"timestamp":1758177188665,"changes":[{"type":"MODIFY","lineNumber":31,"content":"","oldContent":"                val newRepo = MavlinkTelemetryRepository(ipAddress, portInt)"},{"type":"DELETE","lineNumber":36,"oldContent":"    // Mission timer state"},{"type":"DELETE","lineNumber":38,"oldContent":"    private val _missionElapsedTime = MutableStateFlow<Long>(0)"},{"type":"DELETE","lineNumber":40,"oldContent":"    val missionElapsedTime: StateFlow<Long> = _missionElapsedTime.asStateFlow()"},{"type":"DELETE","lineNumber":42,"oldContent":"    private val _isMissionActive = MutableStateFlow<Boolean>(false)"},{"type":"DELETE","lineNumber":44,"oldContent":"    val isMissionActive: StateFlow<Boolean> = _isMissionActive.asStateFlow()"},{"type":"DELETE","lineNumber":46,"oldContent":"    private var timerJob: kotlinx.coroutines.Job? = null"},{"type":"DELETE","lineNumber":48,"oldContent":""},{"type":"INSERT","lineNumber":50,"content":"                // Collect telemetry state"},{"type":"INSERT","lineNumber":56,"content":"        // Subscribe to mission end events and stop timer"},{"type":"INSERT","lineNumber":57,"content":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":58,"content":"            repo?.missionEndedEvents?.collect {"},{"type":"INSERT","lineNumber":59,"content":"                stopMissionTimer()"},{"type":"INSERT","lineNumber":60,"content":"            }"},{"type":"INSERT","lineNumber":61,"content":"        }"},{"type":"MODIFY","lineNumber":65,"content":"            try {","oldContent":"    fun readMissionFromFcu() {"},{"type":"INSERT","lineNumber":67,"content":""},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"MODIFY","lineNumber":82,"content":"                }","oldContent":"                delay(1000)"},{"type":"MODIFY","lineNumber":87,"content":"                if (success) {","oldContent":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":109,"content":"                onResult(false, e.message)"},{"type":"DELETE","lineNumber":115,"oldContent":"                onResult(false, e.message)"},{"type":"INSERT","lineNumber":124,"content":""},{"type":"DELETE","lineNumber":130,"oldContent":""},{"type":"MODIFY","lineNumber":132,"content":"                if (!missionUploaded || lastUploadedCount == 0) {","oldContent":"            if (repo == null) {"},{"type":"MODIFY","lineNumber":136,"content":"                }","oldContent":"        }"},{"type":"INSERT","lineNumber":139,"content":"                // Check basic prerequisites"},{"type":"DELETE","lineNumber":141,"oldContent":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":142,"content":"                    onResult(false, \"Vehicle not armable. Check sensors and GPS.\")"},{"type":"INSERT","lineNumber":143,"content":"                    return@launch"},{"type":"DELETE","lineNumber":143,"oldContent":"                // Check basic prerequisites"},{"type":"INSERT","lineNumber":145,"content":""},{"type":"DELETE","lineNumber":147,"oldContent":"                    onResult(false, \"Vehicle not armable. Check sensors and GPS.\")"},{"type":"DELETE","lineNumber":150,"oldContent":""},{"type":"INSERT","lineNumber":153,"content":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"INSERT","lineNumber":154,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":157,"oldContent":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"DELETE","lineNumber":158,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":162,"content":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":163,"content":"                    val modeTimeout = 5000L"},{"type":"INSERT","lineNumber":164,"content":"                    val modeStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":166,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"DELETE","lineNumber":168,"oldContent":"                    val modeTimeout = 5000L"},{"type":"DELETE","lineNumber":170,"oldContent":"                    val modeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":180,"content":"                    Log.i(\"SharedVM\", \"✓ Already in suitable mode for arming: $currentMode\")"},{"type":"DELETE","lineNumber":184,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Already in suitable mode for arming: $currentMode\")"},{"type":"INSERT","lineNumber":187,"content":""},{"type":"INSERT","lineNumber":188,"content":"                    // Wait for arming with increased timeout"},{"type":"INSERT","lineNumber":189,"content":"                    val armTimeout = 10000L"},{"type":"DELETE","lineNumber":192,"oldContent":""},{"type":"DELETE","lineNumber":193,"oldContent":"                    // Wait for arming with increased timeout"},{"type":"DELETE","lineNumber":195,"oldContent":"                    val armTimeout = 10000L"},{"type":"INSERT","lineNumber":202,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle already armed\")"},{"type":"DELETE","lineNumber":206,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already armed\")"},{"type":"INSERT","lineNumber":210,"content":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"INSERT","lineNumber":211,"content":"                    val autoModeTimeout = 8000L"},{"type":"INSERT","lineNumber":212,"content":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":213,"content":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"DELETE","lineNumber":213,"oldContent":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"INSERT","lineNumber":217,"content":""},{"type":"DELETE","lineNumber":215,"oldContent":"                    val autoModeTimeout = 8000L"},{"type":"DELETE","lineNumber":217,"oldContent":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":219,"oldContent":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"INSERT","lineNumber":222,"content":"                    }"},{"type":"DELETE","lineNumber":223,"oldContent":""},{"type":"INSERT","lineNumber":226,"content":"                }"},{"type":"DELETE","lineNumber":228,"oldContent":"                    }"},{"type":"DELETE","lineNumber":231,"oldContent":"                }"},{"type":"INSERT","lineNumber":234,"content":""},{"type":"DELETE","lineNumber":240,"oldContent":""},{"type":"INSERT","lineNumber":242,"content":""},{"type":"DELETE","lineNumber":244,"oldContent":"                    // Start timer"},{"type":"DELETE","lineNumber":246,"oldContent":"                    _isMissionActive.value = true"},{"type":"DELETE","lineNumber":248,"oldContent":"                    _missionElapsedTime.value = 0"},{"type":"DELETE","lineNumber":249,"oldContent":"                    timerJob?.cancel()"},{"type":"DELETE","lineNumber":251,"oldContent":"                    timerJob = viewModelScope.launch {"},{"type":"DELETE","lineNumber":253,"oldContent":"                        while (_isMissionActive.value) {"},{"type":"DELETE","lineNumber":255,"oldContent":"                            delay(1000)"},{"type":"DELETE","lineNumber":256,"oldContent":"                            _missionElapsedTime.value += 1"},{"type":"DELETE","lineNumber":258,"oldContent":"                        }"},{"type":"DELETE","lineNumber":259,"oldContent":"                    }"},{"type":"INSERT","lineNumber":253,"content":"            if (repo == null) {"},{"type":"DELETE","lineNumber":263,"oldContent":""},{"type":"INSERT","lineNumber":256,"content":"            }"},{"type":"INSERT","lineNumber":257,"content":"            try {"},{"type":"INSERT","lineNumber":258,"content":"                repo?.requestMissionAndLog()"},{"type":"INSERT","lineNumber":260,"content":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"DELETE","lineNumber":270,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"DELETE","lineNumber":271,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":272,"oldContent":"    // Call this to stop the timer when mission ends"},{"type":"DELETE","lineNumber":273,"oldContent":"            try {"},{"type":"DELETE","lineNumber":274,"oldContent":"    fun stopMissionTimer() {"},{"type":"DELETE","lineNumber":275,"oldContent":"            }"},{"type":"DELETE","lineNumber":276,"oldContent":"        _isMissionActive.value = false"},{"type":"DELETE","lineNumber":277,"oldContent":"            if (repo == null) {"},{"type":"DELETE","lineNumber":278,"oldContent":"        timerJob?.cancel()"},{"type":"DELETE","lineNumber":279,"oldContent":""},{"type":"DELETE","lineNumber":280,"oldContent":"        timerJob = null"},{"type":"DELETE","lineNumber":281,"oldContent":"    }"}]},{"timestamp":1758177206060,"changes":[{"type":"MODIFY","lineNumber":9,"content":"import com.google.android.gms.maps.model.LatLng","oldContent":"import kotlinx.coroutines.flow.combine"},{"type":"MODIFY","lineNumber":12,"content":"import kotlinx.coroutines.launch","oldContent":""},{"type":"MODIFY","lineNumber":32,"content":"    // Store uploaded waypoints for display on main screen","oldContent":"                newRepo.start()"},{"type":"DELETE","lineNumber":43,"oldContent":"                // Collect telemetry state"},{"type":"DELETE","lineNumber":50,"oldContent":"        // Subscribe to mission end events and stop timer"},{"type":"DELETE","lineNumber":52,"oldContent":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":54,"oldContent":"            repo?.missionEndedEvents?.collect {"},{"type":"DELETE","lineNumber":56,"oldContent":"                stopMissionTimer()"},{"type":"DELETE","lineNumber":58,"oldContent":"            }"},{"type":"DELETE","lineNumber":60,"oldContent":"        }"},{"type":"DELETE","lineNumber":130,"oldContent":"                val autoOk = repo!!.changeModeAutoWithVerify(timeoutMs = 7000)"},{"type":"INSERT","lineNumber":123,"content":""},{"type":"DELETE","lineNumber":143,"oldContent":"                }"},{"type":"DELETE","lineNumber":145,"oldContent":"                val sats = _telemetryState.value.sats ?: 0"},{"type":"INSERT","lineNumber":137,"content":"                }"},{"type":"INSERT","lineNumber":139,"content":"                val sats = _telemetryState.value.sats ?: 0"},{"type":"DELETE","lineNumber":154,"oldContent":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"INSERT","lineNumber":148,"content":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"DELETE","lineNumber":163,"oldContent":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"DELETE","lineNumber":165,"oldContent":"                        val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":158,"content":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"INSERT","lineNumber":159,"content":"                        val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":188,"oldContent":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":190,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":183,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":184,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":211,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":213,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":215,"oldContent":"                    }"},{"type":"INSERT","lineNumber":207,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":208,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":209,"content":"                    }"},{"type":"INSERT","lineNumber":210,"content":""},{"type":"DELETE","lineNumber":219,"oldContent":""},{"type":"DELETE","lineNumber":222,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"INSERT","lineNumber":216,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":226,"oldContent":""},{"type":"INSERT","lineNumber":220,"content":""},{"type":"DELETE","lineNumber":249,"oldContent":"            if (repo == null) {"},{"type":"DELETE","lineNumber":251,"oldContent":"            }"},{"type":"DELETE","lineNumber":252,"oldContent":"            try {"},{"type":"DELETE","lineNumber":254,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":255,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":246,"content":"            if (repo == null) {"},{"type":"INSERT","lineNumber":249,"content":"            }"},{"type":"INSERT","lineNumber":250,"content":"            try {"},{"type":"INSERT","lineNumber":251,"content":"                repo?.requestMissionAndLog()"},{"type":"INSERT","lineNumber":253,"content":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"}]},{"timestamp":1758177263360,"changes":[{"type":"MODIFY","lineNumber":13,"content":"import kotlinx.coroutines.delay","oldContent":"class SharedViewModel : ViewModel() {"},{"type":"MODIFY","lineNumber":20,"content":"    private var repo: MavlinkTelemetryRepository? = null","oldContent":"    private val _telemetryState = mutableStateOf(TelemetryState())"},{"type":"DELETE","lineNumber":36,"oldContent":"                    _telemetryState.value = it"},{"type":"DELETE","lineNumber":37,"oldContent":"                }"},{"type":"INSERT","lineNumber":36,"content":"    // Mission timer state"},{"type":"INSERT","lineNumber":37,"content":"    private var missionTimerJob: kotlinx.coroutines.Job? = null"},{"type":"INSERT","lineNumber":38,"content":"    private val _missionElapsedSeconds = MutableStateFlow(0)"},{"type":"INSERT","lineNumber":39,"content":"    val missionElapsedSeconds: StateFlow<Int> = _missionElapsedSeconds.asStateFlow()"},{"type":"INSERT","lineNumber":40,"content":"    val missionElapsedFormatted: StateFlow<String> = missionElapsedSeconds.map { secs ->"},{"type":"INSERT","lineNumber":41,"content":"        val h = secs / 3600"},{"type":"INSERT","lineNumber":42,"content":"        val m = (secs % 3600) / 60"},{"type":"INSERT","lineNumber":43,"content":"        val s = secs % 60"},{"type":"INSERT","lineNumber":44,"content":"        if (h > 0) \"%d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":45,"content":"    }.stateIn(viewModelScope, SharingStarted.Eagerly, \"00:00\")"},{"type":"INSERT","lineNumber":46,"content":""},{"type":"INSERT","lineNumber":47,"content":"    fun connect() {"},{"type":"INSERT","lineNumber":48,"content":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":48,"oldContent":"                    Log.e(tag, \"MISSION_START rejected or timed out\")"},{"type":"INSERT","lineNumber":59,"content":"    }"},{"type":"DELETE","lineNumber":59,"oldContent":"                    val armTimeout = 8000L"},{"type":"INSERT","lineNumber":70,"content":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"DELETE","lineNumber":76,"oldContent":"                    Log.e(tag, \"No mission ACK present. Upload a mission first.\")"},{"type":"INSERT","lineNumber":87,"content":""},{"type":"DELETE","lineNumber":82,"oldContent":"                    _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":83,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":84,"oldContent":"                    Log.i(\"SharedVM\", \"Mission upload succeeded (${missionItems.size}). ACK received.\")"},{"type":"DELETE","lineNumber":85,"oldContent":"                Log.e(\"SharedVM\", \"Failed to start mission\", e)"},{"type":"INSERT","lineNumber":93,"content":""},{"type":"INSERT","lineNumber":94,"content":"                    // Convert MissionItemInt to LatLng for display"},{"type":"INSERT","lineNumber":95,"content":"                    val waypoints = missionItems.map { item ->"},{"type":"INSERT","lineNumber":96,"content":"                        LatLng(item.x / 1E7, item.y / 1E7)"},{"type":"DELETE","lineNumber":92,"oldContent":"                Log.i(\"SharedVM\", \"Sending start mission with first=0 last=$last\")"},{"type":"DELETE","lineNumber":93,"oldContent":"                val last = if (lastUploadedCount > 0) lastUploadedCount - 1 else 0"},{"type":"INSERT","lineNumber":103,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":104,"content":"                    _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":100,"oldContent":"                    } else {"},{"type":"INSERT","lineNumber":111,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":116,"oldContent":""},{"type":"DELETE","lineNumber":123,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - start < armTimeout) {"},{"type":"INSERT","lineNumber":133,"content":"                }"},{"type":"INSERT","lineNumber":134,"content":""},{"type":"DELETE","lineNumber":130,"oldContent":"                }"},{"type":"DELETE","lineNumber":133,"oldContent":"                val sats = _telemetryState.value.sats ?: 0"},{"type":"INSERT","lineNumber":148,"content":"                }"},{"type":"DELETE","lineNumber":140,"oldContent":"                    Log.i(\"SharedVM\", \"=== Mission Start Sequence Completed Successfully ===\")"},{"type":"DELETE","lineNumber":141,"oldContent":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"DELETE","lineNumber":142,"oldContent":"                if (result) {"},{"type":"DELETE","lineNumber":143,"oldContent":"                val result = repo?.startMission(0, last) ?: false"},{"type":"DELETE","lineNumber":144,"oldContent":"                Log.i(\"SharedVM\", \"Sending mission start command with first=0 last=$last\")"},{"type":"DELETE","lineNumber":145,"oldContent":"                val last = if (lastUploadedCount > 0) lastUploadedCount - 1 else 0"},{"type":"DELETE","lineNumber":146,"oldContent":"                Log.i(\"SharedVM\", \"Step 4: Starting mission execution\")"},{"type":"INSERT","lineNumber":150,"content":"                val sats = _telemetryState.value.sats ?: 0"},{"type":"INSERT","lineNumber":151,"content":"                if (sats < 6) {"},{"type":"INSERT","lineNumber":152,"content":"                    Log.w(\"SharedVM\", \"Insufficient GPS satellites ($sats), minimum 6 required\")"},{"type":"INSERT","lineNumber":153,"content":"                    onResult(false, \"Insufficient GPS satellites ($sats). Need at least 6 for mission.\")"},{"type":"INSERT","lineNumber":154,"content":"                    return@launch"},{"type":"INSERT","lineNumber":155,"content":"                }"},{"type":"INSERT","lineNumber":156,"content":""},{"type":"INSERT","lineNumber":159,"content":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"DELETE","lineNumber":151,"oldContent":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"DELETE","lineNumber":153,"oldContent":"                        val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":169,"content":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"INSERT","lineNumber":170,"content":"                        val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":176,"oldContent":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":178,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":194,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":195,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":200,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":202,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":204,"oldContent":"                    }"},{"type":"DELETE","lineNumber":206,"oldContent":""},{"type":"DELETE","lineNumber":210,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"INSERT","lineNumber":218,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":219,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":220,"content":"                    }"},{"type":"INSERT","lineNumber":221,"content":""},{"type":"DELETE","lineNumber":214,"oldContent":""},{"type":"INSERT","lineNumber":227,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"INSERT","lineNumber":231,"content":""},{"type":"INSERT","lineNumber":241,"content":"                    // Start timer"},{"type":"INSERT","lineNumber":242,"content":"                    startMissionTimer()"},{"type":"INSERT","lineNumber":246,"content":"                    stopMissionTimer()"},{"type":"INSERT","lineNumber":252,"content":"                stopMissionTimer()"},{"type":"DELETE","lineNumber":239,"oldContent":"            if (repo == null) {"},{"type":"DELETE","lineNumber":243,"oldContent":"            }"},{"type":"DELETE","lineNumber":244,"oldContent":"            try {"},{"type":"DELETE","lineNumber":246,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":247,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":261,"content":"            if (repo == null) {"},{"type":"INSERT","lineNumber":264,"content":"            }"},{"type":"INSERT","lineNumber":265,"content":"            try {"},{"type":"INSERT","lineNumber":266,"content":"                repo?.requestMissionAndLog()"},{"type":"INSERT","lineNumber":268,"content":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":271,"content":"    }"},{"type":"INSERT","lineNumber":272,"content":""},{"type":"INSERT","lineNumber":273,"content":"    private fun startMissionTimer() {"},{"type":"INSERT","lineNumber":274,"content":"        missionTimerJob?.cancel()"},{"type":"INSERT","lineNumber":275,"content":"        _missionElapsedSeconds.value = 0"},{"type":"INSERT","lineNumber":276,"content":"        missionTimerJob = viewModelScope.launch {"},{"type":"INSERT","lineNumber":277,"content":"            while (true) {"},{"type":"INSERT","lineNumber":278,"content":"                delay(1000)"},{"type":"INSERT","lineNumber":279,"content":"                _missionElapsedSeconds.value += 1"},{"type":"DELETE","lineNumber":257,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":281,"content":"        }"},{"type":"INSERT","lineNumber":282,"content":"        // Monitor for mission end (mode change or disarm)"},{"type":"INSERT","lineNumber":283,"content":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":284,"content":"            telemetryState.collect { state ->"},{"type":"INSERT","lineNumber":285,"content":"                // Stop timer if vehicle is disarmed or mode is RTL/Land/Unknown"},{"type":"INSERT","lineNumber":286,"content":"                if (!state.armed || (state.mode?.let { m ->"},{"type":"INSERT","lineNumber":287,"content":"                    m.contains(\"RTL\", true) || m.contains(\"Land\", true) || m.contains(\"Unknown\", true)"},{"type":"INSERT","lineNumber":288,"content":"                } == true)) {"},{"type":"INSERT","lineNumber":289,"content":"                    stopMissionTimer()"},{"type":"INSERT","lineNumber":290,"content":"                }"},{"type":"INSERT","lineNumber":291,"content":"            }"},{"type":"INSERT","lineNumber":292,"content":"        }"},{"type":"INSERT","lineNumber":293,"content":"    }"},{"type":"INSERT","lineNumber":294,"content":""},{"type":"INSERT","lineNumber":295,"content":"    private fun stopMissionTimer() {"},{"type":"INSERT","lineNumber":296,"content":"        missionTimerJob?.cancel()"},{"type":"INSERT","lineNumber":297,"content":"        missionTimerJob = null"},{"type":"INSERT","lineNumber":298,"content":"    }"},{"type":"INSERT","lineNumber":299,"content":"}"}]},{"timestamp":1758177862114,"changes":[{"type":"DELETE","lineNumber":34,"oldContent":"                newRepo.start()"},{"type":"DELETE","lineNumber":35,"oldContent":"                    _telemetryState.value = it"},{"type":"DELETE","lineNumber":36,"oldContent":"    // Mission timer state"},{"type":"DELETE","lineNumber":37,"oldContent":"    private var missionTimerJob: kotlinx.coroutines.Job? = null"},{"type":"DELETE","lineNumber":38,"oldContent":"    private val _missionElapsedSeconds = MutableStateFlow(0)"},{"type":"INSERT","lineNumber":34,"content":"    val uploadedWaypoints: StateFlow<List<LatLng>> = _uploadedWaypoints.asStateFlow()"},{"type":"INSERT","lineNumber":35,"content":""},{"type":"INSERT","lineNumber":36,"content":"    fun connect() {"},{"type":"INSERT","lineNumber":37,"content":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":40,"oldContent":"    val missionElapsedSeconds: StateFlow<Int> = _missionElapsedSeconds.asStateFlow()"},{"type":"DELETE","lineNumber":42,"oldContent":"    val missionElapsedFormatted: StateFlow<String> = missionElapsedSeconds.map { secs ->"},{"type":"DELETE","lineNumber":44,"oldContent":"        val h = secs / 3600"},{"type":"DELETE","lineNumber":46,"oldContent":"        val m = (secs % 3600) / 60"},{"type":"DELETE","lineNumber":48,"oldContent":"        val s = secs % 60"},{"type":"DELETE","lineNumber":50,"oldContent":"        if (h > 0) \"%d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":52,"oldContent":"    }.stateIn(viewModelScope, SharingStarted.Eagerly, \"00:00\")"},{"type":"DELETE","lineNumber":54,"oldContent":""},{"type":"DELETE","lineNumber":56,"oldContent":"    fun connect() {"},{"type":"DELETE","lineNumber":58,"oldContent":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":48,"content":"    }"},{"type":"DELETE","lineNumber":69,"oldContent":"    }"},{"type":"INSERT","lineNumber":59,"content":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"DELETE","lineNumber":80,"oldContent":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"INSERT","lineNumber":76,"content":""},{"type":"DELETE","lineNumber":92,"oldContent":"                    }"},{"type":"INSERT","lineNumber":83,"content":"                    // Convert MissionItemInt to LatLng for display"},{"type":"INSERT","lineNumber":84,"content":"                    val waypoints = missionItems.map { item ->"},{"type":"INSERT","lineNumber":85,"content":"                        LatLng(item.x / 1E7, item.y / 1E7)"},{"type":"INSERT","lineNumber":86,"content":"                    }"},{"type":"DELETE","lineNumber":99,"oldContent":""},{"type":"DELETE","lineNumber":100,"oldContent":"                    // Convert MissionItemInt to LatLng for display"},{"type":"INSERT","lineNumber":92,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":93,"content":"                    _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":102,"oldContent":"                    val waypoints = missionItems.map { item ->"},{"type":"DELETE","lineNumber":104,"oldContent":"                        LatLng(item.x / 1E7, item.y / 1E7)"},{"type":"INSERT","lineNumber":100,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":111,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":113,"oldContent":"                    _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":121,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":122,"content":"                }"},{"type":"INSERT","lineNumber":123,"content":""},{"type":"DELETE","lineNumber":141,"oldContent":"                }"},{"type":"DELETE","lineNumber":142,"oldContent":""},{"type":"DELETE","lineNumber":148,"oldContent":""},{"type":"DELETE","lineNumber":149,"oldContent":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"DELETE","lineNumber":151,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":152,"oldContent":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":153,"oldContent":"                val sats = _telemetryState.value.sats ?: 0"},{"type":"INSERT","lineNumber":139,"content":"                val sats = _telemetryState.value.sats ?: 0"},{"type":"DELETE","lineNumber":157,"oldContent":"                if (!isInArmableMode) {"},{"type":"DELETE","lineNumber":160,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":162,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":146,"content":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"INSERT","lineNumber":147,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":148,"content":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"INSERT","lineNumber":149,"content":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"INSERT","lineNumber":151,"content":"                if (!isInArmableMode) {"},{"type":"INSERT","lineNumber":152,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":153,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":154,"content":""},{"type":"DELETE","lineNumber":167,"oldContent":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"INSERT","lineNumber":158,"content":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"INSERT","lineNumber":159,"content":"                        val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":178,"oldContent":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"DELETE","lineNumber":180,"oldContent":"                        val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":183,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":184,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":203,"oldContent":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":205,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":207,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":208,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":209,"content":"                    }"},{"type":"INSERT","lineNumber":210,"content":""},{"type":"DELETE","lineNumber":223,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":216,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":225,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":227,"oldContent":"                    }"},{"type":"DELETE","lineNumber":236,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":241,"oldContent":""},{"type":"DELETE","lineNumber":251,"oldContent":"                    // Start timer"},{"type":"DELETE","lineNumber":253,"oldContent":"                    startMissionTimer()"},{"type":"DELETE","lineNumber":256,"oldContent":"                    stopMissionTimer()"},{"type":"INSERT","lineNumber":246,"content":"            if (repo == null) {"},{"type":"DELETE","lineNumber":261,"oldContent":"                stopMissionTimer()"},{"type":"DELETE","lineNumber":263,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":265,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":266,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":267,"oldContent":"}"},{"type":"DELETE","lineNumber":268,"oldContent":"    }"},{"type":"DELETE","lineNumber":269,"oldContent":"        missionTimerJob = null"},{"type":"DELETE","lineNumber":270,"oldContent":"            if (repo == null) {"},{"type":"DELETE","lineNumber":271,"oldContent":"        missionTimerJob?.cancel()"},{"type":"DELETE","lineNumber":272,"oldContent":"    private fun stopMissionTimer() {"},{"type":"DELETE","lineNumber":273,"oldContent":""},{"type":"DELETE","lineNumber":274,"oldContent":"            }"},{"type":"DELETE","lineNumber":275,"oldContent":"    }"},{"type":"DELETE","lineNumber":277,"oldContent":"        }"},{"type":"DELETE","lineNumber":279,"oldContent":"            }"},{"type":"DELETE","lineNumber":280,"oldContent":"                }"},{"type":"INSERT","lineNumber":252,"content":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":282,"oldContent":"                    stopMissionTimer()"},{"type":"DELETE","lineNumber":283,"oldContent":"                } == true)) {"},{"type":"DELETE","lineNumber":284,"oldContent":"                    m.contains(\"RTL\", true) || m.contains(\"Land\", true) || m.contains(\"Unknown\", true)"},{"type":"DELETE","lineNumber":285,"oldContent":"    }"},{"type":"DELETE","lineNumber":286,"oldContent":"                if (!state.armed || (state.mode?.let { m ->"},{"type":"DELETE","lineNumber":287,"oldContent":""},{"type":"DELETE","lineNumber":288,"oldContent":"                // Stop timer if vehicle is disarmed or mode is RTL/Land/Unknown"},{"type":"DELETE","lineNumber":289,"oldContent":"    private fun startMissionTimer() {"},{"type":"DELETE","lineNumber":290,"oldContent":"            telemetryState.collect { state ->"},{"type":"DELETE","lineNumber":291,"oldContent":"        missionTimerJob?.cancel()"},{"type":"DELETE","lineNumber":292,"oldContent":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":293,"oldContent":"        _missionElapsedSeconds.value = 0"},{"type":"DELETE","lineNumber":294,"oldContent":"        // Monitor for mission end (mode change or disarm)"},{"type":"DELETE","lineNumber":295,"oldContent":"        missionTimerJob = viewModelScope.launch {"},{"type":"INSERT","lineNumber":254,"content":"            }"},{"type":"DELETE","lineNumber":297,"oldContent":"            while (true) {"},{"type":"DELETE","lineNumber":298,"oldContent":"                _missionElapsedSeconds.value += 1"},{"type":"DELETE","lineNumber":299,"oldContent":"                delay(1000)"},{"type":"INSERT","lineNumber":256,"content":"    }"},{"type":"INSERT","lineNumber":257,"content":"}"}]},{"timestamp":1758185840192,"changes":[{"type":"DELETE","lineNumber":43,"oldContent":"    }"},{"type":"DELETE","lineNumber":49,"oldContent":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"INSERT","lineNumber":48,"content":"    }"},{"type":"INSERT","lineNumber":59,"content":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"INSERT","lineNumber":66,"content":"                    return@launch"},{"type":"INSERT","lineNumber":67,"content":"                }"},{"type":"INSERT","lineNumber":69,"content":"                if (_telemetryState.value.missionCompleted) {"},{"type":"INSERT","lineNumber":70,"content":"                    Log.w(\"SharedVM\", \"Mission already completed, cannot upload new mission until reset\")"},{"type":"INSERT","lineNumber":71,"content":"                    missionUploaded = false"},{"type":"INSERT","lineNumber":72,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":73,"content":"                    onResult(false, \"Mission already completed. Please reset or reconnect before uploading a new mission.\")"},{"type":"DELETE","lineNumber":73,"oldContent":"                    // Convert MissionItemInt to LatLng for display"},{"type":"DELETE","lineNumber":75,"oldContent":"                    val waypoints = missionItems.map { item ->"},{"type":"DELETE","lineNumber":77,"oldContent":"                        LatLng(item.x / 1E7, item.y / 1E7)"},{"type":"DELETE","lineNumber":79,"oldContent":"                    }"},{"type":"INSERT","lineNumber":84,"content":""},{"type":"DELETE","lineNumber":86,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":87,"oldContent":"                    _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":91,"content":"                    // Convert MissionItemInt to LatLng for display"},{"type":"INSERT","lineNumber":92,"content":"                    val waypoints = missionItems.map { item ->"},{"type":"INSERT","lineNumber":93,"content":"                        LatLng(item.x / 1E7, item.y / 1E7)"},{"type":"INSERT","lineNumber":94,"content":"                    }"},{"type":"DELETE","lineNumber":91,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already in AUTO mode\")"},{"type":"INSERT","lineNumber":97,"content":"                    Log.i(\"SharedVM\", \"Mission upload succeeded (${missionItems.size})\")"},{"type":"INSERT","lineNumber":98,"content":"                    onResult(true, null)"},{"type":"DELETE","lineNumber":93,"oldContent":"                        return@launch"},{"type":"DELETE","lineNumber":94,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":95,"oldContent":"                        val finalMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":100,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":101,"content":"                    _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":102,"content":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":97,"oldContent":"                    if (!modeChangeSuccess) {"},{"type":"INSERT","lineNumber":104,"content":"                }"},{"type":"INSERT","lineNumber":108,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":111,"oldContent":"                }"},{"type":"DELETE","lineNumber":113,"oldContent":""},{"type":"INSERT","lineNumber":130,"content":"                }"},{"type":"INSERT","lineNumber":131,"content":""},{"type":"DELETE","lineNumber":130,"oldContent":"                val sats = _telemetryState.value.sats ?: 0"},{"type":"DELETE","lineNumber":136,"oldContent":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"DELETE","lineNumber":138,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":140,"oldContent":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"DELETE","lineNumber":141,"oldContent":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":143,"oldContent":"                if (!isInArmableMode) {"},{"type":"DELETE","lineNumber":144,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":145,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"MODIFY","lineNumber":147,"content":"                val sats = _telemetryState.value.sats ?: 0","oldContent":""},{"type":"DELETE","lineNumber":150,"oldContent":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"DELETE","lineNumber":152,"oldContent":"                        val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":154,"content":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"INSERT","lineNumber":155,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":156,"content":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"INSERT","lineNumber":157,"content":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"INSERT","lineNumber":159,"content":"                if (!isInArmableMode) {"},{"type":"INSERT","lineNumber":160,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":161,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":162,"content":""},{"type":"INSERT","lineNumber":166,"content":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"INSERT","lineNumber":167,"content":"                        val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":172,"oldContent":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":174,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":191,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":192,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":196,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":198,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":200,"oldContent":"                    }"},{"type":"DELETE","lineNumber":202,"oldContent":""},{"type":"DELETE","lineNumber":209,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"INSERT","lineNumber":215,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":216,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":217,"content":"                    }"},{"type":"INSERT","lineNumber":218,"content":""},{"type":"INSERT","lineNumber":224,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":235,"oldContent":"            if (repo == null) {"},{"type":"DELETE","lineNumber":241,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":248,"content":"        }"},{"type":"INSERT","lineNumber":249,"content":"    }"},{"type":"INSERT","lineNumber":250,"content":""},{"type":"INSERT","lineNumber":251,"content":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"INSERT","lineNumber":252,"content":"    fun readMissionFromFcu() {"},{"type":"DELETE","lineNumber":243,"oldContent":"            }"},{"type":"DELETE","lineNumber":244,"oldContent":"                return@launch"},{"type":"INSERT","lineNumber":254,"content":"            if (repo == null) {"},{"type":"DELETE","lineNumber":246,"oldContent":"    }"},{"type":"DELETE","lineNumber":247,"oldContent":"}"},{"type":"DELETE","lineNumber":249,"oldContent":"}"},{"type":"DELETE","lineNumber":250,"oldContent":"    }"},{"type":"DELETE","lineNumber":251,"oldContent":"        }"},{"type":"DELETE","lineNumber":252,"oldContent":"            if (repo == null) {"},{"type":"INSERT","lineNumber":260,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":262,"content":"            }"},{"type":"INSERT","lineNumber":264,"content":"    }"},{"type":"INSERT","lineNumber":265,"content":"}"}]},{"timestamp":1758187312046,"changes":[{"type":"MODIFY","lineNumber":14,"content":"","oldContent":"    var ipAddress by mutableStateOf(\"10.0.2.2\")"},{"type":"INSERT","lineNumber":15,"content":"import androidx.compose.runtime.State"},{"type":"INSERT","lineNumber":16,"content":""},{"type":"DELETE","lineNumber":17,"oldContent":"    var ipAddress by mutableStateOf(\"10.0.2.2\")"},{"type":"MODIFY","lineNumber":19,"content":"    private val _ipAddress = mutableStateOf(\"10.0.2.2\")","oldContent":"    var port by mutableStateOf(\"5762\")"},{"type":"INSERT","lineNumber":20,"content":"    val ipAddress: State<String> = _ipAddress"},{"type":"INSERT","lineNumber":22,"content":"    private val _port = mutableStateOf(\"5762\")"},{"type":"INSERT","lineNumber":23,"content":"    val port: State<String> = _port"},{"type":"INSERT","lineNumber":24,"content":""},{"type":"INSERT","lineNumber":25,"content":"    fun onIpAddressChange(newValue: String) {"},{"type":"INSERT","lineNumber":26,"content":"        _ipAddress.value = newValue"},{"type":"INSERT","lineNumber":27,"content":"    }"},{"type":"INSERT","lineNumber":28,"content":""},{"type":"INSERT","lineNumber":29,"content":"    fun onPortChange(newValue: String) {"},{"type":"INSERT","lineNumber":30,"content":"        _port.value = newValue"},{"type":"INSERT","lineNumber":31,"content":"    }"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"DELETE","lineNumber":33,"oldContent":"                newRepo.start()"},{"type":"INSERT","lineNumber":46,"content":"    private val _uploadedWaypoints = MutableStateFlow<List<LatLng>>(emptyList())"},{"type":"DELETE","lineNumber":38,"oldContent":"        }"},{"type":"INSERT","lineNumber":51,"content":"            val portInt = port.value.toIntOrNull()"},{"type":"DELETE","lineNumber":40,"oldContent":"                val newRepo = MavlinkTelemetryRepository(ipAddress, portInt)"},{"type":"INSERT","lineNumber":53,"content":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"DELETE","lineNumber":47,"oldContent":"    }"},{"type":"INSERT","lineNumber":61,"content":"    }"},{"type":"DELETE","lineNumber":58,"oldContent":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"INSERT","lineNumber":72,"content":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"DELETE","lineNumber":67,"oldContent":""},{"type":"INSERT","lineNumber":81,"content":""},{"type":"INSERT","lineNumber":82,"content":"                if (_telemetryState.value.missionCompleted) {"},{"type":"INSERT","lineNumber":83,"content":"                    Log.w(\"SharedVM\", \"Mission already completed, cannot upload new mission until reset\")"},{"type":"INSERT","lineNumber":84,"content":"                    missionUploaded = false"},{"type":"INSERT","lineNumber":85,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":86,"content":"                    onResult(false, \"Mission already completed. Please reset or reconnect before uploading a new mission.\")"},{"type":"DELETE","lineNumber":71,"oldContent":"                if (_telemetryState.value.missionCompleted) {"},{"type":"DELETE","lineNumber":73,"oldContent":"                    Log.w(\"SharedVM\", \"Mission already completed, cannot upload new mission until reset\")"},{"type":"DELETE","lineNumber":75,"oldContent":"                    missionUploaded = false"},{"type":"DELETE","lineNumber":77,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":79,"oldContent":"                    onResult(false, \"Mission already completed. Please reset or reconnect before uploading a new mission.\")"},{"type":"INSERT","lineNumber":97,"content":""},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"DELETE","lineNumber":91,"oldContent":"                // Check if vehicle is armable"},{"type":"DELETE","lineNumber":92,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":95,"oldContent":"                // Check if mission is uploaded"},{"type":"DELETE","lineNumber":98,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":108,"content":"                    _uploadedWaypoints.value = waypoints"},{"type":"INSERT","lineNumber":109,"content":""},{"type":"INSERT","lineNumber":112,"content":"                } else {"},{"type":"INSERT","lineNumber":113,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":114,"content":"                    _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":115,"content":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":116,"content":"                    onResult(false, \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":117,"content":"                }"},{"type":"DELETE","lineNumber":103,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":105,"oldContent":"                    _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":121,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":107,"oldContent":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":110,"oldContent":"                }"},{"type":"DELETE","lineNumber":115,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":122,"oldContent":"                    "},{"type":"INSERT","lineNumber":135,"content":"                    onResult(false, \"Not connected to vehicle\")"},{"type":"DELETE","lineNumber":126,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already armed\")"},{"type":"INSERT","lineNumber":139,"content":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"DELETE","lineNumber":128,"oldContent":"                    }"},{"type":"INSERT","lineNumber":141,"content":"                    onResult(false, \"FCU not detected\")"},{"type":"INSERT","lineNumber":143,"content":"                }"},{"type":"INSERT","lineNumber":144,"content":""},{"type":"DELETE","lineNumber":136,"oldContent":"                }"},{"type":"DELETE","lineNumber":137,"oldContent":""},{"type":"DELETE","lineNumber":152,"oldContent":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"DELETE","lineNumber":154,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":167,"content":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"INSERT","lineNumber":168,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":157,"oldContent":""},{"type":"INSERT","lineNumber":171,"content":""},{"type":"INSERT","lineNumber":172,"content":"                if (!isInArmableMode) {"},{"type":"INSERT","lineNumber":173,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":174,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":175,"content":""},{"type":"DELETE","lineNumber":161,"oldContent":"                if (!isInArmableMode) {"},{"type":"DELETE","lineNumber":163,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":179,"content":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"INSERT","lineNumber":180,"content":"                        val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":165,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":167,"oldContent":""},{"type":"DELETE","lineNumber":172,"oldContent":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"DELETE","lineNumber":174,"oldContent":"                        val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":204,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":205,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":197,"oldContent":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":199,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":228,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":229,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":230,"content":"                    }"},{"type":"INSERT","lineNumber":231,"content":""},{"type":"DELETE","lineNumber":218,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":220,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":222,"oldContent":"                    }"},{"type":"INSERT","lineNumber":237,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":224,"oldContent":""},{"type":"DELETE","lineNumber":231,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":248,"oldContent":"            try {"},{"type":"DELETE","lineNumber":249,"oldContent":"                onResult(false, e.message)"},{"type":"DELETE","lineNumber":251,"oldContent":"                Log.e(\"SharedVM\", \"Failed to start mission\", e)"},{"type":"INSERT","lineNumber":266,"content":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":257,"oldContent":"            if (repo == null) {"},{"type":"INSERT","lineNumber":268,"content":"                Log.w(\"SharedVM\", \"No repo available, cannot request mission readback\")"},{"type":"INSERT","lineNumber":269,"content":"                return@launch"},{"type":"INSERT","lineNumber":270,"content":"            }"},{"type":"INSERT","lineNumber":273,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":275,"content":"            }"},{"type":"DELETE","lineNumber":262,"oldContent":"}"},{"type":"DELETE","lineNumber":264,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":265,"oldContent":"            }"},{"type":"INSERT","lineNumber":278,"content":"}"}]},{"timestamp":1758259104342,"changes":[{"type":"INSERT","lineNumber":16,"content":""},{"type":"DELETE","lineNumber":18,"oldContent":""},{"type":"DELETE","lineNumber":19,"oldContent":"    var port by mutableStateOf(\"5762\")"},{"type":"DELETE","lineNumber":22,"oldContent":"    private var repo: MavlinkTelemetryRepository? = null"},{"type":"DELETE","lineNumber":25,"oldContent":"    private val _telemetryState = MutableStateFlow(TelemetryState())"},{"type":"DELETE","lineNumber":27,"oldContent":"    val telemetryState: StateFlow<TelemetryState> = _telemetryState.asStateFlow()"},{"type":"DELETE","lineNumber":29,"oldContent":""},{"type":"DELETE","lineNumber":31,"oldContent":"    val isConnected: StateFlow<Boolean> = telemetryState"},{"type":"DELETE","lineNumber":33,"oldContent":"        .map { it.connected }"},{"type":"DELETE","lineNumber":35,"oldContent":"        .stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), false)"},{"type":"DELETE","lineNumber":37,"oldContent":""},{"type":"DELETE","lineNumber":39,"oldContent":"    var missionUploaded by mutableStateOf(false)"},{"type":"DELETE","lineNumber":41,"oldContent":"    var lastUploadedCount by mutableStateOf(0)"},{"type":"INSERT","lineNumber":33,"content":"    private var repo: MavlinkTelemetryRepository? = null"},{"type":"INSERT","lineNumber":35,"content":"    private val _telemetryState = MutableStateFlow(TelemetryState())"},{"type":"INSERT","lineNumber":36,"content":"    val telemetryState: StateFlow<TelemetryState> = _telemetryState.asStateFlow()"},{"type":"INSERT","lineNumber":37,"content":""},{"type":"INSERT","lineNumber":38,"content":"    val isConnected: StateFlow<Boolean> = telemetryState"},{"type":"INSERT","lineNumber":39,"content":"        .map { it.connected }"},{"type":"INSERT","lineNumber":40,"content":"        .stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), false)"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":42,"content":"    var missionUploaded by mutableStateOf(false)"},{"type":"INSERT","lineNumber":43,"content":"    var lastUploadedCount by mutableStateOf(0)"},{"type":"INSERT","lineNumber":44,"content":""},{"type":"INSERT","lineNumber":46,"content":"    private val _uploadedWaypoints = MutableStateFlow<List<LatLng>>(emptyList())"},{"type":"INSERT","lineNumber":51,"content":"            val portInt = port.value.toIntOrNull()"},{"type":"INSERT","lineNumber":53,"content":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"DELETE","lineNumber":56,"oldContent":"    private val _uploadedWaypoints = MutableStateFlow<List<LatLng>>(emptyList())"},{"type":"DELETE","lineNumber":58,"oldContent":"                "},{"type":"INSERT","lineNumber":60,"content":"        }"},{"type":"INSERT","lineNumber":61,"content":"    }"},{"type":"DELETE","lineNumber":61,"oldContent":"            val portInt = port.value.toIntOrNull()"},{"type":"DELETE","lineNumber":64,"oldContent":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"INSERT","lineNumber":72,"content":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"DELETE","lineNumber":72,"oldContent":"    }"},{"type":"INSERT","lineNumber":74,"content":"                // Reset mission state before attempting new upload"},{"type":"INSERT","lineNumber":75,"content":"                missionUploaded = false"},{"type":"INSERT","lineNumber":76,"content":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":77,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":78,"content":"                if (_telemetryState.value.missionCompleted) {"},{"type":"INSERT","lineNumber":79,"content":"                    Log.i(\"SharedVM\", \"Resetting missionCompleted flag for new upload\")"},{"type":"INSERT","lineNumber":80,"content":"                    _telemetryState.value = _telemetryState.value.copy(missionCompleted = false, missionElapsedSec = null)"},{"type":"INSERT","lineNumber":81,"content":"                }"},{"type":"INSERT","lineNumber":82,"content":""},{"type":"DELETE","lineNumber":80,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":81,"oldContent":"                }"},{"type":"DELETE","lineNumber":82,"oldContent":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"DELETE","lineNumber":88,"oldContent":""},{"type":"DELETE","lineNumber":90,"oldContent":"                if (_telemetryState.value.missionCompleted) {"},{"type":"DELETE","lineNumber":92,"oldContent":"                    Log.w(\"SharedVM\", \"Mission already completed, cannot upload new mission until reset\")"},{"type":"DELETE","lineNumber":94,"oldContent":"                    missionUploaded = false"},{"type":"INSERT","lineNumber":98,"content":""},{"type":"DELETE","lineNumber":96,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":98,"oldContent":"                    onResult(false, \"Mission already completed. Please reset or reconnect before uploading a new mission.\")"},{"type":"DELETE","lineNumber":106,"oldContent":""},{"type":"INSERT","lineNumber":109,"content":"                    _uploadedWaypoints.value = waypoints"},{"type":"INSERT","lineNumber":110,"content":""},{"type":"INSERT","lineNumber":113,"content":"                } else {"},{"type":"INSERT","lineNumber":114,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":115,"content":"                    _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":116,"content":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":117,"content":"                    onResult(false, \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":118,"content":"                }"},{"type":"INSERT","lineNumber":122,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":114,"oldContent":"                    _uploadedWaypoints.value = waypoints"},{"type":"DELETE","lineNumber":116,"oldContent":""},{"type":"DELETE","lineNumber":119,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":121,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":123,"oldContent":"                    _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":125,"oldContent":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":126,"oldContent":"                    onResult(false, \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":128,"oldContent":"                }"},{"type":"DELETE","lineNumber":133,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":136,"content":"                    onResult(false, \"Not connected to vehicle\")"},{"type":"DELETE","lineNumber":138,"oldContent":"        }"},{"type":"DELETE","lineNumber":139,"oldContent":"                onResult(false, e.message)"},{"type":"INSERT","lineNumber":140,"content":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"INSERT","lineNumber":141,"content":"                    Log.w(\"SharedVM\", \"FCU not detected, cannot start mission\")"},{"type":"INSERT","lineNumber":142,"content":"                    onResult(false, \"FCU not detected\")"},{"type":"INSERT","lineNumber":143,"content":"                    return@launch"},{"type":"INSERT","lineNumber":144,"content":"                }"},{"type":"INSERT","lineNumber":145,"content":""},{"type":"DELETE","lineNumber":142,"oldContent":"                Log.i(\"SharedVM\", \"Sending start mission command with first=0 last=$last\")"},{"type":"INSERT","lineNumber":148,"content":"                    Log.w(\"SharedVM\", \"No mission uploaded or acknowledged, cannot start\")"},{"type":"DELETE","lineNumber":144,"oldContent":"                // Step 5: Start the mission"},{"type":"DELETE","lineNumber":145,"oldContent":"                    onResult(false, \"Not connected to vehicle\")"},{"type":"INSERT","lineNumber":150,"content":"                    return@launch"},{"type":"DELETE","lineNumber":147,"oldContent":"                }"},{"type":"DELETE","lineNumber":148,"oldContent":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"INSERT","lineNumber":152,"content":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":151,"oldContent":"                    onResult(false, \"FCU not detected\")"},{"type":"DELETE","lineNumber":154,"oldContent":"                }"},{"type":"DELETE","lineNumber":156,"oldContent":""},{"type":"INSERT","lineNumber":168,"content":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"INSERT","lineNumber":169,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":172,"content":""},{"type":"INSERT","lineNumber":173,"content":"                if (!isInArmableMode) {"},{"type":"INSERT","lineNumber":174,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":175,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":176,"content":""},{"type":"INSERT","lineNumber":180,"content":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"INSERT","lineNumber":181,"content":"                        val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":174,"oldContent":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"DELETE","lineNumber":175,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":179,"oldContent":""},{"type":"DELETE","lineNumber":181,"oldContent":"                if (!isInArmableMode) {"},{"type":"DELETE","lineNumber":182,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":184,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":185,"oldContent":""},{"type":"DELETE","lineNumber":190,"oldContent":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"DELETE","lineNumber":192,"oldContent":"                        val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":205,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":206,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":215,"oldContent":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":217,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":229,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":230,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":231,"content":"                    }"},{"type":"INSERT","lineNumber":232,"content":""},{"type":"INSERT","lineNumber":238,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":237,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":239,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":241,"oldContent":"                    }"},{"type":"DELETE","lineNumber":243,"oldContent":""},{"type":"DELETE","lineNumber":249,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":266,"oldContent":"        timerJob?.cancel()"},{"type":"INSERT","lineNumber":267,"content":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":268,"content":"            if (repo == null) {"},{"type":"INSERT","lineNumber":269,"content":"                Log.w(\"SharedVM\", \"No repo available, cannot request mission readback\")"},{"type":"INSERT","lineNumber":270,"content":"                return@launch"},{"type":"INSERT","lineNumber":271,"content":"            }"},{"type":"INSERT","lineNumber":274,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":276,"content":"            }"},{"type":"DELETE","lineNumber":272,"oldContent":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":274,"oldContent":"            }"},{"type":"DELETE","lineNumber":275,"oldContent":"                Log.w(\"SharedVM\", \"No repo available, cannot request mission readback\")"},{"type":"DELETE","lineNumber":276,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":277,"oldContent":"                return@launch"},{"type":"DELETE","lineNumber":278,"oldContent":"            }"}]},{"timestamp":1758259499795,"changes":[{"type":"DELETE","lineNumber":27,"oldContent":"    private var repo: MavlinkTelemetryRepository? = null"},{"type":"INSERT","lineNumber":28,"content":""},{"type":"INSERT","lineNumber":29,"content":"    fun onPortChange(newValue: String) {"},{"type":"INSERT","lineNumber":30,"content":"        _port.value = newValue"},{"type":"INSERT","lineNumber":31,"content":"    }"},{"type":"INSERT","lineNumber":32,"content":""},{"type":"INSERT","lineNumber":33,"content":"    private var repo: MavlinkTelemetryRepository? = null"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"DELETE","lineNumber":32,"oldContent":""},{"type":"DELETE","lineNumber":34,"oldContent":"    fun onPortChange(newValue: String) {"},{"type":"DELETE","lineNumber":37,"oldContent":"        _port.value = newValue"},{"type":"DELETE","lineNumber":40,"oldContent":"    }"},{"type":"DELETE","lineNumber":43,"oldContent":""},{"type":"DELETE","lineNumber":44,"oldContent":""},{"type":"MODIFY","lineNumber":52,"content":"            if (portInt != null) {","oldContent":"            if (portInt != null) {"},{"type":"INSERT","lineNumber":53,"content":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"DELETE","lineNumber":55,"oldContent":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"INSERT","lineNumber":58,"content":"                }"},{"type":"DELETE","lineNumber":59,"oldContent":"                onResult(false, e.message)"},{"type":"DELETE","lineNumber":60,"oldContent":""},{"type":"MODIFY","lineNumber":62,"content":"","oldContent":"    fun arm() {"},{"type":"INSERT","lineNumber":63,"content":"    fun arm() {"},{"type":"DELETE","lineNumber":72,"oldContent":""},{"type":"DELETE","lineNumber":74,"oldContent":"                if (repo == null) {"},{"type":"INSERT","lineNumber":73,"content":""},{"type":"DELETE","lineNumber":76,"oldContent":"                    Log.w(\"SharedVM\", \"No repo available, cannot upload mission\")"},{"type":"DELETE","lineNumber":78,"oldContent":"                    missionUploaded = false"},{"type":"DELETE","lineNumber":80,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":82,"oldContent":"                    onResult(false, \"Not connected to vehicle\")"},{"type":"DELETE","lineNumber":84,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":86,"oldContent":"                }"},{"type":"INSERT","lineNumber":83,"content":"                if (repo == null) {"},{"type":"INSERT","lineNumber":84,"content":"                    Log.w(\"SharedVM\", \"No repo available, cannot upload mission\")"},{"type":"INSERT","lineNumber":85,"content":"                    missionUploaded = false"},{"type":"INSERT","lineNumber":86,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":87,"content":"                    onResult(false, \"Not connected to vehicle\")"},{"type":"INSERT","lineNumber":88,"content":"                    return@launch"},{"type":"INSERT","lineNumber":89,"content":"                }"},{"type":"INSERT","lineNumber":98,"content":""},{"type":"DELETE","lineNumber":100,"oldContent":""},{"type":"DELETE","lineNumber":109,"oldContent":"                    Log.i(\"SharedVM\", \"Mission upload succeeded (${missionItems.size})\")"},{"type":"DELETE","lineNumber":111,"oldContent":"                    onResult(true, null)"},{"type":"DELETE","lineNumber":113,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":114,"oldContent":"                missionUploaded = false"},{"type":"DELETE","lineNumber":115,"oldContent":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":111,"content":"                    Log.i(\"SharedVM\", \"Mission upload succeeded (${missionItems.size})\")"},{"type":"INSERT","lineNumber":112,"content":"                    onResult(true, null)"},{"type":"DELETE","lineNumber":117,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission upload\", e)"},{"type":"DELETE","lineNumber":120,"oldContent":"                onResult(false, e.message)"},{"type":"DELETE","lineNumber":123,"oldContent":"            }"},{"type":"INSERT","lineNumber":119,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":120,"content":"                missionUploaded = false"},{"type":"INSERT","lineNumber":121,"content":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":122,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":123,"content":"                Log.e(\"SharedVM\", \"Exception during mission upload\", e)"},{"type":"INSERT","lineNumber":124,"content":"                onResult(false, e.message)"},{"type":"INSERT","lineNumber":125,"content":"            }"},{"type":"DELETE","lineNumber":127,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":132,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":133,"oldContent":"                    onResult(true, null)"},{"type":"INSERT","lineNumber":132,"content":"                Log.i(\"SharedVM\", \"Starting mission start sequence...\")"},{"type":"INSERT","lineNumber":133,"content":""},{"type":"DELETE","lineNumber":135,"oldContent":"                val result = repo?.startMission(0, last) ?: false"},{"type":"DELETE","lineNumber":136,"oldContent":"                    return@launch"},{"type":"INSERT","lineNumber":135,"content":"                    Log.w(\"SharedVM\", \"No repo available, cannot start mission\")"},{"type":"INSERT","lineNumber":137,"content":"                    return@launch"},{"type":"DELETE","lineNumber":141,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":143,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":146,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":149,"oldContent":"                }"},{"type":"INSERT","lineNumber":146,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":147,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":151,"oldContent":""},{"type":"INSERT","lineNumber":149,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":153,"oldContent":"                // Check basic prerequisites"},{"type":"INSERT","lineNumber":151,"content":"                }"},{"type":"INSERT","lineNumber":153,"content":""},{"type":"INSERT","lineNumber":154,"content":"                // Check basic prerequisites"},{"type":"DELETE","lineNumber":168,"oldContent":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"DELETE","lineNumber":170,"oldContent":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":172,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"DELETE","lineNumber":173,"oldContent":"                    val modeTimeout = 5000L"},{"type":"DELETE","lineNumber":174,"oldContent":"                    val modeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":170,"content":"                val isInArmableMode = currentMode?.equals(\"Stabilize\", ignoreCase = true) == true ||"},{"type":"INSERT","lineNumber":171,"content":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":176,"oldContent":"                        if (mode?.equals(\"Stabilize\", ignoreCase = true) == true) {"},{"type":"DELETE","lineNumber":178,"oldContent":"                            Log.i(\"SharedVM\", \"✓ Successfully switched to Stabilize mode\")"},{"type":"INSERT","lineNumber":177,"content":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":178,"content":"                    val modeTimeout = 5000L"},{"type":"INSERT","lineNumber":179,"content":"                    val modeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":180,"content":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"INSERT","lineNumber":181,"content":"                        val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":182,"content":"                        if (mode?.equals(\"Stabilize\", ignoreCase = true) == true) {"},{"type":"INSERT","lineNumber":183,"content":"                            Log.i(\"SharedVM\", \"✓ Successfully switched to Stabilize mode\")"},{"type":"DELETE","lineNumber":185,"oldContent":"                    while (System.currentTimeMillis() - modeStart < modeTimeout) {"},{"type":"DELETE","lineNumber":187,"oldContent":"                        val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":205,"oldContent":"                        delay(500)"},{"type":"MODIFY","lineNumber":207,"content":"                        delay(500)","oldContent":"                    }"},{"type":"INSERT","lineNumber":208,"content":"                    }"},{"type":"INSERT","lineNumber":220,"content":"                // Log current mode and armed state before switching to AUTO"},{"type":"INSERT","lineNumber":221,"content":"                Log.i(\"SharedVM\", \"Preparing to switch to AUTO. Current mode: ${_telemetryState.value.mode}, armed: ${_telemetryState.value.armed}\")"},{"type":"INSERT","lineNumber":222,"content":""},{"type":"DELETE","lineNumber":223,"oldContent":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"INSERT","lineNumber":226,"content":"                    val modeChanged = repo?.changeMode(MavMode.AUTO) ?: false"},{"type":"INSERT","lineNumber":227,"content":"                    Log.i(\"SharedVM\", \"Result of changeMode to AUTO: $modeChanged\")"},{"type":"DELETE","lineNumber":229,"oldContent":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":231,"oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"DELETE","lineNumber":233,"oldContent":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"DELETE","lineNumber":235,"oldContent":"                        return@launch"},{"type":"INSERT","lineNumber":237,"content":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":238,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"INSERT","lineNumber":239,"content":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":240,"content":"                        return@launch"},{"type":"INSERT","lineNumber":242,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":242,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":261,"oldContent":"            try {"},{"type":"INSERT","lineNumber":265,"content":"            }"},{"type":"DELETE","lineNumber":268,"oldContent":"            try {"},{"type":"DELETE","lineNumber":270,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":272,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"DELETE","lineNumber":274,"oldContent":"}"},{"type":"DELETE","lineNumber":276,"oldContent":"            }"},{"type":"DELETE","lineNumber":277,"oldContent":"            }"},{"type":"INSERT","lineNumber":276,"content":"            try {"},{"type":"INSERT","lineNumber":277,"content":"                repo?.requestMissionAndLog()"},{"type":"INSERT","lineNumber":279,"content":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":281,"content":"        }"},{"type":"INSERT","lineNumber":282,"content":"    }"},{"type":"INSERT","lineNumber":283,"content":"}"}]},{"timestamp":1758259924725,"changes":[{"type":"MODIFY","lineNumber":28,"content":"","oldContent":""},{"type":"DELETE","lineNumber":30,"oldContent":"    private val _telemetryState = MutableStateFlow(TelemetryState())"},{"type":"DELETE","lineNumber":32,"oldContent":"    val telemetryState: StateFlow<TelemetryState> = _telemetryState.asStateFlow()"},{"type":"DELETE","lineNumber":35,"oldContent":""},{"type":"DELETE","lineNumber":37,"oldContent":"    val isConnected: StateFlow<Boolean> = telemetryState"},{"type":"INSERT","lineNumber":35,"content":"    private val _telemetryState = MutableStateFlow(TelemetryState())"},{"type":"INSERT","lineNumber":36,"content":"    val telemetryState: StateFlow<TelemetryState> = _telemetryState.asStateFlow()"},{"type":"INSERT","lineNumber":37,"content":""},{"type":"INSERT","lineNumber":38,"content":"    val isConnected: StateFlow<Boolean> = telemetryState"},{"type":"INSERT","lineNumber":51,"content":"            val portInt = port.value.toIntOrNull()"},{"type":"DELETE","lineNumber":52,"oldContent":"            if (portInt != null) {"},{"type":"MODIFY","lineNumber":56,"content":"                newRepo.state.collect {","oldContent":"        viewModelScope.launch {"},{"type":"MODIFY","lineNumber":59,"content":"            }","oldContent":"    fun readMissionFromFcu() {"},{"type":"INSERT","lineNumber":61,"content":"    }"},{"type":"DELETE","lineNumber":63,"oldContent":"    }"},{"type":"INSERT","lineNumber":69,"content":"    // Helper: Wait for FCU to be ready for new mission (not in AUTO, not running mission)"},{"type":"INSERT","lineNumber":70,"content":"    private suspend fun waitForFcuReadyForNewMission(timeoutMs: Long = 5000L): Boolean {"},{"type":"INSERT","lineNumber":71,"content":"        val start = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":72,"content":"        while (System.currentTimeMillis() - start < timeoutMs) {"},{"type":"INSERT","lineNumber":73,"content":"            val mode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":74,"content":"            val armed = _telemetryState.value.armed"},{"type":"INSERT","lineNumber":75,"content":"            val completed = _telemetryState.value.missionCompleted"},{"type":"INSERT","lineNumber":76,"content":"            // FCU is ready if not in AUTO, not armed, and missionCompleted is true"},{"type":"INSERT","lineNumber":77,"content":"            if ((mode?.contains(\"Auto\", ignoreCase = true) != true) && !armed && completed) {"},{"type":"INSERT","lineNumber":78,"content":"                return true"},{"type":"INSERT","lineNumber":79,"content":"            }"},{"type":"INSERT","lineNumber":80,"content":"            delay(500)"},{"type":"INSERT","lineNumber":81,"content":"        }"},{"type":"INSERT","lineNumber":82,"content":"        return false"},{"type":"INSERT","lineNumber":83,"content":"    }"},{"type":"INSERT","lineNumber":84,"content":""},{"type":"DELETE","lineNumber":72,"oldContent":""},{"type":"INSERT","lineNumber":89,"content":""},{"type":"INSERT","lineNumber":90,"content":"                // Wait for FCU to be ready for new mission"},{"type":"INSERT","lineNumber":91,"content":"                val ready = waitForFcuReadyForNewMission()"},{"type":"INSERT","lineNumber":92,"content":"                if (!ready) {"},{"type":"INSERT","lineNumber":93,"content":"                    Log.w(\"SharedVM\", \"FCU not ready for new mission upload (still in AUTO or armed)\")"},{"type":"INSERT","lineNumber":94,"content":"                    onResult(false, \"FCU not ready for new mission. Please wait for mission completion and disarm.\")"},{"type":"INSERT","lineNumber":95,"content":"                    return@launch"},{"type":"INSERT","lineNumber":96,"content":"                }"},{"type":"INSERT","lineNumber":97,"content":""},{"type":"DELETE","lineNumber":78,"oldContent":"                if (repo == null) {"},{"type":"INSERT","lineNumber":103,"content":"                    Log.i(\"SharedVM\", \"Resetting missionCompleted flag for new upload\")"},{"type":"INSERT","lineNumber":104,"content":"                    _telemetryState.value = _telemetryState.value.copy(missionCompleted = false, missionElapsedSec = null)"},{"type":"INSERT","lineNumber":105,"content":"                }"},{"type":"INSERT","lineNumber":106,"content":""},{"type":"INSERT","lineNumber":107,"content":"                if (repo == null) {"},{"type":"DELETE","lineNumber":82,"oldContent":"                    Log.i(\"SharedVM\", \"Resetting missionCompleted flag for new upload\")"},{"type":"DELETE","lineNumber":85,"oldContent":"                    _telemetryState.value = _telemetryState.value.copy(missionCompleted = false, missionElapsedSec = null)"},{"type":"DELETE","lineNumber":88,"oldContent":"                }"},{"type":"DELETE","lineNumber":90,"oldContent":""},{"type":"INSERT","lineNumber":134,"content":""},{"type":"DELETE","lineNumber":112,"oldContent":""},{"type":"DELETE","lineNumber":115,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":140,"content":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":141,"content":"                    onResult(false, \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":142,"content":"                }"},{"type":"INSERT","lineNumber":143,"content":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":119,"oldContent":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":121,"oldContent":"                    onResult(false, \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":124,"oldContent":"                }"},{"type":"INSERT","lineNumber":153,"content":"    // Helper: Robustly switch to AUTO mode with retries and checks"},{"type":"INSERT","lineNumber":154,"content":"    private suspend fun robustSwitchToAutoMode(maxRetries: Int = 3): Boolean {"},{"type":"INSERT","lineNumber":155,"content":"        for (attempt in 1..maxRetries) {"},{"type":"INSERT","lineNumber":156,"content":"            Log.i(\"SharedVM\", \"Attempt $attempt to switch to AUTO mode...\")"},{"type":"INSERT","lineNumber":157,"content":"            val modeChanged = repo?.changeMode(MavMode.AUTO) ?: false"},{"type":"INSERT","lineNumber":158,"content":"            Log.i(\"SharedVM\", \"Result of changeMode to AUTO: $modeChanged\")"},{"type":"INSERT","lineNumber":159,"content":"            if (modeChanged) return true"},{"type":"INSERT","lineNumber":160,"content":"            delay(1000)"},{"type":"INSERT","lineNumber":161,"content":"        }"},{"type":"INSERT","lineNumber":162,"content":"        return false"},{"type":"INSERT","lineNumber":163,"content":"    }"},{"type":"INSERT","lineNumber":164,"content":""},{"type":"DELETE","lineNumber":136,"oldContent":"                    return@launch"},{"type":"INSERT","lineNumber":173,"content":"                    return@launch"},{"type":"DELETE","lineNumber":144,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":145,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":148,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":182,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":183,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":150,"oldContent":"                }"},{"type":"INSERT","lineNumber":185,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":187,"content":"                }"},{"type":"INSERT","lineNumber":188,"content":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":154,"oldContent":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"INSERT","lineNumber":205,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":171,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":173,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":210,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":211,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":212,"content":""},{"type":"INSERT","lineNumber":213,"content":"                    // Wait for mode change to Stabilize"},{"type":"DELETE","lineNumber":177,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":179,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":181,"oldContent":""},{"type":"DELETE","lineNumber":183,"oldContent":"                            break"},{"type":"INSERT","lineNumber":220,"content":"                            break"},{"type":"INSERT","lineNumber":242,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":208,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":221,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"DELETE","lineNumber":223,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":225,"oldContent":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"DELETE","lineNumber":226,"oldContent":""},{"type":"DELETE","lineNumber":227,"oldContent":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"DELETE","lineNumber":228,"oldContent":"                    val modeChanged = repo?.changeMode(MavMode.AUTO) ?: false"},{"type":"DELETE","lineNumber":229,"oldContent":"                    val autoModeTimeout = 8000L"},{"type":"DELETE","lineNumber":230,"oldContent":"                    Log.i(\"SharedVM\", \"Result of changeMode to AUTO: $modeChanged\")"},{"type":"DELETE","lineNumber":231,"oldContent":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":232,"oldContent":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"DELETE","lineNumber":233,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":234,"oldContent":"                        delay(500)"},{"type":"INSERT","lineNumber":259,"content":"                // Step 4: Change mode to Auto (robust)"},{"type":"INSERT","lineNumber":260,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":261,"content":"                    val autoModeSuccess = robustSwitchToAutoMode()"},{"type":"INSERT","lineNumber":262,"content":"                    if (!autoModeSuccess) {"},{"type":"INSERT","lineNumber":263,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode after retries\")"},{"type":"INSERT","lineNumber":264,"content":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":265,"content":"                        return@launch"},{"type":"DELETE","lineNumber":236,"oldContent":""},{"type":"DELETE","lineNumber":237,"oldContent":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":238,"oldContent":"                    }"},{"type":"DELETE","lineNumber":239,"oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"INSERT","lineNumber":267,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":241,"oldContent":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"DELETE","lineNumber":243,"oldContent":"                        return@launch"},{"type":"DELETE","lineNumber":246,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":256,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"DELETE","lineNumber":257,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":258,"oldContent":"            try {"},{"type":"DELETE","lineNumber":259,"oldContent":"            }"},{"type":"DELETE","lineNumber":260,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":281,"content":"                    onResult(true, null)"},{"type":"INSERT","lineNumber":282,"content":"                } else {"},{"type":"INSERT","lineNumber":283,"content":"                    Log.e(\"SharedVM\", \"Mission start failed or not acknowledged\")"},{"type":"INSERT","lineNumber":284,"content":"                    onResult(false, \"Mission start failed. Check vehicle status and try again.\")"},{"type":"INSERT","lineNumber":285,"content":"                }"},{"type":"DELETE","lineNumber":262,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":263,"oldContent":"            try {"},{"type":"INSERT","lineNumber":287,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":288,"content":"                Log.e(\"SharedVM\", \"Failed to start mission\", e)"},{"type":"INSERT","lineNumber":289,"content":"                onResult(false, e.message)"},{"type":"DELETE","lineNumber":268,"oldContent":"            }"},{"type":"DELETE","lineNumber":281,"oldContent":"}"},{"type":"INSERT","lineNumber":308,"content":"}"}]},{"timestamp":1758260134471,"changes":[{"type":"MODIFY","lineNumber":17,"content":"class SharedViewModel : ViewModel() {","oldContent":"    var port by mutableStateOf(\"5762\")"},{"type":"INSERT","lineNumber":27,"content":"    }"},{"type":"DELETE","lineNumber":28,"oldContent":""},{"type":"INSERT","lineNumber":33,"content":"    private var repo: MavlinkTelemetryRepository? = null"},{"type":"INSERT","lineNumber":34,"content":""},{"type":"DELETE","lineNumber":35,"oldContent":"    private var repo: MavlinkTelemetryRepository? = null"},{"type":"DELETE","lineNumber":38,"oldContent":""},{"type":"MODIFY","lineNumber":52,"content":"            if (portInt != null) {","oldContent":"    }"},{"type":"DELETE","lineNumber":54,"oldContent":""},{"type":"DELETE","lineNumber":55,"oldContent":"            }"},{"type":"INSERT","lineNumber":54,"content":"                repo = newRepo"},{"type":"INSERT","lineNumber":55,"content":"                newRepo.start()"},{"type":"DELETE","lineNumber":68,"oldContent":"                        onResult(false, \"Vehicle failed to arm. Check pre-arm conditions.\")"},{"type":"DELETE","lineNumber":69,"oldContent":"    // Helper: Wait for FCU to be ready for new mission (not in AUTO, not running mission)"},{"type":"DELETE","lineNumber":70,"oldContent":"    fun uploadMission(missionItems: List<MissionItemInt>, onResult: (Boolean, String?) -> Unit = { _, _ -> }) {"},{"type":"INSERT","lineNumber":68,"content":""},{"type":"INSERT","lineNumber":69,"content":"    // Helper: Wait for FCU to be ready for new mission (not in AUTO, not armed)"},{"type":"DELETE","lineNumber":72,"oldContent":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":74,"oldContent":"            try {"},{"type":"DELETE","lineNumber":77,"oldContent":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"INSERT","lineNumber":75,"content":"            // FCU is ready if not in AUTO and not armed"},{"type":"INSERT","lineNumber":76,"content":"            if ((mode?.contains(\"Auto\", ignoreCase = true) != true) && !armed) {"},{"type":"INSERT","lineNumber":77,"content":"                return true"},{"type":"INSERT","lineNumber":78,"content":"            }"},{"type":"INSERT","lineNumber":79,"content":"            delay(500)"},{"type":"INSERT","lineNumber":80,"content":"        }"},{"type":"INSERT","lineNumber":81,"content":"        return false"},{"type":"INSERT","lineNumber":82,"content":"    }"},{"type":"INSERT","lineNumber":83,"content":""},{"type":"INSERT","lineNumber":84,"content":"    fun uploadMission(missionItems: List<MissionItemInt>, onResult: (Boolean, String?) -> Unit = { _, _ -> }) {"},{"type":"INSERT","lineNumber":85,"content":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":86,"content":"            try {"},{"type":"INSERT","lineNumber":87,"content":"                Log.i(\"SharedVM\", \"Request to upload mission with ${missionItems.size} items\")"},{"type":"INSERT","lineNumber":88,"content":""},{"type":"INSERT","lineNumber":89,"content":"                // Wait for FCU to be ready for new mission"},{"type":"INSERT","lineNumber":90,"content":"                val ready = waitForFcuReadyForNewMission()"},{"type":"INSERT","lineNumber":91,"content":"                if (!ready) {"},{"type":"INSERT","lineNumber":92,"content":"                    Log.w(\"SharedVM\", \"FCU not ready for new mission upload (still in AUTO or armed)\")"},{"type":"INSERT","lineNumber":93,"content":"                    onResult(false, \"FCU not ready for new mission. Please wait for mission completion and disarm.\")"},{"type":"INSERT","lineNumber":94,"content":"                    return@launch"},{"type":"INSERT","lineNumber":95,"content":"                }"},{"type":"INSERT","lineNumber":96,"content":""},{"type":"DELETE","lineNumber":80,"oldContent":"            val completed = _telemetryState.value.missionCompleted"},{"type":"DELETE","lineNumber":82,"oldContent":"            // FCU is ready if not in AUTO, not armed, and missionCompleted is true"},{"type":"DELETE","lineNumber":84,"oldContent":"            if ((mode?.contains(\"Auto\", ignoreCase = true) != true) && !armed && completed) {"},{"type":"DELETE","lineNumber":86,"oldContent":"                return true"},{"type":"DELETE","lineNumber":87,"oldContent":"            }"},{"type":"DELETE","lineNumber":89,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":102,"content":"                    Log.i(\"SharedVM\", \"Resetting missionCompleted flag for new upload\")"},{"type":"INSERT","lineNumber":103,"content":"                    _telemetryState.value = _telemetryState.value.copy(missionCompleted = false, missionElapsedSec = null)"},{"type":"INSERT","lineNumber":104,"content":"                }"},{"type":"INSERT","lineNumber":105,"content":""},{"type":"INSERT","lineNumber":106,"content":"                if (repo == null) {"},{"type":"DELETE","lineNumber":91,"oldContent":"        }"},{"type":"DELETE","lineNumber":93,"oldContent":"        return false"},{"type":"DELETE","lineNumber":94,"oldContent":"    }"},{"type":"DELETE","lineNumber":96,"oldContent":""},{"type":"DELETE","lineNumber":101,"oldContent":""},{"type":"DELETE","lineNumber":102,"oldContent":"                // Wait for FCU to be ready for new mission"},{"type":"DELETE","lineNumber":103,"oldContent":"                val ready = waitForFcuReadyForNewMission()"},{"type":"DELETE","lineNumber":105,"oldContent":"                if (!ready) {"},{"type":"DELETE","lineNumber":107,"oldContent":"                    Log.w(\"SharedVM\", \"FCU not ready for new mission upload (still in AUTO or armed)\")"},{"type":"DELETE","lineNumber":109,"oldContent":"                    onResult(false, \"FCU not ready for new mission. Please wait for mission completion and disarm.\")"},{"type":"DELETE","lineNumber":111,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":113,"oldContent":"                }"},{"type":"DELETE","lineNumber":115,"oldContent":""},{"type":"DELETE","lineNumber":122,"oldContent":"                    Log.i(\"SharedVM\", \"Resetting missionCompleted flag for new upload\")"},{"type":"DELETE","lineNumber":124,"oldContent":"                    _telemetryState.value = _telemetryState.value.copy(missionCompleted = false, missionElapsedSec = null)"},{"type":"DELETE","lineNumber":126,"oldContent":"                }"},{"type":"DELETE","lineNumber":128,"oldContent":""},{"type":"DELETE","lineNumber":130,"oldContent":"                if (repo == null) {"},{"type":"INSERT","lineNumber":133,"content":""},{"type":"INSERT","lineNumber":139,"content":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":140,"content":"                    onResult(false, \"Mission upload failed or timed out\")"},{"type":"INSERT","lineNumber":141,"content":"                }"},{"type":"INSERT","lineNumber":142,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":152,"content":"    // Helper: Robustly switch to AUTO mode with retries and checks"},{"type":"INSERT","lineNumber":153,"content":"    private suspend fun robustSwitchToAutoMode(maxRetries: Int = 3): Boolean {"},{"type":"INSERT","lineNumber":154,"content":"        for (attempt in 1..maxRetries) {"},{"type":"INSERT","lineNumber":155,"content":"            Log.i(\"SharedVM\", \"Attempt $attempt to switch to AUTO mode...\")"},{"type":"INSERT","lineNumber":156,"content":"            val modeChanged = repo?.changeMode(MavMode.AUTO) ?: false"},{"type":"INSERT","lineNumber":157,"content":"            Log.i(\"SharedVM\", \"Result of changeMode to AUTO: $modeChanged\")"},{"type":"INSERT","lineNumber":158,"content":"            if (modeChanged) return true"},{"type":"INSERT","lineNumber":159,"content":"            delay(1000)"},{"type":"INSERT","lineNumber":160,"content":"        }"},{"type":"INSERT","lineNumber":161,"content":"        return false"},{"type":"INSERT","lineNumber":162,"content":"    }"},{"type":"INSERT","lineNumber":163,"content":""},{"type":"DELETE","lineNumber":153,"oldContent":""},{"type":"INSERT","lineNumber":172,"content":"                    return@launch"},{"type":"DELETE","lineNumber":159,"oldContent":"                    Log.e(\"SharedVM\", \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":161,"oldContent":"                    onResult(false, \"Mission upload failed or timed out\")"},{"type":"DELETE","lineNumber":163,"oldContent":"                }"},{"type":"DELETE","lineNumber":165,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":181,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":182,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"INSERT","lineNumber":184,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":186,"content":"                }"},{"type":"INSERT","lineNumber":187,"content":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":172,"oldContent":"    // Helper: Robustly switch to AUTO mode with retries and checks"},{"type":"DELETE","lineNumber":174,"oldContent":"    private suspend fun robustSwitchToAutoMode(maxRetries: Int = 3): Boolean {"},{"type":"DELETE","lineNumber":175,"oldContent":"        for (attempt in 1..maxRetries) {"},{"type":"DELETE","lineNumber":177,"oldContent":"            Log.i(\"SharedVM\", \"Attempt $attempt to switch to AUTO mode...\")"},{"type":"DELETE","lineNumber":179,"oldContent":"            val modeChanged = repo?.changeMode(MavMode.AUTO) ?: false"},{"type":"DELETE","lineNumber":181,"oldContent":"            Log.i(\"SharedVM\", \"Result of changeMode to AUTO: $modeChanged\")"},{"type":"DELETE","lineNumber":183,"oldContent":"            if (modeChanged) return true"},{"type":"DELETE","lineNumber":185,"oldContent":"            delay(1000)"},{"type":"DELETE","lineNumber":187,"oldContent":"        }"},{"type":"DELETE","lineNumber":189,"oldContent":"        return false"},{"type":"DELETE","lineNumber":191,"oldContent":"    }"},{"type":"DELETE","lineNumber":193,"oldContent":""},{"type":"INSERT","lineNumber":204,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":202,"oldContent":"                    return@launch"},{"type":"INSERT","lineNumber":209,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":210,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":211,"content":""},{"type":"INSERT","lineNumber":212,"content":"                    // Wait for mode change to Stabilize"},{"type":"DELETE","lineNumber":208,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":210,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":212,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":219,"content":"                            break"},{"type":"DELETE","lineNumber":215,"oldContent":"                }"},{"type":"DELETE","lineNumber":217,"oldContent":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":235,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":241,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":240,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":242,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":244,"oldContent":""},{"type":"DELETE","lineNumber":246,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"DELETE","lineNumber":252,"oldContent":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"INSERT","lineNumber":253,"content":"                }"},{"type":"DELETE","lineNumber":254,"oldContent":"                            break"},{"type":"INSERT","lineNumber":258,"content":"                // Step 4: Change mode to Auto (robust)"},{"type":"INSERT","lineNumber":259,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":260,"content":"                    val autoModeSuccess = robustSwitchToAutoMode()"},{"type":"INSERT","lineNumber":261,"content":"                    if (!autoModeSuccess) {"},{"type":"INSERT","lineNumber":262,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode after retries\")"},{"type":"INSERT","lineNumber":263,"content":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":264,"content":"                        return@launch"},{"type":"INSERT","lineNumber":266,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":260,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":266,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"DELETE","lineNumber":267,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"INSERT","lineNumber":273,"content":""},{"type":"INSERT","lineNumber":274,"content":"                // Step 5: Start the mission"},{"type":"DELETE","lineNumber":269,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":276,"content":"                val result = repo?.startMission() ?: false"},{"type":"DELETE","lineNumber":271,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":272,"oldContent":"            try {"},{"type":"DELETE","lineNumber":273,"oldContent":"                // Step 4: Change mode to Auto (robust)"},{"type":"DELETE","lineNumber":274,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":275,"oldContent":"                    val autoModeSuccess = robustSwitchToAutoMode()"},{"type":"INSERT","lineNumber":278,"content":"                if (result) {"},{"type":"INSERT","lineNumber":279,"content":"                    Log.i(\"SharedVM\", \"✓ Mission start acknowledged by FCU\")"},{"type":"INSERT","lineNumber":280,"content":"                    onResult(true, null)"},{"type":"INSERT","lineNumber":281,"content":"                } else {"},{"type":"INSERT","lineNumber":282,"content":"                    Log.e(\"SharedVM\", \"Mission start failed or not acknowledged\")"},{"type":"INSERT","lineNumber":283,"content":"                    onResult(false, \"Mission start failed. Check vehicle status and try again.\")"},{"type":"INSERT","lineNumber":284,"content":"                }"},{"type":"DELETE","lineNumber":277,"oldContent":"                    if (!autoModeSuccess) {"},{"type":"DELETE","lineNumber":278,"oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode after retries\")"},{"type":"DELETE","lineNumber":279,"oldContent":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"DELETE","lineNumber":280,"oldContent":"    // Call this to stop the timer when mission ends"},{"type":"DELETE","lineNumber":281,"oldContent":"                        return@launch"},{"type":"INSERT","lineNumber":286,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":287,"content":"                Log.e(\"SharedVM\", \"Failed to start mission\", e)"},{"type":"INSERT","lineNumber":288,"content":"                onResult(false, e.message)"},{"type":"INSERT","lineNumber":289,"content":"            }"},{"type":"DELETE","lineNumber":284,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":298,"oldContent":"                    onResult(true, null)"},{"type":"DELETE","lineNumber":299,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":301,"oldContent":"                    Log.e(\"SharedVM\", \"Mission start failed or not acknowledged\")"},{"type":"DELETE","lineNumber":303,"oldContent":"                    onResult(false, \"Mission start failed. Check vehicle status and try again.\")"},{"type":"DELETE","lineNumber":305,"oldContent":"                }"},{"type":"DELETE","lineNumber":306,"oldContent":"                onResult(false, e.message)"},{"type":"DELETE","lineNumber":307,"oldContent":"                Log.e(\"SharedVM\", \"Failed to start mission\", e)"},{"type":"DELETE","lineNumber":308,"oldContent":"            } catch (e: Exception) {"}]},{"timestamp":1758261332434,"changes":[{"type":"MODIFY","lineNumber":35,"content":"    private val _telemetryState = MutableStateFlow(TelemetryState())","oldContent":"    private val _telemetryState = MutableStateFlow(TelemetryState())"},{"type":"MODIFY","lineNumber":57,"content":"                    _telemetryState.value = it","oldContent":"                    onResult(false, \"Mission start failed. Check vehicle status and try again.\")"},{"type":"DELETE","lineNumber":69,"oldContent":"    // Helper: Wait for FCU to be ready for new mission (not in AUTO, not armed)"},{"type":"DELETE","lineNumber":70,"oldContent":"    private suspend fun waitForFcuReadyForNewMission(timeoutMs: Long = 5000L): Boolean {"},{"type":"DELETE","lineNumber":71,"oldContent":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":72,"oldContent":"            // FCU is ready if not in AUTO and not armed"},{"type":"DELETE","lineNumber":73,"oldContent":"        while (System.currentTimeMillis() - start < timeoutMs) {"},{"type":"DELETE","lineNumber":74,"oldContent":"            if ((mode?.contains(\"Auto\", ignoreCase = true) != true) && !armed) {"},{"type":"DELETE","lineNumber":75,"oldContent":"            val mode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":76,"oldContent":"                return true"},{"type":"DELETE","lineNumber":77,"oldContent":"            }"},{"type":"DELETE","lineNumber":78,"oldContent":"            val armed = _telemetryState.value.armed"},{"type":"DELETE","lineNumber":79,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":80,"oldContent":"                // Reset mission state before attempting new upload"},{"type":"DELETE","lineNumber":81,"oldContent":"        }"},{"type":"DELETE","lineNumber":82,"oldContent":"        return false"},{"type":"DELETE","lineNumber":83,"oldContent":"                missionUploaded = false"},{"type":"DELETE","lineNumber":84,"oldContent":"    }"},{"type":"DELETE","lineNumber":85,"oldContent":""},{"type":"DELETE","lineNumber":86,"oldContent":"                lastUploadedCount = 0"},{"type":"DELETE","lineNumber":89,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":93,"oldContent":"                if (_telemetryState.value.missionCompleted) {"},{"type":"DELETE","lineNumber":94,"oldContent":"                // Wait for FCU to be ready for new mission"},{"type":"DELETE","lineNumber":95,"oldContent":"                val ready = waitForFcuReadyForNewMission()"},{"type":"INSERT","lineNumber":74,"content":"                if (repo == null) {"},{"type":"DELETE","lineNumber":97,"oldContent":"                if (!ready) {"},{"type":"DELETE","lineNumber":98,"oldContent":"                    Log.w(\"SharedVM\", \"FCU not ready for new mission upload (still in AUTO or armed)\")"},{"type":"DELETE","lineNumber":100,"oldContent":"                    onResult(false, \"FCU not ready for new mission. Please wait for mission completion and disarm.\")"},{"type":"DELETE","lineNumber":101,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":102,"oldContent":"                }"},{"type":"DELETE","lineNumber":104,"oldContent":""},{"type":"DELETE","lineNumber":109,"oldContent":"                    Log.i(\"SharedVM\", \"Resetting missionCompleted flag for new upload\")"},{"type":"DELETE","lineNumber":110,"oldContent":"                    _telemetryState.value = _telemetryState.value.copy(missionCompleted = false, missionElapsedSec = null)"},{"type":"INSERT","lineNumber":82,"content":"                if (_telemetryState.value.missionCompleted) {"},{"type":"INSERT","lineNumber":83,"content":"                    Log.w(\"SharedVM\", \"Mission already completed, cannot upload new mission until reset\")"},{"type":"INSERT","lineNumber":84,"content":"                    missionUploaded = false"},{"type":"INSERT","lineNumber":85,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":86,"content":"                    onResult(false, \"Mission already completed. Please reset or reconnect before uploading a new mission.\")"},{"type":"INSERT","lineNumber":87,"content":"                    return@launch"},{"type":"DELETE","lineNumber":112,"oldContent":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"DELETE","lineNumber":114,"oldContent":"                if (repo == null) {"},{"type":"INSERT","lineNumber":90,"content":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"DELETE","lineNumber":132,"oldContent":""},{"type":"INSERT","lineNumber":109,"content":""},{"type":"DELETE","lineNumber":140,"oldContent":"                missionUploaded = false"},{"type":"DELETE","lineNumber":142,"oldContent":"                lastUploadedCount = 0"},{"type":"DELETE","lineNumber":144,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":119,"content":"                missionUploaded = false"},{"type":"INSERT","lineNumber":120,"content":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":121,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":156,"oldContent":"    // Helper: Robustly switch to AUTO mode with retries and checks"},{"type":"DELETE","lineNumber":158,"oldContent":"    private suspend fun robustSwitchToAutoMode(maxRetries: Int = 3): Boolean {"},{"type":"DELETE","lineNumber":159,"oldContent":"        for (attempt in 1..maxRetries) {"},{"type":"DELETE","lineNumber":161,"oldContent":"            Log.i(\"SharedVM\", \"Attempt $attempt to switch to AUTO mode...\")"},{"type":"DELETE","lineNumber":163,"oldContent":"            val modeChanged = repo?.changeMode(MavMode.AUTO) ?: false"},{"type":"DELETE","lineNumber":165,"oldContent":"            Log.i(\"SharedVM\", \"Result of changeMode to AUTO: $modeChanged\")"},{"type":"INSERT","lineNumber":136,"content":"                    return@launch"},{"type":"DELETE","lineNumber":167,"oldContent":"            if (modeChanged) return true"},{"type":"DELETE","lineNumber":169,"oldContent":"            delay(1000)"},{"type":"DELETE","lineNumber":170,"oldContent":"        }"},{"type":"DELETE","lineNumber":172,"oldContent":"        return false"},{"type":"DELETE","lineNumber":173,"oldContent":"    }"},{"type":"DELETE","lineNumber":175,"oldContent":""},{"type":"INSERT","lineNumber":145,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":146,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"INSERT","lineNumber":148,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":150,"content":"                }"},{"type":"INSERT","lineNumber":151,"content":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":183,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":188,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":189,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":191,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":193,"oldContent":"                }"},{"type":"DELETE","lineNumber":195,"oldContent":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"INSERT","lineNumber":168,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":208,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"INSERT","lineNumber":173,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":174,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":175,"content":""},{"type":"INSERT","lineNumber":176,"content":"                    // Wait for mode change to Stabilize"},{"type":"DELETE","lineNumber":213,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":215,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":216,"oldContent":""},{"type":"DELETE","lineNumber":218,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":183,"content":"                            break"},{"type":"DELETE","lineNumber":223,"oldContent":"                            break"},{"type":"INSERT","lineNumber":205,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":244,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":255,"oldContent":"                // Log current mode and armed state before switching to AUTO"},{"type":"DELETE","lineNumber":256,"oldContent":"                Log.i(\"SharedVM\", \"Preparing to switch to AUTO. Current mode: ${_telemetryState.value.mode}, armed: ${_telemetryState.value.armed}\")"},{"type":"INSERT","lineNumber":219,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":220,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":221,"content":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"INSERT","lineNumber":222,"content":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":258,"oldContent":"                // Step 4: Change mode to Auto (robust)"},{"type":"INSERT","lineNumber":224,"content":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"INSERT","lineNumber":225,"content":"                    val autoModeTimeout = 8000L"},{"type":"INSERT","lineNumber":226,"content":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":227,"content":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"INSERT","lineNumber":228,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":229,"content":"                        delay(500)"},{"type":"DELETE","lineNumber":260,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":261,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":262,"oldContent":"                    val autoModeSuccess = robustSwitchToAutoMode()"},{"type":"DELETE","lineNumber":263,"oldContent":"                    if (!autoModeSuccess) {"},{"type":"DELETE","lineNumber":264,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":265,"oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode after retries\")"},{"type":"DELETE","lineNumber":266,"oldContent":"                }"},{"type":"DELETE","lineNumber":267,"oldContent":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":232,"content":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":233,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"INSERT","lineNumber":234,"content":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"DELETE","lineNumber":270,"oldContent":"            if (repo == null) {"},{"type":"DELETE","lineNumber":271,"oldContent":"                }"},{"type":"INSERT","lineNumber":236,"content":"                    }"},{"type":"DELETE","lineNumber":273,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"INSERT","lineNumber":238,"content":"                } else {"},{"type":"INSERT","lineNumber":239,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle already in AUTO mode\")"},{"type":"INSERT","lineNumber":240,"content":"                }"},{"type":"INSERT","lineNumber":242,"content":"                // Give a small delay to ensure all mode changes are processed"},{"type":"INSERT","lineNumber":243,"content":"                delay(1000)"},{"type":"INSERT","lineNumber":246,"content":"                Log.i(\"SharedVM\", \"Sending start mission command\")"},{"type":"DELETE","lineNumber":284,"oldContent":"        }"},{"type":"DELETE","lineNumber":286,"oldContent":"    }"},{"type":"DELETE","lineNumber":290,"oldContent":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"DELETE","lineNumber":292,"oldContent":"    fun readMissionFromFcu() {"},{"type":"DELETE","lineNumber":294,"oldContent":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":261,"content":"        }"},{"type":"INSERT","lineNumber":262,"content":"    }"},{"type":"INSERT","lineNumber":263,"content":""},{"type":"INSERT","lineNumber":264,"content":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"INSERT","lineNumber":265,"content":"    fun readMissionFromFcu() {"},{"type":"INSERT","lineNumber":266,"content":"        viewModelScope.launch {"}]},{"timestamp":1758274051638,"changes":[{"type":"INSERT","lineNumber":34,"content":""},{"type":"DELETE","lineNumber":35,"oldContent":"    private val _telemetryState = MutableStateFlow(TelemetryState())"},{"type":"DELETE","lineNumber":65,"oldContent":"                // Give a small delay to ensure all mode changes are processed"},{"type":"DELETE","lineNumber":66,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already in AUTO mode\")"},{"type":"DELETE","lineNumber":67,"oldContent":"                        delay(500)"},{"type":"INSERT","lineNumber":65,"content":"            repo?.arm()"},{"type":"INSERT","lineNumber":66,"content":"        }"},{"type":"INSERT","lineNumber":67,"content":"    }"},{"type":"DELETE","lineNumber":69,"oldContent":"                if (repo == null) {"},{"type":"DELETE","lineNumber":70,"oldContent":"                if (_telemetryState.value.missionCompleted) {"},{"type":"DELETE","lineNumber":71,"oldContent":"                    Log.w(\"SharedVM\", \"Mission already completed, cannot upload new mission until reset\")"},{"type":"DELETE","lineNumber":72,"oldContent":"                    missionUploaded = false"},{"type":"DELETE","lineNumber":73,"oldContent":"                    lastUploadedCount = 0"},{"type":"DELETE","lineNumber":74,"oldContent":"                    onResult(false, \"Mission already completed. Please reset or reconnect before uploading a new mission.\")"},{"type":"DELETE","lineNumber":75,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":78,"oldContent":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"INSERT","lineNumber":74,"content":"                if (repo == null) {"},{"type":"DELETE","lineNumber":89,"oldContent":""},{"type":"DELETE","lineNumber":90,"oldContent":"                }"},{"type":"DELETE","lineNumber":91,"oldContent":""},{"type":"INSERT","lineNumber":82,"content":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"DELETE","lineNumber":96,"oldContent":"                missionUploaded = false"},{"type":"DELETE","lineNumber":98,"oldContent":"                lastUploadedCount = 0"},{"type":"DELETE","lineNumber":100,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":90,"content":"                // Always clear previous mission in FCU before uploading new one (handled in repo)"},{"type":"INSERT","lineNumber":102,"content":""},{"type":"DELETE","lineNumber":115,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":122,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":124,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"INSERT","lineNumber":112,"content":"                missionUploaded = false"},{"type":"INSERT","lineNumber":113,"content":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":114,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":127,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":130,"oldContent":"                }"},{"type":"DELETE","lineNumber":132,"oldContent":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"INSERT","lineNumber":129,"content":"                    return@launch"},{"type":"DELETE","lineNumber":143,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":146,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":147,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":149,"oldContent":""},{"type":"DELETE","lineNumber":150,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":138,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":139,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"INSERT","lineNumber":141,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":143,"content":"                }"},{"type":"INSERT","lineNumber":144,"content":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":158,"oldContent":"                            break"},{"type":"INSERT","lineNumber":161,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":175,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":166,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":167,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":168,"content":""},{"type":"INSERT","lineNumber":169,"content":"                    // Wait for mode change to Stabilize"},{"type":"DELETE","lineNumber":185,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":176,"content":"                            break"},{"type":"DELETE","lineNumber":187,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":189,"oldContent":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"DELETE","lineNumber":191,"oldContent":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":193,"oldContent":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"DELETE","lineNumber":195,"oldContent":"                    val autoModeTimeout = 8000L"},{"type":"DELETE","lineNumber":197,"oldContent":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":199,"oldContent":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"DELETE","lineNumber":201,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":203,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":207,"oldContent":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":209,"oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"DELETE","lineNumber":211,"oldContent":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"DELETE","lineNumber":214,"oldContent":"                    }"},{"type":"DELETE","lineNumber":217,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":219,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already in AUTO mode\")"},{"type":"DELETE","lineNumber":221,"oldContent":"                }"},{"type":"INSERT","lineNumber":198,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":224,"oldContent":"                // Give a small delay to ensure all mode changes are processed"},{"type":"DELETE","lineNumber":226,"oldContent":"                delay(1000)"},{"type":"DELETE","lineNumber":229,"oldContent":"                Log.i(\"SharedVM\", \"Sending start mission command\")"},{"type":"INSERT","lineNumber":212,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":213,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":214,"content":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"INSERT","lineNumber":215,"content":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"INSERT","lineNumber":217,"content":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"INSERT","lineNumber":218,"content":"                    val autoModeTimeout = 8000L"},{"type":"INSERT","lineNumber":219,"content":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":220,"content":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"INSERT","lineNumber":221,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":222,"content":"                        delay(500)"},{"type":"DELETE","lineNumber":241,"oldContent":"        }"},{"type":"DELETE","lineNumber":242,"oldContent":"    }"},{"type":"DELETE","lineNumber":244,"oldContent":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"DELETE","lineNumber":245,"oldContent":"    fun readMissionFromFcu() {"},{"type":"DELETE","lineNumber":246,"oldContent":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":247,"oldContent":""},{"type":"INSERT","lineNumber":225,"content":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":226,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"INSERT","lineNumber":227,"content":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":229,"content":"                    }"},{"type":"INSERT","lineNumber":231,"content":"                } else {"},{"type":"INSERT","lineNumber":232,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle already in AUTO mode\")"},{"type":"INSERT","lineNumber":233,"content":"                }"},{"type":"INSERT","lineNumber":235,"content":"                // Give a small delay to ensure all mode changes are processed"},{"type":"INSERT","lineNumber":236,"content":"                delay(1000)"},{"type":"INSERT","lineNumber":239,"content":"                Log.i(\"SharedVM\", \"Sending start mission command\")"},{"type":"INSERT","lineNumber":254,"content":"        }"},{"type":"INSERT","lineNumber":255,"content":"    }"},{"type":"INSERT","lineNumber":256,"content":""},{"type":"INSERT","lineNumber":257,"content":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"INSERT","lineNumber":258,"content":"    fun readMissionFromFcu() {"},{"type":"INSERT","lineNumber":259,"content":"        viewModelScope.launch {"}]},{"timestamp":1758276942866,"changes":[{"type":"MODIFY","lineNumber":64,"content":"        viewModelScope.launch {","oldContent":"                val result = repo?.startMission(0, last) ?: false"},{"type":"DELETE","lineNumber":69,"oldContent":"                if (repo == null) {"},{"type":"DELETE","lineNumber":75,"oldContent":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"INSERT","lineNumber":74,"content":"                if (repo == null) {"},{"type":"DELETE","lineNumber":83,"oldContent":"                // Always clear previous mission in FCU before uploading new one (handled in repo)"},{"type":"INSERT","lineNumber":82,"content":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"DELETE","lineNumber":91,"oldContent":""},{"type":"INSERT","lineNumber":90,"content":"                // Always clear previous mission in FCU before uploading new one (handled in repo)"},{"type":"DELETE","lineNumber":102,"oldContent":"                missionUploaded = false"},{"type":"DELETE","lineNumber":104,"oldContent":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":102,"content":""},{"type":"DELETE","lineNumber":106,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":112,"content":"                missionUploaded = false"},{"type":"INSERT","lineNumber":113,"content":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":114,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":118,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":126,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":128,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":131,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":129,"content":"                    return@launch"},{"type":"DELETE","lineNumber":134,"oldContent":"                }"},{"type":"DELETE","lineNumber":135,"oldContent":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"INSERT","lineNumber":138,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":139,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"INSERT","lineNumber":141,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":143,"content":"                }"},{"type":"INSERT","lineNumber":144,"content":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":148,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":154,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":156,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":158,"oldContent":""},{"type":"DELETE","lineNumber":160,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":161,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":167,"oldContent":"                            break"},{"type":"INSERT","lineNumber":166,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":167,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":168,"content":""},{"type":"INSERT","lineNumber":169,"content":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":176,"content":"                            break"},{"type":"DELETE","lineNumber":183,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":192,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"DELETE","lineNumber":194,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":196,"oldContent":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"DELETE","lineNumber":197,"oldContent":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":200,"oldContent":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"DELETE","lineNumber":201,"oldContent":"                    val autoModeTimeout = 8000L"},{"type":"DELETE","lineNumber":203,"oldContent":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":204,"oldContent":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"DELETE","lineNumber":206,"oldContent":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"DELETE","lineNumber":207,"oldContent":"                        delay(500)"},{"type":"INSERT","lineNumber":198,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":210,"oldContent":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":212,"oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"DELETE","lineNumber":213,"oldContent":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"DELETE","lineNumber":216,"oldContent":"                    }"},{"type":"DELETE","lineNumber":218,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":220,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already in AUTO mode\")"},{"type":"DELETE","lineNumber":222,"oldContent":"                }"},{"type":"DELETE","lineNumber":225,"oldContent":"                // Give a small delay to ensure all mode changes are processed"},{"type":"DELETE","lineNumber":227,"oldContent":"                delay(1000)"},{"type":"DELETE","lineNumber":231,"oldContent":"                Log.i(\"SharedVM\", \"Sending start mission command\")"},{"type":"INSERT","lineNumber":212,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":213,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":214,"content":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"INSERT","lineNumber":215,"content":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"INSERT","lineNumber":217,"content":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"INSERT","lineNumber":218,"content":"                    val autoModeTimeout = 8000L"},{"type":"INSERT","lineNumber":219,"content":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":220,"content":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"INSERT","lineNumber":221,"content":"                        System.currentTimeMillis() - autoModeStart < autoModeTimeout) {"},{"type":"INSERT","lineNumber":222,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":225,"content":"                    if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":226,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not switch to AUTO mode within timeout\")"},{"type":"INSERT","lineNumber":227,"content":"                        onResult(false, \"Failed to switch to AUTO mode. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":229,"content":"                    }"},{"type":"INSERT","lineNumber":231,"content":"                } else {"},{"type":"INSERT","lineNumber":232,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle already in AUTO mode\")"},{"type":"INSERT","lineNumber":233,"content":"                }"},{"type":"INSERT","lineNumber":235,"content":"                // Give a small delay to ensure all mode changes are processed"},{"type":"INSERT","lineNumber":236,"content":"                delay(1000)"},{"type":"INSERT","lineNumber":239,"content":"                Log.i(\"SharedVM\", \"Sending start mission command\")"},{"type":"DELETE","lineNumber":241,"oldContent":"        }"},{"type":"DELETE","lineNumber":243,"oldContent":"    }"},{"type":"DELETE","lineNumber":245,"oldContent":""},{"type":"DELETE","lineNumber":247,"oldContent":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"DELETE","lineNumber":249,"oldContent":"    fun readMissionFromFcu() {"},{"type":"DELETE","lineNumber":251,"oldContent":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":254,"content":"        }"},{"type":"INSERT","lineNumber":255,"content":"    }"},{"type":"INSERT","lineNumber":256,"content":""},{"type":"INSERT","lineNumber":257,"content":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"INSERT","lineNumber":258,"content":"    fun readMissionFromFcu() {"},{"type":"INSERT","lineNumber":259,"content":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":271,"content":""},{"type":"INSERT","lineNumber":272,"content":"    fun cancelConnection() {"},{"type":"INSERT","lineNumber":273,"content":"        // Cancel any ongoing connection coroutine (handled by ConnectionPage)"},{"type":"INSERT","lineNumber":274,"content":"        // Attempt to close/flush the repo's socket/connection if possible"},{"type":"INSERT","lineNumber":275,"content":"        repo?.let {"},{"type":"INSERT","lineNumber":276,"content":"            try {"},{"type":"INSERT","lineNumber":277,"content":"                // If your repo has a close/disconnect method, call it here"},{"type":"INSERT","lineNumber":278,"content":"                if (it is MavlinkTelemetryRepository) {"},{"type":"INSERT","lineNumber":279,"content":"                    it.closeConnection()"},{"type":"INSERT","lineNumber":280,"content":"                }"},{"type":"INSERT","lineNumber":281,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":282,"content":"                Log.e(\"SharedVM\", \"Error closing connection\", e)"},{"type":"INSERT","lineNumber":283,"content":"            }"},{"type":"INSERT","lineNumber":284,"content":"        }"},{"type":"INSERT","lineNumber":285,"content":"        repo = null"},{"type":"INSERT","lineNumber":286,"content":"        _telemetryState.value = TelemetryState() // Reset state"},{"type":"INSERT","lineNumber":287,"content":"    }"}]},{"timestamp":1758277005484,"changes":[{"type":"MODIFY","lineNumber":74,"content":"                if (repo == null) {","oldContent":"                if (repo == null) {"},{"type":"MODIFY","lineNumber":82,"content":"                if (!_telemetryState.value.fcuDetected) {","oldContent":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"MODIFY","lineNumber":90,"content":"                // Always clear previous mission in FCU before uploading new one (handled in repo)","oldContent":"                // Always clear previous mission in FCU before uploading new one (handled in repo)"},{"type":"MODIFY","lineNumber":102,"content":"","oldContent":""},{"type":"DELETE","lineNumber":109,"oldContent":"                missionUploaded = false"},{"type":"DELETE","lineNumber":111,"oldContent":"                lastUploadedCount = 0"},{"type":"DELETE","lineNumber":113,"oldContent":"                _uploadedWaypoints.value = emptyList()"},{"type":"INSERT","lineNumber":112,"content":"                missionUploaded = false"},{"type":"INSERT","lineNumber":113,"content":"                lastUploadedCount = 0"},{"type":"INSERT","lineNumber":114,"content":"                _uploadedWaypoints.value = emptyList()"},{"type":"DELETE","lineNumber":126,"oldContent":"                    return@launch"},{"type":"INSERT","lineNumber":129,"content":"                    return@launch"},{"type":"DELETE","lineNumber":133,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":135,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":138,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":141,"oldContent":"                }"},{"type":"INSERT","lineNumber":138,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":139,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":143,"oldContent":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"INSERT","lineNumber":141,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":143,"content":"                }"},{"type":"INSERT","lineNumber":144,"content":"                Log.i(\"SharedVM\", \"✓ Mission upload acknowledged (${lastUploadedCount} items)\")"},{"type":"DELETE","lineNumber":156,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":162,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":161,"content":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":164,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":165,"oldContent":""},{"type":"DELETE","lineNumber":167,"oldContent":"                    // Wait for mode change to Stabilize"},{"type":"INSERT","lineNumber":166,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":167,"content":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":168,"content":""},{"type":"INSERT","lineNumber":169,"content":"                    // Wait for mode change to Stabilize"},{"type":"MODIFY","lineNumber":176,"content":"                            break","oldContent":"                            break"},{"type":"MODIFY","lineNumber":188,"content":"                }","oldContent":"            }"},{"type":"DELETE","lineNumber":193,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":198,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":201,"content":""},{"type":"INSERT","lineNumber":202,"content":"                    if (!_telemetryState.value.armed) {"},{"type":"INSERT","lineNumber":203,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not arm within timeout\")"},{"type":"INSERT","lineNumber":204,"content":"                        onResult(false, \"Vehicle failed to arm. Check pre-arm conditions.\")"},{"type":"INSERT","lineNumber":205,"content":"                        return@launch"},{"type":"INSERT","lineNumber":206,"content":"                    }"},{"type":"INSERT","lineNumber":207,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle armed successfully\")"},{"type":"INSERT","lineNumber":208,"content":"                } else {"},{"type":"INSERT","lineNumber":209,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle already armed\")"},{"type":"INSERT","lineNumber":210,"content":"                }"},{"type":"INSERT","lineNumber":211,"content":""},{"type":"DELETE","lineNumber":204,"oldContent":""},{"type":"DELETE","lineNumber":206,"oldContent":"                    if (!_telemetryState.value.armed) {"},{"type":"INSERT","lineNumber":216,"content":""},{"type":"DELETE","lineNumber":208,"oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not arm within timeout\")"},{"type":"DELETE","lineNumber":211,"oldContent":"                        onResult(false, \"Vehicle failed to arm. Check pre-arm conditions.\")"},{"type":"DELETE","lineNumber":214,"oldContent":"                        return@launch"},{"type":"DELETE","lineNumber":217,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle armed successfully\")"},{"type":"INSERT","lineNumber":224,"content":""},{"type":"DELETE","lineNumber":220,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":222,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already armed\")"},{"type":"INSERT","lineNumber":228,"content":"                        return@launch"},{"type":"DELETE","lineNumber":224,"oldContent":"                }"},{"type":"DELETE","lineNumber":225,"oldContent":""},{"type":"INSERT","lineNumber":230,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":228,"oldContent":""},{"type":"DELETE","lineNumber":230,"oldContent":"                    }"},{"type":"DELETE","lineNumber":233,"oldContent":"                        return@launch"},{"type":"DELETE","lineNumber":235,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":237,"oldContent":""},{"type":"MODIFY","lineNumber":239,"content":"                Log.i(\"SharedVM\", \"Sending start mission command\")","oldContent":"                Log.i(\"SharedVM\", \"Sending start mission command\")"},{"type":"DELETE","lineNumber":248,"oldContent":"        }"},{"type":"DELETE","lineNumber":250,"oldContent":"    }"},{"type":"DELETE","lineNumber":252,"oldContent":""},{"type":"DELETE","lineNumber":254,"oldContent":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"DELETE","lineNumber":256,"oldContent":"    fun readMissionFromFcu() {"},{"type":"DELETE","lineNumber":258,"oldContent":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":254,"content":"        }"},{"type":"INSERT","lineNumber":255,"content":"    }"},{"type":"INSERT","lineNumber":256,"content":""},{"type":"INSERT","lineNumber":257,"content":"    // New helper to request mission from FCU and log its items for debugging"},{"type":"INSERT","lineNumber":258,"content":"    fun readMissionFromFcu() {"},{"type":"INSERT","lineNumber":259,"content":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":272,"oldContent":"}"},{"type":"DELETE","lineNumber":273,"oldContent":"    fun cancelConnection() {"},{"type":"DELETE","lineNumber":274,"oldContent":"    }"},{"type":"INSERT","lineNumber":272,"content":"    suspend fun cancelConnection() {"},{"type":"DELETE","lineNumber":276,"oldContent":"        _telemetryState.value = TelemetryState() // Reset state"},{"type":"DELETE","lineNumber":278,"oldContent":"        repo = null"},{"type":"DELETE","lineNumber":280,"oldContent":"        }"},{"type":"DELETE","lineNumber":282,"oldContent":"            }"},{"type":"DELETE","lineNumber":284,"oldContent":"                Log.e(\"SharedVM\", \"Error closing connection\", e)"},{"type":"DELETE","lineNumber":286,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":281,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":282,"content":"                Log.e(\"SharedVM\", \"Error closing connection\", e)"},{"type":"INSERT","lineNumber":283,"content":"            }"},{"type":"INSERT","lineNumber":284,"content":"        }"},{"type":"INSERT","lineNumber":285,"content":"        repo = null"},{"type":"INSERT","lineNumber":286,"content":"        _telemetryState.value = TelemetryState() // Reset state"},{"type":"INSERT","lineNumber":287,"content":"    }"},{"type":"INSERT","lineNumber":288,"content":"}"}]},{"timestamp":1758277061791,"changes":[{"type":"INSERT","lineNumber":73,"content":""},{"type":"DELETE","lineNumber":74,"oldContent":"                if (repo == null) {"},{"type":"INSERT","lineNumber":81,"content":""},{"type":"DELETE","lineNumber":82,"oldContent":"                if (!_telemetryState.value.fcuDetected) {"},{"type":"INSERT","lineNumber":89,"content":""},{"type":"DELETE","lineNumber":90,"oldContent":"                // Always clear previous mission in FCU before uploading new one (handled in repo)"},{"type":"INSERT","lineNumber":101,"content":"                    _uploadedWaypoints.value = waypoints"},{"type":"DELETE","lineNumber":102,"oldContent":""},{"type":"DELETE","lineNumber":110,"oldContent":"                missionUploaded = false"},{"type":"INSERT","lineNumber":111,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":112,"content":"                missionUploaded = false"},{"type":"DELETE","lineNumber":114,"oldContent":"            } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":129,"content":"                    return@launch","oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":136,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":137,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":140,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":138,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":139,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"INSERT","lineNumber":141,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":142,"content":"                    return@launch"},{"type":"DELETE","lineNumber":144,"oldContent":"                    return@launch"},{"type":"MODIFY","lineNumber":161,"content":"                val currentMode = _telemetryState.value.mode","oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"DELETE","lineNumber":163,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":164,"content":""},{"type":"INSERT","lineNumber":165,"content":"                if (!isInArmableMode) {"},{"type":"INSERT","lineNumber":166,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":167,"oldContent":""},{"type":"DELETE","lineNumber":169,"oldContent":"                if (!isInArmableMode) {"},{"type":"INSERT","lineNumber":175,"content":"                            Log.i(\"SharedVM\", \"✓ Successfully switched to Stabilize mode\")"},{"type":"DELETE","lineNumber":176,"oldContent":"                            break"},{"type":"MODIFY","lineNumber":198,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {","oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":202,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"DELETE","lineNumber":204,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":206,"oldContent":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"DELETE","lineNumber":209,"oldContent":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":212,"oldContent":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"DELETE","lineNumber":215,"oldContent":"                    val autoModeTimeout = 8000L"},{"type":"DELETE","lineNumber":217,"oldContent":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":212,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":213,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":214,"content":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"INSERT","lineNumber":215,"content":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"INSERT","lineNumber":216,"content":""},{"type":"INSERT","lineNumber":217,"content":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"INSERT","lineNumber":218,"content":"                    val autoModeTimeout = 8000L"},{"type":"INSERT","lineNumber":219,"content":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":222,"oldContent":""},{"type":"INSERT","lineNumber":224,"content":""},{"type":"INSERT","lineNumber":228,"content":"                        return@launch"},{"type":"DELETE","lineNumber":228,"oldContent":""},{"type":"INSERT","lineNumber":230,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"DELETE","lineNumber":231,"oldContent":"                        return@launch"},{"type":"DELETE","lineNumber":233,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle mode is now AUTO\")"},{"type":"INSERT","lineNumber":238,"content":"                // Step 5: Start the mission"},{"type":"DELETE","lineNumber":239,"oldContent":"                Log.i(\"SharedVM\", \"Sending start mission command\")"},{"type":"INSERT","lineNumber":251,"content":"                Log.e(\"SharedVM\", \"Failed to start mission\", e)"},{"type":"INSERT","lineNumber":252,"content":"                onResult(false, e.message)"},{"type":"INSERT","lineNumber":253,"content":"            }"},{"type":"DELETE","lineNumber":253,"oldContent":"                Log.e(\"SharedVM\", \"Failed to start mission\", e)"},{"type":"DELETE","lineNumber":256,"oldContent":"                onResult(false, e.message)"},{"type":"DELETE","lineNumber":259,"oldContent":"            }"},{"type":"DELETE","lineNumber":276,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":277,"content":"                it.closeConnection()"},{"type":"INSERT","lineNumber":278,"content":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":280,"oldContent":"                // If your repo has a close/disconnect method, call it here"},{"type":"DELETE","lineNumber":283,"oldContent":"                if (it is MavlinkTelemetryRepository) {"},{"type":"DELETE","lineNumber":286,"oldContent":"                    it.closeConnection()"},{"type":"DELETE","lineNumber":288,"oldContent":"                }"}]},{"timestamp":1758606402400,"changes":[{"type":"MODIFY","lineNumber":111,"content":"            } catch (e: Exception) {","oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":128,"content":"                    onResult(false, \"Not connected to vehicle\")"},{"type":"DELETE","lineNumber":129,"oldContent":"                    return@launch"},{"type":"DELETE","lineNumber":136,"oldContent":"                // Step 1: Check for acknowledgment of the mission"},{"type":"DELETE","lineNumber":138,"oldContent":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"DELETE","lineNumber":140,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":138,"content":"                // Step 1: Check for acknowledgment of the mission"},{"type":"INSERT","lineNumber":139,"content":"                if (!missionUploaded || lastUploadedCount == 0) {"},{"type":"INSERT","lineNumber":141,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":160,"content":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"DELETE","lineNumber":161,"oldContent":"                val currentMode = _telemetryState.value.mode"},{"type":"MODIFY","lineNumber":164,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":167,"content":"                    repo?.changeMode(MavMode.STABILIZE)","oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"INSERT","lineNumber":197,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":198,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":208,"content":"                } else {"},{"type":"INSERT","lineNumber":209,"content":"                    Log.i(\"SharedVM\", \"✓ Vehicle already armed\")"},{"type":"INSERT","lineNumber":210,"content":"                }"},{"type":"INSERT","lineNumber":211,"content":""},{"type":"DELETE","lineNumber":210,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":212,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Vehicle already armed\")"},{"type":"DELETE","lineNumber":215,"oldContent":"                }"},{"type":"DELETE","lineNumber":218,"oldContent":""},{"type":"DELETE","lineNumber":228,"oldContent":"                    }"},{"type":"DELETE","lineNumber":230,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":229,"content":"                    }"},{"type":"INSERT","lineNumber":231,"content":"                } else {"},{"type":"DELETE","lineNumber":252,"oldContent":"        }"},{"type":"MODIFY","lineNumber":254,"content":"        }","oldContent":"    }"},{"type":"INSERT","lineNumber":255,"content":"    }"},{"type":"MODIFY","lineNumber":277,"content":"                it.closeConnection()","oldContent":"                it.closeConnection()"},{"type":"INSERT","lineNumber":285,"content":""},{"type":"INSERT","lineNumber":286,"content":""}]},{"timestamp":1758686783482,"changes":[{"type":"INSERT","lineNumber":49,"content":"    // Store survey polygon for grid missions"},{"type":"INSERT","lineNumber":50,"content":"    private val _surveyPolygon = MutableStateFlow<List<LatLng>>(emptyList())"},{"type":"INSERT","lineNumber":51,"content":"    val surveyPolygon: StateFlow<List<LatLng>> = _surveyPolygon.asStateFlow()"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"INSERT","lineNumber":53,"content":"    // Store grid lines for grid missions"},{"type":"INSERT","lineNumber":54,"content":"    private val _gridLines = MutableStateFlow<List<Pair<LatLng, LatLng>>>(emptyList())"},{"type":"INSERT","lineNumber":55,"content":"    val gridLines: StateFlow<List<Pair<LatLng, LatLng>>> = _gridLines.asStateFlow()"},{"type":"INSERT","lineNumber":56,"content":""},{"type":"INSERT","lineNumber":57,"content":"    // Store grid waypoints for grid missions"},{"type":"INSERT","lineNumber":58,"content":"    private val _gridWaypoints = MutableStateFlow<List<LatLng>>(emptyList())"},{"type":"INSERT","lineNumber":59,"content":"    val gridWaypoints: StateFlow<List<LatLng>> = _gridWaypoints.asStateFlow()"},{"type":"INSERT","lineNumber":60,"content":""},{"type":"INSERT","lineNumber":61,"content":"    // Setters for plan screen to update these"},{"type":"INSERT","lineNumber":62,"content":"    fun setSurveyPolygon(polygon: List<LatLng>) { _surveyPolygon.value = polygon }"},{"type":"INSERT","lineNumber":63,"content":"    fun setGridLines(lines: List<Pair<LatLng, LatLng>>) { _gridLines.value = lines }"},{"type":"INSERT","lineNumber":64,"content":"    fun setGridWaypoints(waypoints: List<LatLng>) { _gridWaypoints.value = waypoints }"},{"type":"INSERT","lineNumber":65,"content":""},{"type":"INSERT","lineNumber":127,"content":"                }"},{"type":"DELETE","lineNumber":111,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":118,"oldContent":"                Log.i(\"SharedVM\", \"Sending start mission command with first=0 last=$last\")"},{"type":"INSERT","lineNumber":135,"content":"        }"},{"type":"INSERT","lineNumber":154,"content":""},{"type":"DELETE","lineNumber":139,"oldContent":""},{"type":"DELETE","lineNumber":140,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":158,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":147,"oldContent":"                    val armTimeout = 10000L"},{"type":"DELETE","lineNumber":148,"oldContent":""},{"type":"INSERT","lineNumber":164,"content":"                if (!_telemetryState.value.armable) {"},{"type":"INSERT","lineNumber":165,"content":"                    Log.w(\"SharedVM\", \"Vehicle not armable, cannot start mission\")"},{"type":"INSERT","lineNumber":180,"content":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":164,"oldContent":""},{"type":"INSERT","lineNumber":183,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":167,"oldContent":"                    repo?.changeMode(MavMode.STABILIZE)"},{"type":"DELETE","lineNumber":177,"oldContent":"                val result = repo?.startMission() ?: false"},{"type":"DELETE","lineNumber":178,"oldContent":"                }"},{"type":"INSERT","lineNumber":194,"content":"                        }"},{"type":"INSERT","lineNumber":195,"content":"                        delay(500)"},{"type":"DELETE","lineNumber":181,"oldContent":"                    repo?.changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":182,"oldContent":"                    Log.i(\"SharedVM\", \"Switching vehicle mode to AUTO\")"},{"type":"DELETE","lineNumber":183,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":184,"oldContent":""},{"type":"DELETE","lineNumber":185,"oldContent":"                    repo?.arm()"},{"type":"DELETE","lineNumber":186,"oldContent":"                    Log.i(\"SharedVM\", \"Vehicle not armed - attempting to arm\")"},{"type":"INSERT","lineNumber":198,"content":"                    if (!(_telemetryState.value.mode?.equals(\"Stabilize\", ignoreCase = true) == true)) {"},{"type":"INSERT","lineNumber":199,"content":"                        Log.w(\"SharedVM\", \"Failed to switch to Stabilize mode within timeout\")"},{"type":"INSERT","lineNumber":200,"content":"                        onResult(false, \"Failed to switch to suitable mode for arming. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":201,"content":"                        return@launch"},{"type":"INSERT","lineNumber":202,"content":"                    }"},{"type":"INSERT","lineNumber":203,"content":"                } else {"},{"type":"DELETE","lineNumber":189,"oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"DELETE","lineNumber":190,"oldContent":"                repo?.requestMissionAndLog()"},{"type":"DELETE","lineNumber":191,"oldContent":"            }"},{"type":"DELETE","lineNumber":193,"oldContent":"        timerJob = null"},{"type":"INSERT","lineNumber":207,"content":"                // Step 3: Arm the drone"},{"type":"INSERT","lineNumber":208,"content":"                if (!_telemetryState.value.armed) {"},{"type":"INSERT","lineNumber":209,"content":"                    Log.i(\"SharedVM\", \"Vehicle not armed - attempting to arm\")"},{"type":"INSERT","lineNumber":210,"content":"                    repo?.arm()"},{"type":"DELETE","lineNumber":209,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"DELETE","lineNumber":211,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":229,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":230,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":223,"oldContent":"                        while (_isMissionActive.value) {"},{"type":"INSERT","lineNumber":240,"content":"                    }"},{"type":"DELETE","lineNumber":228,"oldContent":"                    }"},{"type":"DELETE","lineNumber":230,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":246,"content":"                    }"},{"type":"INSERT","lineNumber":248,"content":"                } else {"},{"type":"DELETE","lineNumber":237,"oldContent":"            }"},{"type":"INSERT","lineNumber":254,"content":""},{"type":"DELETE","lineNumber":241,"oldContent":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":258,"content":""},{"type":"INSERT","lineNumber":270,"content":"            }"},{"type":"DELETE","lineNumber":255,"oldContent":"            }"},{"type":"DELETE","lineNumber":268,"oldContent":"}"},{"type":"INSERT","lineNumber":285,"content":"            }"},{"type":"DELETE","lineNumber":270,"oldContent":"}"},{"type":"INSERT","lineNumber":287,"content":"    }"},{"type":"INSERT","lineNumber":293,"content":"            try {"},{"type":"DELETE","lineNumber":277,"oldContent":"                it.closeConnection()"},{"type":"DELETE","lineNumber":286,"oldContent":"}"},{"type":"INSERT","lineNumber":304,"content":"}"}]},{"timestamp":1758692918280,"changes":[{"type":"MODIFY","lineNumber":8,"content":"import com.divpundir.mavlink.definitions.common.MissionItemInt","oldContent":"import kotlinx.coroutines.flow.StateFlow"},{"type":"MODIFY","lineNumber":10,"content":"//import com.example.aerogcsclone.Telemetry.MissionItemInt","oldContent":"import kotlinx.coroutines.launch"},{"type":"DELETE","lineNumber":50,"oldContent":"    fun connect() {"},{"type":"DELETE","lineNumber":52,"oldContent":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":54,"oldContent":"            val portInt = port.value.toIntOrNull()"},{"type":"DELETE","lineNumber":56,"oldContent":"            if (portInt != null) {"},{"type":"DELETE","lineNumber":58,"oldContent":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"DELETE","lineNumber":60,"oldContent":"                repo = newRepo"},{"type":"DELETE","lineNumber":62,"oldContent":"                newRepo.start()"},{"type":"DELETE","lineNumber":64,"oldContent":"                newRepo.state.collect {"},{"type":"DELETE","lineNumber":66,"oldContent":"                    _telemetryState.value = it"},{"type":"DELETE","lineNumber":68,"oldContent":"                }"},{"type":"DELETE","lineNumber":70,"oldContent":"            }"},{"type":"DELETE","lineNumber":72,"oldContent":"        }"},{"type":"DELETE","lineNumber":74,"oldContent":"    }"},{"type":"DELETE","lineNumber":76,"oldContent":""},{"type":"DELETE","lineNumber":78,"oldContent":"    fun arm() {"},{"type":"INSERT","lineNumber":65,"content":""},{"type":"INSERT","lineNumber":66,"content":"    fun connect() {"},{"type":"INSERT","lineNumber":68,"content":"            val portInt = port.value.toIntOrNull()"},{"type":"INSERT","lineNumber":69,"content":"            if (portInt != null) {"},{"type":"INSERT","lineNumber":70,"content":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"INSERT","lineNumber":71,"content":"                repo = newRepo"},{"type":"INSERT","lineNumber":72,"content":"                newRepo.start()"},{"type":"INSERT","lineNumber":73,"content":"                newRepo.state.collect {"},{"type":"INSERT","lineNumber":74,"content":"                    _telemetryState.value = it"},{"type":"INSERT","lineNumber":75,"content":"                }"},{"type":"INSERT","lineNumber":76,"content":"            }"},{"type":"INSERT","lineNumber":77,"content":"        }"},{"type":"INSERT","lineNumber":78,"content":"    }"},{"type":"INSERT","lineNumber":80,"content":"    fun arm() {"},{"type":"INSERT","lineNumber":81,"content":"        viewModelScope.launch {"},{"type":"MODIFY","lineNumber":115,"content":"                    val waypoints = missionItems.filter { item ->","oldContent":"                    val waypoints = missionItems.map { item ->"},{"type":"INSERT","lineNumber":116,"content":"                        // Only show real waypoints (exclude RTL, x=0/y=0, and non-NAV_WAYPOINT/NAV_TAKEOFF)"},{"type":"INSERT","lineNumber":117,"content":"                        (item.command.value == 16u || item.command.value == 22u) && // NAV_WAYPOINT or NAV_TAKEOFF"},{"type":"INSERT","lineNumber":118,"content":"                        !(item.x == 0 && item.y == 0)"},{"type":"INSERT","lineNumber":119,"content":"                    }.map { item ->"},{"type":"INSERT","lineNumber":131,"content":"                }"},{"type":"INSERT","lineNumber":139,"content":"        }"},{"type":"DELETE","lineNumber":142,"oldContent":"                }"},{"type":"DELETE","lineNumber":151,"oldContent":"        }"},{"type":"INSERT","lineNumber":158,"content":""},{"type":"INSERT","lineNumber":162,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":168,"content":"                if (!_telemetryState.value.armable) {"},{"type":"INSERT","lineNumber":169,"content":"                    Log.w(\"SharedVM\", \"Vehicle not armable, cannot start mission\")"},{"type":"DELETE","lineNumber":167,"oldContent":""},{"type":"DELETE","lineNumber":172,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":184,"content":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":179,"oldContent":"                if (!_telemetryState.value.armable) {"},{"type":"DELETE","lineNumber":180,"oldContent":"                    Log.w(\"SharedVM\", \"Vehicle not armable, cannot start mission\")"},{"type":"INSERT","lineNumber":187,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":192,"oldContent":"                        while (_isMissionActive.value) {"},{"type":"DELETE","lineNumber":193,"oldContent":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":194,"oldContent":"                    timerJob = viewModelScope.launch {"},{"type":"DELETE","lineNumber":195,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"INSERT","lineNumber":198,"content":"                        }"},{"type":"INSERT","lineNumber":199,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":200,"content":"                    }"},{"type":"INSERT","lineNumber":201,"content":""},{"type":"INSERT","lineNumber":202,"content":"                    if (!(_telemetryState.value.mode?.equals(\"Stabilize\", ignoreCase = true) == true)) {"},{"type":"INSERT","lineNumber":203,"content":"                        Log.w(\"SharedVM\", \"Failed to switch to Stabilize mode within timeout\")"},{"type":"INSERT","lineNumber":204,"content":"                        onResult(false, \"Failed to switch to suitable mode for arming. Current mode: ${_telemetryState.value.mode}\")"},{"type":"INSERT","lineNumber":205,"content":"                        return@launch"},{"type":"INSERT","lineNumber":206,"content":"                    }"},{"type":"INSERT","lineNumber":207,"content":"                } else {"},{"type":"DELETE","lineNumber":198,"oldContent":"                    val armTimeout = 10000L"},{"type":"DELETE","lineNumber":199,"oldContent":"                        }"},{"type":"DELETE","lineNumber":201,"oldContent":"                        delay(500)"},{"type":"INSERT","lineNumber":211,"content":"                // Step 3: Arm the drone"},{"type":"INSERT","lineNumber":212,"content":"                if (!_telemetryState.value.armed) {"},{"type":"INSERT","lineNumber":213,"content":"                    Log.i(\"SharedVM\", \"Vehicle not armed - attempting to arm\")"},{"type":"INSERT","lineNumber":214,"content":"                    repo?.arm()"},{"type":"INSERT","lineNumber":215,"content":""},{"type":"DELETE","lineNumber":205,"oldContent":"                    if (!(_telemetryState.value.mode?.equals(\"Stabilize\", ignoreCase = true) == true)) {"},{"type":"DELETE","lineNumber":207,"oldContent":"                        Log.w(\"SharedVM\", \"Failed to switch to Stabilize mode within timeout\")"},{"type":"DELETE","lineNumber":209,"oldContent":"                        onResult(false, \"Failed to switch to suitable mode for arming. Current mode: ${_telemetryState.value.mode}\")"},{"type":"DELETE","lineNumber":211,"oldContent":"                        return@launch"},{"type":"DELETE","lineNumber":213,"oldContent":"                    }"},{"type":"DELETE","lineNumber":215,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":220,"oldContent":"                // Step 3: Arm the drone"},{"type":"DELETE","lineNumber":222,"oldContent":"                if (!_telemetryState.value.armed) {"},{"type":"DELETE","lineNumber":224,"oldContent":"                    Log.i(\"SharedVM\", \"Vehicle not armed - attempting to arm\")"},{"type":"DELETE","lineNumber":225,"oldContent":"                    repo?.arm()"},{"type":"INSERT","lineNumber":233,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":234,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":244,"content":"                    }"},{"type":"DELETE","lineNumber":242,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"DELETE","lineNumber":244,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":250,"content":"                    }"},{"type":"INSERT","lineNumber":252,"content":"                } else {"},{"type":"INSERT","lineNumber":258,"content":""},{"type":"DELETE","lineNumber":253,"oldContent":"                    }"},{"type":"INSERT","lineNumber":262,"content":""},{"type":"DELETE","lineNumber":259,"oldContent":"                    }"},{"type":"DELETE","lineNumber":262,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":274,"content":"            }"},{"type":"DELETE","lineNumber":269,"oldContent":""},{"type":"DELETE","lineNumber":273,"oldContent":""},{"type":"DELETE","lineNumber":282,"oldContent":"    }"},{"type":"INSERT","lineNumber":287,"content":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":284,"oldContent":"                onResult(false, e.message)"},{"type":"INSERT","lineNumber":290,"content":"        }"},{"type":"INSERT","lineNumber":291,"content":"    }"},{"type":"INSERT","lineNumber":297,"content":"            try {"},{"type":"DELETE","lineNumber":299,"oldContent":"            }"},{"type":"DELETE","lineNumber":301,"oldContent":"    }"},{"type":"DELETE","lineNumber":304,"oldContent":"            try {"}]},{"timestamp":1758694968092,"changes":[{"type":"INSERT","lineNumber":2,"content":"import android.util.Log"},{"type":"DELETE","lineNumber":7,"oldContent":"import kotlinx.coroutines.flow.Flow"},{"type":"MODIFY","lineNumber":11,"content":"import kotlinx.coroutines.flow.*","oldContent":""},{"type":"DELETE","lineNumber":57,"oldContent":""},{"type":"MODIFY","lineNumber":59,"content":"    val gridWaypoints: StateFlow<List<LatLng>> = _gridWaypoints.asStateFlow()","oldContent":"    fun connect() {"},{"type":"INSERT","lineNumber":60,"content":""},{"type":"INSERT","lineNumber":61,"content":"    // Setters for plan screen to update these"},{"type":"INSERT","lineNumber":62,"content":"    fun setSurveyPolygon(polygon: List<LatLng>) { _surveyPolygon.value = polygon }"},{"type":"INSERT","lineNumber":63,"content":"    fun setGridLines(lines: List<Pair<LatLng, LatLng>>) { _gridLines.value = lines }"},{"type":"INSERT","lineNumber":64,"content":"    fun setGridWaypoints(waypoints: List<LatLng>) { _gridWaypoints.value = waypoints }"},{"type":"INSERT","lineNumber":65,"content":""},{"type":"INSERT","lineNumber":66,"content":"    fun connect() {"},{"type":"INSERT","lineNumber":67,"content":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":63,"oldContent":"    val gridWaypoints: StateFlow<List<LatLng>> = _gridWaypoints.asStateFlow()"},{"type":"DELETE","lineNumber":66,"oldContent":""},{"type":"DELETE","lineNumber":69,"oldContent":"    // Setters for plan screen to update these"},{"type":"DELETE","lineNumber":72,"oldContent":"    fun setSurveyPolygon(polygon: List<LatLng>) { _surveyPolygon.value = polygon }"},{"type":"DELETE","lineNumber":75,"oldContent":"    fun setGridLines(lines: List<Pair<LatLng, LatLng>>) { _gridLines.value = lines }"},{"type":"DELETE","lineNumber":77,"oldContent":"    fun setGridWaypoints(waypoints: List<LatLng>) { _gridWaypoints.value = waypoints }"},{"type":"INSERT","lineNumber":79,"content":""},{"type":"DELETE","lineNumber":80,"oldContent":"        viewModelScope.launch {"},{"type":"DELETE","lineNumber":81,"oldContent":""},{"type":"DELETE","lineNumber":100,"oldContent":"                // Step 2: See if the drone is either in Stabilize or Loiter to arm the drone"},{"type":"DELETE","lineNumber":101,"oldContent":""},{"type":"DELETE","lineNumber":102,"oldContent":"                    onResult(false, \"Vehicle not armable. Check sensors and GPS.\")"},{"type":"DELETE","lineNumber":103,"oldContent":"            try {"},{"type":"INSERT","lineNumber":100,"content":"                    Log.w(\"SharedVM\", \"FCU not detected, aborting mission upload\")"},{"type":"INSERT","lineNumber":101,"content":"                    missionUploaded = false"},{"type":"INSERT","lineNumber":102,"content":"                    lastUploadedCount = 0"},{"type":"INSERT","lineNumber":103,"content":"                    onResult(false, \"FCU not detected, please connect to vehicle first\")"},{"type":"MODIFY","lineNumber":110,"content":"                missionUploaded = success","oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"MODIFY","lineNumber":112,"content":"                    lastUploadedCount = missionItems.size","oldContent":"            try {"},{"type":"DELETE","lineNumber":117,"oldContent":"                        LatLng(item.x / 1E7, item.y / 1E7)"},{"type":"DELETE","lineNumber":119,"oldContent":"                    }"},{"type":"DELETE","lineNumber":121,"oldContent":"                    _uploadedWaypoints.value = waypoints"},{"type":"INSERT","lineNumber":120,"content":"                        LatLng(item.x / 1E7, item.y / 1E7)"},{"type":"INSERT","lineNumber":121,"content":"                    }"},{"type":"INSERT","lineNumber":122,"content":"                    _uploadedWaypoints.value = waypoints"},{"type":"INSERT","lineNumber":131,"content":"                }"},{"type":"DELETE","lineNumber":135,"oldContent":"                }"},{"type":"DELETE","lineNumber":139,"oldContent":""},{"type":"DELETE","lineNumber":140,"oldContent":"                    while (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true &&"},{"type":"DELETE","lineNumber":141,"oldContent":"                    val autoModeStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":142,"oldContent":"                    val autoModeTimeout = 8000L"},{"type":"DELETE","lineNumber":143,"oldContent":"                    // Wait for mode change to AUTO with increased timeout"},{"type":"INSERT","lineNumber":140,"content":"    }"},{"type":"INSERT","lineNumber":141,"content":""},{"type":"INSERT","lineNumber":142,"content":"    fun startMission(onResult: (Boolean, String?) -> Unit = { _, _ -> }) {"},{"type":"INSERT","lineNumber":143,"content":"        viewModelScope.launch {"},{"type":"INSERT","lineNumber":144,"content":"            // Reset missionCompleted and missionElapsedSec before starting a new mission"},{"type":"INSERT","lineNumber":145,"content":"            _telemetryState.value = _telemetryState.value.copy(missionCompleted = false, missionElapsedSec = null)"},{"type":"INSERT","lineNumber":146,"content":"            try {"},{"type":"DELETE","lineNumber":147,"oldContent":"                    // Wait for arming with increased timeout"},{"type":"INSERT","lineNumber":149,"content":"                if (repo == null) {"},{"type":"DELETE","lineNumber":151,"oldContent":"                    val modeTimeout = 5000L"},{"type":"INSERT","lineNumber":153,"content":"                }"},{"type":"INSERT","lineNumber":160,"content":""},{"type":"INSERT","lineNumber":164,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":162,"oldContent":""},{"type":"DELETE","lineNumber":167,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"INSERT","lineNumber":170,"content":"                if (!_telemetryState.value.armable) {"},{"type":"INSERT","lineNumber":171,"content":"                    Log.w(\"SharedVM\", \"Vehicle not armable, cannot start mission\")"},{"type":"DELETE","lineNumber":173,"oldContent":"                if (!_telemetryState.value.armable) {"},{"type":"DELETE","lineNumber":175,"oldContent":"                    Log.w(\"SharedVM\", \"Vehicle not armable, cannot start mission\")"},{"type":"INSERT","lineNumber":186,"content":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"INSERT","lineNumber":189,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":188,"oldContent":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":192,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":198,"oldContent":"                if (!state.armed || (state.mode?.let { m ->"},{"type":"DELETE","lineNumber":199,"oldContent":"                }"},{"type":"DELETE","lineNumber":203,"oldContent":"        missionTimerJob = viewModelScope.launch {"},{"type":"DELETE","lineNumber":206,"oldContent":"        _missionElapsedSeconds.value = 0"},{"type":"DELETE","lineNumber":208,"oldContent":"        missionTimerJob?.cancel()"},{"type":"DELETE","lineNumber":210,"oldContent":"                    val armStart = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":213,"oldContent":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"DELETE","lineNumber":215,"oldContent":"                        delay(500)"},{"type":"DELETE","lineNumber":216,"oldContent":"                    }"},{"type":"INSERT","lineNumber":210,"content":"                    Log.i(\"SharedVM\", \"✓ Already in suitable mode for arming: $currentMode\")"},{"type":"INSERT","lineNumber":211,"content":"                }"},{"type":"INSERT","lineNumber":212,"content":""},{"type":"DELETE","lineNumber":219,"oldContent":""},{"type":"DELETE","lineNumber":222,"oldContent":"                    if (!_telemetryState.value.armed) {"},{"type":"INSERT","lineNumber":218,"content":"                    // Wait for arming with increased timeout"},{"type":"INSERT","lineNumber":219,"content":"                    val armTimeout = 10000L"},{"type":"INSERT","lineNumber":220,"content":"                    val armStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":221,"content":"                    while (!_telemetryState.value.armed && System.currentTimeMillis() - armStart < armTimeout) {"},{"type":"INSERT","lineNumber":222,"content":"                        delay(500)"},{"type":"INSERT","lineNumber":223,"content":"                    }"},{"type":"INSERT","lineNumber":224,"content":""},{"type":"INSERT","lineNumber":225,"content":"                    if (!_telemetryState.value.armed) {"},{"type":"INSERT","lineNumber":235,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":236,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":237,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"DELETE","lineNumber":239,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":246,"content":"                    }"},{"type":"INSERT","lineNumber":254,"content":"                } else {"},{"type":"DELETE","lineNumber":255,"oldContent":"                    }"},{"type":"INSERT","lineNumber":260,"content":""},{"type":"DELETE","lineNumber":258,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":264,"content":""},{"type":"DELETE","lineNumber":264,"oldContent":""},{"type":"DELETE","lineNumber":268,"oldContent":""},{"type":"DELETE","lineNumber":270,"oldContent":"}"},{"type":"INSERT","lineNumber":272,"content":""},{"type":"INSERT","lineNumber":276,"content":"            }"},{"type":"DELETE","lineNumber":278,"oldContent":"            }"},{"type":"DELETE","lineNumber":281,"oldContent":"                    onResult(false, \"Mission start failed. Check vehicle status and try again.\")"},{"type":"DELETE","lineNumber":282,"oldContent":"                    Log.e(\"SharedVM\", \"Mission start failed or not acknowledged\")"},{"type":"DELETE","lineNumber":283,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":284,"oldContent":"                    onResult(true, null)"},{"type":"DELETE","lineNumber":285,"oldContent":"    }"},{"type":"DELETE","lineNumber":286,"oldContent":"        _telemetryState.value = TelemetryState() // Reset state"},{"type":"DELETE","lineNumber":287,"oldContent":"        }"},{"type":"INSERT","lineNumber":283,"content":"            if (repo == null) {"},{"type":"INSERT","lineNumber":284,"content":"                Log.w(\"SharedVM\", \"No repo available, cannot request mission readback\")"},{"type":"INSERT","lineNumber":285,"content":"                return@launch"},{"type":"DELETE","lineNumber":289,"oldContent":""},{"type":"INSERT","lineNumber":287,"content":"            try {"},{"type":"INSERT","lineNumber":288,"content":"                repo?.requestMissionAndLog()"},{"type":"INSERT","lineNumber":290,"content":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":291,"content":"            }"},{"type":"INSERT","lineNumber":292,"content":"        }"},{"type":"INSERT","lineNumber":293,"content":"    }"},{"type":"INSERT","lineNumber":294,"content":""},{"type":"DELETE","lineNumber":294,"oldContent":"        }"},{"type":"DELETE","lineNumber":296,"oldContent":"    }"},{"type":"INSERT","lineNumber":299,"content":"            try {"},{"type":"INSERT","lineNumber":305,"content":"        repo = null"},{"type":"INSERT","lineNumber":306,"content":"        _telemetryState.value = TelemetryState() // Reset state"},{"type":"INSERT","lineNumber":307,"content":"    }"},{"type":"DELETE","lineNumber":303,"oldContent":"            try {"},{"type":"DELETE","lineNumber":306,"oldContent":"            try {"}]},{"timestamp":1758695082038,"changes":[{"type":"INSERT","lineNumber":58,"content":"    private val _gridWaypoints = MutableStateFlow<List<LatLng>>(emptyList())"},{"type":"DELETE","lineNumber":60,"oldContent":"    private val _gridWaypoints = MutableStateFlow<List<LatLng>>(emptyList())"},{"type":"DELETE","lineNumber":62,"oldContent":"            val portInt = port.value.toIntOrNull()"},{"type":"DELETE","lineNumber":64,"oldContent":"            if (portInt != null) {"},{"type":"DELETE","lineNumber":67,"oldContent":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"DELETE","lineNumber":69,"oldContent":"                repo = newRepo"},{"type":"INSERT","lineNumber":68,"content":"            val portInt = port.value.toIntOrNull()"},{"type":"INSERT","lineNumber":69,"content":"            if (portInt != null) {"},{"type":"INSERT","lineNumber":70,"content":"                val newRepo = MavlinkTelemetryRepository(ipAddress.value, portInt)"},{"type":"INSERT","lineNumber":71,"content":"                repo = newRepo"},{"type":"MODIFY","lineNumber":80,"content":"    fun arm() {","oldContent":"    fun arm() {"},{"type":"MODIFY","lineNumber":104,"content":"                    return@launch","oldContent":"                    val armTimeout = 10000L"},{"type":"DELETE","lineNumber":108,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Already in suitable mode for arming: $currentMode\")"},{"type":"DELETE","lineNumber":109,"oldContent":"                    val modeStart = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":108,"content":"                Log.i(\"SharedVM\", \"Starting mission upload to FCU...\")"},{"type":"INSERT","lineNumber":109,"content":"                val success = repo?.uploadMissionWithAck(missionItems) ?: false"},{"type":"DELETE","lineNumber":116,"oldContent":"                        // Only show real waypoints (exclude RTL, x=0/y=0, and non-NAV_WAYPOINT/NAV_TAKEOFF)"},{"type":"DELETE","lineNumber":117,"oldContent":"                        (item.command.value == 16u || item.command.value == 22u) && // NAV_WAYPOINT or NAV_TAKEOFF"},{"type":"INSERT","lineNumber":116,"content":"                        // Show all waypoints except RTL (command 20u) and points with x=0/y=0"},{"type":"INSERT","lineNumber":117,"content":"                        item.command.value != 20u && !(item.x == 0 && item.y == 0)"},{"type":"INSERT","lineNumber":118,"content":"                    }.map { item ->"},{"type":"DELETE","lineNumber":119,"oldContent":"                        !(item.x == 0 && item.y == 0)"},{"type":"DELETE","lineNumber":122,"oldContent":"                    }.map { item ->"},{"type":"INSERT","lineNumber":138,"content":"        }"},{"type":"DELETE","lineNumber":144,"oldContent":"        }"},{"type":"MODIFY","lineNumber":146,"content":"                Log.i(\"SharedVM\", \"Starting mission start sequence...\")","oldContent":"                Log.i(\"SharedVM\", \"Starting mission start sequence...\")"},{"type":"MODIFY","lineNumber":149,"content":"                    Log.w(\"SharedVM\", \"No repo available, cannot start mission\")","oldContent":"                    Log.w(\"SharedVM\", \"No repo available, cannot start mission\")"},{"type":"MODIFY","lineNumber":153,"content":"","oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"INSERT","lineNumber":159,"content":""},{"type":"DELETE","lineNumber":162,"oldContent":""},{"type":"INSERT","lineNumber":163,"content":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":166,"oldContent":"                    onResult(false, \"No mission uploaded. Please upload a mission first.\")"},{"type":"DELETE","lineNumber":170,"oldContent":"        missionTimerJob = null"},{"type":"DELETE","lineNumber":171,"oldContent":"        missionTimerJob?.cancel()"},{"type":"DELETE","lineNumber":173,"oldContent":"                }"},{"type":"INSERT","lineNumber":171,"content":"                    onResult(false, \"Vehicle not armable. Check sensors and GPS.\")"},{"type":"INSERT","lineNumber":172,"content":"                    return@launch"},{"type":"INSERT","lineNumber":173,"content":"                }"},{"type":"INSERT","lineNumber":185,"content":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"MODIFY","lineNumber":188,"content":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")","oldContent":"                        currentMode?.equals(\"Loiter\", ignoreCase = true) == true"},{"type":"DELETE","lineNumber":191,"oldContent":"                    Log.i(\"SharedVM\", \"Current mode '$currentMode' not suitable for arming, switching to Stabilize\")"},{"type":"DELETE","lineNumber":207,"oldContent":"                    Log.i(\"SharedVM\", \"✓ Already in suitable mode for arming: $currentMode\")"},{"type":"DELETE","lineNumber":208,"oldContent":"                }"},{"type":"DELETE","lineNumber":210,"oldContent":""},{"type":"INSERT","lineNumber":209,"content":"                    Log.i(\"SharedVM\", \"✓ Already in suitable mode for arming: $currentMode\")"},{"type":"INSERT","lineNumber":210,"content":"                }"},{"type":"INSERT","lineNumber":211,"content":""},{"type":"MODIFY","lineNumber":214,"content":"                    Log.i(\"SharedVM\", \"Vehicle not armed - attempting to arm\")","oldContent":"                    // Wait for arming with increased timeout"},{"type":"INSERT","lineNumber":215,"content":"                    repo?.arm()"},{"type":"INSERT","lineNumber":216,"content":""},{"type":"INSERT","lineNumber":217,"content":"                    // Wait for arming with increased timeout"},{"type":"DELETE","lineNumber":218,"oldContent":"                    Log.i(\"SharedVM\", \"Vehicle not armed - attempting to arm\")"},{"type":"DELETE","lineNumber":220,"oldContent":"                    repo?.arm()"},{"type":"DELETE","lineNumber":224,"oldContent":""},{"type":"MODIFY","lineNumber":225,"content":"                        Log.w(\"SharedVM\", \"Vehicle did not arm within timeout\")","oldContent":"                        Log.w(\"SharedVM\", \"Vehicle did not arm within timeout\")"},{"type":"INSERT","lineNumber":234,"content":"                // Step 4: Change mode to Auto"},{"type":"INSERT","lineNumber":235,"content":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"DELETE","lineNumber":237,"oldContent":"                // Step 4: Change mode to Auto"},{"type":"DELETE","lineNumber":239,"oldContent":"                if (_telemetryState.value.mode?.contains(\"Auto\", ignoreCase = true) != true) {"},{"type":"INSERT","lineNumber":245,"content":"                    }"},{"type":"DELETE","lineNumber":248,"oldContent":"                    }"},{"type":"INSERT","lineNumber":253,"content":"                } else {"},{"type":"DELETE","lineNumber":257,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":259,"content":""},{"type":"MODIFY","lineNumber":263,"content":"","oldContent":""},{"type":"DELETE","lineNumber":267,"oldContent":""},{"type":"MODIFY","lineNumber":272,"content":"            } catch (e: Exception) {","oldContent":"    }"},{"type":"INSERT","lineNumber":275,"content":"            }"},{"type":"DELETE","lineNumber":278,"oldContent":"            }"},{"type":"INSERT","lineNumber":285,"content":"            }"},{"type":"DELETE","lineNumber":288,"oldContent":"            }"},{"type":"MODIFY","lineNumber":289,"content":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)","oldContent":"                Log.e(\"SharedVM\", \"Exception during mission readback\", e)"},{"type":"DELETE","lineNumber":292,"oldContent":"    suspend fun cancelConnection() {"},{"type":"DELETE","lineNumber":294,"oldContent":"        _telemetryState.value = TelemetryState() // Reset state"},{"type":"DELETE","lineNumber":296,"oldContent":"        }"},{"type":"DELETE","lineNumber":298,"oldContent":"                Log.e(\"SharedVM\", \"Error closing connection\", e)"},{"type":"DELETE","lineNumber":299,"oldContent":"                it.closeConnection()"},{"type":"DELETE","lineNumber":300,"oldContent":""},{"type":"INSERT","lineNumber":294,"content":"    suspend fun cancelConnection() {"},{"type":"INSERT","lineNumber":295,"content":"        // Cancel any ongoing connection coroutine (handled by ConnectionPage)"},{"type":"INSERT","lineNumber":296,"content":"        // Attempt to close/flush the repo's socket/connection if possible"},{"type":"INSERT","lineNumber":297,"content":"        repo?.let {"},{"type":"DELETE","lineNumber":302,"oldContent":"}"},{"type":"DELETE","lineNumber":303,"oldContent":"            try {"},{"type":"DELETE","lineNumber":304,"oldContent":"    }"},{"type":"INSERT","lineNumber":299,"content":"                it.closeConnection()"},{"type":"INSERT","lineNumber":300,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":301,"content":"                Log.e(\"SharedVM\", \"Error closing connection\", e)"},{"type":"DELETE","lineNumber":306,"oldContent":"    }"},{"type":"INSERT","lineNumber":303,"content":"        }"},{"type":"INSERT","lineNumber":306,"content":"    }"},{"type":"INSERT","lineNumber":307,"content":""},{"type":"INSERT","lineNumber":308,"content":""},{"type":"INSERT","lineNumber":309,"content":"}"}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/MainPage.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/MainPage.kt","baseContent":"package com.example.aerogcsclone.uimain\n\nimport androidx.compose.foundation.background\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.*\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.Composable\nimport androidx.compose.runtime.collectAsState\nimport androidx.compose.runtime.getValue\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.unit.dp\nimport androidx.navigation.NavHostController\nimport com.example.aerogcsclone.Telemetry.SharedViewModel\nimport com.example.aerogcsclone.Telemetry.TelemetryState\nimport com.example.aerogcsclone.authentication.AuthViewModel\n\n@Composable\nfun MainPage(\n    telemetryViewModel: SharedViewModel,\n    authViewModel: AuthViewModel,\n    navController: NavHostController\n) {\n    val telemetryState by telemetryViewModel.telemetryState.collectAsState()\n\n    Column(\n        modifier = Modifier\n            .fillMaxSize()\n            .background(MaterialTheme.colorScheme.background)\n    ) {\n        // ✅ Corrected TopNavBar call\n        TopNavBar(\n            telemetryState = telemetryState,\n            authViewModel = authViewModel,\n            navController = navController\n        )\n\n        Box(\n            modifier = Modifier\n                .weight(1f)\n                .fillMaxWidth()\n        ) {\n            // ✅ Pass telemetryState to GcsMap\n//\n            GcsMap(telemetryState = telemetryState)\n\n\n\n            StatusPanel(\n                modifier = Modifier\n                    .align(Alignment.BottomStart)\n                    .padding(12.dp),\n                telemetryState = telemetryState\n            )\n\n            FloatingButtons(\n                modifier = Modifier\n                    .align(Alignment.CenterEnd)\n                    .padding(12.dp)\n            )\n        }\n    }\n}\n\n@Composable\nfun StatusPanel(\n    modifier: Modifier = Modifier,\n    telemetryState: TelemetryState\n) {\n    Surface(\n        modifier = modifier\n            .width(500.dp)\n            .height(120.dp),\n        color = Color.Black.copy(alpha = 0.6f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(\n            modifier = Modifier.padding(10.dp),\n            verticalArrangement = Arrangement.spacedBy(8.dp)\n        ) {\n            Row(\n                horizontalArrangement = Arrangement.SpaceBetween,\n                modifier = Modifier.fillMaxWidth()\n            ) {\n                Text(\"Alt: ${telemetryState.altitudeRelative ?: \"N/A\"}\", color = Color.White)\n                Text(\"Speed: ${telemetryState.groundspeed ?: \"N/A\"}\", color = Color.White)\n                Text(\"Area: N/A\", color = Color.White)\n                Text(\"Flow: N/A\", color = Color.White)\n            }\n            Spacer(modifier = Modifier.height(8.dp))\n            Row(\n                horizontalArrangement = Arrangement.SpaceBetween,\n                modifier = Modifier.fillMaxWidth()\n            ) {\n                Text(\"Obs Alt: N/A\", color = Color.White)\n                Text(\"Time: N/A\", color = Color.White)\n                Text(\"Distance: N/A\", color = Color.White)\n                Text(\"Consumed: N/A\", color = Color.White)\n            }\n        }\n    }\n}\n\n@Composable\nfun FloatingButtons(modifier: Modifier = Modifier) {\n    Column(\n        modifier = modifier,\n        verticalArrangement = Arrangement.spacedBy(12.dp),\n        horizontalAlignment = Alignment.CenterHorizontally\n    ) {\n        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {\n            Icon(Icons.Default.PlayArrow, contentDescription = \"Start\", tint = Color.White)\n        }\n        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {\n            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)\n        }\n        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {\n            Icon(Icons.Default.Refresh, contentDescription = \"Refresh\", tint = Color.White)\n        }\n        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {\n            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)\n        }\n    }\n}","baseTimestamp":1757909204070,"deltas":[{"timestamp":1758686783427,"changes":[{"type":"INSERT","lineNumber":6,"content":"import androidx.compose.material.icons.Icons"},{"type":"DELETE","lineNumber":7,"oldContent":"import androidx.compose.material.icons.filled.*"},{"type":"DELETE","lineNumber":18,"oldContent":"import com.example.aerogcsclone.Telemetry.SharedViewModel"},{"type":"MODIFY","lineNumber":18,"content":"import com.google.maps.android.compose.MapType","oldContent":"import com.example.aerogcsclone.Telemetry.TelemetryState"},{"type":"INSERT","lineNumber":19,"content":"import androidx.compose.ui.platform.LocalContext"},{"type":"INSERT","lineNumber":21,"content":"import androidx.compose.ui.unit.sp"},{"type":"INSERT","lineNumber":37,"content":"    val surveyPolygon by telemetryViewModel.surveyPolygon.collectAsState()"},{"type":"INSERT","lineNumber":38,"content":"    val gridLines by telemetryViewModel.gridLines.collectAsState()"},{"type":"INSERT","lineNumber":39,"content":"    val gridWaypoints by telemetryViewModel.gridWaypoints.collectAsState()"},{"type":"DELETE","lineNumber":49,"oldContent":"    Column("},{"type":"DELETE","lineNumber":51,"oldContent":"        modifier = Modifier"},{"type":"DELETE","lineNumber":53,"oldContent":"            .fillMaxSize()"},{"type":"INSERT","lineNumber":56,"content":"    }"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":58,"content":"    Column("},{"type":"INSERT","lineNumber":59,"content":"        modifier = Modifier"},{"type":"INSERT","lineNumber":60,"content":"            .fillMaxSize()"},{"type":"DELETE","lineNumber":57,"oldContent":"    }"},{"type":"DELETE","lineNumber":60,"oldContent":""},{"type":"DELETE","lineNumber":64,"oldContent":"            modifier = Modifier"},{"type":"DELETE","lineNumber":66,"oldContent":"                .weight(1f)"},{"type":"INSERT","lineNumber":70,"content":"            modifier = Modifier"},{"type":"INSERT","lineNumber":71,"content":"                .weight(1f)"},{"type":"INSERT","lineNumber":77,"content":"                points = uploadedWaypoints,"},{"type":"INSERT","lineNumber":78,"content":"                surveyPolygon = surveyPolygon,"},{"type":"INSERT","lineNumber":79,"content":"                gridLines = gridLines,"},{"type":"INSERT","lineNumber":80,"content":"                gridWaypoints = gridWaypoints,"},{"type":"DELETE","lineNumber":75,"oldContent":"                autoCenter = false"},{"type":"INSERT","lineNumber":83,"content":"                autoCenter = false,"},{"type":"INSERT","lineNumber":84,"content":"                heading = telemetryState.heading"},{"type":"DELETE","lineNumber":122,"oldContent":"            .width(500.dp)"},{"type":"DELETE","lineNumber":123,"oldContent":"            .height(120.dp),"},{"type":"INSERT","lineNumber":131,"content":"            .width(340.dp)"},{"type":"INSERT","lineNumber":132,"content":"            .height(64.dp),"},{"type":"DELETE","lineNumber":128,"oldContent":"            modifier = Modifier.padding(10.dp),"},{"type":"DELETE","lineNumber":129,"oldContent":"            verticalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"INSERT","lineNumber":137,"content":"            modifier = Modifier.padding(8.dp),"},{"type":"INSERT","lineNumber":138,"content":"            verticalArrangement = Arrangement.spacedBy(2.dp)"},{"type":"DELETE","lineNumber":135,"oldContent":"                Text(\"Alt: ${telemetryState.altitudeRelative ?: \"N/A\"}\", color = Color.White)"},{"type":"DELETE","lineNumber":136,"oldContent":"                Text(\"Speed: ${telemetryState.formattedGroundspeed ?: \"N/A\"}\", color = Color.White)"},{"type":"DELETE","lineNumber":137,"oldContent":"                Text(\"Area: N/A\", color = Color.White)"},{"type":"DELETE","lineNumber":138,"oldContent":"                Text(\"Flow: N/A\", color = Color.White)"},{"type":"INSERT","lineNumber":144,"content":"                Text(\"Alt: ${telemetryState.altitudeRelative ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":145,"content":"                Text(\"Speed: ${telemetryState.formattedGroundspeed ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":146,"content":"                Text(\"Area: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":147,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":149,"content":"            Spacer(modifier = Modifier.height(2.dp))"},{"type":"DELETE","lineNumber":141,"oldContent":"            Spacer(modifier = Modifier.height(8.dp))"},{"type":"DELETE","lineNumber":142,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":143,"oldContent":"                Text(\"Obs Alt: N/A\", color = Color.White)"},{"type":"INSERT","lineNumber":152,"content":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":153,"content":"            ) {"},{"type":"INSERT","lineNumber":154,"content":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":147,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":153,"oldContent":"                Text(\"Time: $timeStr\", color = Color.White)"},{"type":"INSERT","lineNumber":162,"content":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":159,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White)"},{"type":"DELETE","lineNumber":160,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White)"},{"type":"INSERT","lineNumber":168,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":169,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":197,"oldContent":""},{"type":"DELETE","lineNumber":199,"oldContent":"}"},{"type":"DELETE","lineNumber":201,"oldContent":"    }"},{"type":"DELETE","lineNumber":203,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"DELETE","lineNumber":205,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":211,"content":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":212,"content":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"INSERT","lineNumber":213,"content":"    }"},{"type":"INSERT","lineNumber":214,"content":"}"},{"type":"INSERT","lineNumber":215,"content":""}]},{"timestamp":1758693996579,"changes":[{"type":"MODIFY","lineNumber":19,"content":"import androidx.compose.ui.platform.LocalContext","oldContent":"import com.example.aerogcsclone.authentication.AuthViewModel"},{"type":"MODIFY","lineNumber":34,"content":"","oldContent":"            .background(MaterialTheme.colorScheme.background)"},{"type":"DELETE","lineNumber":37,"oldContent":""},{"type":"DELETE","lineNumber":39,"oldContent":"    // Map camera state controlled from parent so refresh can move it"},{"type":"MODIFY","lineNumber":41,"content":"    // Map camera state controlled from parent so refresh can move it","oldContent":"    val cameraPositionState = rememberCameraPositionState()"},{"type":"INSERT","lineNumber":42,"content":"    val cameraPositionState = rememberCameraPositionState()"},{"type":"INSERT","lineNumber":43,"content":""},{"type":"DELETE","lineNumber":56,"oldContent":"            .background(MaterialTheme.colorScheme.background)"},{"type":"DELETE","lineNumber":58,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":61,"oldContent":"        TopNavBar("},{"type":"DELETE","lineNumber":63,"oldContent":"            telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":61,"content":"            .background(MaterialTheme.colorScheme.background)"},{"type":"INSERT","lineNumber":62,"content":"    ) {"},{"type":"INSERT","lineNumber":63,"content":"        TopNavBar("},{"type":"INSERT","lineNumber":64,"content":"            telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":70,"content":"            modifier = Modifier"},{"type":"INSERT","lineNumber":71,"content":"                .weight(1f)"},{"type":"DELETE","lineNumber":72,"oldContent":"            modifier = Modifier"},{"type":"DELETE","lineNumber":74,"oldContent":"                .weight(1f)"},{"type":"DELETE","lineNumber":75,"oldContent":""},{"type":"DELETE","lineNumber":76,"oldContent":"            StatusPanel("},{"type":"DELETE","lineNumber":77,"oldContent":"                mapType = mapType,"},{"type":"DELETE","lineNumber":78,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":79,"oldContent":"            )"},{"type":"INSERT","lineNumber":75,"content":"            GcsMap("},{"type":"INSERT","lineNumber":76,"content":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":81,"oldContent":""},{"type":"DELETE","lineNumber":83,"oldContent":"            StatusPanel("},{"type":"DELETE","lineNumber":85,"oldContent":"            )"},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"DELETE","lineNumber":88,"oldContent":"            FloatingButtons("},{"type":"DELETE","lineNumber":89,"oldContent":"                modifier = Modifier"},{"type":"INSERT","lineNumber":81,"content":"                mapType = mapType,"},{"type":"INSERT","lineNumber":82,"content":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":91,"oldContent":"            )"},{"type":"INSERT","lineNumber":85,"content":"            )"},{"type":"DELETE","lineNumber":94,"oldContent":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":87,"content":"            StatusPanel("},{"type":"INSERT","lineNumber":88,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":89,"content":"                    .align(Alignment.BottomStart)"},{"type":"INSERT","lineNumber":90,"content":"                    .padding(12.dp),"},{"type":"INSERT","lineNumber":91,"content":"                telemetryState = telemetryState"},{"type":"DELETE","lineNumber":96,"oldContent":"        }"},{"type":"DELETE","lineNumber":97,"oldContent":"}"},{"type":"DELETE","lineNumber":99,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":100,"oldContent":"fun StatusPanel("},{"type":"DELETE","lineNumber":101,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"DELETE","lineNumber":102,"oldContent":") {"},{"type":"DELETE","lineNumber":103,"oldContent":"    Surface("},{"type":"DELETE","lineNumber":104,"oldContent":"            .width(500.dp)"},{"type":"DELETE","lineNumber":105,"oldContent":"            .height(120.dp),"},{"type":"DELETE","lineNumber":106,"oldContent":"        shape = RoundedCornerShape(8.dp)"},{"type":"DELETE","lineNumber":107,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":108,"oldContent":"        Column("},{"type":"INSERT","lineNumber":94,"content":"            FloatingButtons("},{"type":"INSERT","lineNumber":95,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":96,"content":"                    .align(Alignment.CenterEnd)"},{"type":"INSERT","lineNumber":97,"content":"                    .padding(12.dp),"},{"type":"INSERT","lineNumber":98,"content":"                onToggleMapType = {"},{"type":"INSERT","lineNumber":99,"content":"                    mapType = if (mapType == MapType.SATELLITE) MapType.NORMAL else MapType.SATELLITE"},{"type":"INSERT","lineNumber":101,"content":"                onStartMission = {"},{"type":"INSERT","lineNumber":102,"content":"                    telemetryViewModel.startMission { success, error ->"},{"type":"INSERT","lineNumber":103,"content":"                        if (success) {"},{"type":"INSERT","lineNumber":104,"content":"                            Toast.makeText(context, \"Mission start sent\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":105,"content":"                        } else {"},{"type":"INSERT","lineNumber":106,"content":"                            Toast.makeText(context, error ?: \"Failed to start mission\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":107,"content":"                        }"},{"type":"INSERT","lineNumber":108,"content":"                    }"},{"type":"INSERT","lineNumber":109,"content":"                },"},{"type":"INSERT","lineNumber":120,"content":""},{"type":"INSERT","lineNumber":121,"content":"            // Mission Complete Popup"},{"type":"INSERT","lineNumber":122,"content":"            var showMissionCompleteDialog by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":123,"content":"            // Show dialog when missionCompleted becomes true"},{"type":"INSERT","lineNumber":124,"content":"            LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":125,"content":"                if (telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":126,"content":"                    showMissionCompleteDialog = true"},{"type":"INSERT","lineNumber":127,"content":"                }"},{"type":"INSERT","lineNumber":128,"content":"            }"},{"type":"INSERT","lineNumber":129,"content":"            if (showMissionCompleteDialog) {"},{"type":"INSERT","lineNumber":130,"content":"                AlertDialog("},{"type":"INSERT","lineNumber":131,"content":"                    onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":132,"content":"                    confirmButton = {"},{"type":"INSERT","lineNumber":133,"content":"                        Button("},{"type":"INSERT","lineNumber":134,"content":"                            onClick = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":135,"content":"                            colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.primary)"},{"type":"INSERT","lineNumber":136,"content":"                        ) {"},{"type":"INSERT","lineNumber":137,"content":"                            Text(\"OK\", color = MaterialTheme.colorScheme.onPrimary)"},{"type":"INSERT","lineNumber":138,"content":"                        }"},{"type":"INSERT","lineNumber":139,"content":"                    },"},{"type":"INSERT","lineNumber":140,"content":"                    title = {"},{"type":"INSERT","lineNumber":141,"content":"                        Text(\"Mission completed!\", style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":142,"content":"                    },"},{"type":"INSERT","lineNumber":143,"content":"                    text = {"},{"type":"INSERT","lineNumber":144,"content":"                        Column(horizontalAlignment = Alignment.CenterHorizontally) {"},{"type":"INSERT","lineNumber":145,"content":"                            val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":146,"content":"                                val h = sec / 3600"},{"type":"INSERT","lineNumber":147,"content":"                                val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":148,"content":"                                val s = sec % 60"},{"type":"INSERT","lineNumber":149,"content":"                                if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":150,"content":"                            } ?: \"N/A\""},{"type":"INSERT","lineNumber":151,"content":"                            val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":152,"content":"                                if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":153,"content":"                                else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":154,"content":"                            } ?: \"N/A\""},{"type":"INSERT","lineNumber":155,"content":"                            Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":156,"content":"                            Spacer(modifier = Modifier.height(8.dp))"},{"type":"INSERT","lineNumber":157,"content":"                            Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":158,"content":"                        }"},{"type":"INSERT","lineNumber":159,"content":"                    },"},{"type":"INSERT","lineNumber":160,"content":"                    modifier = Modifier.align(Alignment.Center)"},{"type":"INSERT","lineNumber":161,"content":"                )"},{"type":"INSERT","lineNumber":162,"content":"            }"},{"type":"INSERT","lineNumber":174,"content":"            .width(340.dp)"},{"type":"INSERT","lineNumber":175,"content":"            .height(64.dp),"},{"type":"INSERT","lineNumber":180,"content":"            modifier = Modifier.padding(8.dp),"},{"type":"INSERT","lineNumber":181,"content":"            verticalArrangement = Arrangement.spacedBy(2.dp)"},{"type":"DELETE","lineNumber":136,"oldContent":"            .width(340.dp)"},{"type":"DELETE","lineNumber":138,"oldContent":"            .height(64.dp),"},{"type":"DELETE","lineNumber":142,"oldContent":"            modifier = Modifier.padding(8.dp),"},{"type":"DELETE","lineNumber":143,"oldContent":"            verticalArrangement = Arrangement.spacedBy(2.dp)"},{"type":"INSERT","lineNumber":187,"content":"                Text(\"Alt: ${telemetryState.altitudeRelative ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":188,"content":"                Text(\"Speed: ${telemetryState.formattedGroundspeed ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":189,"content":"                Text(\"Area: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":190,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":192,"content":"            Spacer(modifier = Modifier.height(2.dp))"},{"type":"DELETE","lineNumber":146,"oldContent":"                Text(\"Alt: ${telemetryState.altitudeRelative ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":148,"oldContent":"                Text(\"Speed: ${telemetryState.formattedGroundspeed ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":195,"content":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":196,"content":"            ) {"},{"type":"INSERT","lineNumber":197,"content":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":150,"oldContent":"                Text(\"Area: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":152,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":154,"oldContent":"            Spacer(modifier = Modifier.height(2.dp))"},{"type":"DELETE","lineNumber":158,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":160,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":161,"oldContent":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":205,"content":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":211,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":212,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":168,"oldContent":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":175,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":177,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":211,"oldContent":""},{"type":"DELETE","lineNumber":212,"oldContent":"}"},{"type":"DELETE","lineNumber":213,"oldContent":"    }"},{"type":"DELETE","lineNumber":214,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"INSERT","lineNumber":255,"content":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"INSERT","lineNumber":256,"content":"    }"},{"type":"INSERT","lineNumber":257,"content":"}"},{"type":"INSERT","lineNumber":258,"content":""}]},{"timestamp":1758694006845,"changes":[{"type":"INSERT","lineNumber":0,"content":"// Kotlin"},{"type":"DELETE","lineNumber":3,"oldContent":"import androidx.compose.foundation.background"},{"type":"INSERT","lineNumber":5,"content":"import androidx.compose.foundation.shape.RoundedCornerShape"},{"type":"DELETE","lineNumber":6,"oldContent":"import androidx.compose.material.icons.Icons"},{"type":"INSERT","lineNumber":21,"content":"import androidx.compose.ui.text.font.FontWeight"},{"type":"DELETE","lineNumber":22,"oldContent":"    telemetryViewModel: SharedViewModel,"},{"type":"INSERT","lineNumber":23,"content":"import com.google.maps.android.compose.rememberCameraPositionState"},{"type":"INSERT","lineNumber":40,"content":"    val gridWaypoints by telemetryViewModel.gridWaypoints.collectAsState()"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"DELETE","lineNumber":41,"oldContent":"    val gridWaypoints by telemetryViewModel.gridWaypoints.collectAsState()"},{"type":"DELETE","lineNumber":43,"oldContent":""},{"type":"INSERT","lineNumber":60,"content":"        modifier = Modifier"},{"type":"INSERT","lineNumber":61,"content":"            .fillMaxSize()"},{"type":"DELETE","lineNumber":61,"oldContent":"        modifier = Modifier"},{"type":"DELETE","lineNumber":64,"oldContent":"            .fillMaxSize()"},{"type":"DELETE","lineNumber":71,"oldContent":"                .fillMaxWidth()"},{"type":"INSERT","lineNumber":73,"content":"                .fillMaxWidth()"},{"type":"DELETE","lineNumber":78,"oldContent":"                mapType = mapType,"},{"type":"DELETE","lineNumber":79,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"MODIFY","lineNumber":82,"content":"                mapType = mapType,","oldContent":"            )"},{"type":"INSERT","lineNumber":83,"content":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":84,"content":"                autoCenter = false,"},{"type":"INSERT","lineNumber":85,"content":"                heading = telemetryState.heading"},{"type":"INSERT","lineNumber":86,"content":"            )"},{"type":"INSERT","lineNumber":87,"content":""},{"type":"DELETE","lineNumber":88,"oldContent":"                autoCenter = false,"},{"type":"DELETE","lineNumber":90,"oldContent":"                heading = telemetryState.heading"},{"type":"INSERT","lineNumber":93,"content":"            )"},{"type":"DELETE","lineNumber":94,"oldContent":"    telemetryState: TelemetryState"},{"type":"DELETE","lineNumber":98,"oldContent":"            .width(500.dp)"},{"type":"INSERT","lineNumber":101,"content":"                },"},{"type":"DELETE","lineNumber":109,"oldContent":"                },"},{"type":"DELETE","lineNumber":121,"oldContent":"        }"},{"type":"DELETE","lineNumber":123,"oldContent":"    }"},{"type":"DELETE","lineNumber":125,"oldContent":"}"},{"type":"DELETE","lineNumber":127,"oldContent":""},{"type":"DELETE","lineNumber":129,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":131,"oldContent":"fun StatusPanel("},{"type":"DELETE","lineNumber":133,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"DELETE","lineNumber":135,"oldContent":"    telemetryState: TelemetryState"},{"type":"DELETE","lineNumber":137,"oldContent":") {"},{"type":"DELETE","lineNumber":139,"oldContent":"    Surface("},{"type":"DELETE","lineNumber":141,"oldContent":"        modifier = modifier"},{"type":"DELETE","lineNumber":143,"oldContent":"        color = Color.Black.copy(alpha = 0.6f),"},{"type":"DELETE","lineNumber":145,"oldContent":"        shape = RoundedCornerShape(8.dp)"},{"type":"DELETE","lineNumber":147,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":149,"oldContent":"        Column("},{"type":"DELETE","lineNumber":151,"oldContent":"        ) {"},{"type":"DELETE","lineNumber":154,"oldContent":"            Row("},{"type":"DELETE","lineNumber":157,"oldContent":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"DELETE","lineNumber":159,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":161,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":165,"oldContent":"            }"},{"type":"DELETE","lineNumber":167,"oldContent":"            Row("},{"type":"DELETE","lineNumber":170,"oldContent":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"DELETE","lineNumber":173,"oldContent":"                // Format mission timer"},{"type":"DELETE","lineNumber":176,"oldContent":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":179,"oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":182,"oldContent":"                    val m = (sec % 3600) / 60"},{"type":"DELETE","lineNumber":184,"oldContent":"                    val s = sec % 60"},{"type":"DELETE","lineNumber":186,"oldContent":"                    if (h > 0) \"%02d:%02d\".format(h, m) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":189,"oldContent":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":164,"content":"        }"},{"type":"INSERT","lineNumber":165,"content":"    }"},{"type":"INSERT","lineNumber":166,"content":"}"},{"type":"INSERT","lineNumber":167,"content":""},{"type":"INSERT","lineNumber":168,"content":"@Composable"},{"type":"INSERT","lineNumber":169,"content":"fun StatusPanel("},{"type":"INSERT","lineNumber":170,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":171,"content":"    telemetryState: TelemetryState"},{"type":"INSERT","lineNumber":172,"content":") {"},{"type":"INSERT","lineNumber":173,"content":"    Surface("},{"type":"INSERT","lineNumber":174,"content":"        modifier = modifier"},{"type":"INSERT","lineNumber":175,"content":"            .width(340.dp)"},{"type":"INSERT","lineNumber":176,"content":"            .height(64.dp),"},{"type":"INSERT","lineNumber":177,"content":"        color = Color.Black.copy(alpha = 0.6f),"},{"type":"INSERT","lineNumber":178,"content":"        shape = RoundedCornerShape(8.dp)"},{"type":"INSERT","lineNumber":179,"content":"    ) {"},{"type":"INSERT","lineNumber":180,"content":"        Column("},{"type":"INSERT","lineNumber":181,"content":"            modifier = Modifier.padding(8.dp),"},{"type":"INSERT","lineNumber":182,"content":"            verticalArrangement = Arrangement.spacedBy(2.dp)"},{"type":"INSERT","lineNumber":183,"content":"        ) {"},{"type":"INSERT","lineNumber":184,"content":"            Row("},{"type":"INSERT","lineNumber":185,"content":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"INSERT","lineNumber":186,"content":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":187,"content":"            ) {"},{"type":"INSERT","lineNumber":188,"content":"                Text(\"Alt: ${telemetryState.altitudeRelative ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":189,"content":"                Text(\"Speed: ${telemetryState.formattedGroundspeed ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":190,"content":"                Text(\"Area: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":191,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":192,"content":"            }"},{"type":"INSERT","lineNumber":193,"content":"            Spacer(modifier = Modifier.height(2.dp))"},{"type":"INSERT","lineNumber":194,"content":"            Row("},{"type":"INSERT","lineNumber":195,"content":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"INSERT","lineNumber":196,"content":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":197,"content":"            ) {"},{"type":"INSERT","lineNumber":198,"content":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":199,"content":"                // Format mission timer"},{"type":"INSERT","lineNumber":200,"content":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":201,"content":"                    val h = sec / 3600"},{"type":"INSERT","lineNumber":202,"content":"                    val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":203,"content":"                    val s = sec % 60"},{"type":"INSERT","lineNumber":204,"content":"                    if (h > 0) \"%02d:%02d\".format(h, m) else \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":205,"content":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":206,"content":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":212,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":213,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":204,"oldContent":"            .width(340.dp)"},{"type":"DELETE","lineNumber":206,"oldContent":"            .height(64.dp),"},{"type":"DELETE","lineNumber":209,"oldContent":""},{"type":"DELETE","lineNumber":210,"oldContent":"            modifier = Modifier.padding(8.dp),"},{"type":"DELETE","lineNumber":211,"oldContent":"    )"},{"type":"DELETE","lineNumber":212,"oldContent":"            verticalArrangement = Arrangement.spacedBy(2.dp)"},{"type":"DELETE","lineNumber":213,"oldContent":"            .wrapContentHeight()"},{"type":"INSERT","lineNumber":223,"content":"    onStartMission: () -> Unit,"},{"type":"INSERT","lineNumber":224,"content":"    onRefresh: () -> Unit"},{"type":"INSERT","lineNumber":225,"content":") {"},{"type":"DELETE","lineNumber":219,"oldContent":"                Text(\"Alt: ${telemetryState.altitudeRelative ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":221,"oldContent":"                Text(\"Speed: ${telemetryState.formattedGroundspeed ?: \"N/A\"}\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":223,"oldContent":"                Text(\"Area: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":225,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":226,"oldContent":""},{"type":"INSERT","lineNumber":234,"content":"        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":228,"oldContent":"            Spacer(modifier = Modifier.height(2.dp))"},{"type":"DELETE","lineNumber":230,"oldContent":"}"},{"type":"INSERT","lineNumber":237,"content":"        FloatingActionButton(onClick = { onRefresh() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":232,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":234,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":236,"oldContent":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":243,"oldContent":""},{"type":"DELETE","lineNumber":245,"oldContent":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":248,"content":""},{"type":"DELETE","lineNumber":252,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":253,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":255,"oldContent":""},{"type":"DELETE","lineNumber":256,"oldContent":"}"},{"type":"MODIFY","lineNumber":257,"content":"    }","oldContent":"    }"},{"type":"INSERT","lineNumber":258,"content":"}"},{"type":"INSERT","lineNumber":259,"content":""}]},{"timestamp":1758694010060,"changes":[{"type":"DELETE","lineNumber":21,"oldContent":"import androidx.compose.ui.text.font.FontWeight"},{"type":"INSERT","lineNumber":25,"content":"import androidx.compose.ui.text.font.FontWeight"},{"type":"DELETE","lineNumber":27,"oldContent":"    navController: NavHostController"},{"type":"DELETE","lineNumber":28,"oldContent":") {"},{"type":"INSERT","lineNumber":27,"content":"@Composable"},{"type":"INSERT","lineNumber":28,"content":"fun MainPage("},{"type":"DELETE","lineNumber":40,"oldContent":"    // Map camera state controlled from parent so refresh can move it"},{"type":"INSERT","lineNumber":41,"content":""},{"type":"INSERT","lineNumber":42,"content":"    // Map camera state controlled from parent so refresh can move it"},{"type":"DELETE","lineNumber":44,"oldContent":""},{"type":"DELETE","lineNumber":60,"oldContent":"            .background(MaterialTheme.colorScheme.background)"},{"type":"MODIFY","lineNumber":62,"content":"            .background(MaterialTheme.colorScheme.background)","oldContent":"    ) {"},{"type":"INSERT","lineNumber":63,"content":"    ) {"},{"type":"INSERT","lineNumber":81,"content":"                gridWaypoints = gridWaypoints,"},{"type":"DELETE","lineNumber":83,"oldContent":"                gridWaypoints = gridWaypoints,"},{"type":"DELETE","lineNumber":85,"oldContent":"            StatusPanel("},{"type":"DELETE","lineNumber":87,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":89,"oldContent":"                    .align(Alignment.BottomStart)"},{"type":"INSERT","lineNumber":88,"content":"            StatusPanel("},{"type":"INSERT","lineNumber":89,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":90,"content":"                    .align(Alignment.BottomStart)"},{"type":"INSERT","lineNumber":93,"content":"            )"},{"type":"DELETE","lineNumber":95,"oldContent":"            )"},{"type":"MODIFY","lineNumber":102,"content":"                onStartMission = {","oldContent":"                onStartMission = {"},{"type":"DELETE","lineNumber":111,"oldContent":"                Text(\"Speed: ${telemetryState.groundspeed ?: \"N/A\"}\", color = Color.White)"},{"type":"DELETE","lineNumber":112,"oldContent":"                Text(\"Flow: N/A\", color = Color.White)"},{"type":"DELETE","lineNumber":113,"oldContent":"            Spacer(modifier = Modifier.height(8.dp))"},{"type":"DELETE","lineNumber":114,"oldContent":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"DELETE","lineNumber":115,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":111,"content":"                onRefresh = {"},{"type":"INSERT","lineNumber":112,"content":"                    val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":113,"content":"                    val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":114,"content":"                    if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":115,"content":"                        cameraPositionState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f))"},{"type":"DELETE","lineNumber":120,"oldContent":"            )"},{"type":"DELETE","lineNumber":121,"oldContent":""},{"type":"DELETE","lineNumber":122,"oldContent":"            // Mission Complete Popup"},{"type":"DELETE","lineNumber":123,"oldContent":"            var showMissionCompleteDialog by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":124,"oldContent":"            // Show dialog when missionCompleted becomes true"},{"type":"DELETE","lineNumber":125,"oldContent":"            LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":126,"oldContent":"                if (telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":127,"oldContent":"                    showMissionCompleteDialog = true"},{"type":"DELETE","lineNumber":128,"oldContent":"                }"},{"type":"DELETE","lineNumber":130,"oldContent":"            if (showMissionCompleteDialog) {"},{"type":"DELETE","lineNumber":131,"oldContent":"                AlertDialog("},{"type":"DELETE","lineNumber":132,"oldContent":"                    onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"DELETE","lineNumber":133,"oldContent":"                    confirmButton = {"},{"type":"DELETE","lineNumber":134,"oldContent":"                        Button("},{"type":"DELETE","lineNumber":135,"oldContent":"                            onClick = { showMissionCompleteDialog = false },"},{"type":"DELETE","lineNumber":136,"oldContent":"                            colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.primary)"},{"type":"DELETE","lineNumber":137,"oldContent":"                        ) {"},{"type":"DELETE","lineNumber":138,"oldContent":"                            Text(\"OK\", color = MaterialTheme.colorScheme.onPrimary)"},{"type":"DELETE","lineNumber":139,"oldContent":"                        }"},{"type":"DELETE","lineNumber":140,"oldContent":"                    },"},{"type":"DELETE","lineNumber":141,"oldContent":"                    title = {"},{"type":"DELETE","lineNumber":142,"oldContent":"                        Text(\"Mission completed!\", style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":143,"oldContent":"                    },"},{"type":"DELETE","lineNumber":144,"oldContent":"                    text = {"},{"type":"DELETE","lineNumber":146,"oldContent":"                        Column(horizontalAlignment = Alignment.CenterHorizontally) {"},{"type":"DELETE","lineNumber":149,"oldContent":"                            val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":152,"oldContent":"                                val h = sec / 3600"},{"type":"DELETE","lineNumber":154,"oldContent":"                                val m = (sec % 3600) / 60"},{"type":"DELETE","lineNumber":157,"oldContent":"                                val s = sec % 60"},{"type":"DELETE","lineNumber":159,"oldContent":"                                if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":162,"oldContent":"                            } ?: \"N/A\""},{"type":"DELETE","lineNumber":164,"oldContent":"                            val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":167,"oldContent":"                                if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":169,"oldContent":"                                else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":172,"oldContent":"                            } ?: \"N/A\""},{"type":"DELETE","lineNumber":174,"oldContent":"                            Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":177,"oldContent":"                            Spacer(modifier = Modifier.height(8.dp))"},{"type":"DELETE","lineNumber":180,"oldContent":"                            Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":183,"oldContent":"                        }"},{"type":"DELETE","lineNumber":185,"oldContent":"                    },"},{"type":"DELETE","lineNumber":188,"oldContent":"                    modifier = Modifier.align(Alignment.Center)"},{"type":"DELETE","lineNumber":190,"oldContent":"                )"},{"type":"DELETE","lineNumber":192,"oldContent":"            }"},{"type":"DELETE","lineNumber":194,"oldContent":"                // Format total distance"},{"type":"DELETE","lineNumber":196,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":198,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":200,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":202,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White)"},{"type":"DELETE","lineNumber":204,"oldContent":"            .fillMaxWidth(0.9f)"},{"type":"DELETE","lineNumber":206,"oldContent":"        },"},{"type":"DELETE","lineNumber":208,"oldContent":"                Text(\"OK\")"},{"type":"DELETE","lineNumber":210,"oldContent":"        confirmButton = {"},{"type":"DELETE","lineNumber":212,"oldContent":""},{"type":"DELETE","lineNumber":214,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":217,"oldContent":"fun FloatingButtons("},{"type":"DELETE","lineNumber":219,"oldContent":") {"},{"type":"DELETE","lineNumber":220,"oldContent":"    telemetryState: TelemetryState,"},{"type":"INSERT","lineNumber":164,"content":"                // Format total distance"},{"type":"INSERT","lineNumber":165,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":166,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":167,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":168,"content":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":223,"oldContent":""},{"type":"DELETE","lineNumber":224,"oldContent":"}"},{"type":"DELETE","lineNumber":225,"oldContent":"    }"},{"type":"INSERT","lineNumber":171,"content":"            }"},{"type":"DELETE","lineNumber":227,"oldContent":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"DELETE","lineNumber":228,"oldContent":""},{"type":"INSERT","lineNumber":173,"content":"    }"},{"type":"INSERT","lineNumber":175,"content":""},{"type":"INSERT","lineNumber":176,"content":"@Composable"},{"type":"INSERT","lineNumber":177,"content":"fun FloatingButtons("},{"type":"INSERT","lineNumber":178,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":179,"content":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":232,"oldContent":"    }"},{"type":"INSERT","lineNumber":183,"content":"    Column("},{"type":"INSERT","lineNumber":184,"content":"        modifier = modifier,"},{"type":"INSERT","lineNumber":185,"content":"        verticalArrangement = Arrangement.spacedBy(12.dp),"},{"type":"INSERT","lineNumber":186,"content":"        horizontalAlignment = Alignment.CenterHorizontally"},{"type":"INSERT","lineNumber":187,"content":"    ) {"},{"type":"INSERT","lineNumber":188,"content":"        FloatingActionButton(onClick = { onStartMission() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"INSERT","lineNumber":189,"content":"            Icon(Icons.Default.PlayArrow, contentDescription = \"Start\", tint = Color.White)"},{"type":"INSERT","lineNumber":190,"content":"        }"},{"type":"INSERT","lineNumber":191,"content":"        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":235,"oldContent":"        ) {"},{"type":"INSERT","lineNumber":193,"content":"        }"},{"type":"INSERT","lineNumber":194,"content":"        FloatingActionButton(onClick = { onRefresh() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":237,"oldContent":"}"},{"type":"DELETE","lineNumber":238,"oldContent":"        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"INSERT","lineNumber":196,"content":"        }"},{"type":"DELETE","lineNumber":240,"oldContent":"        FloatingActionButton(onClick = { onRefresh() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":244,"oldContent":""},{"type":"INSERT","lineNumber":201,"content":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"INSERT","lineNumber":202,"content":"        }"},{"type":"INSERT","lineNumber":203,"content":"    }"},{"type":"DELETE","lineNumber":246,"oldContent":"    )"},{"type":"DELETE","lineNumber":247,"oldContent":"        titleContentColor = Color(0xFF4A90E2),"},{"type":"INSERT","lineNumber":205,"content":""},{"type":"DELETE","lineNumber":250,"oldContent":""},{"type":"INSERT","lineNumber":213,"content":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"DELETE","lineNumber":258,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"}]},{"timestamp":1758694031866,"changes":[{"type":"INSERT","lineNumber":24,"content":"import com.google.android.gms.maps.model.LatLng"},{"type":"DELETE","lineNumber":25,"oldContent":"    telemetryViewModel: SharedViewModel,"},{"type":"MODIFY","lineNumber":26,"content":"","oldContent":"    navController: NavHostController"},{"type":"MODIFY","lineNumber":41,"content":"","oldContent":""},{"type":"INSERT","lineNumber":61,"content":"            .fillMaxSize()"},{"type":"DELETE","lineNumber":63,"oldContent":"            .fillMaxSize()"},{"type":"DELETE","lineNumber":86,"oldContent":"            StatusPanel("},{"type":"INSERT","lineNumber":87,"content":""},{"type":"INSERT","lineNumber":88,"content":"            StatusPanel("},{"type":"DELETE","lineNumber":90,"oldContent":""},{"type":"INSERT","lineNumber":101,"content":"                },"},{"type":"DELETE","lineNumber":102,"oldContent":"                onStartMission = {"},{"type":"MODIFY","lineNumber":119,"content":"                })","oldContent":"                }"},{"type":"DELETE","lineNumber":133,"oldContent":"                // Format total distance"},{"type":"DELETE","lineNumber":134,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":136,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":138,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":139,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":142,"oldContent":"            }"},{"type":"DELETE","lineNumber":144,"oldContent":"    }"},{"type":"DELETE","lineNumber":146,"oldContent":""},{"type":"DELETE","lineNumber":148,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":150,"oldContent":"fun FloatingButtons("},{"type":"DELETE","lineNumber":151,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"DELETE","lineNumber":153,"oldContent":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":157,"oldContent":"    Column("},{"type":"DELETE","lineNumber":158,"oldContent":"        modifier = modifier,"},{"type":"DELETE","lineNumber":160,"oldContent":"        verticalArrangement = Arrangement.spacedBy(12.dp),"},{"type":"DELETE","lineNumber":161,"oldContent":"        horizontalAlignment = Alignment.CenterHorizontally"},{"type":"DELETE","lineNumber":163,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":165,"oldContent":"        FloatingActionButton(onClick = { onStartMission() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":166,"oldContent":"            Icon(Icons.Default.PlayArrow, contentDescription = \"Start\", tint = Color.White)"},{"type":"DELETE","lineNumber":168,"oldContent":"        }"},{"type":"DELETE","lineNumber":169,"oldContent":"        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":171,"oldContent":"        }"},{"type":"DELETE","lineNumber":173,"oldContent":"        FloatingActionButton(onClick = { onRefresh() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":175,"oldContent":"        }"},{"type":"DELETE","lineNumber":178,"oldContent":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"DELETE","lineNumber":180,"oldContent":"        }"},{"type":"DELETE","lineNumber":181,"oldContent":"    }"},{"type":"DELETE","lineNumber":183,"oldContent":""},{"type":"DELETE","lineNumber":188,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"INSERT","lineNumber":164,"content":"                // Format total distance"},{"type":"INSERT","lineNumber":165,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":166,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":167,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":168,"content":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":195,"oldContent":""},{"type":"INSERT","lineNumber":171,"content":"            }"},{"type":"INSERT","lineNumber":173,"content":"    }"},{"type":"INSERT","lineNumber":174,"content":"}"},{"type":"INSERT","lineNumber":175,"content":""},{"type":"INSERT","lineNumber":176,"content":"@Composable"},{"type":"INSERT","lineNumber":177,"content":"fun FloatingButtons("},{"type":"INSERT","lineNumber":178,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":179,"content":"    onToggleMapType: () -> Unit,"},{"type":"INSERT","lineNumber":183,"content":"    Column("},{"type":"INSERT","lineNumber":184,"content":"        modifier = modifier,"},{"type":"INSERT","lineNumber":185,"content":"        verticalArrangement = Arrangement.spacedBy(12.dp),"},{"type":"INSERT","lineNumber":186,"content":"        horizontalAlignment = Alignment.CenterHorizontally"},{"type":"INSERT","lineNumber":187,"content":"    ) {"},{"type":"INSERT","lineNumber":188,"content":"        FloatingActionButton(onClick = { onStartMission() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"INSERT","lineNumber":189,"content":"            Icon(Icons.Default.PlayArrow, contentDescription = \"Start\", tint = Color.White)"},{"type":"INSERT","lineNumber":190,"content":"        }"},{"type":"INSERT","lineNumber":191,"content":"        FloatingActionButton(onClick = { }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"DELETE","lineNumber":201,"oldContent":"    }"},{"type":"INSERT","lineNumber":193,"content":"        }"},{"type":"INSERT","lineNumber":194,"content":"        FloatingActionButton(onClick = { onRefresh() }, containerColor = Color.Black.copy(alpha = 0.7f)) {"},{"type":"INSERT","lineNumber":195,"content":"            Icon(Icons.Default.Refresh, contentDescription = \"Refresh\", tint = Color.White)"},{"type":"INSERT","lineNumber":196,"content":"        }"},{"type":"INSERT","lineNumber":201,"content":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"INSERT","lineNumber":202,"content":"        }"},{"type":"INSERT","lineNumber":203,"content":"    }"},{"type":"INSERT","lineNumber":205,"content":""},{"type":"INSERT","lineNumber":213,"content":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"}]},{"timestamp":1758694052852,"changes":[{"type":"DELETE","lineNumber":25,"oldContent":"import androidx.compose.ui.text.font.FontWeight"},{"type":"INSERT","lineNumber":26,"content":""},{"type":"INSERT","lineNumber":40,"content":"    val gridWaypoints by telemetryViewModel.gridWaypoints.collectAsState()"},{"type":"DELETE","lineNumber":41,"oldContent":""},{"type":"MODIFY","lineNumber":46,"content":"    var mapType by remember { mutableStateOf(MapType.SATELLITE) }","oldContent":"            navController = navController"},{"type":"MODIFY","lineNumber":87,"content":"","oldContent":""},{"type":"DELETE","lineNumber":147,"oldContent":"                // Format total distance"},{"type":"INSERT","lineNumber":148,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":149,"content":"            }"},{"type":"INSERT","lineNumber":150,"content":"            Spacer(modifier = Modifier.height(2.dp))"},{"type":"INSERT","lineNumber":151,"content":"            Row("},{"type":"INSERT","lineNumber":152,"content":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"INSERT","lineNumber":153,"content":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":154,"content":"            ) {"},{"type":"INSERT","lineNumber":155,"content":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":156,"content":"                // Format mission timer"},{"type":"INSERT","lineNumber":157,"content":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":158,"content":"                    val h = sec / 3600"},{"type":"INSERT","lineNumber":159,"content":"                    val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":160,"content":"                    val s = sec % 60"},{"type":"INSERT","lineNumber":161,"content":"                    if (h > 0) \"%02d:%02d\".format(h, m) else \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":162,"content":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":163,"content":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":164,"content":"                // Format total distance"},{"type":"DELETE","lineNumber":152,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":169,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":170,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":155,"oldContent":"            }"},{"type":"DELETE","lineNumber":156,"oldContent":"            Spacer(modifier = Modifier.height(2.dp))"},{"type":"INSERT","lineNumber":172,"content":"        }"},{"type":"DELETE","lineNumber":159,"oldContent":"            Row("},{"type":"DELETE","lineNumber":162,"oldContent":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"DELETE","lineNumber":164,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":167,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":168,"oldContent":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":180,"content":"    onStartMission: () -> Unit,"},{"type":"INSERT","lineNumber":181,"content":"    onRefresh: () -> Unit"},{"type":"INSERT","lineNumber":182,"content":") {"},{"type":"DELETE","lineNumber":171,"oldContent":"                // Format mission timer"},{"type":"DELETE","lineNumber":173,"oldContent":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":175,"oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":177,"oldContent":"                    val m = (sec % 3600) / 60"},{"type":"DELETE","lineNumber":180,"oldContent":"                    val s = sec % 60"},{"type":"DELETE","lineNumber":182,"oldContent":"                    if (h > 0) \"%02d:%02d\".format(h, m) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":184,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":185,"oldContent":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":192,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":187,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":189,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":192,"oldContent":"}"},{"type":"DELETE","lineNumber":193,"oldContent":"    onStartMission: () -> Unit,"},{"type":"DELETE","lineNumber":194,"oldContent":"    onRefresh: () -> Unit"},{"type":"DELETE","lineNumber":195,"oldContent":") {"},{"type":"DELETE","lineNumber":196,"oldContent":"        titleContentColor = Color(0xFF4A90E2),"},{"type":"INSERT","lineNumber":197,"content":"        FloatingActionButton("},{"type":"INSERT","lineNumber":198,"content":"            onClick = { onToggleMapType() },"},{"type":"INSERT","lineNumber":199,"content":"            containerColor = Color.Black.copy(alpha = 0.7f)"},{"type":"INSERT","lineNumber":200,"content":"        ) {"},{"type":"DELETE","lineNumber":199,"oldContent":"                Text(\"Total distance: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":201,"oldContent":"                Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":202,"oldContent":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":204,"content":"}"},{"type":"DELETE","lineNumber":204,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":205,"oldContent":"                val distStr = distanceMeters?.let { dist ->"},{"type":"MODIFY","lineNumber":213,"content":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)","oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"}]},{"timestamp":1758694070658,"changes":[{"type":"MODIFY","lineNumber":23,"content":"import com.google.android.gms.maps.CameraUpdateFactory","oldContent":"    telemetryViewModel: SharedViewModel,"},{"type":"INSERT","lineNumber":86,"content":"            )"},{"type":"DELETE","lineNumber":87,"oldContent":""},{"type":"INSERT","lineNumber":122,"content":""},{"type":"INSERT","lineNumber":123,"content":"        // Mission Complete Popup"},{"type":"INSERT","lineNumber":124,"content":"        var showMissionCompleteDialog by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":125,"content":"        // Show dialog when missionCompleted becomes true"},{"type":"INSERT","lineNumber":126,"content":"        LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":127,"content":"            if (telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":128,"content":"                showMissionCompleteDialog = true"},{"type":"INSERT","lineNumber":129,"content":"            }"},{"type":"INSERT","lineNumber":130,"content":"        }"},{"type":"INSERT","lineNumber":131,"content":"        if (showMissionCompleteDialog) {"},{"type":"INSERT","lineNumber":132,"content":"            AlertDialog("},{"type":"INSERT","lineNumber":133,"content":"                onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":134,"content":"                confirmButton = {"},{"type":"INSERT","lineNumber":135,"content":"                    Button("},{"type":"INSERT","lineNumber":136,"content":"                        onClick = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":137,"content":"                        colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.primary)"},{"type":"INSERT","lineNumber":138,"content":"                    ) {"},{"type":"INSERT","lineNumber":139,"content":"                        Text(\"OK\", color = MaterialTheme.colorScheme.onPrimary)"},{"type":"INSERT","lineNumber":140,"content":"                    }"},{"type":"INSERT","lineNumber":141,"content":"                },"},{"type":"INSERT","lineNumber":142,"content":"                title = {"},{"type":"INSERT","lineNumber":143,"content":"                    Text(\"Mission completed!\", style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":144,"content":"                },"},{"type":"INSERT","lineNumber":145,"content":"                text = {"},{"type":"INSERT","lineNumber":146,"content":"                    Column(horizontalAlignment = Alignment.CenterHorizontally) {"},{"type":"INSERT","lineNumber":147,"content":"                        val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":148,"content":"                            val h = sec / 3600"},{"type":"INSERT","lineNumber":149,"content":"                            val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":150,"content":"                            val s = sec % 60"},{"type":"INSERT","lineNumber":151,"content":"                            if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":152,"content":"                        } ?: \"N/A\""},{"type":"INSERT","lineNumber":153,"content":"                        val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":154,"content":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":155,"content":"                            else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":156,"content":"                        } ?: \"N/A\""},{"type":"INSERT","lineNumber":157,"content":"                        Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":158,"content":"                        Spacer(modifier = Modifier.height(8.dp))"},{"type":"INSERT","lineNumber":159,"content":"                        Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":160,"content":"                    }"},{"type":"INSERT","lineNumber":161,"content":"                },"},{"type":"INSERT","lineNumber":162,"content":"                modifier = Modifier.align(Alignment.Center)"},{"type":"INSERT","lineNumber":163,"content":"            )"},{"type":"INSERT","lineNumber":164,"content":"        }"},{"type":"DELETE","lineNumber":147,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":191,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":150,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":152,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":154,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":157,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":159,"oldContent":"            }"},{"type":"DELETE","lineNumber":163,"oldContent":"    }"},{"type":"DELETE","lineNumber":165,"oldContent":"}"},{"type":"DELETE","lineNumber":168,"oldContent":""},{"type":"DELETE","lineNumber":170,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":173,"oldContent":"fun FloatingButtons("},{"type":"INSERT","lineNumber":208,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":209,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":210,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":211,"content":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":212,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":213,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":214,"content":"            }"},{"type":"INSERT","lineNumber":215,"content":"        }"},{"type":"INSERT","lineNumber":216,"content":"    }"},{"type":"INSERT","lineNumber":217,"content":"}"},{"type":"INSERT","lineNumber":218,"content":""},{"type":"INSERT","lineNumber":219,"content":"@Composable"},{"type":"INSERT","lineNumber":220,"content":"fun FloatingButtons("},{"type":"DELETE","lineNumber":177,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":223,"content":"    onStartMission: () -> Unit,"},{"type":"INSERT","lineNumber":224,"content":"    onRefresh: () -> Unit"},{"type":"INSERT","lineNumber":225,"content":") {"},{"type":"DELETE","lineNumber":179,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":181,"oldContent":"        }"},{"type":"DELETE","lineNumber":187,"oldContent":"    onStartMission: () -> Unit,"},{"type":"DELETE","lineNumber":188,"oldContent":"    onRefresh: () -> Unit"},{"type":"DELETE","lineNumber":190,"oldContent":") {"},{"type":"INSERT","lineNumber":235,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":196,"oldContent":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":198,"oldContent":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"DELETE","lineNumber":200,"oldContent":"        }"},{"type":"INSERT","lineNumber":244,"content":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"INSERT","lineNumber":245,"content":"        }"},{"type":"DELETE","lineNumber":204,"oldContent":""},{"type":"INSERT","lineNumber":248,"content":""},{"type":"INSERT","lineNumber":255,"content":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"DELETE","lineNumber":213,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"}]},{"timestamp":1758694107761,"changes":[{"type":"INSERT","lineNumber":25,"content":"import androidx.compose.ui.text.font.FontWeight"},{"type":"DELETE","lineNumber":45,"oldContent":"            navController = navController"},{"type":"INSERT","lineNumber":46,"content":"    // Map type state"},{"type":"DELETE","lineNumber":94,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":95,"content":""},{"type":"DELETE","lineNumber":122,"oldContent":""},{"type":"DELETE","lineNumber":124,"oldContent":"        // Mission Complete Popup"},{"type":"DELETE","lineNumber":126,"oldContent":"        var showMissionCompleteDialog by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":128,"oldContent":"        // Show dialog when missionCompleted becomes true"},{"type":"DELETE","lineNumber":130,"oldContent":"        LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":132,"oldContent":"            if (telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":134,"oldContent":"                showMissionCompleteDialog = true"},{"type":"DELETE","lineNumber":136,"oldContent":"            }"},{"type":"DELETE","lineNumber":138,"oldContent":"        }"},{"type":"DELETE","lineNumber":140,"oldContent":"        if (showMissionCompleteDialog) {"},{"type":"DELETE","lineNumber":142,"oldContent":"            AlertDialog("},{"type":"DELETE","lineNumber":144,"oldContent":"                onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"DELETE","lineNumber":146,"oldContent":"                confirmButton = {"},{"type":"DELETE","lineNumber":148,"oldContent":"                    Button("},{"type":"DELETE","lineNumber":150,"oldContent":"                        onClick = { showMissionCompleteDialog = false },"},{"type":"DELETE","lineNumber":152,"oldContent":"                        colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.primary)"},{"type":"DELETE","lineNumber":154,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":156,"oldContent":"                        Text(\"OK\", color = MaterialTheme.colorScheme.onPrimary)"},{"type":"DELETE","lineNumber":158,"oldContent":"                    }"},{"type":"DELETE","lineNumber":160,"oldContent":"                },"},{"type":"DELETE","lineNumber":162,"oldContent":"                title = {"},{"type":"DELETE","lineNumber":164,"oldContent":"                    Text(\"Mission completed!\", style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":166,"oldContent":"                },"},{"type":"DELETE","lineNumber":168,"oldContent":"                text = {"},{"type":"DELETE","lineNumber":170,"oldContent":"                    Column(horizontalAlignment = Alignment.CenterHorizontally) {"},{"type":"DELETE","lineNumber":172,"oldContent":"                        val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":173,"oldContent":"                            val h = sec / 3600"},{"type":"DELETE","lineNumber":175,"oldContent":"                            val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":149,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":177,"oldContent":"                            val s = sec % 60"},{"type":"DELETE","lineNumber":178,"oldContent":"                            if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":180,"oldContent":"                        } ?: \"N/A\""},{"type":"DELETE","lineNumber":181,"oldContent":"                        val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":183,"oldContent":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":184,"oldContent":"                            else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":186,"oldContent":"                        } ?: \"N/A\""},{"type":"DELETE","lineNumber":188,"oldContent":"                        Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":189,"oldContent":"                        Spacer(modifier = Modifier.height(8.dp))"},{"type":"DELETE","lineNumber":191,"oldContent":"                        Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":192,"oldContent":"                    }"},{"type":"DELETE","lineNumber":194,"oldContent":"                },"},{"type":"DELETE","lineNumber":196,"oldContent":"                modifier = Modifier.align(Alignment.Center)"},{"type":"DELETE","lineNumber":198,"oldContent":"            )"},{"type":"DELETE","lineNumber":199,"oldContent":"        }"},{"type":"DELETE","lineNumber":203,"oldContent":"                    if (h > 0) \"%02d:%02d\".format(h, m) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":204,"oldContent":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":162,"content":"                }"},{"type":"INSERT","lineNumber":165,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":166,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":167,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":168,"content":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":169,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":170,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":171,"content":"            }"},{"type":"INSERT","lineNumber":172,"content":"        }"},{"type":"INSERT","lineNumber":173,"content":"    }"},{"type":"INSERT","lineNumber":174,"content":"}"},{"type":"INSERT","lineNumber":175,"content":""},{"type":"INSERT","lineNumber":176,"content":"@Composable"},{"type":"INSERT","lineNumber":177,"content":"fun FloatingButtons("},{"type":"INSERT","lineNumber":180,"content":"    onStartMission: () -> Unit,"},{"type":"INSERT","lineNumber":181,"content":"    onRefresh: () -> Unit"},{"type":"INSERT","lineNumber":182,"content":") {"},{"type":"DELETE","lineNumber":217,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":192,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"INSERT","lineNumber":201,"content":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"INSERT","lineNumber":202,"content":"        }"},{"type":"INSERT","lineNumber":205,"content":""},{"type":"DELETE","lineNumber":231,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":233,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":235,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":237,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":239,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":212,"content":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"DELETE","lineNumber":241,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":242,"oldContent":"            }"},{"type":"DELETE","lineNumber":244,"oldContent":"        }"},{"type":"DELETE","lineNumber":246,"oldContent":"    }"},{"type":"DELETE","lineNumber":248,"oldContent":"}"},{"type":"DELETE","lineNumber":249,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"DELETE","lineNumber":250,"oldContent":""},{"type":"DELETE","lineNumber":251,"oldContent":""},{"type":"DELETE","lineNumber":252,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":253,"oldContent":"        }"},{"type":"DELETE","lineNumber":254,"oldContent":"fun FloatingButtons("},{"type":"DELETE","lineNumber":255,"oldContent":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"DELETE","lineNumber":256,"oldContent":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":257,"oldContent":") {"},{"type":"DELETE","lineNumber":258,"oldContent":"    onStartMission: () -> Unit,"},{"type":"DELETE","lineNumber":259,"oldContent":"    onRefresh: () -> Unit"}]},{"timestamp":1758694140085,"changes":[{"type":"DELETE","lineNumber":124,"oldContent":"}"},{"type":"INSERT","lineNumber":125,"content":""},{"type":"DELETE","lineNumber":136,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":144,"oldContent":"                }"},{"type":"DELETE","lineNumber":146,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":148,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":149,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":151,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":152,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":154,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":155,"oldContent":"            }"},{"type":"DELETE","lineNumber":157,"oldContent":"        }"},{"type":"DELETE","lineNumber":158,"oldContent":"    }"},{"type":"DELETE","lineNumber":159,"oldContent":"}"},{"type":"DELETE","lineNumber":161,"oldContent":""},{"type":"DELETE","lineNumber":162,"oldContent":"@Composable"},{"type":"INSERT","lineNumber":149,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":164,"oldContent":"fun FloatingButtons("},{"type":"DELETE","lineNumber":166,"oldContent":"    onStartMission: () -> Unit,"},{"type":"DELETE","lineNumber":167,"oldContent":"    onRefresh: () -> Unit"},{"type":"DELETE","lineNumber":168,"oldContent":") {"},{"type":"DELETE","lineNumber":173,"oldContent":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":178,"oldContent":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"DELETE","lineNumber":180,"oldContent":"        }"},{"type":"DELETE","lineNumber":182,"oldContent":""},{"type":"INSERT","lineNumber":162,"content":"                }"},{"type":"INSERT","lineNumber":165,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":166,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":167,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":168,"content":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":169,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":170,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":171,"content":"            }"},{"type":"INSERT","lineNumber":172,"content":"        }"},{"type":"INSERT","lineNumber":173,"content":"    }"},{"type":"INSERT","lineNumber":174,"content":"}"},{"type":"INSERT","lineNumber":175,"content":""},{"type":"INSERT","lineNumber":176,"content":"@Composable"},{"type":"INSERT","lineNumber":177,"content":"fun FloatingButtons("},{"type":"INSERT","lineNumber":180,"content":"    onStartMission: () -> Unit,"},{"type":"INSERT","lineNumber":181,"content":"    onRefresh: () -> Unit"},{"type":"INSERT","lineNumber":182,"content":") {"},{"type":"DELETE","lineNumber":190,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":192,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"INSERT","lineNumber":201,"content":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"INSERT","lineNumber":202,"content":"        }"},{"type":"INSERT","lineNumber":205,"content":""},{"type":"INSERT","lineNumber":212,"content":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"}]},{"timestamp":1758694534340,"changes":[{"type":"MODIFY","lineNumber":37,"content":"    // Collect uploaded waypoints for display","oldContent":"        TopNavBar("},{"type":"MODIFY","lineNumber":48,"content":"","oldContent":"                .weight(1f)"},{"type":"MODIFY","lineNumber":117,"content":"                    } else {","oldContent":"                Text(\"Time: N/A\", color = Color.White)"},{"type":"INSERT","lineNumber":125,"content":"    // Mission Complete Popup"},{"type":"INSERT","lineNumber":126,"content":"    var showMissionCompleteDialog by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":127,"content":"    LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":128,"content":"        if (telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":129,"content":"            showMissionCompleteDialog = true"},{"type":"INSERT","lineNumber":130,"content":"        }"},{"type":"INSERT","lineNumber":131,"content":"    }"},{"type":"INSERT","lineNumber":132,"content":"    if (showMissionCompleteDialog) {"},{"type":"INSERT","lineNumber":133,"content":"        AlertDialog("},{"type":"INSERT","lineNumber":134,"content":"            onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":135,"content":"            confirmButton = {"},{"type":"INSERT","lineNumber":136,"content":"                Button("},{"type":"INSERT","lineNumber":137,"content":"                    onClick = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":138,"content":"                    colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.primary)"},{"type":"INSERT","lineNumber":139,"content":"                ) {"},{"type":"INSERT","lineNumber":140,"content":"                    Text(\"OK\", color = MaterialTheme.colorScheme.onPrimary)"},{"type":"INSERT","lineNumber":141,"content":"                }"},{"type":"INSERT","lineNumber":142,"content":"            },"},{"type":"INSERT","lineNumber":143,"content":"            title = {"},{"type":"INSERT","lineNumber":144,"content":"                Text(\"Mission completed!\", style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":145,"content":"            },"},{"type":"INSERT","lineNumber":146,"content":"            text = {"},{"type":"INSERT","lineNumber":147,"content":"                Column(horizontalAlignment = Alignment.CenterHorizontally) {"},{"type":"INSERT","lineNumber":148,"content":"                    val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":149,"content":"                        val h = sec / 3600"},{"type":"INSERT","lineNumber":150,"content":"                        val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":151,"content":"                        val s = sec % 60"},{"type":"INSERT","lineNumber":152,"content":"                        if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":153,"content":"                    } ?: \"N/A\""},{"type":"INSERT","lineNumber":154,"content":"                    val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":155,"content":"                        if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":156,"content":"                        else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":157,"content":"                    } ?: \"N/A\""},{"type":"INSERT","lineNumber":158,"content":"                    Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":159,"content":"                    Spacer(modifier = Modifier.height(8.dp))"},{"type":"INSERT","lineNumber":160,"content":"                    Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":161,"content":"                }"},{"type":"INSERT","lineNumber":162,"content":"            }"},{"type":"INSERT","lineNumber":163,"content":"        )"},{"type":"INSERT","lineNumber":164,"content":"    }"},{"type":"INSERT","lineNumber":165,"content":"}"},{"type":"INSERT","lineNumber":167,"content":""},{"type":"DELETE","lineNumber":145,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":150,"oldContent":"                }"},{"type":"INSERT","lineNumber":191,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":152,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":194,"content":"            Row("},{"type":"INSERT","lineNumber":195,"content":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"INSERT","lineNumber":196,"content":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":197,"content":"            ) {"},{"type":"INSERT","lineNumber":198,"content":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":199,"content":"                // Format mission timer"},{"type":"INSERT","lineNumber":200,"content":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":201,"content":"                    val h = sec / 3600"},{"type":"INSERT","lineNumber":202,"content":"                    val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":203,"content":"                    val s = sec % 60"},{"type":"INSERT","lineNumber":204,"content":"                }"},{"type":"INSERT","lineNumber":205,"content":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":206,"content":"                // Format total distance"},{"type":"INSERT","lineNumber":207,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":158,"oldContent":"            Row("},{"type":"DELETE","lineNumber":160,"oldContent":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"DELETE","lineNumber":162,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":164,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":167,"oldContent":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":169,"oldContent":"                // Format mission timer"},{"type":"DELETE","lineNumber":171,"oldContent":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":173,"oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":174,"oldContent":"                    val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":220,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":221,"content":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":177,"oldContent":"                    val s = sec % 60"},{"type":"DELETE","lineNumber":179,"oldContent":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":180,"oldContent":"                // Format total distance"},{"type":"DELETE","lineNumber":181,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"DELETE","lineNumber":182,"oldContent":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":187,"oldContent":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"INSERT","lineNumber":234,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":197,"oldContent":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"DELETE","lineNumber":199,"oldContent":"        }"},{"type":"DELETE","lineNumber":203,"oldContent":""},{"type":"INSERT","lineNumber":243,"content":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"INSERT","lineNumber":244,"content":"        }"},{"type":"INSERT","lineNumber":247,"content":""},{"type":"DELETE","lineNumber":211,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":254,"content":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"}]},{"timestamp":1758694559332,"changes":[{"type":"MODIFY","lineNumber":76,"content":"            // Pass uploadedWaypoints to GcsMap for blue markers/lines","oldContent":"                modifier = Modifier"},{"type":"INSERT","lineNumber":121,"content":"        }"},{"type":"INSERT","lineNumber":122,"content":""},{"type":"INSERT","lineNumber":123,"content":"        // Mission Complete Popup (must be inside the composable)"},{"type":"INSERT","lineNumber":124,"content":"        var showMissionCompleteDialog by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":125,"content":"        LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":126,"content":"            if (telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":127,"content":"                showMissionCompleteDialog = true"},{"type":"INSERT","lineNumber":130,"content":"        if (showMissionCompleteDialog) {"},{"type":"INSERT","lineNumber":131,"content":"            AlertDialog("},{"type":"INSERT","lineNumber":132,"content":"                onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":133,"content":"                confirmButton = {"},{"type":"INSERT","lineNumber":134,"content":"                    Button("},{"type":"INSERT","lineNumber":135,"content":"                        onClick = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":136,"content":"                        colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.primary)"},{"type":"INSERT","lineNumber":137,"content":"                    ) {"},{"type":"INSERT","lineNumber":138,"content":"                        Text(\"OK\", color = MaterialTheme.colorScheme.onPrimary)"},{"type":"INSERT","lineNumber":139,"content":"                    }"},{"type":"INSERT","lineNumber":140,"content":"                },"},{"type":"INSERT","lineNumber":141,"content":"                title = {"},{"type":"INSERT","lineNumber":142,"content":"                    Text(\"Mission completed!\", style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":143,"content":"                },"},{"type":"INSERT","lineNumber":144,"content":"                text = {"},{"type":"INSERT","lineNumber":145,"content":"                    Column(horizontalAlignment = Alignment.CenterHorizontally) {"},{"type":"INSERT","lineNumber":146,"content":"                        val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":147,"content":"                            val h = sec / 3600"},{"type":"INSERT","lineNumber":148,"content":"                            val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":149,"content":"                            val s = sec % 60"},{"type":"INSERT","lineNumber":150,"content":"                            if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":151,"content":"                        } ?: \"N/A\""},{"type":"INSERT","lineNumber":152,"content":"                        val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":153,"content":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":154,"content":"                            else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":155,"content":"                        } ?: \"N/A\""},{"type":"INSERT","lineNumber":156,"content":"                        Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":157,"content":"                        Spacer(modifier = Modifier.height(8.dp))"},{"type":"INSERT","lineNumber":158,"content":"                        Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":159,"content":"                    }"},{"type":"INSERT","lineNumber":160,"content":"                }"},{"type":"INSERT","lineNumber":161,"content":"            )"},{"type":"INSERT","lineNumber":162,"content":"        }"},{"type":"DELETE","lineNumber":125,"oldContent":"    // Mission Complete Popup"},{"type":"DELETE","lineNumber":127,"oldContent":"    var showMissionCompleteDialog by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":129,"oldContent":"    LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":131,"oldContent":"        if (telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":133,"oldContent":"            showMissionCompleteDialog = true"},{"type":"DELETE","lineNumber":135,"oldContent":"        }"},{"type":"DELETE","lineNumber":137,"oldContent":"    }"},{"type":"DELETE","lineNumber":139,"oldContent":"    if (showMissionCompleteDialog) {"},{"type":"DELETE","lineNumber":141,"oldContent":"        AlertDialog("},{"type":"DELETE","lineNumber":143,"oldContent":"            onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"DELETE","lineNumber":145,"oldContent":"            confirmButton = {"},{"type":"DELETE","lineNumber":147,"oldContent":"                Button("},{"type":"DELETE","lineNumber":149,"oldContent":"                    onClick = { showMissionCompleteDialog = false },"},{"type":"DELETE","lineNumber":151,"oldContent":"                    colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.primary)"},{"type":"DELETE","lineNumber":153,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":155,"oldContent":"                    Text(\"OK\", color = MaterialTheme.colorScheme.onPrimary)"},{"type":"DELETE","lineNumber":157,"oldContent":"                }"},{"type":"DELETE","lineNumber":159,"oldContent":"            },"},{"type":"DELETE","lineNumber":161,"oldContent":"            title = {"},{"type":"DELETE","lineNumber":163,"oldContent":"                Text(\"Mission completed!\", style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":165,"oldContent":"            },"},{"type":"DELETE","lineNumber":166,"oldContent":"            text = {"},{"type":"DELETE","lineNumber":168,"oldContent":"                Column(horizontalAlignment = Alignment.CenterHorizontally) {"},{"type":"DELETE","lineNumber":170,"oldContent":"                    val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":172,"oldContent":"                        val h = sec / 3600"},{"type":"DELETE","lineNumber":174,"oldContent":"                        val m = (sec % 3600) / 60"},{"type":"DELETE","lineNumber":175,"oldContent":"                        val s = sec % 60"},{"type":"INSERT","lineNumber":189,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":177,"oldContent":"                        if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":178,"oldContent":"                    } ?: \"N/A\""},{"type":"DELETE","lineNumber":180,"oldContent":"                    val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":192,"content":"            Row("},{"type":"INSERT","lineNumber":193,"content":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"INSERT","lineNumber":194,"content":"                modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":195,"content":"            ) {"},{"type":"INSERT","lineNumber":196,"content":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":197,"content":"                // Format mission timer"},{"type":"INSERT","lineNumber":198,"content":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":199,"content":"                    val h = sec / 3600"},{"type":"INSERT","lineNumber":200,"content":"                    val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":201,"content":"                    val s = sec % 60"},{"type":"INSERT","lineNumber":202,"content":"                }"},{"type":"INSERT","lineNumber":203,"content":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":204,"content":"                // Format total distance"},{"type":"INSERT","lineNumber":205,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":182,"oldContent":"                        if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":184,"oldContent":"                        else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":186,"oldContent":"                    } ?: \"N/A\""},{"type":"DELETE","lineNumber":188,"oldContent":"                    Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":189,"oldContent":"                    Spacer(modifier = Modifier.height(8.dp))"},{"type":"DELETE","lineNumber":191,"oldContent":"                    Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":192,"oldContent":"                }"},{"type":"DELETE","lineNumber":194,"oldContent":"            }"},{"type":"DELETE","lineNumber":195,"oldContent":"        )"},{"type":"DELETE","lineNumber":199,"oldContent":"    }"},{"type":"DELETE","lineNumber":200,"oldContent":"}"},{"type":"DELETE","lineNumber":202,"oldContent":""},{"type":"INSERT","lineNumber":218,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":219,"content":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":215,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":232,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":219,"oldContent":"            Row("},{"type":"DELETE","lineNumber":221,"oldContent":"                horizontalArrangement = Arrangement.SpaceBetween,"},{"type":"DELETE","lineNumber":223,"oldContent":"                modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":225,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":226,"oldContent":"                Text(\"Obs Alt: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":228,"oldContent":"                // Format mission timer"},{"type":"DELETE","lineNumber":229,"oldContent":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":231,"oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":233,"oldContent":"                    val m = (sec % 3600) / 60"},{"type":"DELETE","lineNumber":235,"oldContent":"                    val s = sec % 60"},{"type":"DELETE","lineNumber":236,"oldContent":"                }"},{"type":"INSERT","lineNumber":241,"content":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"INSERT","lineNumber":242,"content":"        }"},{"type":"DELETE","lineNumber":238,"oldContent":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":240,"oldContent":"                // Format total distance"},{"type":"INSERT","lineNumber":245,"content":""},{"type":"DELETE","lineNumber":242,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":244,"oldContent":""},{"type":"DELETE","lineNumber":245,"oldContent":"    }"},{"type":"INSERT","lineNumber":248,"content":"    if (speed == null || speed < 0f) return \"--\""},{"type":"INSERT","lineNumber":249,"content":"    return when {"},{"type":"INSERT","lineNumber":250,"content":"        speed < 0.01f -> String.format(\"%.0f mm/s\", speed * 1000)"},{"type":"INSERT","lineNumber":251,"content":"        speed < 1f -> String.format(\"%.1f cm/s\", speed * 100)"},{"type":"DELETE","lineNumber":247,"oldContent":""},{"type":"DELETE","lineNumber":249,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":254,"content":"    }"},{"type":"INSERT","lineNumber":255,"content":"}"},{"type":"DELETE","lineNumber":251,"oldContent":"        }"},{"type":"DELETE","lineNumber":252,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"DELETE","lineNumber":253,"oldContent":""},{"type":"DELETE","lineNumber":254,"oldContent":"        }"},{"type":"DELETE","lineNumber":255,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"DELETE","lineNumber":256,"oldContent":"            Icon(Icons.Default.Map, contentDescription = \"Map Options\", tint = Color.White)"},{"type":"DELETE","lineNumber":257,"oldContent":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":258,"oldContent":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"}]},{"timestamp":1758694585233,"changes":[{"type":"DELETE","lineNumber":122,"oldContent":"            }"},{"type":"DELETE","lineNumber":124,"oldContent":"        }"},{"type":"DELETE","lineNumber":126,"oldContent":"    }"},{"type":"DELETE","lineNumber":128,"oldContent":""},{"type":"DELETE","lineNumber":131,"oldContent":""},{"type":"DELETE","lineNumber":133,"oldContent":"@Composable"},{"type":"INSERT","lineNumber":128,"content":"            }"},{"type":"INSERT","lineNumber":129,"content":"        }"},{"type":"DELETE","lineNumber":135,"oldContent":"fun StatusPanel("},{"type":"DELETE","lineNumber":138,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"DELETE","lineNumber":141,"oldContent":"    telemetryState: TelemetryState"},{"type":"DELETE","lineNumber":144,"oldContent":") {"},{"type":"DELETE","lineNumber":147,"oldContent":"    Surface("},{"type":"DELETE","lineNumber":150,"oldContent":"        modifier = modifier"},{"type":"DELETE","lineNumber":153,"oldContent":"            .width(340.dp)"},{"type":"DELETE","lineNumber":156,"oldContent":"            .height(64.dp),"},{"type":"DELETE","lineNumber":159,"oldContent":"        color = Color.Black.copy(alpha = 0.6f),"},{"type":"DELETE","lineNumber":162,"oldContent":"        shape = RoundedCornerShape(8.dp)"},{"type":"DELETE","lineNumber":165,"oldContent":"    ) {"},{"type":"DELETE","lineNumber":168,"oldContent":"        Column("},{"type":"DELETE","lineNumber":171,"oldContent":"            modifier = Modifier.padding(8.dp),"},{"type":"DELETE","lineNumber":174,"oldContent":"            verticalArrangement = Arrangement.spacedBy(2.dp)"},{"type":"DELETE","lineNumber":177,"oldContent":"        ) {"},{"type":"DELETE","lineNumber":180,"oldContent":"            Row("},{"type":"INSERT","lineNumber":163,"content":"    }"},{"type":"INSERT","lineNumber":164,"content":""},{"type":"INSERT","lineNumber":165,"content":""},{"type":"INSERT","lineNumber":166,"content":"@Composable"},{"type":"INSERT","lineNumber":167,"content":"fun StatusPanel("},{"type":"INSERT","lineNumber":168,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":169,"content":"    telemetryState: TelemetryState"},{"type":"INSERT","lineNumber":170,"content":") {"},{"type":"INSERT","lineNumber":171,"content":"    Surface("},{"type":"INSERT","lineNumber":172,"content":"        modifier = modifier"},{"type":"INSERT","lineNumber":173,"content":"            .width(340.dp)"},{"type":"INSERT","lineNumber":174,"content":"            .height(64.dp),"},{"type":"INSERT","lineNumber":175,"content":"        color = Color.Black.copy(alpha = 0.6f),"},{"type":"INSERT","lineNumber":176,"content":"        shape = RoundedCornerShape(8.dp)"},{"type":"INSERT","lineNumber":177,"content":"    ) {"},{"type":"INSERT","lineNumber":178,"content":"        Column("},{"type":"INSERT","lineNumber":179,"content":"            modifier = Modifier.padding(8.dp),"},{"type":"INSERT","lineNumber":180,"content":"            verticalArrangement = Arrangement.spacedBy(2.dp)"},{"type":"INSERT","lineNumber":181,"content":"        ) {"},{"type":"INSERT","lineNumber":182,"content":"            Row("},{"type":"INSERT","lineNumber":189,"content":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":191,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":192,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":193,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":194,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":195,"oldContent":"                Text(\"Flow: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":196,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":199,"oldContent":"            }"},{"type":"DELETE","lineNumber":203,"oldContent":"        }"},{"type":"DELETE","lineNumber":205,"oldContent":"    }"},{"type":"DELETE","lineNumber":207,"oldContent":"}"},{"type":"DELETE","lineNumber":211,"oldContent":""},{"type":"DELETE","lineNumber":214,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":216,"oldContent":"fun FloatingButtons("},{"type":"INSERT","lineNumber":206,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":207,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":208,"content":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":209,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":210,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":211,"content":"            }"},{"type":"INSERT","lineNumber":212,"content":"        }"},{"type":"INSERT","lineNumber":213,"content":"    }"},{"type":"INSERT","lineNumber":214,"content":"}"},{"type":"INSERT","lineNumber":215,"content":""},{"type":"INSERT","lineNumber":216,"content":"@Composable"},{"type":"INSERT","lineNumber":217,"content":"fun FloatingButtons("},{"type":"INSERT","lineNumber":218,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":219,"content":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":230,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":232,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":232,"oldContent":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":238,"oldContent":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":241,"oldContent":"    }"},{"type":"DELETE","lineNumber":242,"oldContent":"}"},{"type":"DELETE","lineNumber":244,"oldContent":"}"},{"type":"DELETE","lineNumber":246,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"DELETE","lineNumber":247,"oldContent":""},{"type":"INSERT","lineNumber":244,"content":"}"},{"type":"INSERT","lineNumber":245,"content":""},{"type":"INSERT","lineNumber":246,"content":"// Add this helper at the bottom of the file (or near the composable)"},{"type":"INSERT","lineNumber":247,"content":"fun formatSpeedHumanReadable(speed: Float?): String {"},{"type":"DELETE","lineNumber":250,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"DELETE","lineNumber":253,"oldContent":""},{"type":"INSERT","lineNumber":252,"content":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":253,"content":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"INSERT","lineNumber":256,"content":""}]},{"timestamp":1758694595906,"changes":[{"type":"MODIFY","lineNumber":38,"content":"    val uploadedWaypoints by telemetryViewModel.uploadedWaypoints.collectAsState()","oldContent":"            telemetryState = telemetryState,"},{"type":"MODIFY","lineNumber":118,"content":"                        Toast.makeText(context, \"No GPS location available\", Toast.LENGTH_SHORT).show()","oldContent":"                Text(\"Time: N/A\", color = Color.White)"},{"type":"DELETE","lineNumber":125,"oldContent":"            }"},{"type":"DELETE","lineNumber":126,"oldContent":"        }"},{"type":"INSERT","lineNumber":128,"content":"            }"},{"type":"INSERT","lineNumber":129,"content":"        }"},{"type":"DELETE","lineNumber":149,"oldContent":"    }"},{"type":"MODIFY","lineNumber":151,"content":"                        } ?: \"N/A\"","oldContent":""},{"type":"INSERT","lineNumber":152,"content":"                        val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":153,"content":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":154,"content":"                            else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":155,"content":"                        } ?: \"N/A\""},{"type":"INSERT","lineNumber":156,"content":"                        Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":157,"content":"                        Spacer(modifier = Modifier.height(8.dp))"},{"type":"INSERT","lineNumber":158,"content":"                        Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"INSERT","lineNumber":159,"content":"                    }"},{"type":"INSERT","lineNumber":160,"content":"                }"},{"type":"INSERT","lineNumber":161,"content":"            )"},{"type":"INSERT","lineNumber":162,"content":"        }"},{"type":"INSERT","lineNumber":163,"content":"    }"},{"type":"INSERT","lineNumber":165,"content":""},{"type":"DELETE","lineNumber":155,"oldContent":"                        } ?: \"N/A\""},{"type":"DELETE","lineNumber":157,"oldContent":"                        val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":160,"oldContent":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":162,"oldContent":"                            else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":165,"oldContent":"                        } ?: \"N/A\""},{"type":"DELETE","lineNumber":167,"oldContent":"                        Text(\"Total time taken: $timeStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":170,"oldContent":"                        Spacer(modifier = Modifier.height(8.dp))"},{"type":"DELETE","lineNumber":172,"oldContent":"                        Text(\"Total distance covered: $distStr\", style = MaterialTheme.typography.bodyLarge)"},{"type":"DELETE","lineNumber":175,"oldContent":"                    }"},{"type":"DELETE","lineNumber":177,"oldContent":"                }"},{"type":"DELETE","lineNumber":180,"oldContent":"            )"},{"type":"DELETE","lineNumber":182,"oldContent":"        }"},{"type":"DELETE","lineNumber":198,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":199,"content":"                    val h = sec / 3600"},{"type":"INSERT","lineNumber":200,"content":"                    val m = (sec % 3600) / 60"},{"type":"INSERT","lineNumber":201,"content":"                    val s = sec % 60"},{"type":"INSERT","lineNumber":202,"content":"                }"},{"type":"INSERT","lineNumber":203,"content":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":204,"content":"                // Format total distance"},{"type":"INSERT","lineNumber":205,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":206,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"DELETE","lineNumber":202,"oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":204,"oldContent":"                    val m = (sec % 3600) / 60"},{"type":"DELETE","lineNumber":206,"oldContent":"                    val s = sec % 60"},{"type":"DELETE","lineNumber":209,"oldContent":"                }"},{"type":"DELETE","lineNumber":211,"oldContent":"                Text(\"Time: $timeStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":214,"oldContent":"                // Format total distance"},{"type":"DELETE","lineNumber":217,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"MODIFY","lineNumber":220,"content":"    onStartMission: () -> Unit,","oldContent":"    onStartMission: () -> Unit,"},{"type":"MODIFY","lineNumber":233,"content":"        }","oldContent":"        }"},{"type":"INSERT","lineNumber":242,"content":"        }"},{"type":"INSERT","lineNumber":243,"content":"    }"},{"type":"DELETE","lineNumber":244,"oldContent":"        }"},{"type":"DELETE","lineNumber":247,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"DELETE","lineNumber":250,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"MODIFY","lineNumber":252,"content":"        speed < 100f -> String.format(\"%.2f m/s\", speed)","oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"INSERT","lineNumber":253,"content":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"MODIFY","lineNumber":256,"content":"","oldContent":""}]},{"timestamp":1758694601790,"changes":[{"type":"DELETE","lineNumber":126,"oldContent":"            }"},{"type":"MODIFY","lineNumber":128,"content":"            }","oldContent":"        }"},{"type":"INSERT","lineNumber":129,"content":"        }"},{"type":"INSERT","lineNumber":150,"content":"                            if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":152,"oldContent":"                            if (h > 0) \"%02d:%02d:%02d\".format(h, m, s) else \"%02d:%02d\".format(m, s)"},{"type":"DELETE","lineNumber":154,"oldContent":""},{"type":"DELETE","lineNumber":156,"oldContent":"@Composable"},{"type":"DELETE","lineNumber":159,"oldContent":"fun StatusPanel("},{"type":"DELETE","lineNumber":162,"oldContent":"    modifier: Modifier = Modifier,"},{"type":"DELETE","lineNumber":164,"oldContent":"    telemetryState: TelemetryState"},{"type":"DELETE","lineNumber":167,"oldContent":") {"},{"type":"INSERT","lineNumber":164,"content":""},{"type":"INSERT","lineNumber":165,"content":""},{"type":"INSERT","lineNumber":166,"content":"@Composable"},{"type":"INSERT","lineNumber":167,"content":"fun StatusPanel("},{"type":"INSERT","lineNumber":168,"content":"    modifier: Modifier = Modifier,"},{"type":"INSERT","lineNumber":169,"content":"    telemetryState: TelemetryState"},{"type":"INSERT","lineNumber":170,"content":") {"},{"type":"DELETE","lineNumber":172,"oldContent":""},{"type":"MODIFY","lineNumber":199,"content":"                    val h = sec / 3600","oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":201,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":203,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":206,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"DELETE","lineNumber":209,"oldContent":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":207,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":208,"content":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":209,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":210,"content":"                Text(\"Consumed: N/A\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":219,"content":"    onToggleMapType: () -> Unit,"},{"type":"DELETE","lineNumber":220,"oldContent":"    onStartMission: () -> Unit,"},{"type":"INSERT","lineNumber":232,"content":"            Icon(Icons.Default.Settings, contentDescription = \"Settings\", tint = Color.White)"},{"type":"DELETE","lineNumber":233,"oldContent":"        }"},{"type":"MODIFY","lineNumber":244,"content":"}","oldContent":"}"},{"type":"INSERT","lineNumber":251,"content":"        speed < 1f -> String.format(\"%.1f cm/s\", speed * 100)"},{"type":"DELETE","lineNumber":253,"oldContent":"        speed < 1f -> String.format(\"%.1f cm/s\", speed * 100)"}]},{"timestamp":1758694639500,"changes":[{"type":"INSERT","lineNumber":127,"content":"                showMissionCompleteDialog = true"},{"type":"DELETE","lineNumber":129,"oldContent":"                showMissionCompleteDialog = true"},{"type":"INSERT","lineNumber":160,"content":"                }"},{"type":"INSERT","lineNumber":161,"content":"            )"},{"type":"INSERT","lineNumber":162,"content":"        }"},{"type":"INSERT","lineNumber":163,"content":"    }"},{"type":"INSERT","lineNumber":164,"content":"}"},{"type":"DELETE","lineNumber":162,"oldContent":"                }"},{"type":"DELETE","lineNumber":164,"oldContent":"            )"},{"type":"DELETE","lineNumber":167,"oldContent":"        }"},{"type":"DELETE","lineNumber":169,"oldContent":"    }"},{"type":"INSERT","lineNumber":199,"content":"                val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"DELETE","lineNumber":199,"oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":204,"oldContent":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"DELETE","lineNumber":206,"oldContent":"                } ?: \"N/A\""},{"type":"INSERT","lineNumber":207,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":208,"content":"                    else \"%.2f km\".format(dist / 1000f)"},{"type":"INSERT","lineNumber":209,"content":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":210,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":244,"content":"    }"},{"type":"DELETE","lineNumber":244,"oldContent":"}"},{"type":"INSERT","lineNumber":256,"content":"}"},{"type":"DELETE","lineNumber":256,"oldContent":""}]},{"timestamp":1758694665959,"changes":[{"type":"INSERT","lineNumber":6,"content":"import androidx.compose.material.icons.Icons"},{"type":"DELETE","lineNumber":7,"oldContent":"import androidx.compose.material.icons.filled.*"},{"type":"MODIFY","lineNumber":10,"content":"import androidx.compose.ui.Alignment","oldContent":"import androidx.compose.runtime.getValue"},{"type":"DELETE","lineNumber":30,"oldContent":""},{"type":"DELETE","lineNumber":31,"oldContent":"        modifier = Modifier"},{"type":"INSERT","lineNumber":30,"content":"    telemetryViewModel: SharedViewModel,"},{"type":"INSERT","lineNumber":31,"content":"    authViewModel: AuthViewModel,"},{"type":"DELETE","lineNumber":67,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":68,"oldContent":"                    .padding(12.dp),"},{"type":"INSERT","lineNumber":67,"content":"            authViewModel = authViewModel,"},{"type":"INSERT","lineNumber":68,"content":"            navController = navController"},{"type":"DELETE","lineNumber":161,"oldContent":""},{"type":"DELETE","lineNumber":163,"oldContent":""},{"type":"DELETE","lineNumber":166,"oldContent":"@Composable"},{"type":"INSERT","lineNumber":165,"content":""},{"type":"INSERT","lineNumber":166,"content":""},{"type":"INSERT","lineNumber":167,"content":"@Composable"},{"type":"DELETE","lineNumber":199,"oldContent":"                    val h = sec / 3600"},{"type":"DELETE","lineNumber":203,"oldContent":"                }"},{"type":"INSERT","lineNumber":202,"content":"                    \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":203,"content":"                } ?: \"N/A\""},{"type":"MODIFY","lineNumber":207,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)","oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"MODIFY","lineNumber":210,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)","oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"MODIFY","lineNumber":245,"content":"}","oldContent":"}"},{"type":"DELETE","lineNumber":251,"oldContent":"        speed < 0.01f -> String.format(\"%.0f mm/s\", speed * 1000)"},{"type":"DELETE","lineNumber":252,"oldContent":"        speed < 1f -> String.format(\"%.1f cm/s\", speed * 100)"},{"type":"DELETE","lineNumber":253,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"DELETE","lineNumber":254,"oldContent":"        else -> String.format(\"%.2f km/h\", speed * 3.6f)"},{"type":"INSERT","lineNumber":251,"content":"        speed < 0.01f -> String.format(java.util.Locale.US, \"%.0f mm/s\", speed * 1000)"},{"type":"INSERT","lineNumber":252,"content":"        speed < 1f -> String.format(java.util.Locale.US, \"%.1f cm/s\", speed * 100)"},{"type":"INSERT","lineNumber":253,"content":"        speed < 100f -> String.format(java.util.Locale.US, \"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":254,"content":"        else -> String.format(java.util.Locale.US, \"%.2f km/h\", speed * 3.6f)"},{"type":"MODIFY","lineNumber":257,"content":"","oldContent":""}]},{"timestamp":1758694990266,"changes":[{"type":"MODIFY","lineNumber":7,"content":"import androidx.compose.material.icons.filled.*","oldContent":"import androidx.compose.material.icons.Icons"},{"type":"DELETE","lineNumber":16,"oldContent":"import androidx.navigation.NavHostController"},{"type":"MODIFY","lineNumber":16,"content":"import com.example.aerogcsclone.Telemetry.TelemetryState","oldContent":"import com.example.aerogcsclone.Telemetry.SharedViewModel"},{"type":"INSERT","lineNumber":17,"content":"import com.example.aerogcsclone.authentication.AuthViewModel"},{"type":"DELETE","lineNumber":33,"oldContent":"        modifier = Modifier"},{"type":"DELETE","lineNumber":34,"oldContent":"            .fillMaxSize()"},{"type":"INSERT","lineNumber":33,"content":") {"},{"type":"INSERT","lineNumber":34,"content":"    val telemetryState by telemetryViewModel.telemetryState.collectAsState()"},{"type":"MODIFY","lineNumber":75,"content":"        ) {","oldContent":""},{"type":"INSERT","lineNumber":125,"content":"        var lastMissionTime by remember { mutableStateOf<Long?>(null) }"},{"type":"INSERT","lineNumber":126,"content":"        var lastMissionDistance by remember { mutableStateOf<Float?>(null) }"},{"type":"INSERT","lineNumber":127,"content":"        var prevMissionCompleted by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":126,"oldContent":"            if (telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":129,"content":"            if (!prevMissionCompleted && telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":130,"content":"                // Mission just completed: store last time and distance"},{"type":"INSERT","lineNumber":131,"content":"                lastMissionTime = telemetryState.missionElapsedSec"},{"type":"INSERT","lineNumber":132,"content":"                lastMissionDistance = telemetryState.totalDistanceMeters"},{"type":"INSERT","lineNumber":135,"content":"            prevMissionCompleted = telemetryState.missionCompleted"},{"type":"DELETE","lineNumber":146,"oldContent":"                        val timeStr = telemetryState.missionElapsedSec?.let { sec ->"},{"type":"INSERT","lineNumber":153,"content":"                        val timeStr = lastMissionTime?.let { sec ->"},{"type":"DELETE","lineNumber":152,"oldContent":"                        val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"INSERT","lineNumber":159,"content":"                        val distStr = lastMissionDistance?.let { dist ->"},{"type":"DELETE","lineNumber":163,"oldContent":""},{"type":"INSERT","lineNumber":171,"content":"}"},{"type":"INSERT","lineNumber":173,"content":""},{"type":"DELETE","lineNumber":167,"oldContent":"}"},{"type":"DELETE","lineNumber":201,"oldContent":"                    \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":209,"content":"                    \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":213,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":207,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":216,"content":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":210,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":251,"content":"    }"},{"type":"DELETE","lineNumber":245,"oldContent":"}"},{"type":"INSERT","lineNumber":263,"content":"}"},{"type":"DELETE","lineNumber":257,"oldContent":""}]},{"timestamp":1758695419325,"changes":[{"type":"MODIFY","lineNumber":9,"content":"import androidx.compose.runtime.*","oldContent":"import androidx.compose.runtime.Composable"},{"type":"DELETE","lineNumber":13,"oldContent":"import androidx.compose.ui.Modifier"},{"type":"MODIFY","lineNumber":13,"content":"import androidx.compose.ui.unit.dp","oldContent":"import androidx.compose.ui.graphics.Color"},{"type":"INSERT","lineNumber":15,"content":"import com.example.aerogcsclone.Telemetry.SharedViewModel"},{"type":"MODIFY","lineNumber":17,"content":"import com.example.aerogcsclone.authentication.AuthViewModel","oldContent":"import com.example.aerogcsclone.Telemetry.TelemetryState"},{"type":"MODIFY","lineNumber":32,"content":"    navController: NavHostController","oldContent":"        modifier = Modifier"},{"type":"DELETE","lineNumber":126,"oldContent":"        LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":128,"content":"        LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":129,"content":"            if (!prevMissionCompleted && telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":130,"content":"                // Mission just completed: store last time and distance"},{"type":"INSERT","lineNumber":131,"content":"                lastMissionTime = telemetryState.lastMissionElapsedSec"},{"type":"INSERT","lineNumber":132,"content":"                lastMissionDistance = telemetryState.totalDistanceMeters"},{"type":"DELETE","lineNumber":131,"oldContent":"            if (!prevMissionCompleted && telemetryState.missionCompleted) {"},{"type":"INSERT","lineNumber":135,"content":"            prevMissionCompleted = telemetryState.missionCompleted"},{"type":"DELETE","lineNumber":133,"oldContent":"                // Mission just completed: store last time and distance"},{"type":"DELETE","lineNumber":135,"oldContent":"                lastMissionTime = telemetryState.missionElapsedSec"},{"type":"DELETE","lineNumber":137,"oldContent":"                lastMissionDistance = telemetryState.totalDistanceMeters"},{"type":"DELETE","lineNumber":141,"oldContent":"            prevMissionCompleted = telemetryState.missionCompleted"},{"type":"INSERT","lineNumber":153,"content":"                        val timeStr = lastMissionTime?.let { sec ->"},{"type":"MODIFY","lineNumber":159,"content":"                        val distStr = lastMissionDistance?.let { dist ->","oldContent":"                        val timeStr = lastMissionTime?.let { sec ->"},{"type":"DELETE","lineNumber":165,"oldContent":"                        val distStr = lastMissionDistance?.let { dist ->"},{"type":"INSERT","lineNumber":171,"content":"}"},{"type":"INSERT","lineNumber":173,"content":""},{"type":"DELETE","lineNumber":176,"oldContent":"}"},{"type":"DELETE","lineNumber":179,"oldContent":""},{"type":"INSERT","lineNumber":209,"content":"                    \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":213,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":214,"oldContent":"                    \"%02d:%02d\".format(m, s)"},{"type":"INSERT","lineNumber":216,"content":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":218,"oldContent":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":222,"oldContent":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":247,"oldContent":"        speed < 100f -> String.format(\"%.2f m/s\", speed)"},{"type":"DELETE","lineNumber":248,"oldContent":""},{"type":"INSERT","lineNumber":247,"content":"            containerColor = Color.Black.copy(alpha = 0.7f)"},{"type":"INSERT","lineNumber":248,"content":"        ) {"},{"type":"INSERT","lineNumber":251,"content":"    }"},{"type":"DELETE","lineNumber":257,"oldContent":"    }"},{"type":"MODIFY","lineNumber":264,"content":"","oldContent":""}]},{"timestamp":1758695688529,"changes":[{"type":"INSERT","lineNumber":4,"content":"import androidx.compose.foundation.layout.*"},{"type":"DELETE","lineNumber":5,"oldContent":"import androidx.compose.foundation.shape.RoundedCornerShape"},{"type":"MODIFY","lineNumber":8,"content":"import androidx.compose.material3.*","oldContent":"import androidx.compose.runtime.Composable"},{"type":"MODIFY","lineNumber":15,"content":"import com.example.aerogcsclone.Telemetry.SharedViewModel","oldContent":"import com.example.aerogcsclone.Telemetry.SharedViewModel"},{"type":"DELETE","lineNumber":127,"oldContent":"        LaunchedEffect(telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":129,"oldContent":"            if (!prevMissionCompleted && telemetryState.missionCompleted) {"},{"type":"DELETE","lineNumber":130,"oldContent":"                showMissionCompleteDialog = true"},{"type":"DELETE","lineNumber":131,"oldContent":"                // Mission just completed: store last time and distance"},{"type":"DELETE","lineNumber":132,"oldContent":"            }"},{"type":"INSERT","lineNumber":128,"content":"        LaunchedEffect(telemetryState.missionCompleted, telemetryState.missionElapsedSec) {"},{"type":"INSERT","lineNumber":129,"content":"            // Only show dialog if missionCompleted just transitioned to true AND timer is not running (i.e., mission just ended)"},{"type":"INSERT","lineNumber":130,"content":"            if (!prevMissionCompleted && telemetryState.missionCompleted && telemetryState.missionElapsedSec == null) {"},{"type":"INSERT","lineNumber":133,"content":"                showMissionCompleteDialog = true"},{"type":"INSERT","lineNumber":134,"content":"            }"},{"type":"INSERT","lineNumber":135,"content":"            prevMissionCompleted = telemetryState.missionCompleted"},{"type":"DELETE","lineNumber":137,"oldContent":"            prevMissionCompleted = telemetryState.missionCompleted"},{"type":"DELETE","lineNumber":159,"oldContent":"                        val timeStr = lastMissionTime?.let { sec ->"},{"type":"INSERT","lineNumber":160,"content":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"MODIFY","lineNumber":174,"content":"@Composable","oldContent":"@Composable"},{"type":"MODIFY","lineNumber":214,"content":"                    if (dist < 1000f) \"%.0f m\".format(dist)","oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"MODIFY","lineNumber":217,"content":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)","oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"},{"type":"INSERT","lineNumber":263,"content":"}"},{"type":"DELETE","lineNumber":264,"oldContent":""}]},{"timestamp":1758695950313,"changes":[{"type":"MODIFY","lineNumber":11,"content":"import androidx.compose.ui.Modifier","oldContent":"import androidx.compose.ui.Alignment"},{"type":"INSERT","lineNumber":14,"content":"import androidx.navigation.NavHostController"},{"type":"DELETE","lineNumber":15,"oldContent":"import com.example.aerogcsclone.Telemetry.SharedViewModel"},{"type":"DELETE","lineNumber":49,"oldContent":"                .fillMaxWidth()"},{"type":"DELETE","lineNumber":50,"oldContent":"            // ✅ Pass telemetryState to GcsMap"},{"type":"DELETE","lineNumber":51,"oldContent":"            GcsMap(telemetryState = telemetryState)"},{"type":"DELETE","lineNumber":52,"oldContent":""},{"type":"DELETE","lineNumber":53,"oldContent":"            StatusPanel("},{"type":"DELETE","lineNumber":54,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":55,"oldContent":"                    .padding(12.dp),"},{"type":"DELETE","lineNumber":56,"oldContent":"                telemetryState = telemetryState"},{"type":"DELETE","lineNumber":57,"oldContent":"            )"},{"type":"INSERT","lineNumber":49,"content":"    // Ensure we center the map once when MainPage opens if we have telemetry"},{"type":"INSERT","lineNumber":50,"content":"    var centeredOnce by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":51,"content":"    LaunchedEffect(telemetryState.latitude, telemetryState.longitude) {"},{"type":"INSERT","lineNumber":52,"content":"        val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":53,"content":"        val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":54,"content":"        if (!centeredOnce && lat != null && lon != null) {"},{"type":"INSERT","lineNumber":55,"content":"            cameraPositionState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f))"},{"type":"INSERT","lineNumber":56,"content":"            centeredOnce = true"},{"type":"INSERT","lineNumber":57,"content":"        }"},{"type":"DELETE","lineNumber":127,"oldContent":"        LaunchedEffect(telemetryState.missionCompleted, telemetryState.missionElapsedSec) {"},{"type":"INSERT","lineNumber":128,"content":"        var prevMissionElapsedSec by remember { mutableStateOf<Long?>(null) }"},{"type":"INSERT","lineNumber":129,"content":"        var missionJustCompleted by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":130,"content":"        LaunchedEffect(telemetryState.missionCompleted, telemetryState.missionElapsedSec) {"},{"type":"DELETE","lineNumber":130,"oldContent":"            if (!prevMissionCompleted && telemetryState.missionCompleted && telemetryState.missionElapsedSec == null) {"},{"type":"DELETE","lineNumber":131,"oldContent":"                showMissionCompleteDialog = true"},{"type":"INSERT","lineNumber":132,"content":"            val completedNow = !prevMissionCompleted && telemetryState.missionCompleted && telemetryState.missionElapsedSec == null && prevMissionElapsedSec != null"},{"type":"INSERT","lineNumber":133,"content":"            if (completedNow) {"},{"type":"DELETE","lineNumber":133,"oldContent":"            }"},{"type":"INSERT","lineNumber":136,"content":"                missionJustCompleted = true"},{"type":"INSERT","lineNumber":137,"content":"            }"},{"type":"INSERT","lineNumber":139,"content":"            prevMissionElapsedSec = telemetryState.missionElapsedSec"},{"type":"DELETE","lineNumber":137,"oldContent":"        if (showMissionCompleteDialog) {"},{"type":"INSERT","lineNumber":141,"content":"        if (missionJustCompleted) {"},{"type":"DELETE","lineNumber":139,"oldContent":"                onDismissRequest = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":143,"content":"                onDismissRequest = {"},{"type":"INSERT","lineNumber":144,"content":"                    missionJustCompleted = false"},{"type":"INSERT","lineNumber":145,"content":"                    showMissionCompleteDialog = false"},{"type":"INSERT","lineNumber":146,"content":"                },"},{"type":"DELETE","lineNumber":142,"oldContent":"                        onClick = { showMissionCompleteDialog = false },"},{"type":"INSERT","lineNumber":149,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":150,"content":"                            missionJustCompleted = false"},{"type":"INSERT","lineNumber":151,"content":"                            showMissionCompleteDialog = false"},{"type":"INSERT","lineNumber":152,"content":"                        },"},{"type":"DELETE","lineNumber":159,"oldContent":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":170,"content":"                            if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":183,"content":""},{"type":"DELETE","lineNumber":174,"oldContent":"@Composable"},{"type":"INSERT","lineNumber":223,"content":"                val distStr = telemetryState.totalDistanceMeters?.let { dist ->"},{"type":"DELETE","lineNumber":214,"oldContent":"                    if (dist < 1000f) \"%.0f m\".format(dist)"},{"type":"INSERT","lineNumber":226,"content":"                } ?: \"N/A\""},{"type":"DELETE","lineNumber":217,"oldContent":"                Text(\"Distance: $distStr\", color = Color.White, fontSize = 13.sp)"}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/PlanScreen.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/PlanScreen.kt","baseContent":"package com.example.aerogcsclone.uimain\n\nimport androidx.compose.foundation.layout.Column\nimport androidx.compose.foundation.layout.fillMaxSize\nimport androidx.compose.foundation.layout.padding\nimport androidx.compose.material3.FloatingActionButton\nimport androidx.compose.material3.Scaffold\nimport androidx.compose.material3.Text\nimport androidx.compose.runtime.Composable\nimport androidx.compose.runtime.collectAsState\nimport androidx.compose.runtime.getValue\nimport androidx.compose.ui.Modifier\nimport androidx.navigation.NavHostController\nimport com.example.aerogcsclone.Telemetry.SharedViewModel\nimport com.example.aerogcsclone.authentication.AuthViewModel\n\n@Composable\nfun PlanScreen(\n    telemetryViewModel: SharedViewModel,\n    authViewModel: AuthViewModel,\n    navController: NavHostController\n) {\n    val telemetryState by telemetryViewModel.telemetryState.collectAsState()\n\n    Scaffold(\n        floatingActionButton = {\n            FloatingActionButton(onClick = { /* TODO */ }) {\n                Text(\"Create Plan\")\n            }\n        }\n    ) { paddingValues ->\n        Column(\n            modifier = Modifier\n                .fillMaxSize()\n                .padding(paddingValues)\n        ) {\n            TopNavBar(\n                telemetryState = telemetryState,\n                authViewModel = authViewModel,\n                navController = navController\n            )\n            GcsMap(telemetryState = telemetryState)\n        }\n    }\n}","baseTimestamp":1757650088623,"deltas":[{"timestamp":1758607982919,"changes":[{"type":"DELETE","lineNumber":36,"oldContent":"                .fillMaxSize()"},{"type":"DELETE","lineNumber":37,"oldContent":"                .padding(paddingValues)"},{"type":"DELETE","lineNumber":38,"oldContent":"        ) {"},{"type":"INSERT","lineNumber":36,"content":"    navController: NavHostController"},{"type":"INSERT","lineNumber":37,"content":") {"},{"type":"INSERT","lineNumber":38,"content":"    val telemetryState by telemetryViewModel.telemetryState.collectAsState()"},{"type":"MODIFY","lineNumber":40,"content":"","oldContent":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":53,"oldContent":"    // Map type state"},{"type":"INSERT","lineNumber":54,"content":""},{"type":"INSERT","lineNumber":55,"content":"    // Map type state"},{"type":"DELETE","lineNumber":57,"oldContent":""},{"type":"DELETE","lineNumber":59,"oldContent":"    // Ensure we center the map once when Plan screen opens if we have telemetry"},{"type":"INSERT","lineNumber":60,"content":""},{"type":"INSERT","lineNumber":61,"content":"    // Ensure we center the map once when Plan screen opens if we have telemetry"},{"type":"DELETE","lineNumber":63,"oldContent":""},{"type":"INSERT","lineNumber":67,"content":"            cameraPositionState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f))"},{"type":"DELETE","lineNumber":70,"oldContent":"    fun buildMissionItemFromLatLng("},{"type":"DELETE","lineNumber":71,"oldContent":"            cameraPositionState.move(CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f))"},{"type":"DELETE","lineNumber":72,"oldContent":"        latLng: LatLng,"},{"type":"DELETE","lineNumber":73,"oldContent":"        seq: Int,"},{"type":"DELETE","lineNumber":74,"oldContent":"        isTakeoff: Boolean = false,"},{"type":"DELETE","lineNumber":75,"oldContent":"                    Text(\"Waypoints:\", style = MaterialTheme.typography.titleSmall)"},{"type":"INSERT","lineNumber":71,"content":""},{"type":"INSERT","lineNumber":77,"content":"    fun buildMissionItemFromLatLng("},{"type":"INSERT","lineNumber":78,"content":"        latLng: LatLng,"},{"type":"INSERT","lineNumber":79,"content":"        seq: Int,"},{"type":"INSERT","lineNumber":80,"content":"        isTakeoff: Boolean = false,"},{"type":"DELETE","lineNumber":87,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":89,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":90,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":94,"oldContent":"    }"},{"type":"DELETE","lineNumber":97,"oldContent":"    // Handler when user taps on map: add marker and mission item"},{"type":"DELETE","lineNumber":99,"oldContent":"    val onMapClick: (LatLng) -> Unit = { latLng ->"},{"type":"INSERT","lineNumber":94,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":95,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":96,"content":"            param4 = 0f,"},{"type":"DELETE","lineNumber":101,"oldContent":"        val seq = waypoints.size"},{"type":"DELETE","lineNumber":103,"oldContent":"        val isTakeoff = seq == 0"},{"type":"DELETE","lineNumber":105,"oldContent":"        val item = buildMissionItemFromLatLng(latLng, seq, isTakeoff)"},{"type":"INSERT","lineNumber":101,"content":"    }"},{"type":"INSERT","lineNumber":102,"content":""},{"type":"INSERT","lineNumber":103,"content":"    // Handler when user taps on map: add marker and mission item"},{"type":"INSERT","lineNumber":104,"content":"    val onMapClick: (LatLng) -> Unit = { latLng ->"},{"type":"INSERT","lineNumber":105,"content":"        val seq = waypoints.size"},{"type":"INSERT","lineNumber":106,"content":"        val isTakeoff = seq == 0"},{"type":"INSERT","lineNumber":107,"content":"        val item = buildMissionItemFromLatLng(latLng, seq, isTakeoff)"},{"type":"DELETE","lineNumber":109,"oldContent":""},{"type":"MODIFY","lineNumber":115,"content":"        floatingActionButton = {","oldContent":""},{"type":"DELETE","lineNumber":118,"oldContent":"                            val seq = waypoints.size"},{"type":"DELETE","lineNumber":119,"oldContent":"                            val isTakeoff = seq == 0"},{"type":"DELETE","lineNumber":121,"oldContent":"                            val item = buildMissionItemFromLatLng(center, seq, isTakeoff)"},{"type":"DELETE","lineNumber":122,"oldContent":"                            points.add(center)"},{"type":"DELETE","lineNumber":124,"oldContent":"                            waypoints.add(item)"},{"type":"DELETE","lineNumber":130,"oldContent":"                            if (waypoints.isNotEmpty()) {"},{"type":"DELETE","lineNumber":132,"oldContent":"                                waypoints.removeAt(waypoints.lastIndex)"},{"type":"DELETE","lineNumber":133,"oldContent":"                                points.removeAt(points.lastIndex)"},{"type":"INSERT","lineNumber":126,"content":"                            val seq = waypoints.size"},{"type":"INSERT","lineNumber":127,"content":"                            val isTakeoff = seq == 0"},{"type":"INSERT","lineNumber":128,"content":"                            val item = buildMissionItemFromLatLng(center, seq, isTakeoff)"},{"type":"INSERT","lineNumber":129,"content":"                            points.add(center)"},{"type":"INSERT","lineNumber":130,"content":"                            waypoints.add(item)"},{"type":"DELETE","lineNumber":136,"oldContent":"                        Icon(Icons.Default.Delete, contentDescription = \"Delete Waypoints\")"},{"type":"DELETE","lineNumber":138,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":140,"oldContent":"                        onClick = { waypoints.clear(); points.clear() },"},{"type":"MODIFY","lineNumber":141,"content":"                            if (waypoints.isNotEmpty()) {","oldContent":"                        modifier = Modifier"},{"type":"INSERT","lineNumber":142,"content":"                                waypoints.removeAt(waypoints.lastIndex)"},{"type":"INSERT","lineNumber":143,"content":"                                points.removeAt(points.lastIndex)"},{"type":"DELETE","lineNumber":152,"oldContent":"                points = points,"},{"type":"DELETE","lineNumber":154,"oldContent":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":155,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":157,"oldContent":"                mapType = mapType,"},{"type":"DELETE","lineNumber":158,"oldContent":"                autoCenter = false // do not force camera while planning (user pans)"},{"type":"DELETE","lineNumber":159,"oldContent":"            )"},{"type":"DELETE","lineNumber":160,"oldContent":""},{"type":"INSERT","lineNumber":150,"content":"                        Icon(Icons.Default.Delete, contentDescription = \"Delete Waypoints\")"},{"type":"DELETE","lineNumber":163,"oldContent":"                modifier = Modifier"},{"type":"INSERT","lineNumber":153,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":154,"content":"                        onClick = { waypoints.clear(); points.clear() },"},{"type":"INSERT","lineNumber":155,"content":"                        modifier = Modifier"},{"type":"DELETE","lineNumber":172,"oldContent":""},{"type":"DELETE","lineNumber":178,"oldContent":""},{"type":"INSERT","lineNumber":169,"content":"                }"},{"type":"DELETE","lineNumber":184,"oldContent":"                "},{"type":"DELETE","lineNumber":185,"oldContent":"                // Waypoint list"},{"type":"DELETE","lineNumber":186,"oldContent":"            // Left-side floating buttons (below TopNavBar)"},{"type":"DELETE","lineNumber":187,"oldContent":"                    .align(Alignment.TopStart)"},{"type":"DELETE","lineNumber":188,"oldContent":"                // Refresh button (moved here above Arm)"},{"type":"DELETE","lineNumber":189,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":175,"content":"            GcsMap("},{"type":"INSERT","lineNumber":176,"content":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":177,"content":"                points = points,"},{"type":"INSERT","lineNumber":178,"content":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":179,"content":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":180,"content":"                mapType = mapType,"},{"type":"INSERT","lineNumber":181,"content":"                autoCenter = false // do not force camera while planning (user pans)"},{"type":"INSERT","lineNumber":182,"content":"            )"},{"type":"INSERT","lineNumber":183,"content":""},{"type":"INSERT","lineNumber":186,"content":"                modifier = Modifier"},{"type":"DELETE","lineNumber":198,"oldContent":"                                \"No GPS location available\","},{"type":"DELETE","lineNumber":200,"oldContent":"                                Toast.LENGTH_SHORT"},{"type":"DELETE","lineNumber":202,"oldContent":"                            ).show()"},{"type":"DELETE","lineNumber":204,"oldContent":"                        }"},{"type":"DELETE","lineNumber":206,"oldContent":"                    },"},{"type":"DELETE","lineNumber":208,"oldContent":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter Map\")"},{"type":"DELETE","lineNumber":210,"oldContent":""},{"type":"DELETE","lineNumber":212,"oldContent":"                // Arm button"},{"type":"DELETE","lineNumber":214,"oldContent":"                    onClick = { telemetryViewModel.arm() },"},{"type":"INSERT","lineNumber":201,"content":""},{"type":"DELETE","lineNumber":216,"oldContent":"                    Icon(Icons.Default.FlightTakeoff, contentDescription = \"Arm\")"},{"type":"DELETE","lineNumber":218,"oldContent":"                }"},{"type":"INSERT","lineNumber":206,"content":"                    .align(Alignment.Center),"},{"type":"INSERT","lineNumber":207,"content":"                contentAlignment = Alignment.Center"},{"type":"INSERT","lineNumber":208,"content":"            ) {"},{"type":"INSERT","lineNumber":209,"content":"                Icon("},{"type":"INSERT","lineNumber":210,"content":"                    Icons.Default.Add,"},{"type":"INSERT","lineNumber":211,"content":"                    contentDescription = \"Crosshair\","},{"type":"INSERT","lineNumber":212,"content":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":213,"content":"                    modifier = Modifier.size(28.dp)"},{"type":"INSERT","lineNumber":214,"content":"                )"},{"type":"INSERT","lineNumber":215,"content":"            }"},{"type":"INSERT","lineNumber":216,"content":""},{"type":"INSERT","lineNumber":217,"content":"            // Left-side floating buttons (below TopNavBar)"},{"type":"INSERT","lineNumber":218,"content":"            Column("},{"type":"INSERT","lineNumber":219,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":220,"content":"                    .align(Alignment.TopStart)"},{"type":"INSERT","lineNumber":221,"content":"                    .padding(start = 16.dp, top = 72.dp),"},{"type":"INSERT","lineNumber":222,"content":"                verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"INSERT","lineNumber":223,"content":"            ) {"},{"type":"INSERT","lineNumber":224,"content":"                // Refresh button (moved here above Arm)"},{"type":"INSERT","lineNumber":225,"content":"                FloatingActionButton("},{"type":"INSERT","lineNumber":226,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":227,"content":"                        val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":228,"content":"                        val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":229,"content":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":230,"content":"                            cameraPositionState.move("},{"type":"INSERT","lineNumber":231,"content":"                                CameraUpdateFactory.newLatLngZoom("},{"type":"INSERT","lineNumber":232,"content":"                                    LatLng(lat, lon),"},{"type":"INSERT","lineNumber":233,"content":"                                    16f"},{"type":"INSERT","lineNumber":234,"content":"                                )"},{"type":"INSERT","lineNumber":235,"content":"                            )"},{"type":"INSERT","lineNumber":236,"content":"                        } else {"},{"type":"INSERT","lineNumber":237,"content":"                            Toast.makeText("},{"type":"INSERT","lineNumber":238,"content":"                                context,"},{"type":"INSERT","lineNumber":239,"content":"                                \"No GPS location available\","},{"type":"INSERT","lineNumber":240,"content":"                                Toast.LENGTH_SHORT"},{"type":"INSERT","lineNumber":241,"content":"                            ).show()"},{"type":"INSERT","lineNumber":242,"content":"                        }"},{"type":"INSERT","lineNumber":243,"content":"                    },"},{"type":"INSERT","lineNumber":244,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":245,"content":"                ) {"},{"type":"INSERT","lineNumber":246,"content":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter Map\")"},{"type":"INSERT","lineNumber":247,"content":"                }"},{"type":"INSERT","lineNumber":248,"content":""},{"type":"INSERT","lineNumber":249,"content":"                // Arm button"},{"type":"INSERT","lineNumber":250,"content":"                FloatingActionButton("},{"type":"INSERT","lineNumber":251,"content":"                    onClick = { telemetryViewModel.arm() },"},{"type":"INSERT","lineNumber":252,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":253,"content":"                ) {"},{"type":"INSERT","lineNumber":254,"content":"                    Icon(Icons.Default.FlightTakeoff, contentDescription = \"Arm\")"},{"type":"INSERT","lineNumber":255,"content":"                }"},{"type":"INSERT","lineNumber":256,"content":""},{"type":"INSERT","lineNumber":257,"content":"                FloatingActionButton("},{"type":"INSERT","lineNumber":258,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":259,"content":"                        mapType ="},{"type":"DELETE","lineNumber":223,"oldContent":"                    .align(Alignment.Center),"},{"type":"DELETE","lineNumber":226,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":229,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":232,"oldContent":"                Icon("},{"type":"INSERT","lineNumber":268,"content":""},{"type":"DELETE","lineNumber":234,"oldContent":"                    Icons.Default.Add,"},{"type":"DELETE","lineNumber":236,"oldContent":"                    contentDescription = \"Crosshair\","},{"type":"DELETE","lineNumber":238,"oldContent":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":239,"oldContent":"                    modifier = Modifier.size(28.dp)"},{"type":"DELETE","lineNumber":240,"oldContent":"                )"},{"type":"INSERT","lineNumber":272,"content":"                }"},{"type":"DELETE","lineNumber":242,"oldContent":"            // Bottom panel: upload and list"},{"type":"DELETE","lineNumber":243,"oldContent":"            Column("},{"type":"DELETE","lineNumber":245,"oldContent":"                modifier = Modifier"},{"type":"INSERT","lineNumber":275,"content":"            // Bottom panel: upload mission"},{"type":"DELETE","lineNumber":247,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":248,"oldContent":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":278,"content":"                    .align(Alignment.BottomCenter)"},{"type":"INSERT","lineNumber":279,"content":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":252,"oldContent":"                    .padding(start = 16.dp, top = 72.dp),"},{"type":"DELETE","lineNumber":256,"oldContent":"                verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":260,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":266,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":271,"oldContent":"                        val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":273,"oldContent":"                        val lon = telemetryState.longitude"},{"type":"DELETE","lineNumber":275,"oldContent":"                        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":277,"oldContent":"                            cameraPositionState.move("},{"type":"DELETE","lineNumber":279,"oldContent":"                                CameraUpdateFactory.newLatLngZoom("},{"type":"DELETE","lineNumber":281,"oldContent":"                                    LatLng(lat, lon),"},{"type":"DELETE","lineNumber":283,"oldContent":"                                    16f"},{"type":"DELETE","lineNumber":285,"oldContent":"                                )"},{"type":"DELETE","lineNumber":287,"oldContent":"                            )"},{"type":"DELETE","lineNumber":289,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":291,"oldContent":"                            Toast.makeText("},{"type":"DELETE","lineNumber":292,"oldContent":"                                context,"},{"type":"INSERT","lineNumber":307,"content":"                        )"},{"type":"INSERT","lineNumber":308,"content":""},{"type":"DELETE","lineNumber":295,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":298,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":302,"oldContent":"                }"},{"type":"DELETE","lineNumber":304,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":306,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":309,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":311,"oldContent":""},{"type":"DELETE","lineNumber":313,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":317,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":326,"content":"                            )"},{"type":"DELETE","lineNumber":320,"oldContent":"                        mapType ="},{"type":"DELETE","lineNumber":321,"oldContent":"                        points.forEachIndexed { idx, latLng ->"},{"type":"INSERT","lineNumber":329,"content":""},{"type":"INSERT","lineNumber":330,"content":"                        points.forEachIndexed { idx, latLng ->"},{"type":"DELETE","lineNumber":325,"oldContent":"                }"},{"type":"DELETE","lineNumber":327,"oldContent":"            }"},{"type":"DELETE","lineNumber":329,"oldContent":""},{"type":"DELETE","lineNumber":332,"oldContent":"                        )"},{"type":"DELETE","lineNumber":335,"oldContent":""},{"type":"INSERT","lineNumber":350,"content":"                                )"},{"type":"INSERT","lineNumber":352,"content":"                        }"},{"type":"INSERT","lineNumber":353,"content":""},{"type":"DELETE","lineNumber":353,"oldContent":""},{"type":"DELETE","lineNumber":355,"oldContent":""},{"type":"DELETE","lineNumber":365,"oldContent":"                                )"},{"type":"INSERT","lineNumber":369,"content":"                        }"},{"type":"DELETE","lineNumber":368,"oldContent":"                            )"},{"type":"DELETE","lineNumber":370,"oldContent":"                        }"},{"type":"DELETE","lineNumber":371,"oldContent":""},{"type":"INSERT","lineNumber":373,"content":"                ) {"},{"type":"INSERT","lineNumber":375,"content":"                }"},{"type":"INSERT","lineNumber":376,"content":""},{"type":"INSERT","lineNumber":378,"content":""},{"type":"INSERT","lineNumber":379,"content":""},{"type":"DELETE","lineNumber":377,"oldContent":"                        }"},{"type":"INSERT","lineNumber":383,"content":"            }"},{"type":"DELETE","lineNumber":379,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":382,"oldContent":"                }"},{"type":"DELETE","lineNumber":384,"oldContent":""},{"type":"DELETE","lineNumber":385,"oldContent":""},{"type":"DELETE","lineNumber":386,"oldContent":"            }"},{"type":"DELETE","lineNumber":387,"oldContent":""},{"type":"DELETE","lineNumber":388,"oldContent":""}]},{"timestamp":1758608083722,"changes":[{"type":"DELETE","lineNumber":4,"oldContent":"import androidx.compose.foundation.background"},{"type":"MODIFY","lineNumber":11,"content":"import androidx.compose.ui.Modifier","oldContent":"import androidx.compose.runtime.getValue"},{"type":"DELETE","lineNumber":27,"oldContent":"        floatingActionButton = {"},{"type":"INSERT","lineNumber":26,"content":"import com.example.aerogcsclone.navigation.Screen"},{"type":"MODIFY","lineNumber":47,"content":"    // State management","oldContent":"    // State to toggle plan action buttons"},{"type":"DELETE","lineNumber":50,"oldContent":"            }"},{"type":"DELETE","lineNumber":51,"oldContent":"    // Grid survey mode state"},{"type":"DELETE","lineNumber":53,"oldContent":""},{"type":"DELETE","lineNumber":55,"oldContent":"    // Map type state"},{"type":"DELETE","lineNumber":58,"oldContent":"    // Camera state for map center / crosshair"},{"type":"INSERT","lineNumber":53,"content":"    // Grid survey parameters"},{"type":"INSERT","lineNumber":54,"content":"    var lineSpacing by remember { mutableStateOf(30f) }"},{"type":"INSERT","lineNumber":55,"content":"    var gridAngle by remember { mutableStateOf(0f) }"},{"type":"INSERT","lineNumber":56,"content":"    var surveySpeed by remember { mutableStateOf(10f) }"},{"type":"INSERT","lineNumber":57,"content":"    var surveyAltitude by remember { mutableStateOf(60f) }"},{"type":"INSERT","lineNumber":58,"content":"    "},{"type":"INSERT","lineNumber":59,"content":"    // Grid state"},{"type":"INSERT","lineNumber":60,"content":"    var surveyPolygon by remember { mutableStateOf<List<LatLng>>(emptyList()) }"},{"type":"INSERT","lineNumber":61,"content":"    var gridResult by remember { mutableStateOf<GridSurveyResult?>(null) }"},{"type":"INSERT","lineNumber":62,"content":"    val gridGenerator = remember { GridGenerator() }"},{"type":"DELETE","lineNumber":60,"oldContent":"                    }"},{"type":"DELETE","lineNumber":61,"oldContent":"    // Ensure we center the map once when Plan screen opens if we have telemetry"},{"type":"INSERT","lineNumber":64,"content":"    // Camera and waypoint state"},{"type":"INSERT","lineNumber":65,"content":"    val cameraPositionState = rememberCameraPositionState()"},{"type":"INSERT","lineNumber":66,"content":"    val points = remember { mutableStateListOf<LatLng>() }"},{"type":"INSERT","lineNumber":67,"content":"    val waypoints = remember { mutableStateListOf<MissionItemInt>() }"},{"type":"INSERT","lineNumber":68,"content":"    val coroutineScope = rememberCoroutineScope()"},{"type":"INSERT","lineNumber":69,"content":""},{"type":"INSERT","lineNumber":70,"content":"    // Center map once when screen opens"},{"type":"DELETE","lineNumber":72,"oldContent":"    // Waypoint storage: geographic points and mission items"},{"type":"INSERT","lineNumber":81,"content":"    // Helper functions"},{"type":"DELETE","lineNumber":74,"oldContent":"    val points = remember { mutableStateListOf<LatLng>() }"},{"type":"DELETE","lineNumber":76,"oldContent":"    val waypoints = remember { mutableStateListOf<MissionItemInt>() }"},{"type":"DELETE","lineNumber":78,"oldContent":""},{"type":"DELETE","lineNumber":80,"oldContent":"    // Helper to build MissionItemInt from LatLng"},{"type":"DELETE","lineNumber":88,"oldContent":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of("},{"type":"DELETE","lineNumber":89,"oldContent":"                MavCmd.NAV_WAYPOINT"},{"type":"DELETE","lineNumber":90,"oldContent":"            ),"},{"type":"DELETE","lineNumber":91,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":92,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":93,"oldContent":"            current = 0u, // ensure 0 for compatibility"},{"type":"DELETE","lineNumber":94,"oldContent":"            param4 = 0f,"},{"type":"INSERT","lineNumber":93,"content":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":94,"content":"            current = 0u,"},{"type":"MODIFY","lineNumber":96,"content":"            param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,","oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":98,"oldContent":"    }"},{"type":"DELETE","lineNumber":99,"oldContent":""},{"type":"DELETE","lineNumber":101,"oldContent":"    // Handler when user taps on map: add marker and mission item"},{"type":"DELETE","lineNumber":102,"oldContent":"    val onMapClick: (LatLng) -> Unit = { latLng ->"},{"type":"DELETE","lineNumber":104,"oldContent":"        val seq = waypoints.size"},{"type":"DELETE","lineNumber":105,"oldContent":"        val isTakeoff = seq == 0"},{"type":"DELETE","lineNumber":107,"oldContent":"        val item = buildMissionItemFromLatLng(latLng, seq, isTakeoff)"},{"type":"DELETE","lineNumber":108,"oldContent":"        points.add(latLng)"},{"type":"DELETE","lineNumber":109,"oldContent":"        waypoints.add(item)"},{"type":"DELETE","lineNumber":112,"oldContent":"    val coroutineScope = rememberCoroutineScope()"},{"type":"INSERT","lineNumber":103,"content":"    fun regenerateGrid() {"},{"type":"INSERT","lineNumber":104,"content":"        if (surveyPolygon.size >= 3) {"},{"type":"INSERT","lineNumber":105,"content":"            val params = GridSurveyParams("},{"type":"INSERT","lineNumber":106,"content":"                lineSpacing = lineSpacing,"},{"type":"INSERT","lineNumber":107,"content":"                gridAngle = gridAngle,"},{"type":"INSERT","lineNumber":108,"content":"                speed = surveySpeed,"},{"type":"INSERT","lineNumber":109,"content":"                altitude = surveyAltitude,"},{"type":"INSERT","lineNumber":110,"content":"                includeSpeedCommands = true"},{"type":"INSERT","lineNumber":111,"content":"            )"},{"type":"INSERT","lineNumber":112,"content":"            gridResult = gridGenerator.generateGridSurvey(surveyPolygon, params)"},{"type":"INSERT","lineNumber":113,"content":"        }"},{"type":"INSERT","lineNumber":114,"content":"    }"},{"type":"INSERT","lineNumber":116,"content":"    // Map click handler"},{"type":"INSERT","lineNumber":117,"content":"    val onMapClick: (LatLng) -> Unit = { latLng ->"},{"type":"INSERT","lineNumber":118,"content":"        if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":119,"content":"            surveyPolygon = surveyPolygon + latLng"},{"type":"INSERT","lineNumber":120,"content":"            if (surveyPolygon.size >= 3) {"},{"type":"INSERT","lineNumber":121,"content":"                regenerateGrid()"},{"type":"INSERT","lineNumber":122,"content":"            }"},{"type":"INSERT","lineNumber":123,"content":"        } else {"},{"type":"INSERT","lineNumber":124,"content":"            val seq = waypoints.size"},{"type":"INSERT","lineNumber":125,"content":"            val isTakeoff = seq == 0"},{"type":"INSERT","lineNumber":126,"content":"            val item = buildMissionItemFromLatLng(latLng, seq, isTakeoff)"},{"type":"INSERT","lineNumber":127,"content":"            points.add(latLng)"},{"type":"INSERT","lineNumber":128,"content":"            waypoints.add(item)"},{"type":"INSERT","lineNumber":129,"content":"        }"},{"type":"INSERT","lineNumber":130,"content":"    }"},{"type":"INSERT","lineNumber":131,"content":""},{"type":"INSERT","lineNumber":132,"content":"    // Update grid when parameters change"},{"type":"INSERT","lineNumber":133,"content":"    LaunchedEffect(lineSpacing, gridAngle, surveySpeed, surveyAltitude, surveyPolygon) {"},{"type":"INSERT","lineNumber":134,"content":"        if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":135,"content":"            regenerateGrid()"},{"type":"INSERT","lineNumber":136,"content":"        }"},{"type":"INSERT","lineNumber":137,"content":"    }"},{"type":"INSERT","lineNumber":138,"content":""},{"type":"DELETE","lineNumber":116,"oldContent":"            Column("},{"type":"DELETE","lineNumber":117,"oldContent":"                horizontalAlignment = Alignment.End"},{"type":"DELETE","lineNumber":118,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":119,"oldContent":"                // Extra buttons shown above \"Create Plan\""},{"type":"INSERT","lineNumber":141,"content":"            Column(horizontalAlignment = Alignment.End) {"},{"type":"DELETE","lineNumber":121,"oldContent":"                            val seq = waypoints.size"},{"type":"DELETE","lineNumber":122,"oldContent":"                    // Add at crosshair"},{"type":"DELETE","lineNumber":123,"oldContent":"                            val isTakeoff = seq == 0"},{"type":"DELETE","lineNumber":125,"oldContent":"                            val item = buildMissionItemFromLatLng(center, seq, isTakeoff)"},{"type":"DELETE","lineNumber":127,"oldContent":"                            points.add(center)"},{"type":"DELETE","lineNumber":128,"oldContent":"                            // get map center"},{"type":"DELETE","lineNumber":129,"oldContent":"                            waypoints.add(item)"},{"type":"INSERT","lineNumber":146,"content":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":147,"content":"                                surveyPolygon = surveyPolygon + center"},{"type":"INSERT","lineNumber":148,"content":"                                if (surveyPolygon.size >= 3) regenerateGrid()"},{"type":"INSERT","lineNumber":149,"content":"                            } else {"},{"type":"INSERT","lineNumber":150,"content":"                                val seq = waypoints.size"},{"type":"INSERT","lineNumber":151,"content":"                                val item = buildMissionItemFromLatLng(center, seq, seq == 0)"},{"type":"INSERT","lineNumber":152,"content":"                                points.add(center)"},{"type":"INSERT","lineNumber":153,"content":"                                waypoints.add(item)"},{"type":"INSERT","lineNumber":154,"content":"                            }"},{"type":"DELETE","lineNumber":132,"oldContent":"                        modifier = Modifier"},{"type":"DELETE","lineNumber":133,"oldContent":"                            .padding(bottom = 12.dp)"},{"type":"DELETE","lineNumber":134,"oldContent":"                            .size(56.dp)"},{"type":"DELETE","lineNumber":135,"oldContent":"                            if (waypoints.isNotEmpty()) {"},{"type":"DELETE","lineNumber":136,"oldContent":"                                waypoints.removeAt(waypoints.lastIndex)"},{"type":"INSERT","lineNumber":156,"content":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"DELETE","lineNumber":138,"oldContent":"                                points.removeAt(points.lastIndex)"},{"type":"DELETE","lineNumber":139,"oldContent":"                        Icon(Icons.Default.Add, contentDescription = \"Add Waypoint at Crosshair\")"},{"type":"INSERT","lineNumber":158,"content":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"INSERT","lineNumber":163,"content":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":164,"content":"                                if (surveyPolygon.isNotEmpty()) {"},{"type":"INSERT","lineNumber":165,"content":"                                    surveyPolygon = surveyPolygon.dropLast(1)"},{"type":"INSERT","lineNumber":166,"content":"                                    if (surveyPolygon.size >= 3) regenerateGrid() else gridResult = null"},{"type":"INSERT","lineNumber":167,"content":"                                }"},{"type":"INSERT","lineNumber":168,"content":"                            } else {"},{"type":"INSERT","lineNumber":169,"content":"                                if (waypoints.isNotEmpty()) {"},{"type":"INSERT","lineNumber":170,"content":"                                    waypoints.removeAt(waypoints.lastIndex)"},{"type":"INSERT","lineNumber":171,"content":"                                    points.removeAt(points.lastIndex)"},{"type":"INSERT","lineNumber":172,"content":"                                }"},{"type":"DELETE","lineNumber":146,"oldContent":"                        Icon(Icons.Default.Delete, contentDescription = \"Delete Waypoints\")"},{"type":"DELETE","lineNumber":147,"oldContent":"                        modifier = Modifier"},{"type":"DELETE","lineNumber":148,"oldContent":"                            .padding(bottom = 12.dp)"},{"type":"DELETE","lineNumber":149,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":150,"oldContent":"                            .size(56.dp)"},{"type":"DELETE","lineNumber":151,"oldContent":"                        onClick = { waypoints.clear(); points.clear() },"},{"type":"DELETE","lineNumber":152,"oldContent":"                        modifier = Modifier"},{"type":"INSERT","lineNumber":175,"content":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"INSERT","lineNumber":177,"content":"                        Icon(Icons.Default.Delete, contentDescription = \"Delete Last\")"},{"type":"DELETE","lineNumber":156,"oldContent":"                            .padding(bottom = 12.dp)"},{"type":"DELETE","lineNumber":157,"oldContent":"                            .size(56.dp)"},{"type":"INSERT","lineNumber":180,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":181,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":182,"content":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":183,"content":"                                surveyPolygon = emptyList()"},{"type":"INSERT","lineNumber":184,"content":"                                gridResult = null"},{"type":"INSERT","lineNumber":185,"content":"                            } else {"},{"type":"INSERT","lineNumber":186,"content":"                                waypoints.clear()"},{"type":"INSERT","lineNumber":187,"content":"                                points.clear()"},{"type":"INSERT","lineNumber":188,"content":"                            }"},{"type":"INSERT","lineNumber":189,"content":"                        },"},{"type":"INSERT","lineNumber":190,"content":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"DELETE","lineNumber":159,"oldContent":"                        Icon(Icons.Default.ClearAll, contentDescription = \"Clear Plan\")"},{"type":"INSERT","lineNumber":192,"content":"                        Icon(Icons.Default.ClearAll, contentDescription = \"Clear All\")"},{"type":"DELETE","lineNumber":162,"oldContent":"                }"},{"type":"DELETE","lineNumber":164,"oldContent":"                // Main Create Plan button"},{"type":"DELETE","lineNumber":166,"oldContent":""},{"type":"INSERT","lineNumber":197,"content":"                    onClick = { showPlanActions = !showPlanActions },"},{"type":"INSERT","lineNumber":198,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":199,"content":"                ) {"},{"type":"INSERT","lineNumber":200,"content":"                    Icon(Icons.Default.Menu, contentDescription = \"Plan Menu\")"},{"type":"INSERT","lineNumber":201,"content":"                }"},{"type":"INSERT","lineNumber":202,"content":"            }"},{"type":"INSERT","lineNumber":203,"content":"        }"},{"type":"INSERT","lineNumber":204,"content":"    ) { paddingValues ->"},{"type":"INSERT","lineNumber":205,"content":"        Box(modifier = Modifier.fillMaxSize().padding(paddingValues)) {"},{"type":"INSERT","lineNumber":206,"content":"            // Map"},{"type":"DELETE","lineNumber":168,"oldContent":"}"},{"type":"DELETE","lineNumber":170,"oldContent":"    }"},{"type":"DELETE","lineNumber":171,"oldContent":"                points = points,"},{"type":"DELETE","lineNumber":172,"oldContent":"        }"},{"type":"INSERT","lineNumber":209,"content":"                points = if (isGridSurveyMode) emptyList() else points,"},{"type":"DELETE","lineNumber":175,"oldContent":"            }"},{"type":"DELETE","lineNumber":177,"oldContent":"        }"},{"type":"DELETE","lineNumber":178,"oldContent":"                autoCenter = false // do not force camera while planning (user pans)"},{"type":"DELETE","lineNumber":179,"oldContent":"    ) { paddingValues ->"},{"type":"INSERT","lineNumber":213,"content":"                autoCenter = false,"},{"type":"INSERT","lineNumber":214,"content":"                surveyPolygon = if (isGridSurveyMode) surveyPolygon else emptyList(),"},{"type":"INSERT","lineNumber":215,"content":"                gridLines = gridResult?.gridLines ?: emptyList(),"},{"type":"INSERT","lineNumber":216,"content":"                gridWaypoints = gridResult?.waypoints?.map { it.position } ?: emptyList()"},{"type":"DELETE","lineNumber":181,"oldContent":"        Box(modifier = Modifier.fillMaxSize().padding(paddingValues)) {"},{"type":"DELETE","lineNumber":183,"oldContent":"            // Map background"},{"type":"DELETE","lineNumber":184,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":185,"oldContent":"            // Small connection / FCU status indicator"},{"type":"INSERT","lineNumber":219,"content":"            // Status indicator"},{"type":"INSERT","lineNumber":221,"content":"                modifier = Modifier"},{"type":"DELETE","lineNumber":194,"oldContent":""},{"type":"DELETE","lineNumber":198,"oldContent":"                    .align(Alignment.Center),"},{"type":"DELETE","lineNumber":199,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"INSERT","lineNumber":233,"content":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":234,"content":"                )"},{"type":"INSERT","lineNumber":235,"content":"                Text("},{"type":"INSERT","lineNumber":236,"content":"                    \"Mode: ${if (isGridSurveyMode) \"Grid Survey\" else \"Waypoints\"}\","},{"type":"INSERT","lineNumber":237,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":238,"content":"                    color = if (isGridSurveyMode) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.onSurface,"},{"type":"INSERT","lineNumber":239,"content":"                    fontWeight = if (isGridSurveyMode) FontWeight.Bold else FontWeight.Normal"},{"type":"INSERT","lineNumber":240,"content":"                )"},{"type":"INSERT","lineNumber":241,"content":"            }"},{"type":"INSERT","lineNumber":242,"content":""},{"type":"INSERT","lineNumber":243,"content":"            // Crosshair"},{"type":"INSERT","lineNumber":244,"content":"            Box("},{"type":"INSERT","lineNumber":245,"content":"                modifier = Modifier.size(36.dp).align(Alignment.Center),"},{"type":"INSERT","lineNumber":246,"content":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":203,"oldContent":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":206,"oldContent":"                )"},{"type":"DELETE","lineNumber":209,"oldContent":"            }"},{"type":"DELETE","lineNumber":212,"oldContent":"            // Crosshair overlay"},{"type":"DELETE","lineNumber":214,"oldContent":"            // Left-side floating buttons (below TopNavBar)"},{"type":"DELETE","lineNumber":215,"oldContent":"            Box("},{"type":"INSERT","lineNumber":256,"content":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":218,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":220,"oldContent":"                    .size(36.dp)"},{"type":"DELETE","lineNumber":222,"oldContent":"                            if (mapType == MapType.SATELLITE) MapType.NORMAL else MapType.SATELLITE"},{"type":"DELETE","lineNumber":224,"oldContent":"                    },"},{"type":"DELETE","lineNumber":226,"oldContent":"                // Refresh button (moved here above Arm)"},{"type":"DELETE","lineNumber":227,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":264,"content":"                    onClick = { "},{"type":"INSERT","lineNumber":265,"content":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"INSERT","lineNumber":266,"content":"                        showGridControls = isGridSurveyMode"},{"type":"INSERT","lineNumber":267,"content":"                        if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":268,"content":"                            points.clear()"},{"type":"INSERT","lineNumber":269,"content":"                            waypoints.clear()"},{"type":"INSERT","lineNumber":270,"content":"                        } else {"},{"type":"INSERT","lineNumber":271,"content":"                            surveyPolygon = emptyList()"},{"type":"INSERT","lineNumber":272,"content":"                            gridResult = null"},{"type":"INSERT","lineNumber":273,"content":"                        }"},{"type":"INSERT","lineNumber":274,"content":"                    },"},{"type":"INSERT","lineNumber":275,"content":"                    containerColor = if (isGridSurveyMode) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.surface,"},{"type":"INSERT","lineNumber":276,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":278,"content":"                    Icon("},{"type":"INSERT","lineNumber":279,"content":"                        Icons.Default.GridOn, "},{"type":"INSERT","lineNumber":280,"content":"                        contentDescription = \"Grid Survey Mode\","},{"type":"INSERT","lineNumber":281,"content":"                        tint = if (isGridSurveyMode) Color.White else MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":282,"content":"                    )"},{"type":"INSERT","lineNumber":283,"content":"                }"},{"type":"INSERT","lineNumber":284,"content":""},{"type":"INSERT","lineNumber":285,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":232,"oldContent":"                    Icon(Icons.Default.Map, contentDescription = \"Toggle Map Type\")"},{"type":"DELETE","lineNumber":234,"oldContent":"                }"},{"type":"DELETE","lineNumber":237,"oldContent":"                }"},{"type":"DELETE","lineNumber":238,"oldContent":"                                CameraUpdateFactory.newLatLngZoom("},{"type":"DELETE","lineNumber":239,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":240,"oldContent":"                                    LatLng(lat, lon),"},{"type":"DELETE","lineNumber":241,"oldContent":"                                    16f"},{"type":"DELETE","lineNumber":242,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":243,"oldContent":"                                )"},{"type":"INSERT","lineNumber":291,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":245,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":247,"oldContent":"                            Toast.makeText("},{"type":"DELETE","lineNumber":248,"oldContent":"                    Icon(Icons.Default.Build, contentDescription = \"Change Mode\")"},{"type":"DELETE","lineNumber":249,"oldContent":"                                context,"},{"type":"DELETE","lineNumber":250,"oldContent":"                                \"No GPS location available\","},{"type":"DELETE","lineNumber":251,"oldContent":"                                Toast.LENGTH_SHORT"},{"type":"DELETE","lineNumber":252,"oldContent":"                            ).show()"},{"type":"DELETE","lineNumber":253,"oldContent":"            }"},{"type":"INSERT","lineNumber":294,"content":"                            Toast.makeText(context, \"No GPS location available\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":257,"oldContent":""},{"type":"DELETE","lineNumber":259,"oldContent":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter Map\")"},{"type":"DELETE","lineNumber":260,"oldContent":"            Column("},{"type":"INSERT","lineNumber":299,"content":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter\")"},{"type":"DELETE","lineNumber":263,"oldContent":"                // Arm button"},{"type":"DELETE","lineNumber":264,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":266,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":268,"oldContent":"                Button("},{"type":"DELETE","lineNumber":271,"oldContent":"                    onClick = {"},{"type":"DELETE","lineNumber":273,"oldContent":"                        // Build correct MAVLink mission plan"},{"type":"DELETE","lineNumber":275,"oldContent":"                        val builtMission = mutableListOf<MissionItemInt>()"},{"type":"DELETE","lineNumber":278,"oldContent":"                        val homeLat = telemetryState.latitude ?: 0.0"},{"type":"DELETE","lineNumber":279,"oldContent":"                    onClick = {"},{"type":"DELETE","lineNumber":280,"oldContent":"                        val homeLon = telemetryState.longitude ?: 0.0"},{"type":"DELETE","lineNumber":281,"oldContent":"                        mapType ="},{"type":"DELETE","lineNumber":282,"oldContent":"                        val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"INSERT","lineNumber":310,"content":"                    onClick = { mapType = if (mapType == MapType.SATELLITE) MapType.NORMAL else MapType.SATELLITE },"},{"type":"INSERT","lineNumber":311,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":312,"content":"                ) {"},{"type":"INSERT","lineNumber":313,"content":"                    Icon(Icons.Default.Map, contentDescription = \"Toggle Map\")"},{"type":"INSERT","lineNumber":314,"content":"                }"},{"type":"INSERT","lineNumber":315,"content":"            }"},{"type":"DELETE","lineNumber":284,"oldContent":"                        // Sequence 0: Home position as NAV_WAYPOINT"},{"type":"DELETE","lineNumber":285,"oldContent":"                        builtMission.add("},{"type":"DELETE","lineNumber":286,"oldContent":"                            MissionItemInt("},{"type":"DELETE","lineNumber":287,"oldContent":"                                targetSystem = 0u,"},{"type":"DELETE","lineNumber":288,"oldContent":"                                targetComponent = 0u,"},{"type":"INSERT","lineNumber":317,"content":"            // Grid controls panel"},{"type":"INSERT","lineNumber":318,"content":"            if (showGridControls) {"},{"type":"INSERT","lineNumber":319,"content":"                Surface("},{"type":"INSERT","lineNumber":320,"content":"                    modifier = Modifier"},{"type":"INSERT","lineNumber":321,"content":"                        .align(Alignment.CenterStart)"},{"type":"INSERT","lineNumber":322,"content":"                        .padding(start = 16.dp)"},{"type":"INSERT","lineNumber":323,"content":"                        .width(320.dp),"},{"type":"INSERT","lineNumber":324,"content":"                    shape = RoundedCornerShape(12.dp),"},{"type":"INSERT","lineNumber":325,"content":"                    color = Color.Black.copy(alpha = 0.8f)"},{"type":"INSERT","lineNumber":326,"content":"                ) {"},{"type":"INSERT","lineNumber":327,"content":"                    Column("},{"type":"INSERT","lineNumber":328,"content":"                        modifier = Modifier.padding(16.dp),"},{"type":"INSERT","lineNumber":329,"content":"                        verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"INSERT","lineNumber":330,"content":"                    ) {"},{"type":"INSERT","lineNumber":331,"content":"                        Text("},{"type":"INSERT","lineNumber":332,"content":"                            \"Grid Survey Parameters\","},{"type":"INSERT","lineNumber":333,"content":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":334,"content":"                            color = Color.White,"},{"type":"INSERT","lineNumber":335,"content":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":336,"content":"                        )"},{"type":"DELETE","lineNumber":290,"oldContent":"                                seq = 0u,"},{"type":"DELETE","lineNumber":291,"oldContent":"                                frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":292,"oldContent":"                                command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":293,"oldContent":"                }"},{"type":"DELETE","lineNumber":294,"oldContent":"                                current = 1u, // True for first item"},{"type":"DELETE","lineNumber":295,"oldContent":"                                autocontinue = 1u,"},{"type":"DELETE","lineNumber":296,"oldContent":"            // Bottom panel: upload mission"},{"type":"DELETE","lineNumber":297,"oldContent":"                                param1 = 0f,"},{"type":"DELETE","lineNumber":298,"oldContent":"                    .align(Alignment.BottomCenter)"},{"type":"DELETE","lineNumber":299,"oldContent":"                                param2 = 0f,"},{"type":"DELETE","lineNumber":300,"oldContent":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":301,"oldContent":"                                param3 = 0f,"},{"type":"DELETE","lineNumber":302,"oldContent":"                                param4 = 0f,"},{"type":"DELETE","lineNumber":303,"oldContent":"                                x = (homeLat * 1E7).toInt(),"},{"type":"DELETE","lineNumber":304,"oldContent":"                                y = (homeLon * 1E7).toInt(),"},{"type":"DELETE","lineNumber":305,"oldContent":"                                z = homeAlt"},{"type":"INSERT","lineNumber":338,"content":"                        Column {"},{"type":"INSERT","lineNumber":339,"content":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"INSERT","lineNumber":340,"content":"                            Slider("},{"type":"INSERT","lineNumber":341,"content":"                                value = lineSpacing,"},{"type":"INSERT","lineNumber":342,"content":"                                onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":343,"content":"                                valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":344,"content":"                                steps = 17"},{"type":"DELETE","lineNumber":307,"oldContent":"                        // Sequence 1: Takeoff at home position"},{"type":"DELETE","lineNumber":308,"oldContent":"                        builtMission.add("},{"type":"DELETE","lineNumber":309,"oldContent":"                            MissionItemInt("},{"type":"DELETE","lineNumber":310,"oldContent":"                                targetSystem = 0u,"},{"type":"DELETE","lineNumber":311,"oldContent":"                                targetComponent = 0u,"},{"type":"DELETE","lineNumber":312,"oldContent":"                                seq = 1u,"},{"type":"DELETE","lineNumber":313,"oldContent":"                                frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":314,"oldContent":"                                command = MavEnumValue.of(MavCmd.NAV_TAKEOFF),"},{"type":"DELETE","lineNumber":315,"oldContent":"                                current = 0u,"},{"type":"DELETE","lineNumber":316,"oldContent":"                        )"},{"type":"DELETE","lineNumber":317,"oldContent":"                                autocontinue = 1u,"},{"type":"INSERT","lineNumber":346,"content":"                        }"},{"type":"DELETE","lineNumber":319,"oldContent":"                                param1 = 0f,"},{"type":"DELETE","lineNumber":320,"oldContent":"                                param2 = 0f,"},{"type":"DELETE","lineNumber":321,"oldContent":"                                param3 = 0f,"},{"type":"DELETE","lineNumber":322,"oldContent":"                                param4 = 0f,"},{"type":"DELETE","lineNumber":323,"oldContent":"                                x = (homeLat * 1E7).toInt(),"},{"type":"DELETE","lineNumber":324,"oldContent":"                                y = (homeLon * 1E7).toInt(),"},{"type":"DELETE","lineNumber":325,"oldContent":"                                z = 10f // Takeoff altitude"},{"type":"DELETE","lineNumber":326,"oldContent":"                        )"},{"type":"INSERT","lineNumber":348,"content":"                        Column {"},{"type":"INSERT","lineNumber":349,"content":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"INSERT","lineNumber":350,"content":"                            Slider("},{"type":"INSERT","lineNumber":351,"content":"                                value = gridAngle,"},{"type":"INSERT","lineNumber":352,"content":"                                onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":353,"content":"                                valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":354,"content":"                                steps = 35"},{"type":"INSERT","lineNumber":355,"content":"                            )"},{"type":"INSERT","lineNumber":356,"content":"                        }"},{"type":"DELETE","lineNumber":328,"oldContent":"                            val seq = idx + 2"},{"type":"DELETE","lineNumber":329,"oldContent":"                            val isLast = idx == points.lastIndex"},{"type":"INSERT","lineNumber":358,"content":"                        Column {"},{"type":"INSERT","lineNumber":359,"content":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"INSERT","lineNumber":360,"content":"                            Slider("},{"type":"INSERT","lineNumber":361,"content":"                                value = surveySpeed,"},{"type":"INSERT","lineNumber":362,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":363,"content":"                                valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":364,"content":"                                steps = 18"},{"type":"DELETE","lineNumber":331,"oldContent":"                            val altitude = 10f // You may want to allow user to set this per waypoint"},{"type":"DELETE","lineNumber":332,"oldContent":"                            builtMission.add("},{"type":"INSERT","lineNumber":366,"content":"                        }"},{"type":"DELETE","lineNumber":334,"oldContent":"                        points.forEachIndexed { idx, latLng ->"},{"type":"DELETE","lineNumber":335,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":336,"oldContent":"                                    targetSystem = 0u,"},{"type":"DELETE","lineNumber":337,"oldContent":"                                    targetComponent = 0u,"},{"type":"DELETE","lineNumber":338,"oldContent":"                                    seq = seq.toUShort(),"},{"type":"DELETE","lineNumber":339,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":340,"oldContent":"                                    command = if (isLast) MavEnumValue.of(MavCmd.NAV_LAND) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":341,"oldContent":"                                    current = 0u,"},{"type":"DELETE","lineNumber":342,"oldContent":"                                    autocontinue = 1u,"},{"type":"DELETE","lineNumber":343,"oldContent":"                                    param1 = 0f,"},{"type":"DELETE","lineNumber":344,"oldContent":"                                    param2 = 0f,"},{"type":"DELETE","lineNumber":345,"oldContent":"                                    param3 = 0f,"},{"type":"DELETE","lineNumber":346,"oldContent":"                                    param4 = 0f,"},{"type":"DELETE","lineNumber":347,"oldContent":"                                    x = (latLng.latitude * 1E7).toInt(),"},{"type":"DELETE","lineNumber":348,"oldContent":"                                    y = (latLng.longitude * 1E7).toInt(),"},{"type":"DELETE","lineNumber":349,"oldContent":"                                    z = altitude"},{"type":"INSERT","lineNumber":368,"content":"                        Column {"},{"type":"INSERT","lineNumber":369,"content":"                            Text(\"Altitude: ${surveyAltitude.toInt()}m\", color = Color.White)"},{"type":"INSERT","lineNumber":370,"content":"                            Slider("},{"type":"INSERT","lineNumber":371,"content":"                                value = surveyAltitude,"},{"type":"INSERT","lineNumber":372,"content":"                                onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":373,"content":"                                valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":374,"content":"                                steps = 21"},{"type":"DELETE","lineNumber":351,"oldContent":"                        telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"DELETE","lineNumber":352,"oldContent":"                            if (success) {"},{"type":"DELETE","lineNumber":353,"oldContent":"                                )"},{"type":"DELETE","lineNumber":354,"oldContent":"                                Toast.makeText(context, \"Mission uploaded\", Toast.LENGTH_SHORT)"},{"type":"DELETE","lineNumber":355,"oldContent":"                                    .show()"},{"type":"DELETE","lineNumber":357,"oldContent":"                                coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"DELETE","lineNumber":359,"oldContent":"                                navController.navigate(Screen.Main.route) {"},{"type":"DELETE","lineNumber":360,"oldContent":"                                    popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"DELETE","lineNumber":361,"oldContent":"                                }"},{"type":"DELETE","lineNumber":362,"oldContent":"                            } else {"},{"type":"DELETE","lineNumber":363,"oldContent":"                                Toast.makeText("},{"type":"DELETE","lineNumber":364,"oldContent":"                                    context,"},{"type":"DELETE","lineNumber":365,"oldContent":"                                    error ?: \"Mission upload failed\","},{"type":"DELETE","lineNumber":366,"oldContent":"                                    Toast.LENGTH_SHORT"},{"type":"DELETE","lineNumber":367,"oldContent":"                                ).show()"},{"type":"INSERT","lineNumber":378,"content":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":379,"content":"                            Divider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":380,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"INSERT","lineNumber":381,"content":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":382,"content":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":383,"content":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":384,"content":"                                Text(\"Distance: ${String.format(\"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":385,"content":"                                Text(\"Time: ${String.format(\"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":369,"oldContent":"                    },"},{"type":"DELETE","lineNumber":370,"oldContent":"                    enabled = points.isNotEmpty(),"},{"type":"DELETE","lineNumber":372,"oldContent":"                    modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":373,"oldContent":"                    Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":374,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":375,"oldContent":"                Spacer(modifier = Modifier.height(8.dp))"},{"type":"DELETE","lineNumber":376,"oldContent":"                Spacer(modifier = Modifier.height(8.dp))"},{"type":"INSERT","lineNumber":388,"content":""},{"type":"INSERT","lineNumber":389,"content":"                        if (surveyPolygon.size < 3) {"},{"type":"INSERT","lineNumber":390,"content":"                            Text("},{"type":"INSERT","lineNumber":391,"content":"                                \"Tap map to add polygon vertices (need ${3 - surveyPolygon.size} more)\","},{"type":"INSERT","lineNumber":392,"content":"                                color = Color.Yellow,"},{"type":"INSERT","lineNumber":393,"content":"                                style = MaterialTheme.typography.bodySmall"},{"type":"INSERT","lineNumber":394,"content":"                            )"},{"type":"INSERT","lineNumber":395,"content":"                        }"},{"type":"INSERT","lineNumber":396,"content":""},{"type":"INSERT","lineNumber":397,"content":"                        Row("},{"type":"INSERT","lineNumber":398,"content":"                            modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":399,"content":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"INSERT","lineNumber":400,"content":"                        ) {"},{"type":"INSERT","lineNumber":401,"content":"                            Button("},{"type":"INSERT","lineNumber":402,"content":"                                onClick = { surveyPolygon = emptyList(); gridResult = null },"},{"type":"INSERT","lineNumber":403,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":404,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":405,"content":"                            ) {"},{"type":"INSERT","lineNumber":406,"content":"                                Text(\"Clear\")"},{"type":"INSERT","lineNumber":407,"content":"                            }"},{"type":"INSERT","lineNumber":408,"content":"                            "},{"type":"INSERT","lineNumber":409,"content":"                            Button("},{"type":"INSERT","lineNumber":410,"content":"                                onClick = {"},{"type":"INSERT","lineNumber":411,"content":"                                    if (surveyPolygon.size >= 3) {"},{"type":"INSERT","lineNumber":412,"content":"                                        gridAngle = gridGenerator.calculateOptimalGridAngle(surveyPolygon)"},{"type":"INSERT","lineNumber":413,"content":"                                    }"},{"type":"INSERT","lineNumber":414,"content":"                                },"},{"type":"INSERT","lineNumber":415,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":416,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":417,"content":"                            ) {"},{"type":"INSERT","lineNumber":418,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":419,"content":"                            }"},{"type":"INSERT","lineNumber":420,"content":"                        }"},{"type":"INSERT","lineNumber":421,"content":"                    }"},{"type":"INSERT","lineNumber":423,"content":"            }"},{"type":"INSERT","lineNumber":425,"content":"            // Upload button"},{"type":"INSERT","lineNumber":426,"content":"            Column("},{"type":"INSERT","lineNumber":427,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":428,"content":"                    .align(Alignment.BottomCenter)"},{"type":"INSERT","lineNumber":429,"content":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":430,"content":"            ) {"},{"type":"INSERT","lineNumber":431,"content":"                if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":432,"content":"                    Button("},{"type":"INSERT","lineNumber":433,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":434,"content":"                            gridResult?.let { result ->"},{"type":"INSERT","lineNumber":435,"content":"                                val homeLat = telemetryState.latitude ?: 0.0"},{"type":"INSERT","lineNumber":436,"content":"                                val homeLon = telemetryState.longitude ?: 0.0"},{"type":"INSERT","lineNumber":437,"content":"                                val homePosition = LatLng(homeLat, homeLon)"},{"type":"INSERT","lineNumber":438,"content":"                                val builtMission = GridMissionConverter.convertToMissionItems(result, homePosition)"},{"type":"INSERT","lineNumber":439,"content":"                                "},{"type":"INSERT","lineNumber":440,"content":"                                telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"INSERT","lineNumber":441,"content":"                                    if (success) {"},{"type":"INSERT","lineNumber":442,"content":"                                        Toast.makeText(context, \"Grid survey uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":443,"content":"                                        coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"INSERT","lineNumber":444,"content":"                                        navController.navigate(Screen.Main.route) {"},{"type":"INSERT","lineNumber":445,"content":"                                            popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"INSERT","lineNumber":446,"content":"                                        }"},{"type":"INSERT","lineNumber":447,"content":"                                    } else {"},{"type":"INSERT","lineNumber":448,"content":"                                        Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":449,"content":"                                    }"},{"type":"INSERT","lineNumber":450,"content":"                                }"},{"type":"INSERT","lineNumber":451,"content":"                            }"},{"type":"INSERT","lineNumber":452,"content":"                        },"},{"type":"INSERT","lineNumber":453,"content":"                        enabled = gridResult?.waypoints?.isNotEmpty() == true,"},{"type":"INSERT","lineNumber":454,"content":"                        modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":455,"content":"                    ) {"},{"type":"INSERT","lineNumber":456,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":457,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":458,"content":"                    }"},{"type":"INSERT","lineNumber":459,"content":"                } else {"},{"type":"INSERT","lineNumber":460,"content":"                    Button("},{"type":"INSERT","lineNumber":461,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":462,"content":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"INSERT","lineNumber":463,"content":"                            val homeLat = telemetryState.latitude ?: 0.0"},{"type":"INSERT","lineNumber":464,"content":"                            val homeLon = telemetryState.longitude ?: 0.0"},{"type":"INSERT","lineNumber":465,"content":"                            val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"DELETE","lineNumber":380,"oldContent":"                // Waypoint list"},{"type":"INSERT","lineNumber":467,"content":"                            builtMission.add("},{"type":"INSERT","lineNumber":468,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":469,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 0u,"},{"type":"INSERT","lineNumber":470,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":471,"content":"                                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":472,"content":"                                    current = 1u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":473,"content":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":474,"content":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = homeAlt"},{"type":"INSERT","lineNumber":475,"content":"                                )"},{"type":"INSERT","lineNumber":476,"content":"                            )"},{"type":"DELETE","lineNumber":382,"oldContent":"        }"},{"type":"INSERT","lineNumber":478,"content":"                            builtMission.add("},{"type":"INSERT","lineNumber":479,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":480,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 1u,"},{"type":"INSERT","lineNumber":481,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":482,"content":"                                    command = MavEnumValue.of(MavCmd.NAV_TAKEOFF),"},{"type":"INSERT","lineNumber":483,"content":"                                    current = 0u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":484,"content":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":485,"content":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = 10f"},{"type":"INSERT","lineNumber":486,"content":"                                )"},{"type":"INSERT","lineNumber":487,"content":"                            )"},{"type":"INSERT","lineNumber":489,"content":"                            points.forEachIndexed { idx, latLng ->"},{"type":"INSERT","lineNumber":490,"content":"                                val seq = idx + 2"},{"type":"INSERT","lineNumber":491,"content":"                                val isLast = idx == points.lastIndex"},{"type":"INSERT","lineNumber":492,"content":"                                builtMission.add("},{"type":"INSERT","lineNumber":493,"content":"                                    MissionItemInt("},{"type":"INSERT","lineNumber":494,"content":"                                        targetSystem = 0u, targetComponent = 0u, seq = seq.toUShort(),"},{"type":"INSERT","lineNumber":495,"content":"                                        frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":496,"content":"                                        command = if (isLast) MavEnumValue.of(MavCmd.NAV_LAND) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":497,"content":"                                        current = 0u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":498,"content":"                                        param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":499,"content":"                                        x = (latLng.latitude * 1E7).toInt(),"},{"type":"INSERT","lineNumber":500,"content":"                                        y = (latLng.longitude * 1E7).toInt(), z = 10f"},{"type":"INSERT","lineNumber":501,"content":"                                    )"},{"type":"INSERT","lineNumber":502,"content":"                                )"},{"type":"INSERT","lineNumber":503,"content":"                            }"},{"type":"INSERT","lineNumber":504,"content":""},{"type":"INSERT","lineNumber":505,"content":"                            telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"INSERT","lineNumber":506,"content":"                                if (success) {"},{"type":"INSERT","lineNumber":507,"content":"                                    Toast.makeText(context, \"Mission uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":508,"content":"                                    coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"INSERT","lineNumber":509,"content":"                                    navController.navigate(Screen.Main.route) {"},{"type":"INSERT","lineNumber":510,"content":"                                        popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"INSERT","lineNumber":511,"content":"                                    }"},{"type":"INSERT","lineNumber":512,"content":"                                } else {"},{"type":"INSERT","lineNumber":513,"content":"                                    Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":514,"content":"                                }"},{"type":"INSERT","lineNumber":515,"content":"                            }"},{"type":"INSERT","lineNumber":516,"content":"                        },"},{"type":"INSERT","lineNumber":517,"content":"                        enabled = points.isNotEmpty(),"},{"type":"INSERT","lineNumber":518,"content":"                        modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":519,"content":"                    ) {"},{"type":"INSERT","lineNumber":520,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":521,"content":"                    }"},{"type":"INSERT","lineNumber":522,"content":"                }"},{"type":"INSERT","lineNumber":523,"content":"            }"},{"type":"INSERT","lineNumber":524,"content":"        }"},{"type":"DELETE","lineNumber":386,"oldContent":"            }"}]},{"timestamp":1758608126448,"changes":[{"type":"INSERT","lineNumber":10,"content":"import androidx.compose.ui.Alignment"},{"type":"DELETE","lineNumber":11,"oldContent":"import androidx.compose.runtime.getValue"},{"type":"INSERT","lineNumber":25,"content":"import com.google.maps.android.compose.MapType"},{"type":"DELETE","lineNumber":26,"oldContent":"    Scaffold("},{"type":"DELETE","lineNumber":33,"oldContent":"        Column("},{"type":"DELETE","lineNumber":34,"oldContent":"            modifier = Modifier"},{"type":"INSERT","lineNumber":33,"content":"    telemetryViewModel: SharedViewModel,"},{"type":"INSERT","lineNumber":34,"content":"    authViewModel: AuthViewModel,"},{"type":"DELETE","lineNumber":42,"oldContent":"            )"},{"type":"DELETE","lineNumber":43,"oldContent":"            GcsMap(telemetryState = telemetryState)"},{"type":"DELETE","lineNumber":44,"oldContent":"        }"},{"type":"INSERT","lineNumber":42,"content":"        telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":43,"content":"        authViewModel = authViewModel,"},{"type":"INSERT","lineNumber":44,"content":"        navController = navController"},{"type":"INSERT","lineNumber":46,"content":""},{"type":"DELETE","lineNumber":47,"oldContent":"    // State to toggle plan action buttons"},{"type":"INSERT","lineNumber":50,"content":"    var showGridControls by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":51,"content":"    var mapType by remember { mutableStateOf(MapType.SATELLITE) }"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"DELETE","lineNumber":52,"oldContent":"    var showGridControls by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":55,"oldContent":"    var mapType by remember { mutableStateOf(MapType.SATELLITE) }"},{"type":"DELETE","lineNumber":58,"oldContent":"    "},{"type":"DELETE","lineNumber":60,"oldContent":""},{"type":"INSERT","lineNumber":63,"content":""},{"type":"INSERT","lineNumber":64,"content":"    // Camera and waypoint state"},{"type":"INSERT","lineNumber":65,"content":"    val cameraPositionState = rememberCameraPositionState()"},{"type":"INSERT","lineNumber":66,"content":"    val points = remember { mutableStateListOf<LatLng>() }"},{"type":"INSERT","lineNumber":67,"content":"    val waypoints = remember { mutableStateListOf<MissionItemInt>() }"},{"type":"INSERT","lineNumber":68,"content":"    val coroutineScope = rememberCoroutineScope()"},{"type":"INSERT","lineNumber":69,"content":""},{"type":"INSERT","lineNumber":70,"content":"    // Center map once when screen opens"},{"type":"DELETE","lineNumber":66,"oldContent":"    // Camera and waypoint state"},{"type":"DELETE","lineNumber":68,"oldContent":"    val cameraPositionState = rememberCameraPositionState()"},{"type":"DELETE","lineNumber":70,"oldContent":"    val points = remember { mutableStateListOf<LatLng>() }"},{"type":"DELETE","lineNumber":72,"oldContent":"    val waypoints = remember { mutableStateListOf<MissionItemInt>() }"},{"type":"DELETE","lineNumber":74,"oldContent":"    val coroutineScope = rememberCoroutineScope()"},{"type":"DELETE","lineNumber":76,"oldContent":""},{"type":"DELETE","lineNumber":78,"oldContent":"    // Center map once when screen opens"},{"type":"INSERT","lineNumber":81,"content":"    // Helper functions"},{"type":"DELETE","lineNumber":85,"oldContent":"    // Helper functions"},{"type":"DELETE","lineNumber":99,"oldContent":"    fun regenerateGrid() {"},{"type":"INSERT","lineNumber":100,"content":"        )"},{"type":"INSERT","lineNumber":101,"content":"    }"},{"type":"INSERT","lineNumber":102,"content":""},{"type":"INSERT","lineNumber":103,"content":"    fun regenerateGrid() {"},{"type":"DELETE","lineNumber":104,"oldContent":"        )"},{"type":"DELETE","lineNumber":109,"oldContent":"    }"},{"type":"DELETE","lineNumber":111,"oldContent":""},{"type":"DELETE","lineNumber":114,"oldContent":""},{"type":"DELETE","lineNumber":116,"oldContent":"    Scaffold("},{"type":"DELETE","lineNumber":117,"oldContent":"        floatingActionButton = {"},{"type":"INSERT","lineNumber":115,"content":""},{"type":"DELETE","lineNumber":123,"oldContent":"                if (showPlanActions) {"},{"type":"DELETE","lineNumber":128,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":131,"oldContent":"                        onClick = {"},{"type":"DELETE","lineNumber":136,"oldContent":"                            val center = cameraPositionState.position.target"},{"type":"DELETE","lineNumber":138,"oldContent":"                        },"},{"type":"DELETE","lineNumber":145,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":147,"oldContent":"                    }"},{"type":"INSERT","lineNumber":139,"content":"    Scaffold("},{"type":"INSERT","lineNumber":140,"content":"        floatingActionButton = {"},{"type":"DELETE","lineNumber":149,"oldContent":""},{"type":"INSERT","lineNumber":142,"content":"                if (showPlanActions) {"},{"type":"DELETE","lineNumber":152,"oldContent":"                            }"},{"type":"DELETE","lineNumber":153,"oldContent":"                        },"},{"type":"INSERT","lineNumber":145,"content":"                            val center = cameraPositionState.position.target"},{"type":"DELETE","lineNumber":162,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":164,"oldContent":"                    }"},{"type":"DELETE","lineNumber":165,"oldContent":""},{"type":"INSERT","lineNumber":155,"content":"                        },"},{"type":"DELETE","lineNumber":167,"oldContent":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"INSERT","lineNumber":158,"content":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"DELETE","lineNumber":170,"oldContent":"                }"},{"type":"DELETE","lineNumber":171,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":161,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":162,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":163,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":175,"oldContent":"        }"},{"type":"DELETE","lineNumber":178,"oldContent":"            GcsMap("},{"type":"DELETE","lineNumber":181,"oldContent":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":185,"oldContent":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":186,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":173,"content":"                            }"},{"type":"INSERT","lineNumber":174,"content":"                        },"},{"type":"DELETE","lineNumber":188,"oldContent":"                mapType = mapType,"},{"type":"INSERT","lineNumber":176,"content":"                    ) {"},{"type":"INSERT","lineNumber":178,"content":"                    }"},{"type":"INSERT","lineNumber":179,"content":""},{"type":"DELETE","lineNumber":191,"oldContent":"            )"},{"type":"DELETE","lineNumber":194,"oldContent":""},{"type":"DELETE","lineNumber":199,"oldContent":"            Column("},{"type":"DELETE","lineNumber":201,"oldContent":"                    .align(Alignment.TopEnd)"},{"type":"DELETE","lineNumber":203,"oldContent":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":205,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":207,"oldContent":"                Text("},{"type":"DELETE","lineNumber":208,"oldContent":"                    \"Connected: ${telemetryState.connected}\","},{"type":"INSERT","lineNumber":191,"content":"                    ) {"},{"type":"DELETE","lineNumber":210,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":211,"oldContent":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":212,"oldContent":"                )"},{"type":"DELETE","lineNumber":213,"oldContent":"                Text("},{"type":"INSERT","lineNumber":193,"content":"                    }"},{"type":"INSERT","lineNumber":194,"content":"                }"},{"type":"INSERT","lineNumber":195,"content":""},{"type":"INSERT","lineNumber":196,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":215,"oldContent":"                    \"FCU detected: ${telemetryState.fcuDetected}\","},{"type":"DELETE","lineNumber":219,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":221,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":223,"oldContent":"                Icon("},{"type":"DELETE","lineNumber":226,"oldContent":"                    Icons.Default.Add,"},{"type":"DELETE","lineNumber":228,"oldContent":"                    contentDescription = \"Crosshair\","},{"type":"DELETE","lineNumber":230,"oldContent":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":231,"oldContent":"                    modifier = Modifier.size(28.dp)"},{"type":"INSERT","lineNumber":207,"content":"            GcsMap("},{"type":"INSERT","lineNumber":208,"content":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":233,"oldContent":"                )"},{"type":"DELETE","lineNumber":234,"oldContent":"            }"},{"type":"INSERT","lineNumber":210,"content":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":211,"content":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":212,"content":"                mapType = mapType,"},{"type":"DELETE","lineNumber":236,"oldContent":""},{"type":"INSERT","lineNumber":217,"content":"            )"},{"type":"INSERT","lineNumber":218,"content":""},{"type":"INSERT","lineNumber":219,"content":"            // Status indicator"},{"type":"DELETE","lineNumber":242,"oldContent":"            // Status indicator"},{"type":"DELETE","lineNumber":243,"oldContent":"                    .align(Alignment.TopStart)"},{"type":"DELETE","lineNumber":244,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":245,"oldContent":"                    .padding(start = 16.dp, top = 72.dp),"},{"type":"DELETE","lineNumber":246,"oldContent":"                verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"INSERT","lineNumber":222,"content":"                    .align(Alignment.TopEnd)"},{"type":"INSERT","lineNumber":223,"content":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":248,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":249,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":250,"oldContent":"                    onClick = {"},{"type":"DELETE","lineNumber":251,"oldContent":"                        val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":225,"content":"                Text("},{"type":"INSERT","lineNumber":226,"content":"                    \"Connected: ${telemetryState.connected}\","},{"type":"INSERT","lineNumber":227,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":253,"oldContent":"                        val lon = telemetryState.longitude"},{"type":"DELETE","lineNumber":256,"oldContent":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":231,"content":"                    \"FCU detected: ${telemetryState.fcuDetected}\","},{"type":"INSERT","lineNumber":232,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":233,"content":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":234,"content":"                )"},{"type":"INSERT","lineNumber":235,"content":"                Text("},{"type":"DELETE","lineNumber":258,"oldContent":"                            cameraPositionState.move("},{"type":"DELETE","lineNumber":267,"oldContent":"                            )"},{"type":"DELETE","lineNumber":270,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":271,"oldContent":"                        }"},{"type":"DELETE","lineNumber":272,"oldContent":"                    },"},{"type":"DELETE","lineNumber":273,"oldContent":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":274,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":275,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":276,"oldContent":"                }"},{"type":"INSERT","lineNumber":247,"content":"            ) {"},{"type":"INSERT","lineNumber":248,"content":"                Icon("},{"type":"INSERT","lineNumber":249,"content":"                    Icons.Default.Add,"},{"type":"INSERT","lineNumber":250,"content":"                    contentDescription = \"Crosshair\","},{"type":"INSERT","lineNumber":251,"content":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":252,"content":"                    modifier = Modifier.size(28.dp)"},{"type":"INSERT","lineNumber":253,"content":"                )"},{"type":"INSERT","lineNumber":254,"content":"            }"},{"type":"DELETE","lineNumber":278,"oldContent":"                    onClick = { "},{"type":"DELETE","lineNumber":279,"oldContent":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"INSERT","lineNumber":256,"content":"            // Left sidebar buttons"},{"type":"INSERT","lineNumber":257,"content":"            Column("},{"type":"INSERT","lineNumber":258,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":259,"content":"                    .align(Alignment.TopStart)"},{"type":"INSERT","lineNumber":260,"content":"                    .padding(start = 16.dp, top = 72.dp),"},{"type":"INSERT","lineNumber":261,"content":"                verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"INSERT","lineNumber":262,"content":"            ) {"},{"type":"INSERT","lineNumber":264,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":265,"content":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"DELETE","lineNumber":283,"oldContent":"                    onClick = { telemetryViewModel.arm() },"},{"type":"DELETE","lineNumber":286,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":288,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":291,"oldContent":"                    Icon(Icons.Default.FlightTakeoff, contentDescription = \"Arm\")"},{"type":"DELETE","lineNumber":294,"oldContent":"                }"},{"type":"DELETE","lineNumber":297,"oldContent":""},{"type":"DELETE","lineNumber":298,"oldContent":"                FloatingActionButton("},{"type":"INSERT","lineNumber":277,"content":"                ) {"},{"type":"DELETE","lineNumber":300,"oldContent":"                        Icons.Default.GridOn, "},{"type":"INSERT","lineNumber":279,"content":"                        Icons.Default.GridOn,"},{"type":"DELETE","lineNumber":306,"oldContent":""},{"type":"DELETE","lineNumber":308,"oldContent":""},{"type":"INSERT","lineNumber":286,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":287,"content":"                        val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":288,"content":"                        val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":289,"content":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":290,"content":"                            cameraPositionState.move("},{"type":"INSERT","lineNumber":292,"content":"                            )"},{"type":"INSERT","lineNumber":293,"content":"                        } else {"},{"type":"INSERT","lineNumber":295,"content":"                        }"},{"type":"INSERT","lineNumber":296,"content":"                    },"},{"type":"INSERT","lineNumber":297,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":298,"content":"                ) {"},{"type":"DELETE","lineNumber":312,"oldContent":"                            )"},{"type":"INSERT","lineNumber":300,"content":"                }"},{"type":"INSERT","lineNumber":301,"content":""},{"type":"INSERT","lineNumber":302,"content":"                FloatingActionButton("},{"type":"INSERT","lineNumber":303,"content":"                    onClick = { telemetryViewModel.arm() },"},{"type":"INSERT","lineNumber":304,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":305,"content":"                ) {"},{"type":"INSERT","lineNumber":306,"content":"                    Icon(Icons.Default.FlightTakeoff, contentDescription = \"Arm\")"},{"type":"INSERT","lineNumber":307,"content":"                }"},{"type":"INSERT","lineNumber":308,"content":""},{"type":"INSERT","lineNumber":309,"content":"                FloatingActionButton("},{"type":"INSERT","lineNumber":316,"content":""},{"type":"DELETE","lineNumber":321,"oldContent":""},{"type":"DELETE","lineNumber":331,"oldContent":""},{"type":"DELETE","lineNumber":335,"oldContent":"                            )"},{"type":"DELETE","lineNumber":339,"oldContent":""},{"type":"INSERT","lineNumber":337,"content":""},{"type":"INSERT","lineNumber":345,"content":"                            )"},{"type":"INSERT","lineNumber":347,"content":""},{"type":"DELETE","lineNumber":354,"oldContent":"                            )"},{"type":"DELETE","lineNumber":361,"oldContent":"                        }"},{"type":"DELETE","lineNumber":362,"oldContent":"                        Column {"},{"type":"INSERT","lineNumber":358,"content":"                        Column {"},{"type":"INSERT","lineNumber":365,"content":"                            )"},{"type":"INSERT","lineNumber":367,"content":""},{"type":"DELETE","lineNumber":372,"oldContent":"                            }"},{"type":"DELETE","lineNumber":376,"oldContent":"                        }"},{"type":"DELETE","lineNumber":380,"oldContent":"                }"},{"type":"DELETE","lineNumber":381,"oldContent":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":375,"content":"                            )"},{"type":"INSERT","lineNumber":376,"content":"                        }"},{"type":"INSERT","lineNumber":378,"content":"                        gridResult?.let { result ->"},{"type":"DELETE","lineNumber":384,"oldContent":""},{"type":"DELETE","lineNumber":387,"oldContent":""},{"type":"DELETE","lineNumber":390,"oldContent":""},{"type":"DELETE","lineNumber":392,"oldContent":"    }"},{"type":"DELETE","lineNumber":394,"oldContent":"}"},{"type":"INSERT","lineNumber":386,"content":"                            }"},{"type":"INSERT","lineNumber":387,"content":"                        }"},{"type":"DELETE","lineNumber":396,"oldContent":""},{"type":"DELETE","lineNumber":397,"oldContent":"        }"},{"type":"DELETE","lineNumber":399,"oldContent":"            }"},{"type":"DELETE","lineNumber":401,"oldContent":"                }"},{"type":"DELETE","lineNumber":403,"oldContent":"                    }"},{"type":"DELETE","lineNumber":405,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":407,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":409,"oldContent":"                        modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":411,"oldContent":"                        enabled = points.isNotEmpty(),"},{"type":"DELETE","lineNumber":413,"oldContent":"                        },"},{"type":"DELETE","lineNumber":415,"oldContent":"                            }"},{"type":"DELETE","lineNumber":417,"oldContent":"                                }"},{"type":"DELETE","lineNumber":419,"oldContent":"                                    Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":421,"oldContent":"                                } else {"},{"type":"DELETE","lineNumber":423,"oldContent":"                                    }"},{"type":"DELETE","lineNumber":425,"oldContent":"                                        popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"DELETE","lineNumber":427,"oldContent":"                                    navController.navigate(Screen.Main.route) {"},{"type":"DELETE","lineNumber":429,"oldContent":"                                    coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"DELETE","lineNumber":431,"oldContent":"                                    Toast.makeText(context, \"Mission uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":433,"oldContent":"                                if (success) {"},{"type":"DELETE","lineNumber":435,"oldContent":"                            telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"DELETE","lineNumber":436,"oldContent":"                            "},{"type":"DELETE","lineNumber":439,"oldContent":"                            }"},{"type":"DELETE","lineNumber":441,"oldContent":"                                )"},{"type":"DELETE","lineNumber":443,"oldContent":"                                    )"},{"type":"DELETE","lineNumber":445,"oldContent":"                                        y = (latLng.longitude * 1E7).toInt(), z = 10f"},{"type":"DELETE","lineNumber":447,"oldContent":"                                        x = (latLng.latitude * 1E7).toInt(),"},{"type":"DELETE","lineNumber":449,"oldContent":"                                        param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"DELETE","lineNumber":451,"oldContent":"                                        current = 0u, autocontinue = 1u,"},{"type":"DELETE","lineNumber":453,"oldContent":"                                        command = if (isLast) MavEnumValue.of(MavCmd.NAV_LAND) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":455,"oldContent":"                                        frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":457,"oldContent":"                                        targetSystem = 0u, targetComponent = 0u, seq = seq.toUShort(),"},{"type":"DELETE","lineNumber":459,"oldContent":"                                    MissionItemInt("},{"type":"DELETE","lineNumber":461,"oldContent":"                                builtMission.add("},{"type":"DELETE","lineNumber":463,"oldContent":"                                val isLast = idx == points.lastIndex"},{"type":"DELETE","lineNumber":464,"oldContent":"                                val seq = idx + 2"},{"type":"INSERT","lineNumber":422,"content":"                }"},{"type":"DELETE","lineNumber":466,"oldContent":"                            points.forEachIndexed { idx, latLng ->"},{"type":"DELETE","lineNumber":467,"oldContent":"                            )"},{"type":"INSERT","lineNumber":424,"content":""},{"type":"DELETE","lineNumber":469,"oldContent":"                                )"},{"type":"DELETE","lineNumber":471,"oldContent":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = 10f"},{"type":"DELETE","lineNumber":473,"oldContent":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"DELETE","lineNumber":475,"oldContent":"                                    current = 0u, autocontinue = 1u,"},{"type":"DELETE","lineNumber":477,"oldContent":"                                    command = MavEnumValue.of(MavCmd.NAV_TAKEOFF),"},{"type":"DELETE","lineNumber":479,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":481,"oldContent":"                                    targetSystem = 0u, targetComponent = 0u, seq = 1u,"},{"type":"DELETE","lineNumber":483,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":485,"oldContent":"                            builtMission.add("},{"type":"DELETE","lineNumber":487,"oldContent":"                            )"},{"type":"DELETE","lineNumber":489,"oldContent":"                                )"},{"type":"DELETE","lineNumber":491,"oldContent":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = homeAlt"},{"type":"DELETE","lineNumber":493,"oldContent":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"DELETE","lineNumber":495,"oldContent":"                                    current = 1u, autocontinue = 1u,"},{"type":"DELETE","lineNumber":496,"oldContent":"                                "},{"type":"DELETE","lineNumber":497,"oldContent":"                                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":439,"content":""},{"type":"DELETE","lineNumber":499,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":501,"oldContent":"                                    targetSystem = 0u, targetComponent = 0u, seq = 0u,"},{"type":"DELETE","lineNumber":503,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":505,"oldContent":"                            builtMission.add("},{"type":"DELETE","lineNumber":507,"oldContent":"                            val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"DELETE","lineNumber":509,"oldContent":"                            val homeLon = telemetryState.longitude ?: 0.0"},{"type":"DELETE","lineNumber":511,"oldContent":"                            val homeLat = telemetryState.latitude ?: 0.0"},{"type":"DELETE","lineNumber":513,"oldContent":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"DELETE","lineNumber":515,"oldContent":"                        onClick = {"},{"type":"DELETE","lineNumber":517,"oldContent":"                    Button("},{"type":"DELETE","lineNumber":519,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":521,"oldContent":"                    }"},{"type":"DELETE","lineNumber":523,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":454,"content":"                        modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":455,"content":"                    ) {"},{"type":"INSERT","lineNumber":457,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":458,"content":"                    }"},{"type":"INSERT","lineNumber":459,"content":"                } else {"},{"type":"INSERT","lineNumber":460,"content":"                    Button("},{"type":"INSERT","lineNumber":461,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":462,"content":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"INSERT","lineNumber":463,"content":"                            val homeLat = telemetryState.latitude ?: 0.0"},{"type":"INSERT","lineNumber":464,"content":"                            val homeLon = telemetryState.longitude ?: 0.0"},{"type":"INSERT","lineNumber":465,"content":"                            val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"INSERT","lineNumber":466,"content":""},{"type":"INSERT","lineNumber":467,"content":"                            builtMission.add("},{"type":"INSERT","lineNumber":468,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":469,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 0u,"},{"type":"INSERT","lineNumber":470,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":471,"content":"                                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":472,"content":"                                    current = 1u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":473,"content":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":474,"content":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = homeAlt"},{"type":"INSERT","lineNumber":475,"content":"                                )"},{"type":"INSERT","lineNumber":476,"content":"                            )"},{"type":"INSERT","lineNumber":477,"content":""},{"type":"INSERT","lineNumber":478,"content":"                            builtMission.add("},{"type":"INSERT","lineNumber":479,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":480,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 1u,"},{"type":"INSERT","lineNumber":481,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":482,"content":"                                    command = MavEnumValue.of(MavCmd.NAV_TAKEOFF),"},{"type":"INSERT","lineNumber":483,"content":"                                    current = 0u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":484,"content":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":485,"content":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = 10f"},{"type":"INSERT","lineNumber":486,"content":"                                )"},{"type":"INSERT","lineNumber":487,"content":"                            )"},{"type":"INSERT","lineNumber":488,"content":""},{"type":"INSERT","lineNumber":489,"content":"                            points.forEachIndexed { idx, latLng ->"},{"type":"INSERT","lineNumber":490,"content":"                                val seq = idx + 2"},{"type":"INSERT","lineNumber":491,"content":"                                val isLast = idx == points.lastIndex"},{"type":"INSERT","lineNumber":492,"content":"                                builtMission.add("},{"type":"INSERT","lineNumber":493,"content":"                                    MissionItemInt("},{"type":"INSERT","lineNumber":494,"content":"                                        targetSystem = 0u, targetComponent = 0u, seq = seq.toUShort(),"},{"type":"INSERT","lineNumber":495,"content":"                                        frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":496,"content":"                                        command = if (isLast) MavEnumValue.of(MavCmd.NAV_LAND) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":497,"content":"                                        current = 0u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":498,"content":"                                        param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":499,"content":"                                        x = (latLng.latitude * 1E7).toInt(),"},{"type":"INSERT","lineNumber":500,"content":"                                        y = (latLng.longitude * 1E7).toInt(), z = 10f"},{"type":"INSERT","lineNumber":501,"content":"                                    )"},{"type":"INSERT","lineNumber":502,"content":"                                )"},{"type":"INSERT","lineNumber":503,"content":"                            }"},{"type":"INSERT","lineNumber":504,"content":""},{"type":"INSERT","lineNumber":505,"content":"                            telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"INSERT","lineNumber":506,"content":"                                if (success) {"},{"type":"INSERT","lineNumber":507,"content":"                                    Toast.makeText(context, \"Mission uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":508,"content":"                                    coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"INSERT","lineNumber":509,"content":"                                    navController.navigate(Screen.Main.route) {"},{"type":"INSERT","lineNumber":510,"content":"                                        popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"INSERT","lineNumber":511,"content":"                                    }"},{"type":"INSERT","lineNumber":512,"content":"                                } else {"},{"type":"INSERT","lineNumber":513,"content":"                                    Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":514,"content":"                                }"},{"type":"INSERT","lineNumber":515,"content":"                            }"},{"type":"INSERT","lineNumber":516,"content":"                        },"},{"type":"INSERT","lineNumber":517,"content":"                        enabled = points.isNotEmpty(),"},{"type":"INSERT","lineNumber":520,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":521,"content":"                    }"},{"type":"INSERT","lineNumber":522,"content":"                }"},{"type":"INSERT","lineNumber":523,"content":"            }"},{"type":"INSERT","lineNumber":524,"content":"        }"},{"type":"INSERT","lineNumber":525,"content":"    }"},{"type":"INSERT","lineNumber":526,"content":"}"},{"type":"INSERT","lineNumber":527,"content":""}]},{"timestamp":1758609916100,"changes":[{"type":"DELETE","lineNumber":51,"oldContent":"    // Grid survey parameters"},{"type":"MODIFY","lineNumber":53,"content":"    // Grid survey parameters","oldContent":"    var lineSpacing by remember { mutableStateOf(30f) }"},{"type":"INSERT","lineNumber":54,"content":"    var lineSpacing by remember { mutableStateOf(30f) }"},{"type":"MODIFY","lineNumber":63,"content":"","oldContent":""},{"type":"DELETE","lineNumber":65,"oldContent":"    var centeredOnce by remember { mutableStateOf(false) }"},{"type":"DELETE","lineNumber":67,"oldContent":"    LaunchedEffect(telemetryState.latitude, telemetryState.longitude) {"},{"type":"DELETE","lineNumber":70,"oldContent":"        val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":73,"oldContent":"        val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":71,"content":"    var centeredOnce by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":72,"content":"    LaunchedEffect(telemetryState.latitude, telemetryState.longitude) {"},{"type":"INSERT","lineNumber":73,"content":"        val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":74,"content":"        val lon = telemetryState.longitude"},{"type":"MODIFY","lineNumber":100,"content":"        )","oldContent":"        )"},{"type":"DELETE","lineNumber":102,"oldContent":"        if (surveyPolygon.size >= 3) {"},{"type":"MODIFY","lineNumber":104,"content":"        if (surveyPolygon.size >= 3) {","oldContent":"            val params = GridSurveyParams("},{"type":"INSERT","lineNumber":105,"content":"            val params = GridSurveyParams("},{"type":"MODIFY","lineNumber":115,"content":"","oldContent":""},{"type":"DELETE","lineNumber":132,"oldContent":"    Scaffold("},{"type":"DELETE","lineNumber":134,"oldContent":"        floatingActionButton = {"},{"type":"DELETE","lineNumber":137,"oldContent":"                if (showPlanActions) {"},{"type":"DELETE","lineNumber":141,"oldContent":"                            val center = cameraPositionState.position.target"},{"type":"INSERT","lineNumber":139,"content":"    Scaffold("},{"type":"INSERT","lineNumber":140,"content":"        floatingActionButton = {"},{"type":"INSERT","lineNumber":142,"content":"                if (showPlanActions) {"},{"type":"INSERT","lineNumber":145,"content":"                            val center = cameraPositionState.position.target"},{"type":"DELETE","lineNumber":147,"oldContent":"                        },"},{"type":"DELETE","lineNumber":151,"oldContent":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"DELETE","lineNumber":155,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":157,"oldContent":"                        onClick = {"},{"type":"DELETE","lineNumber":158,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":155,"content":"                        },"},{"type":"INSERT","lineNumber":158,"content":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"DELETE","lineNumber":163,"oldContent":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter Map\")"},{"type":"DELETE","lineNumber":164,"oldContent":"                            }"},{"type":"INSERT","lineNumber":160,"content":""},{"type":"INSERT","lineNumber":161,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":162,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":163,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":166,"oldContent":"                        },"},{"type":"DELETE","lineNumber":168,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":171,"oldContent":"                    }"},{"type":"DELETE","lineNumber":172,"oldContent":""},{"type":"INSERT","lineNumber":173,"content":"                            }"},{"type":"INSERT","lineNumber":174,"content":"                        },"},{"type":"INSERT","lineNumber":176,"content":"                    ) {"},{"type":"INSERT","lineNumber":178,"content":"                    }"},{"type":"INSERT","lineNumber":179,"content":""},{"type":"DELETE","lineNumber":181,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":183,"oldContent":"                    }"},{"type":"DELETE","lineNumber":185,"oldContent":"                }"},{"type":"DELETE","lineNumber":186,"oldContent":""},{"type":"DELETE","lineNumber":188,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":196,"oldContent":"            GcsMap("},{"type":"DELETE","lineNumber":197,"oldContent":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":191,"content":"                    ) {"},{"type":"DELETE","lineNumber":199,"oldContent":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":200,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":201,"oldContent":"                mapType = mapType,"},{"type":"INSERT","lineNumber":193,"content":"                    }"},{"type":"INSERT","lineNumber":194,"content":"                }"},{"type":"INSERT","lineNumber":195,"content":""},{"type":"INSERT","lineNumber":196,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":204,"oldContent":"            )"},{"type":"DELETE","lineNumber":206,"oldContent":""},{"type":"DELETE","lineNumber":208,"oldContent":"            // Status indicator"},{"type":"DELETE","lineNumber":210,"oldContent":"                    .align(Alignment.TopEnd)"},{"type":"DELETE","lineNumber":212,"oldContent":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":214,"oldContent":"                Text("},{"type":"DELETE","lineNumber":216,"oldContent":"                    \"Connected: ${telemetryState.connected}\","},{"type":"DELETE","lineNumber":217,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":220,"oldContent":"                    \"FCU detected: ${telemetryState.fcuDetected}\","},{"type":"DELETE","lineNumber":221,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":207,"content":"            GcsMap("},{"type":"INSERT","lineNumber":208,"content":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":223,"oldContent":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":224,"oldContent":"                )"},{"type":"DELETE","lineNumber":225,"oldContent":"                Text("},{"type":"INSERT","lineNumber":210,"content":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":211,"content":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":212,"content":"                mapType = mapType,"},{"type":"INSERT","lineNumber":217,"content":"            )"},{"type":"INSERT","lineNumber":218,"content":""},{"type":"INSERT","lineNumber":219,"content":"            // Status indicator"},{"type":"INSERT","lineNumber":222,"content":"                    .align(Alignment.TopEnd)"},{"type":"INSERT","lineNumber":223,"content":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":233,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":234,"oldContent":"                Icon("},{"type":"DELETE","lineNumber":235,"oldContent":"                    Icons.Default.Add,"},{"type":"DELETE","lineNumber":236,"oldContent":"                    contentDescription = \"Crosshair\","},{"type":"DELETE","lineNumber":237,"oldContent":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":238,"oldContent":"                    modifier = Modifier.size(28.dp)"},{"type":"INSERT","lineNumber":225,"content":"                Text("},{"type":"INSERT","lineNumber":226,"content":"                    \"Connected: ${telemetryState.connected}\","},{"type":"INSERT","lineNumber":227,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":241,"oldContent":"            }"},{"type":"INSERT","lineNumber":230,"content":"                Text("},{"type":"INSERT","lineNumber":231,"content":"                    \"FCU detected: ${telemetryState.fcuDetected}\","},{"type":"INSERT","lineNumber":232,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":233,"content":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":244,"oldContent":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":245,"oldContent":"            Column("},{"type":"DELETE","lineNumber":247,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":248,"oldContent":"                    .align(Alignment.TopStart)"},{"type":"DELETE","lineNumber":250,"oldContent":"                    .padding(start = 16.dp, top = 72.dp),"},{"type":"DELETE","lineNumber":252,"oldContent":"                verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":254,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":257,"oldContent":"                    onClick = {"},{"type":"DELETE","lineNumber":259,"oldContent":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"DELETE","lineNumber":264,"oldContent":"                ) {"},{"type":"INSERT","lineNumber":247,"content":"            ) {"},{"type":"INSERT","lineNumber":248,"content":"                Icon("},{"type":"INSERT","lineNumber":249,"content":"                    Icons.Default.Add,"},{"type":"INSERT","lineNumber":250,"content":"                    contentDescription = \"Crosshair\","},{"type":"INSERT","lineNumber":251,"content":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":252,"content":"                    modifier = Modifier.size(28.dp)"},{"type":"INSERT","lineNumber":253,"content":"                )"},{"type":"INSERT","lineNumber":254,"content":"            }"},{"type":"DELETE","lineNumber":266,"oldContent":"                        Icons.Default.GridOn,"},{"type":"INSERT","lineNumber":256,"content":"            // Left sidebar buttons"},{"type":"INSERT","lineNumber":257,"content":"            Column("},{"type":"INSERT","lineNumber":258,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":259,"content":"                    .align(Alignment.TopStart)"},{"type":"INSERT","lineNumber":260,"content":"                    .padding(start = 16.dp, top = 72.dp),"},{"type":"INSERT","lineNumber":261,"content":"                verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"INSERT","lineNumber":262,"content":"            ) {"},{"type":"INSERT","lineNumber":264,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":265,"content":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"INSERT","lineNumber":270,"content":"                        } else {"},{"type":"INSERT","lineNumber":271,"content":"                            surveyPolygon = emptyList()"},{"type":"INSERT","lineNumber":272,"content":"                            gridResult = null"},{"type":"INSERT","lineNumber":273,"content":"                        }"},{"type":"INSERT","lineNumber":274,"content":"                    },"},{"type":"INSERT","lineNumber":275,"content":"                    containerColor = if (isGridSurveyMode) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.surface,"},{"type":"INSERT","lineNumber":276,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":277,"content":"                ) {"},{"type":"INSERT","lineNumber":278,"content":"                    Icon("},{"type":"INSERT","lineNumber":279,"content":"                        Icons.Default.GridOn,"},{"type":"INSERT","lineNumber":280,"content":"                        contentDescription = \"Grid Survey Mode\","},{"type":"INSERT","lineNumber":281,"content":"                        tint = if (isGridSurveyMode) Color.White else MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":282,"content":"                    )"},{"type":"INSERT","lineNumber":283,"content":"                }"},{"type":"INSERT","lineNumber":284,"content":""},{"type":"INSERT","lineNumber":285,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":274,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":277,"oldContent":"                            surveyPolygon = emptyList()"},{"type":"DELETE","lineNumber":279,"oldContent":"                            gridResult = null"},{"type":"INSERT","lineNumber":291,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":281,"oldContent":"                        }"},{"type":"DELETE","lineNumber":283,"oldContent":"                    },"},{"type":"INSERT","lineNumber":294,"content":"                            Toast.makeText(context, \"No GPS location available\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":285,"oldContent":"                    containerColor = if (isGridSurveyMode) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.surface,"},{"type":"DELETE","lineNumber":288,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":290,"oldContent":"                    Icon("},{"type":"INSERT","lineNumber":299,"content":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter\")"},{"type":"DELETE","lineNumber":293,"oldContent":"                        contentDescription = \"Grid Survey Mode\","},{"type":"DELETE","lineNumber":295,"oldContent":"                        tint = if (isGridSurveyMode) Color.White else MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":297,"oldContent":"                    )"},{"type":"DELETE","lineNumber":299,"oldContent":"                }"},{"type":"DELETE","lineNumber":301,"oldContent":""},{"type":"DELETE","lineNumber":304,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":307,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":308,"oldContent":"                            Toast.makeText(context, \"No GPS location available\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":309,"oldContent":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter\")"},{"type":"DELETE","lineNumber":313,"oldContent":""},{"type":"INSERT","lineNumber":316,"content":""},{"type":"DELETE","lineNumber":332,"oldContent":""},{"type":"INSERT","lineNumber":337,"content":""},{"type":"DELETE","lineNumber":340,"oldContent":"                            )"},{"type":"DELETE","lineNumber":343,"oldContent":""},{"type":"INSERT","lineNumber":345,"content":"                            )"},{"type":"INSERT","lineNumber":347,"content":""},{"type":"DELETE","lineNumber":354,"oldContent":"                        Column {"},{"type":"INSERT","lineNumber":358,"content":"                        Column {"},{"type":"DELETE","lineNumber":360,"oldContent":"                            )"},{"type":"DELETE","lineNumber":363,"oldContent":""},{"type":"INSERT","lineNumber":365,"content":"                            )"},{"type":"INSERT","lineNumber":367,"content":""},{"type":"DELETE","lineNumber":371,"oldContent":"                            )"},{"type":"DELETE","lineNumber":373,"oldContent":"                        }"},{"type":"MODIFY","lineNumber":375,"content":"                            )","oldContent":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":376,"content":"                        }"},{"type":"INSERT","lineNumber":378,"content":"                        gridResult?.let { result ->"},{"type":"DELETE","lineNumber":381,"oldContent":"                            }"},{"type":"DELETE","lineNumber":383,"oldContent":"                        }"},{"type":"INSERT","lineNumber":386,"content":"                            }"},{"type":"INSERT","lineNumber":387,"content":"                        }"},{"type":"DELETE","lineNumber":401,"oldContent":"                }"},{"type":"DELETE","lineNumber":403,"oldContent":""},{"type":"DELETE","lineNumber":412,"oldContent":""},{"type":"DELETE","lineNumber":420,"oldContent":"                        modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":422,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":424,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":419,"content":"                            }"},{"type":"INSERT","lineNumber":420,"content":"                        }"},{"type":"INSERT","lineNumber":422,"content":"                }"},{"type":"INSERT","lineNumber":423,"content":"            }"},{"type":"INSERT","lineNumber":424,"content":""},{"type":"INSERT","lineNumber":425,"content":"            // Upload button"},{"type":"INSERT","lineNumber":426,"content":"            Column("},{"type":"INSERT","lineNumber":427,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":428,"content":"                    .align(Alignment.BottomCenter)"},{"type":"INSERT","lineNumber":429,"content":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":430,"content":"            ) {"},{"type":"INSERT","lineNumber":431,"content":"                if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":432,"content":"                    Button("},{"type":"INSERT","lineNumber":433,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":434,"content":"                            gridResult?.let { result ->"},{"type":"INSERT","lineNumber":435,"content":"                                val homeLat = telemetryState.latitude ?: 0.0"},{"type":"INSERT","lineNumber":436,"content":"                                val homeLon = telemetryState.longitude ?: 0.0"},{"type":"INSERT","lineNumber":437,"content":"                                val homePosition = LatLng(homeLat, homeLon)"},{"type":"INSERT","lineNumber":438,"content":"                                val builtMission = GridMissionConverter.convertToMissionItems(result, homePosition)"},{"type":"INSERT","lineNumber":439,"content":""},{"type":"INSERT","lineNumber":440,"content":"                                telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"INSERT","lineNumber":441,"content":"                                    if (success) {"},{"type":"INSERT","lineNumber":442,"content":"                                        Toast.makeText(context, \"Grid survey uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":443,"content":"                                        coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"INSERT","lineNumber":444,"content":"                                        navController.navigate(Screen.Main.route) {"},{"type":"INSERT","lineNumber":445,"content":"                                            popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"INSERT","lineNumber":446,"content":"                                        }"},{"type":"INSERT","lineNumber":447,"content":"                                    } else {"},{"type":"INSERT","lineNumber":448,"content":"                                        Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":449,"content":"                                    }"},{"type":"INSERT","lineNumber":450,"content":"                                }"},{"type":"INSERT","lineNumber":452,"content":"                        },"},{"type":"INSERT","lineNumber":453,"content":"                        enabled = gridResult?.waypoints?.isNotEmpty() == true,"},{"type":"INSERT","lineNumber":454,"content":"                        modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":455,"content":"                    ) {"},{"type":"INSERT","lineNumber":456,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":457,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":458,"content":"                    }"},{"type":"DELETE","lineNumber":429,"oldContent":"                        }"},{"type":"DELETE","lineNumber":432,"oldContent":"                    }"},{"type":"DELETE","lineNumber":436,"oldContent":"            }"},{"type":"DELETE","lineNumber":440,"oldContent":"            // Upload button"},{"type":"DELETE","lineNumber":443,"oldContent":"            Column("},{"type":"DELETE","lineNumber":446,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":449,"oldContent":"                    .align(Alignment.BottomCenter)"},{"type":"DELETE","lineNumber":452,"oldContent":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":455,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":458,"oldContent":"                if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":461,"oldContent":"                    Button("},{"type":"DELETE","lineNumber":464,"oldContent":"                        onClick = {"},{"type":"DELETE","lineNumber":467,"oldContent":"                            gridResult?.let { result ->"},{"type":"DELETE","lineNumber":470,"oldContent":"                                val homeLat = telemetryState.latitude ?: 0.0"},{"type":"DELETE","lineNumber":473,"oldContent":"                                val homeLon = telemetryState.longitude ?: 0.0"},{"type":"DELETE","lineNumber":476,"oldContent":"                                val homePosition = LatLng(homeLat, homeLon)"},{"type":"DELETE","lineNumber":479,"oldContent":"                                val builtMission = GridMissionConverter.convertToMissionItems(result, homePosition)"},{"type":"DELETE","lineNumber":484,"oldContent":"                                telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"DELETE","lineNumber":487,"oldContent":"                                    if (success) {"},{"type":"DELETE","lineNumber":490,"oldContent":"                                        Toast.makeText(context, \"Grid survey uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":493,"oldContent":"                                        coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"DELETE","lineNumber":496,"oldContent":"                                        navController.navigate(Screen.Main.route) {"},{"type":"DELETE","lineNumber":499,"oldContent":"                                            popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"DELETE","lineNumber":502,"oldContent":"                                        }"},{"type":"DELETE","lineNumber":505,"oldContent":"                                    } else {"},{"type":"DELETE","lineNumber":508,"oldContent":"                                        Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":511,"oldContent":"                                    }"},{"type":"DELETE","lineNumber":513,"oldContent":"                                }"},{"type":"INSERT","lineNumber":518,"content":"                        modifier = Modifier.fillMaxWidth()"},{"type":"INSERT","lineNumber":519,"content":"                    ) {"},{"type":"DELETE","lineNumber":515,"oldContent":"                            }"},{"type":"DELETE","lineNumber":518,"oldContent":"                        },"},{"type":"DELETE","lineNumber":521,"oldContent":"                        enabled = gridResult?.waypoints?.isNotEmpty() == true,"},{"type":"DELETE","lineNumber":523,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":525,"oldContent":"                        modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":527,"oldContent":"                    ) {"}]},{"timestamp":1758686783476,"changes":[{"type":"MODIFY","lineNumber":6,"content":"import androidx.compose.material3.*","oldContent":"import androidx.compose.material3.Scaffold"},{"type":"MODIFY","lineNumber":45,"content":"    )","oldContent":"    }"},{"type":"INSERT","lineNumber":52,"content":""},{"type":"DELETE","lineNumber":54,"oldContent":""},{"type":"INSERT","lineNumber":62,"content":"    val gridGenerator = remember { GridGenerator() }"},{"type":"DELETE","lineNumber":63,"oldContent":""},{"type":"DELETE","lineNumber":68,"oldContent":"    var centeredOnce by remember { mutableStateOf(false) }"},{"type":"MODIFY","lineNumber":70,"content":"    // Center map once when screen opens","oldContent":"    LaunchedEffect(telemetryState.latitude, telemetryState.longitude) {"},{"type":"INSERT","lineNumber":71,"content":"    var centeredOnce by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":72,"content":"    LaunchedEffect(telemetryState.latitude, telemetryState.longitude) {"},{"type":"DELETE","lineNumber":74,"oldContent":"    // Center map once when screen opens"},{"type":"INSERT","lineNumber":99,"content":"            z = alt"},{"type":"DELETE","lineNumber":100,"oldContent":"        )"},{"type":"INSERT","lineNumber":103,"content":"    fun regenerateGrid() {"},{"type":"DELETE","lineNumber":105,"oldContent":"    fun regenerateGrid() {"},{"type":"INSERT","lineNumber":114,"content":"    }"},{"type":"DELETE","lineNumber":115,"oldContent":""},{"type":"DELETE","lineNumber":136,"oldContent":"    Scaffold("},{"type":"DELETE","lineNumber":138,"oldContent":"        floatingActionButton = {"},{"type":"DELETE","lineNumber":140,"oldContent":"                if (showPlanActions) {"},{"type":"INSERT","lineNumber":139,"content":"    Scaffold("},{"type":"INSERT","lineNumber":140,"content":"        floatingActionButton = {"},{"type":"INSERT","lineNumber":142,"content":"                if (showPlanActions) {"},{"type":"INSERT","lineNumber":144,"content":"                        onClick = {"},{"type":"DELETE","lineNumber":145,"oldContent":""},{"type":"DELETE","lineNumber":153,"oldContent":"                        },"},{"type":"DELETE","lineNumber":155,"oldContent":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"DELETE","lineNumber":157,"oldContent":""},{"type":"INSERT","lineNumber":155,"content":"                        },"},{"type":"DELETE","lineNumber":159,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":161,"oldContent":"                        onClick = {"},{"type":"INSERT","lineNumber":158,"content":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"INSERT","lineNumber":160,"content":""},{"type":"INSERT","lineNumber":161,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":162,"content":"                        onClick = {"},{"type":"DELETE","lineNumber":168,"oldContent":"                            }"},{"type":"DELETE","lineNumber":170,"oldContent":"                        },"},{"type":"DELETE","lineNumber":173,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":176,"oldContent":"                    }"},{"type":"INSERT","lineNumber":173,"content":"                            }"},{"type":"INSERT","lineNumber":174,"content":"                        },"},{"type":"DELETE","lineNumber":178,"oldContent":""},{"type":"INSERT","lineNumber":176,"content":"                    ) {"},{"type":"INSERT","lineNumber":178,"content":"                    }"},{"type":"INSERT","lineNumber":179,"content":""},{"type":"DELETE","lineNumber":186,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":189,"oldContent":"                    }"},{"type":"DELETE","lineNumber":191,"oldContent":"                }"},{"type":"DELETE","lineNumber":193,"oldContent":""},{"type":"DELETE","lineNumber":195,"oldContent":"                FloatingActionButton("},{"type":"INSERT","lineNumber":191,"content":"                    ) {"},{"type":"INSERT","lineNumber":193,"content":"                    }"},{"type":"INSERT","lineNumber":194,"content":"                }"},{"type":"INSERT","lineNumber":195,"content":""},{"type":"INSERT","lineNumber":196,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":200,"oldContent":"            GcsMap("},{"type":"DELETE","lineNumber":202,"oldContent":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":204,"oldContent":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":205,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":207,"oldContent":"                mapType = mapType,"},{"type":"INSERT","lineNumber":205,"content":"        Box(modifier = Modifier.fillMaxSize().padding(paddingValues)) {"},{"type":"INSERT","lineNumber":206,"content":"            // Map"},{"type":"INSERT","lineNumber":207,"content":"            GcsMap("},{"type":"INSERT","lineNumber":208,"content":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":209,"content":"                points = if (isGridSurveyMode) emptyList() else points,"},{"type":"INSERT","lineNumber":210,"content":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":211,"content":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":212,"content":"                mapType = mapType,"},{"type":"INSERT","lineNumber":213,"content":"                autoCenter = false,"},{"type":"INSERT","lineNumber":214,"content":"                surveyPolygon = if (isGridSurveyMode) surveyPolygon else emptyList(),"},{"type":"INSERT","lineNumber":215,"content":"                gridLines = gridResult?.gridLines ?: emptyList(),"},{"type":"INSERT","lineNumber":216,"content":"                gridWaypoints = gridResult?.waypoints?.map { it.position } ?: emptyList()"},{"type":"DELETE","lineNumber":212,"oldContent":"        Box(modifier = Modifier.fillMaxSize().padding(paddingValues)) {"},{"type":"DELETE","lineNumber":214,"oldContent":"            // Map"},{"type":"INSERT","lineNumber":220,"content":"            Column("},{"type":"INSERT","lineNumber":221,"content":"                modifier = Modifier"},{"type":"DELETE","lineNumber":216,"oldContent":"                points = if (isGridSurveyMode) emptyList() else points,"},{"type":"INSERT","lineNumber":224,"content":"            ) {"},{"type":"DELETE","lineNumber":220,"oldContent":"                autoCenter = false,"},{"type":"DELETE","lineNumber":222,"oldContent":"                surveyPolygon = if (isGridSurveyMode) surveyPolygon else emptyList(),"},{"type":"DELETE","lineNumber":223,"oldContent":"                gridLines = gridResult?.gridLines ?: emptyList(),"},{"type":"DELETE","lineNumber":224,"oldContent":"                gridWaypoints = gridResult?.waypoints?.map { it.position } ?: emptyList()"},{"type":"INSERT","lineNumber":228,"content":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":229,"content":"                )"},{"type":"DELETE","lineNumber":226,"oldContent":"            Column("},{"type":"DELETE","lineNumber":228,"oldContent":"                modifier = Modifier"},{"type":"DELETE","lineNumber":230,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":232,"oldContent":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":234,"oldContent":"                )"},{"type":"INSERT","lineNumber":237,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":238,"content":"                    color = if (isGridSurveyMode) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.onSurface,"},{"type":"INSERT","lineNumber":239,"content":"                    fontWeight = if (isGridSurveyMode) FontWeight.Bold else FontWeight.Normal"},{"type":"INSERT","lineNumber":240,"content":"                )"},{"type":"INSERT","lineNumber":241,"content":"            }"},{"type":"INSERT","lineNumber":242,"content":""},{"type":"INSERT","lineNumber":243,"content":"            // Crosshair"},{"type":"INSERT","lineNumber":244,"content":"            Box("},{"type":"INSERT","lineNumber":245,"content":"                modifier = Modifier.size(36.dp).align(Alignment.Center),"},{"type":"INSERT","lineNumber":246,"content":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":240,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":243,"oldContent":"                    color = if (isGridSurveyMode) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.onSurface,"},{"type":"DELETE","lineNumber":246,"oldContent":"                    fontWeight = if (isGridSurveyMode) FontWeight.Bold else FontWeight.Normal"},{"type":"DELETE","lineNumber":248,"oldContent":"                )"},{"type":"INSERT","lineNumber":255,"content":""},{"type":"DELETE","lineNumber":250,"oldContent":"            }"},{"type":"DELETE","lineNumber":253,"oldContent":""},{"type":"DELETE","lineNumber":256,"oldContent":"            // Crosshair"},{"type":"DELETE","lineNumber":258,"oldContent":"            Box("},{"type":"DELETE","lineNumber":260,"oldContent":"                modifier = Modifier.size(36.dp).align(Alignment.Center),"},{"type":"DELETE","lineNumber":261,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"INSERT","lineNumber":263,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":264,"oldContent":""},{"type":"DELETE","lineNumber":265,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":268,"oldContent":"                        } else {"},{"type":"MODIFY","lineNumber":270,"content":"                        } else {","oldContent":"                            surveyPolygon = emptyList()"},{"type":"INSERT","lineNumber":271,"content":"                            surveyPolygon = emptyList()"},{"type":"DELETE","lineNumber":273,"oldContent":"                    onClick = {"},{"type":"DELETE","lineNumber":275,"oldContent":"                        val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":278,"oldContent":"                        val lon = telemetryState.longitude"},{"type":"DELETE","lineNumber":280,"oldContent":"                        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":283,"oldContent":"                            cameraPositionState.move("},{"type":"DELETE","lineNumber":286,"oldContent":"                            )"},{"type":"DELETE","lineNumber":289,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":292,"oldContent":"                        }"},{"type":"INSERT","lineNumber":286,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":287,"content":"                        val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":288,"content":"                        val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":289,"content":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":290,"content":"                            cameraPositionState.move("},{"type":"INSERT","lineNumber":291,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"INSERT","lineNumber":292,"content":"                            )"},{"type":"INSERT","lineNumber":293,"content":"                        } else {"},{"type":"INSERT","lineNumber":294,"content":"                            Toast.makeText(context, \"No GPS location available\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":295,"content":"                        }"},{"type":"DELETE","lineNumber":297,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"INSERT","lineNumber":299,"content":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter\")"},{"type":"DELETE","lineNumber":300,"oldContent":"                            Toast.makeText(context, \"No GPS location available\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":304,"oldContent":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter\")"},{"type":"MODIFY","lineNumber":316,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":337,"content":"","oldContent":""},{"type":"DELETE","lineNumber":343,"oldContent":"                            )"},{"type":"DELETE","lineNumber":346,"oldContent":""},{"type":"INSERT","lineNumber":345,"content":"                            )"},{"type":"INSERT","lineNumber":347,"content":""},{"type":"MODIFY","lineNumber":358,"content":"                        Column {","oldContent":"                        Column {"},{"type":"DELETE","lineNumber":363,"oldContent":"                            )"},{"type":"DELETE","lineNumber":366,"oldContent":""},{"type":"INSERT","lineNumber":365,"content":"                            )"},{"type":"INSERT","lineNumber":367,"content":""},{"type":"DELETE","lineNumber":373,"oldContent":"                            )"},{"type":"DELETE","lineNumber":374,"oldContent":"                        }"},{"type":"DELETE","lineNumber":377,"oldContent":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":375,"content":"                            )"},{"type":"INSERT","lineNumber":376,"content":"                        }"},{"type":"INSERT","lineNumber":378,"content":"                        gridResult?.let { result ->"},{"type":"DELETE","lineNumber":384,"oldContent":"                            }"},{"type":"MODIFY","lineNumber":386,"content":"                            }","oldContent":"                        }"},{"type":"INSERT","lineNumber":387,"content":"                        }"},{"type":"DELETE","lineNumber":416,"oldContent":"                            }"},{"type":"MODIFY","lineNumber":418,"content":"                                Text(\"Auto Angle\")","oldContent":"                        }"},{"type":"INSERT","lineNumber":419,"content":"                            }"},{"type":"INSERT","lineNumber":420,"content":"                        }"},{"type":"INSERT","lineNumber":421,"content":"                    }"},{"type":"DELETE","lineNumber":422,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":425,"oldContent":"                    }"},{"type":"DELETE","lineNumber":427,"oldContent":"                            }"},{"type":"DELETE","lineNumber":429,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":431,"oldContent":"                    Button("},{"type":"DELETE","lineNumber":434,"oldContent":"                        onClick = {"},{"type":"DELETE","lineNumber":436,"oldContent":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"DELETE","lineNumber":439,"oldContent":"                            val homeLat = telemetryState.latitude ?: 0.0"},{"type":"DELETE","lineNumber":441,"oldContent":"                            val homeLon = telemetryState.longitude ?: 0.0"},{"type":"DELETE","lineNumber":443,"oldContent":"                            val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"DELETE","lineNumber":446,"oldContent":""},{"type":"DELETE","lineNumber":448,"oldContent":"                            builtMission.add("},{"type":"DELETE","lineNumber":450,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":453,"oldContent":"                                    targetSystem = 0u, targetComponent = 0u, seq = 0u,"},{"type":"DELETE","lineNumber":455,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":458,"oldContent":"                                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":460,"oldContent":"                                    current = 1u, autocontinue = 1u,"},{"type":"DELETE","lineNumber":463,"oldContent":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"DELETE","lineNumber":465,"oldContent":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = homeAlt"},{"type":"DELETE","lineNumber":468,"oldContent":"                                )"},{"type":"DELETE","lineNumber":469,"oldContent":"                            )"},{"type":"INSERT","lineNumber":451,"content":"                            }"},{"type":"DELETE","lineNumber":472,"oldContent":""},{"type":"DELETE","lineNumber":473,"oldContent":"                        modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":474,"oldContent":"                            builtMission.add("},{"type":"INSERT","lineNumber":454,"content":"                        modifier = Modifier.widthIn(min = 180.dp, max = 340.dp).align(Alignment.CenterHorizontally)"},{"type":"DELETE","lineNumber":477,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":479,"oldContent":"                                    targetSystem = 0u, targetComponent = 0u, seq = 1u,"},{"type":"INSERT","lineNumber":459,"content":"                } else {"},{"type":"INSERT","lineNumber":460,"content":"                    Button("},{"type":"INSERT","lineNumber":461,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":462,"content":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"INSERT","lineNumber":463,"content":"                            val homeLat = telemetryState.latitude ?: 0.0"},{"type":"INSERT","lineNumber":464,"content":"                            val homeLon = telemetryState.longitude ?: 0.0"},{"type":"INSERT","lineNumber":465,"content":"                            val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"INSERT","lineNumber":466,"content":""},{"type":"INSERT","lineNumber":467,"content":"                            builtMission.add("},{"type":"INSERT","lineNumber":468,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":469,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 0u,"},{"type":"INSERT","lineNumber":471,"content":"                                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":472,"content":"                                    current = 1u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":473,"content":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":474,"content":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = homeAlt"},{"type":"INSERT","lineNumber":475,"content":"                                )"},{"type":"INSERT","lineNumber":476,"content":"                            )"},{"type":"INSERT","lineNumber":477,"content":""},{"type":"INSERT","lineNumber":478,"content":"                            builtMission.add("},{"type":"INSERT","lineNumber":479,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":480,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 1u,"},{"type":"INSERT","lineNumber":481,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":518,"content":"                        modifier = Modifier.widthIn(min = 180.dp, max = 340.dp).align(Alignment.CenterHorizontally)"},{"type":"INSERT","lineNumber":519,"content":"                    ) {"},{"type":"DELETE","lineNumber":521,"oldContent":"                        modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":522,"oldContent":"                    ) {"}]},{"timestamp":1758691151707,"changes":[{"type":"INSERT","lineNumber":30,"content":"import java.util.Locale"},{"type":"INSERT","lineNumber":32,"content":"@Suppress(\"UnusedMaterial3ScaffoldPaddingParameter\")"},{"type":"INSERT","lineNumber":71,"content":""},{"type":"DELETE","lineNumber":71,"oldContent":""},{"type":"INSERT","lineNumber":131,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":137,"oldContent":"    Scaffold("},{"type":"DELETE","lineNumber":139,"oldContent":"        floatingActionButton = {"},{"type":"DELETE","lineNumber":141,"oldContent":"                if (showPlanActions) {"},{"type":"INSERT","lineNumber":142,"content":"    Scaffold("},{"type":"INSERT","lineNumber":143,"content":"        floatingActionButton = {"},{"type":"DELETE","lineNumber":143,"oldContent":"                                    LatLng(lat, lon),"},{"type":"INSERT","lineNumber":145,"content":"                if (showPlanActions) {"},{"type":"INSERT","lineNumber":146,"content":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":154,"oldContent":"                        },"},{"type":"DELETE","lineNumber":156,"oldContent":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"INSERT","lineNumber":158,"content":"                        },"},{"type":"INSERT","lineNumber":160,"content":"                    ) {"},{"type":"INSERT","lineNumber":161,"content":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"INSERT","lineNumber":162,"content":"                    }"},{"type":"DELETE","lineNumber":159,"oldContent":"                )"},{"type":"DELETE","lineNumber":162,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":171,"oldContent":"                            }"},{"type":"DELETE","lineNumber":172,"oldContent":"                        },"},{"type":"DELETE","lineNumber":175,"oldContent":"                    ) {"},{"type":"INSERT","lineNumber":176,"content":"                            }"},{"type":"INSERT","lineNumber":177,"content":"                        },"},{"type":"INSERT","lineNumber":179,"content":"                    ) {"},{"type":"INSERT","lineNumber":180,"content":"                        Icon(Icons.Default.Delete, contentDescription = \"Delete Last\")"},{"type":"DELETE","lineNumber":179,"oldContent":"                        Icon(Icons.Default.Delete, contentDescription = \"Delete Last\")"},{"type":"DELETE","lineNumber":189,"oldContent":"                    ) {"},{"type":"INSERT","lineNumber":193,"content":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"INSERT","lineNumber":194,"content":"                    ) {"},{"type":"INSERT","lineNumber":195,"content":"                        Icon(Icons.Default.ClearAll, contentDescription = \"Clear All\")"},{"type":"DELETE","lineNumber":193,"oldContent":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"DELETE","lineNumber":196,"oldContent":"                        Icon(Icons.Default.ClearAll, contentDescription = \"Clear All\")"},{"type":"DELETE","lineNumber":202,"oldContent":"        Box(modifier = Modifier.fillMaxSize().padding(paddingValues)) {"},{"type":"DELETE","lineNumber":203,"oldContent":"            // Map"},{"type":"INSERT","lineNumber":206,"content":"        }"},{"type":"INSERT","lineNumber":207,"content":"    ) { _ ->"},{"type":"INSERT","lineNumber":208,"content":"        Box(modifier = Modifier.fillMaxSize()) {"},{"type":"INSERT","lineNumber":209,"content":"            // Map"},{"type":"DELETE","lineNumber":207,"oldContent":"        }"},{"type":"DELETE","lineNumber":209,"oldContent":"    ) { paddingValues ->"},{"type":"DELETE","lineNumber":211,"oldContent":"            )"},{"type":"DELETE","lineNumber":213,"oldContent":""},{"type":"DELETE","lineNumber":216,"oldContent":"            // Status indicator"},{"type":"DELETE","lineNumber":219,"oldContent":"                    .align(Alignment.TopEnd)"},{"type":"DELETE","lineNumber":221,"oldContent":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":222,"oldContent":"                Text("},{"type":"DELETE","lineNumber":223,"oldContent":"                    \"Connected: ${telemetryState.connected}\","},{"type":"INSERT","lineNumber":220,"content":"            )"},{"type":"INSERT","lineNumber":221,"content":""},{"type":"INSERT","lineNumber":222,"content":"            // Status indicator"},{"type":"DELETE","lineNumber":226,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":225,"content":"                    .align(Alignment.TopEnd)"},{"type":"INSERT","lineNumber":226,"content":"                    .padding(12.dp)"},{"type":"MODIFY","lineNumber":229,"content":"                    \"Connected: ${telemetryState.connected}\",","oldContent":"                    \"FCU detected: ${telemetryState.fcuDetected}\","},{"type":"INSERT","lineNumber":230,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":233,"content":"                Text("},{"type":"INSERT","lineNumber":234,"content":"                    \"FCU detected: ${telemetryState.fcuDetected}\","},{"type":"DELETE","lineNumber":238,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":240,"oldContent":"                Icon("},{"type":"DELETE","lineNumber":242,"oldContent":"                    Icons.Default.Add,"},{"type":"DELETE","lineNumber":245,"oldContent":"                    contentDescription = \"Crosshair\","},{"type":"DELETE","lineNumber":247,"oldContent":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":250,"oldContent":"                    modifier = Modifier.size(28.dp)"},{"type":"DELETE","lineNumber":252,"oldContent":"                )"},{"type":"INSERT","lineNumber":250,"content":"            ) {"},{"type":"INSERT","lineNumber":251,"content":"                Icon("},{"type":"INSERT","lineNumber":252,"content":"                    Icons.Default.Add,"},{"type":"INSERT","lineNumber":253,"content":"                    contentDescription = \"Crosshair\","},{"type":"INSERT","lineNumber":254,"content":"                    tint = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":255,"content":"                    modifier = Modifier.size(28.dp)"},{"type":"INSERT","lineNumber":256,"content":"                )"},{"type":"INSERT","lineNumber":258,"content":""},{"type":"DELETE","lineNumber":259,"oldContent":""},{"type":"DELETE","lineNumber":263,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":267,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":272,"content":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":271,"oldContent":"                            waypoints.clear()"},{"type":"INSERT","lineNumber":284,"content":"                        tint = if (isGridSurveyMode) Color.White else MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":285,"content":"                    )"},{"type":"INSERT","lineNumber":286,"content":"                }"},{"type":"INSERT","lineNumber":287,"content":""},{"type":"INSERT","lineNumber":288,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":283,"oldContent":"                        tint = if (isGridSurveyMode) Color.White else MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":285,"oldContent":"                    )"},{"type":"DELETE","lineNumber":288,"oldContent":"                }"},{"type":"DELETE","lineNumber":290,"oldContent":""},{"type":"DELETE","lineNumber":293,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":295,"oldContent":"                    },"},{"type":"INSERT","lineNumber":299,"content":"                    },"},{"type":"DELETE","lineNumber":299,"oldContent":"                }"},{"type":"INSERT","lineNumber":303,"content":"                }"},{"type":"INSERT","lineNumber":318,"content":"            }"},{"type":"DELETE","lineNumber":316,"oldContent":""},{"type":"INSERT","lineNumber":339,"content":"                        )"},{"type":"DELETE","lineNumber":337,"oldContent":""},{"type":"DELETE","lineNumber":344,"oldContent":"                            )"},{"type":"DELETE","lineNumber":346,"oldContent":""},{"type":"INSERT","lineNumber":348,"content":"                            )"},{"type":"INSERT","lineNumber":350,"content":""},{"type":"INSERT","lineNumber":360,"content":""},{"type":"DELETE","lineNumber":358,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":364,"oldContent":"                            )"},{"type":"DELETE","lineNumber":366,"oldContent":""},{"type":"INSERT","lineNumber":368,"content":"                            )"},{"type":"INSERT","lineNumber":370,"content":""},{"type":"DELETE","lineNumber":373,"oldContent":"                            )"},{"type":"DELETE","lineNumber":375,"oldContent":"                        }"},{"type":"DELETE","lineNumber":377,"oldContent":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":378,"content":"                            )"},{"type":"INSERT","lineNumber":379,"content":"                        }"},{"type":"DELETE","lineNumber":379,"oldContent":"                            Divider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":381,"content":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":382,"content":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"DELETE","lineNumber":384,"oldContent":"                                Text(\"Distance: ${String.format(\"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":387,"content":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":388,"content":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":387,"oldContent":"                                Text(\"Time: ${String.format(\"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":420,"content":"                            ) {"},{"type":"DELETE","lineNumber":419,"oldContent":"                            ) {"},{"type":"DELETE","lineNumber":421,"oldContent":"                }"},{"type":"INSERT","lineNumber":425,"content":"                }"},{"type":"DELETE","lineNumber":440,"oldContent":"                            }"},{"type":"DELETE","lineNumber":443,"oldContent":"                        modifier = Modifier.widthIn(min = 180.dp, max = 340.dp).align(Alignment.CenterHorizontally)"},{"type":"DELETE","lineNumber":447,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":449,"content":"                                        }"},{"type":"INSERT","lineNumber":450,"content":"                                    } else {"},{"type":"INSERT","lineNumber":451,"content":"                                        Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":452,"content":"                                    }"},{"type":"INSERT","lineNumber":453,"content":"                                }"},{"type":"INSERT","lineNumber":454,"content":"                            }"},{"type":"INSERT","lineNumber":455,"content":"                        },"},{"type":"INSERT","lineNumber":456,"content":"                        enabled = gridResult?.waypoints?.isNotEmpty() == true,"},{"type":"INSERT","lineNumber":457,"content":"                        modifier = Modifier.widthIn(min = 180.dp, max = 340.dp).align(Alignment.CenterHorizontally)"},{"type":"INSERT","lineNumber":458,"content":"                    ) {"},{"type":"INSERT","lineNumber":459,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":460,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":461,"content":"                    }"},{"type":"INSERT","lineNumber":462,"content":"                } else {"},{"type":"DELETE","lineNumber":451,"oldContent":"                                        }"},{"type":"DELETE","lineNumber":453,"oldContent":"                                    } else {"},{"type":"DELETE","lineNumber":456,"oldContent":"                                        Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":459,"oldContent":"                                    }"},{"type":"DELETE","lineNumber":461,"oldContent":"                                }"},{"type":"DELETE","lineNumber":464,"oldContent":"                        },"},{"type":"INSERT","lineNumber":473,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":466,"oldContent":"                        enabled = gridResult?.waypoints?.isNotEmpty() == true,"},{"type":"DELETE","lineNumber":471,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":473,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":476,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":479,"oldContent":"                    }"},{"type":"DELETE","lineNumber":481,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":519,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":523,"content":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691424149,"changes":[{"type":"INSERT","lineNumber":5,"content":"import androidx.compose.foundation.verticalScroll"},{"type":"INSERT","lineNumber":6,"content":"import androidx.compose.foundation.rememberScrollState"},{"type":"DELETE","lineNumber":32,"oldContent":"@Composable"},{"type":"INSERT","lineNumber":35,"content":"@Composable"},{"type":"INSERT","lineNumber":73,"content":""},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"INSERT","lineNumber":133,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":133,"oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":143,"oldContent":"            Column(horizontalAlignment = Alignment.End) {"},{"type":"DELETE","lineNumber":145,"oldContent":"                        onClick = {"},{"type":"INSERT","lineNumber":146,"content":"            Column(horizontalAlignment = Alignment.End) {"},{"type":"DELETE","lineNumber":147,"oldContent":"                            val center = cameraPositionState.position.target"},{"type":"INSERT","lineNumber":149,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":150,"content":"                            val center = cameraPositionState.position.target"},{"type":"DELETE","lineNumber":158,"oldContent":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"DELETE","lineNumber":160,"oldContent":""},{"type":"INSERT","lineNumber":161,"content":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"DELETE","lineNumber":162,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":164,"oldContent":"                        onClick = {"},{"type":"INSERT","lineNumber":165,"content":""},{"type":"INSERT","lineNumber":166,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":167,"content":"                        onClick = {"},{"type":"DELETE","lineNumber":177,"oldContent":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)"},{"type":"DELETE","lineNumber":179,"oldContent":"                    }"},{"type":"MODIFY","lineNumber":180,"content":"                        modifier = Modifier.padding(bottom = 12.dp).size(56.dp)","oldContent":""},{"type":"INSERT","lineNumber":183,"content":"                    }"},{"type":"INSERT","lineNumber":184,"content":""},{"type":"DELETE","lineNumber":193,"oldContent":"                    }"},{"type":"DELETE","lineNumber":194,"oldContent":"                }"},{"type":"DELETE","lineNumber":197,"oldContent":""},{"type":"INSERT","lineNumber":198,"content":"                    }"},{"type":"INSERT","lineNumber":199,"content":"                }"},{"type":"INSERT","lineNumber":200,"content":""},{"type":"DELETE","lineNumber":206,"oldContent":"            GcsMap("},{"type":"DELETE","lineNumber":208,"oldContent":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":211,"oldContent":"                points = if (isGridSurveyMode) emptyList() else points,"},{"type":"INSERT","lineNumber":212,"content":"            GcsMap("},{"type":"INSERT","lineNumber":213,"content":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":214,"content":"                points = if (isGridSurveyMode) emptyList() else points,"},{"type":"DELETE","lineNumber":219,"oldContent":"            )"},{"type":"INSERT","lineNumber":222,"content":"            )"},{"type":"DELETE","lineNumber":224,"oldContent":"                    .align(Alignment.TopEnd)"},{"type":"INSERT","lineNumber":227,"content":"                    .align(Alignment.TopEnd)"},{"type":"DELETE","lineNumber":233,"oldContent":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":235,"oldContent":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":237,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":238,"content":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":250,"content":"                modifier = Modifier.size(36.dp).align(Alignment.Center),"},{"type":"INSERT","lineNumber":251,"content":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":250,"oldContent":"                modifier = Modifier.size(36.dp).align(Alignment.Center),"},{"type":"DELETE","lineNumber":253,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":255,"oldContent":"            }"},{"type":"DELETE","lineNumber":257,"oldContent":"            // Left sidebar buttons"},{"type":"INSERT","lineNumber":259,"content":"            }"},{"type":"INSERT","lineNumber":260,"content":""},{"type":"INSERT","lineNumber":261,"content":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":261,"oldContent":""},{"type":"INSERT","lineNumber":269,"content":"                    onClick = {"},{"type":"DELETE","lineNumber":269,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":274,"content":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":274,"oldContent":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":284,"oldContent":"                    onClick = {"},{"type":"DELETE","lineNumber":285,"oldContent":"                        val lat = telemetryState.latitude"},{"type":"DELETE","lineNumber":287,"oldContent":"                        val lon = telemetryState.longitude"},{"type":"DELETE","lineNumber":290,"oldContent":"                        if (lat != null && lon != null) {"},{"type":"DELETE","lineNumber":292,"oldContent":"                            cameraPositionState.move("},{"type":"INSERT","lineNumber":291,"content":"                    onClick = {"},{"type":"INSERT","lineNumber":292,"content":"                        val lat = telemetryState.latitude"},{"type":"INSERT","lineNumber":293,"content":"                        val lon = telemetryState.longitude"},{"type":"INSERT","lineNumber":294,"content":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":295,"content":"                            cameraPositionState.move("},{"type":"INSERT","lineNumber":301,"content":"                    },"},{"type":"DELETE","lineNumber":301,"oldContent":"                    },"},{"type":"INSERT","lineNumber":305,"content":"                }"},{"type":"DELETE","lineNumber":305,"oldContent":"                }"},{"type":"INSERT","lineNumber":320,"content":"            }"},{"type":"DELETE","lineNumber":320,"oldContent":"            }"},{"type":"INSERT","lineNumber":341,"content":"                        )"},{"type":"DELETE","lineNumber":341,"oldContent":"                        )"},{"type":"DELETE","lineNumber":348,"oldContent":"                        }"},{"type":"INSERT","lineNumber":351,"content":"                        }"},{"type":"INSERT","lineNumber":352,"content":""},{"type":"DELETE","lineNumber":352,"oldContent":""},{"type":"INSERT","lineNumber":362,"content":""},{"type":"DELETE","lineNumber":362,"oldContent":""},{"type":"DELETE","lineNumber":368,"oldContent":"                        }"},{"type":"INSERT","lineNumber":371,"content":"                        }"},{"type":"INSERT","lineNumber":372,"content":""},{"type":"DELETE","lineNumber":372,"oldContent":""},{"type":"DELETE","lineNumber":379,"oldContent":""},{"type":"DELETE","lineNumber":381,"oldContent":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"INSERT","lineNumber":382,"content":""},{"type":"DELETE","lineNumber":383,"oldContent":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":385,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"INSERT","lineNumber":386,"content":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":387,"oldContent":"                            }"},{"type":"DELETE","lineNumber":388,"oldContent":"                        }"},{"type":"INSERT","lineNumber":391,"content":"                            }"},{"type":"INSERT","lineNumber":392,"content":"                        }"},{"type":"INSERT","lineNumber":422,"content":"                            ) {"},{"type":"DELETE","lineNumber":422,"oldContent":"                            ) {"},{"type":"INSERT","lineNumber":427,"content":"                }"},{"type":"DELETE","lineNumber":427,"oldContent":"                }"},{"type":"DELETE","lineNumber":450,"oldContent":"                    Button("},{"type":"DELETE","lineNumber":452,"oldContent":"                        onClick = {"},{"type":"DELETE","lineNumber":455,"oldContent":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"DELETE","lineNumber":458,"oldContent":"                            val homeLat = telemetryState.latitude ?: 0.0"},{"type":"DELETE","lineNumber":460,"oldContent":"                            val homeLon = telemetryState.longitude ?: 0.0"},{"type":"DELETE","lineNumber":463,"oldContent":"                            val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"DELETE","lineNumber":465,"oldContent":""},{"type":"DELETE","lineNumber":468,"oldContent":"                            builtMission.add("},{"type":"INSERT","lineNumber":465,"content":"                    Button("},{"type":"INSERT","lineNumber":466,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":467,"content":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"INSERT","lineNumber":468,"content":"                            val homeLat = telemetryState.latitude ?: 0.0"},{"type":"INSERT","lineNumber":469,"content":"                            val homeLon = telemetryState.longitude ?: 0.0"},{"type":"INSERT","lineNumber":470,"content":"                            val homeAlt = telemetryState.altitudeMsl ?: 10f"},{"type":"INSERT","lineNumber":471,"content":""},{"type":"INSERT","lineNumber":472,"content":"                            builtMission.add("},{"type":"INSERT","lineNumber":475,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":479,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":525,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":525,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691463073,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"import androidx.compose.foundation.verticalScroll"},{"type":"DELETE","lineNumber":7,"oldContent":"import androidx.compose.foundation.rememberScrollState"},{"type":"MODIFY","lineNumber":34,"content":"fun PlanScreen(","oldContent":"fun PlanScreen("},{"type":"INSERT","lineNumber":71,"content":""},{"type":"DELETE","lineNumber":75,"oldContent":""},{"type":"INSERT","lineNumber":131,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":135,"oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"MODIFY","lineNumber":149,"content":"                            if (isGridSurveyMode) {","oldContent":"                            if (isGridSurveyMode) {"},{"type":"MODIFY","lineNumber":163,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":166,"content":"                            if (isGridSurveyMode) {","oldContent":"                            if (isGridSurveyMode) {"},{"type":"MODIFY","lineNumber":183,"content":"                    FloatingActionButton(","oldContent":"                    FloatingActionButton("},{"type":"MODIFY","lineNumber":196,"content":"                    }","oldContent":"                    }"},{"type":"MODIFY","lineNumber":199,"content":"                FloatingActionButton(","oldContent":"                FloatingActionButton("},{"type":"MODIFY","lineNumber":210,"content":"            GcsMap(","oldContent":"            GcsMap("},{"type":"MODIFY","lineNumber":213,"content":"                onMapClick = onMapClick,","oldContent":"                onMapClick = onMapClick,"},{"type":"MODIFY","lineNumber":221,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":226,"content":"                    .padding(12.dp)","oldContent":"                    .padding(12.dp)"},{"type":"MODIFY","lineNumber":237,"content":"                )","oldContent":"                )"},{"type":"DELETE","lineNumber":250,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":251,"oldContent":"                Icon("},{"type":"INSERT","lineNumber":250,"content":"            ) {"},{"type":"INSERT","lineNumber":251,"content":"                Icon("},{"type":"DELETE","lineNumber":260,"oldContent":"            Column("},{"type":"DELETE","lineNumber":262,"oldContent":"                modifier = Modifier"},{"type":"INSERT","lineNumber":260,"content":"            Column("},{"type":"INSERT","lineNumber":261,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":267,"content":"                    onClick = {"},{"type":"DELETE","lineNumber":271,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":272,"content":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":276,"oldContent":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":289,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":288,"content":"                FloatingActionButton("},{"type":"INSERT","lineNumber":289,"content":"                    onClick = {"},{"type":"DELETE","lineNumber":293,"oldContent":"                FloatingActionButton("},{"type":"MODIFY","lineNumber":294,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)","oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"INSERT","lineNumber":299,"content":"                    },"},{"type":"MODIFY","lineNumber":303,"content":"                }","oldContent":"                    },"},{"type":"DELETE","lineNumber":307,"oldContent":"                }"},{"type":"INSERT","lineNumber":318,"content":"            }"},{"type":"DELETE","lineNumber":322,"oldContent":"            }"},{"type":"DELETE","lineNumber":330,"oldContent":"                    color = Color.Black.copy(alpha = 0.8f)"},{"type":"DELETE","lineNumber":331,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":332,"oldContent":"                    Column("},{"type":"INSERT","lineNumber":328,"content":"                        .width(340.dp)"},{"type":"INSERT","lineNumber":329,"content":"                        .heightIn(max = 600.dp),"},{"type":"INSERT","lineNumber":330,"content":"                    shape = RoundedCornerShape(16.dp),"},{"type":"INSERT","lineNumber":331,"content":"                    color = Color.Black.copy(alpha = 0.85f),"},{"type":"INSERT","lineNumber":332,"content":"                    shadowElevation = 8.dp"},{"type":"INSERT","lineNumber":334,"content":"                    val scrollState = rememberScrollState()"},{"type":"INSERT","lineNumber":335,"content":"                    "},{"type":"DELETE","lineNumber":335,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":336,"oldContent":"                        Text("},{"type":"INSERT","lineNumber":337,"content":"                        modifier = Modifier"},{"type":"INSERT","lineNumber":338,"content":"                            .verticalScroll(scrollState)"},{"type":"INSERT","lineNumber":339,"content":"                            .padding(20.dp),"},{"type":"INSERT","lineNumber":340,"content":"                        verticalArrangement = Arrangement.spacedBy(16.dp)"},{"type":"INSERT","lineNumber":342,"content":"                        // Header"},{"type":"DELETE","lineNumber":340,"oldContent":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":345,"content":"                            style = MaterialTheme.typography.titleLarge,"},{"type":"INSERT","lineNumber":346,"content":"                        )"},{"type":"DELETE","lineNumber":343,"oldContent":"                        )"},{"type":"DELETE","lineNumber":345,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":346,"oldContent":"                                value = lineSpacing,"},{"type":"DELETE","lineNumber":347,"oldContent":"                                onValueChange = { lineSpacing = it },"},{"type":"DELETE","lineNumber":348,"oldContent":"                                valueRange = 10f..100f,"},{"type":"DELETE","lineNumber":349,"oldContent":"                                steps = 17"},{"type":"DELETE","lineNumber":350,"oldContent":"                            )"},{"type":"DELETE","lineNumber":351,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":352,"oldContent":"                        }"},{"type":"INSERT","lineNumber":350,"content":"                        // Parameter Controls"},{"type":"INSERT","lineNumber":351,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":352,"content":"                            label = \"Line Spacing\","},{"type":"INSERT","lineNumber":353,"content":"                            value = lineSpacing,"},{"type":"INSERT","lineNumber":354,"content":"                            onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":355,"content":"                            valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":356,"content":"                            steps = 17,"},{"type":"INSERT","lineNumber":357,"content":"                            unit = \"m\","},{"type":"INSERT","lineNumber":358,"content":"                            description = \"Distance between survey lines\""},{"type":"INSERT","lineNumber":359,"content":"                        )"},{"type":"DELETE","lineNumber":354,"oldContent":""},{"type":"DELETE","lineNumber":355,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":356,"oldContent":"                                value = gridAngle,"},{"type":"DELETE","lineNumber":357,"oldContent":"                                onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":358,"oldContent":"                                valueRange = 0f..180f,"},{"type":"DELETE","lineNumber":359,"oldContent":"                                steps = 35"},{"type":"DELETE","lineNumber":360,"oldContent":"                            )"},{"type":"DELETE","lineNumber":361,"oldContent":"                        }"},{"type":"DELETE","lineNumber":362,"oldContent":"                        Column {"},{"type":"INSERT","lineNumber":361,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":362,"content":"                            label = \"Grid Angle\","},{"type":"INSERT","lineNumber":363,"content":"                            value = gridAngle,"},{"type":"INSERT","lineNumber":364,"content":"                            onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":365,"content":"                            valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":366,"content":"                            steps = 35,"},{"type":"INSERT","lineNumber":367,"content":"                            unit = \"°\","},{"type":"INSERT","lineNumber":368,"content":"                            description = \"Survey line direction\""},{"type":"INSERT","lineNumber":369,"content":"                        )"},{"type":"DELETE","lineNumber":364,"oldContent":""},{"type":"DELETE","lineNumber":365,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":366,"oldContent":"                                value = surveySpeed,"},{"type":"DELETE","lineNumber":367,"oldContent":"                                onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":368,"oldContent":"                                valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":369,"oldContent":"                                steps = 18"},{"type":"DELETE","lineNumber":370,"oldContent":"                            )"},{"type":"DELETE","lineNumber":371,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":372,"oldContent":"                        }"},{"type":"INSERT","lineNumber":371,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":372,"content":"                            label = \"Survey Speed\","},{"type":"INSERT","lineNumber":373,"content":"                            value = surveySpeed,"},{"type":"INSERT","lineNumber":374,"content":"                            onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":375,"content":"                            valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":376,"content":"                            steps = 18,"},{"type":"INSERT","lineNumber":377,"content":"                            unit = \"m/s\","},{"type":"INSERT","lineNumber":378,"content":"                            description = \"Flight speed during survey\""},{"type":"INSERT","lineNumber":379,"content":"                        )"},{"type":"DELETE","lineNumber":374,"oldContent":""},{"type":"DELETE","lineNumber":375,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":376,"oldContent":"                                value = surveyAltitude,"},{"type":"DELETE","lineNumber":377,"oldContent":"                                onValueChange = { surveyAltitude = it },"},{"type":"DELETE","lineNumber":378,"oldContent":"                                valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":379,"oldContent":"                                steps = 21"},{"type":"DELETE","lineNumber":380,"oldContent":"                            )"},{"type":"DELETE","lineNumber":381,"oldContent":"                        }"},{"type":"DELETE","lineNumber":382,"oldContent":""},{"type":"DELETE","lineNumber":383,"oldContent":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":381,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":382,"content":"                            label = \"Survey Altitude\","},{"type":"INSERT","lineNumber":383,"content":"                            value = surveyAltitude,"},{"type":"INSERT","lineNumber":384,"content":"                            onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":385,"content":"                            valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":386,"content":"                            steps = 21,"},{"type":"INSERT","lineNumber":387,"content":"                            unit = \"m\","},{"type":"INSERT","lineNumber":388,"content":"                            description = \"Flight altitude above home\""},{"type":"INSERT","lineNumber":389,"content":"                        )"},{"type":"INSERT","lineNumber":391,"content":"                        // Grid Statistics"},{"type":"DELETE","lineNumber":386,"oldContent":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":387,"oldContent":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":388,"oldContent":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":389,"oldContent":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":390,"oldContent":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":391,"oldContent":"                            }"},{"type":"INSERT","lineNumber":393,"content":"                            HorizontalDivider("},{"type":"INSERT","lineNumber":394,"content":"                                color = Color.White.copy(alpha = 0.3f), "},{"type":"INSERT","lineNumber":395,"content":"                                thickness = 1.dp,"},{"type":"INSERT","lineNumber":396,"content":"                                modifier = Modifier.padding(vertical = 8.dp)"},{"type":"INSERT","lineNumber":397,"content":"                            )"},{"type":"INSERT","lineNumber":398,"content":"                            "},{"type":"INSERT","lineNumber":399,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {"},{"type":"INSERT","lineNumber":400,"content":"                                Text("},{"type":"INSERT","lineNumber":401,"content":"                                    \"Grid Statistics\","},{"type":"INSERT","lineNumber":402,"content":"                                    style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":403,"content":"                                    color = Color.White,"},{"type":"INSERT","lineNumber":404,"content":"                                    fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":405,"content":"                                )"},{"type":"INSERT","lineNumber":406,"content":"                                "},{"type":"INSERT","lineNumber":407,"content":"                                GridStatItem(\"Waypoints\", \"${result.waypoints.size}\")"},{"type":"INSERT","lineNumber":408,"content":"                                GridStatItem(\"Survey Lines\", \"${result.numLines}\")"},{"type":"INSERT","lineNumber":409,"content":"                                GridStatItem(\"Total Distance\", String.format(Locale.US, \"%.2f km\", result.totalDistance / 1000))"},{"type":"INSERT","lineNumber":410,"content":"                                GridStatItem(\"Estimated Time\", String.format(Locale.US, \"%.1f min\", result.estimatedTime / 60))"},{"type":"DELETE","lineNumber":393,"oldContent":"                        }"},{"type":"INSERT","lineNumber":414,"content":"                        // Instructions"},{"type":"DELETE","lineNumber":397,"oldContent":"                                color = Color.Yellow,"},{"type":"DELETE","lineNumber":398,"oldContent":"                                style = MaterialTheme.typography.bodySmall"},{"type":"DELETE","lineNumber":399,"oldContent":"                            )"},{"type":"DELETE","lineNumber":400,"oldContent":"                        }"},{"type":"DELETE","lineNumber":401,"oldContent":""},{"type":"INSERT","lineNumber":416,"content":"                            Card("},{"type":"INSERT","lineNumber":417,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":418,"content":"                                colors = CardDefaults.cardColors(containerColor = Color(0xFF2D5016).copy(alpha = 0.8f)),"},{"type":"INSERT","lineNumber":419,"content":"                                shape = RoundedCornerShape(8.dp)"},{"type":"INSERT","lineNumber":420,"content":"                            ) {"},{"type":"INSERT","lineNumber":421,"content":"                                Text("},{"type":"INSERT","lineNumber":422,"content":"                                    \"📍 Tap map to add polygon vertices\\n(need ${3 - surveyPolygon.size} more points)\","},{"type":"INSERT","lineNumber":423,"content":"                                    color = Color(0xFFAED581),"},{"type":"INSERT","lineNumber":424,"content":"                                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":425,"content":"                                    modifier = Modifier.padding(12.dp),"},{"type":"INSERT","lineNumber":426,"content":"                                    fontWeight = FontWeight.Medium"},{"type":"INSERT","lineNumber":427,"content":"                                )"},{"type":"INSERT","lineNumber":428,"content":"                            }"},{"type":"INSERT","lineNumber":431,"content":"                        // Action Buttons"},{"type":"DELETE","lineNumber":406,"oldContent":"                            Button("},{"type":"INSERT","lineNumber":434,"content":"                            horizontalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":408,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":436,"content":"                            OutlinedButton("},{"type":"DELETE","lineNumber":411,"oldContent":"                                Text(\"Clear\")"},{"type":"INSERT","lineNumber":439,"content":"                                enabled = surveyPolygon.isNotEmpty(),"},{"type":"INSERT","lineNumber":440,"content":"                                colors = ButtonDefaults.outlinedButtonColors("},{"type":"INSERT","lineNumber":441,"content":"                                    contentColor = Color.White"},{"type":"INSERT","lineNumber":442,"content":"                                ),"},{"type":"INSERT","lineNumber":443,"content":"                                border = ButtonDefaults.outlinedButtonBorder.copy("},{"type":"INSERT","lineNumber":444,"content":"                                    brush = androidx.compose.ui.graphics.SolidColor(Color.White.copy(alpha = 0.5f))"},{"type":"INSERT","lineNumber":445,"content":"                                )"},{"type":"DELETE","lineNumber":413,"oldContent":""},{"type":"INSERT","lineNumber":447,"content":"                                Text(\"Clear\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":422,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":423,"oldContent":"                            }"},{"type":"DELETE","lineNumber":425,"oldContent":"                        }"},{"type":"INSERT","lineNumber":457,"content":"                                enabled = surveyPolygon.size >= 3,"},{"type":"INSERT","lineNumber":458,"content":"                                colors = ButtonDefaults.buttonColors("},{"type":"INSERT","lineNumber":459,"content":"                                    containerColor = MaterialTheme.colorScheme.primary"},{"type":"INSERT","lineNumber":460,"content":"                                )"},{"type":"INSERT","lineNumber":461,"content":"                            }"},{"type":"INSERT","lineNumber":462,"content":"                                Text(\"Auto Angle\", fontWeight = FontWeight.Medium)"},{"type":"INSERT","lineNumber":464,"content":"                }"},{"type":"DELETE","lineNumber":429,"oldContent":"                }"},{"type":"INSERT","lineNumber":498,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":499,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":500,"content":"                    }"},{"type":"INSERT","lineNumber":501,"content":"                } else {"},{"type":"DELETE","lineNumber":463,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":465,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":468,"oldContent":"                    }"},{"type":"DELETE","lineNumber":470,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":472,"oldContent":"                                MissionItemInt("},{"type":"INSERT","lineNumber":510,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":512,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":477,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":562,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":527,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691493114,"changes":[{"type":"DELETE","lineNumber":32,"oldContent":"fun PlanScreen("},{"type":"DELETE","lineNumber":33,"oldContent":"fun PlanScreen("},{"type":"INSERT","lineNumber":32,"content":"@Suppress(\"UnusedMaterial3ScaffoldPaddingParameter\")"},{"type":"INSERT","lineNumber":34,"content":"fun PlanScreen("},{"type":"DELETE","lineNumber":69,"oldContent":""},{"type":"INSERT","lineNumber":71,"content":""},{"type":"DELETE","lineNumber":129,"oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":131,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":147,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":148,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":147,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":149,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":161,"oldContent":""},{"type":"DELETE","lineNumber":162,"oldContent":""},{"type":"INSERT","lineNumber":161,"content":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"DELETE","lineNumber":164,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":165,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":163,"content":""},{"type":"INSERT","lineNumber":164,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":166,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":181,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":182,"oldContent":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":181,"content":"                    }"},{"type":"INSERT","lineNumber":183,"content":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":194,"oldContent":"                    }"},{"type":"DELETE","lineNumber":195,"oldContent":"                    }"},{"type":"INSERT","lineNumber":194,"content":"                    ) {"},{"type":"DELETE","lineNumber":197,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":198,"oldContent":"                FloatingActionButton("},{"type":"INSERT","lineNumber":196,"content":"                    }"},{"type":"INSERT","lineNumber":197,"content":"                }"},{"type":"INSERT","lineNumber":199,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":208,"oldContent":"            GcsMap("},{"type":"DELETE","lineNumber":209,"oldContent":"            GcsMap("},{"type":"INSERT","lineNumber":208,"content":"        Box(modifier = Modifier.fillMaxSize()) {"},{"type":"DELETE","lineNumber":211,"oldContent":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":212,"oldContent":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":210,"content":"            GcsMap("},{"type":"INSERT","lineNumber":211,"content":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":213,"content":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":219,"oldContent":""},{"type":"DELETE","lineNumber":220,"oldContent":""},{"type":"INSERT","lineNumber":219,"content":"                gridWaypoints = gridResult?.waypoints?.map { it.position } ?: emptyList()"},{"type":"INSERT","lineNumber":221,"content":""},{"type":"DELETE","lineNumber":224,"oldContent":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":225,"oldContent":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":224,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":226,"content":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":235,"oldContent":"                )"},{"type":"DELETE","lineNumber":236,"oldContent":"                )"},{"type":"INSERT","lineNumber":235,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":237,"content":"                )"},{"type":"DELETE","lineNumber":248,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":249,"oldContent":"                Icon("},{"type":"INSERT","lineNumber":250,"content":"            ) {"},{"type":"INSERT","lineNumber":251,"content":"                Icon("},{"type":"DELETE","lineNumber":258,"oldContent":"            Column("},{"type":"DELETE","lineNumber":259,"oldContent":"                modifier = Modifier"},{"type":"INSERT","lineNumber":260,"content":"            Column("},{"type":"INSERT","lineNumber":261,"content":"                modifier = Modifier"},{"type":"DELETE","lineNumber":265,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":267,"content":"                    onClick = {"},{"type":"DELETE","lineNumber":270,"oldContent":"                            waypoints.clear()"},{"type":"INSERT","lineNumber":272,"content":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":286,"oldContent":"                FloatingActionButton("},{"type":"MODIFY","lineNumber":288,"content":"                FloatingActionButton(","oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":289,"content":"                    onClick = {"},{"type":"DELETE","lineNumber":292,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":293,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"INSERT","lineNumber":292,"content":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":294,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":297,"oldContent":"                    },"},{"type":"INSERT","lineNumber":299,"content":"                    },"},{"type":"MODIFY","lineNumber":303,"content":"                }","oldContent":"                }"},{"type":"DELETE","lineNumber":316,"oldContent":"            }"},{"type":"INSERT","lineNumber":318,"content":"            }"},{"type":"DELETE","lineNumber":326,"oldContent":"                        .width(340.dp)"},{"type":"DELETE","lineNumber":328,"oldContent":"                        .heightIn(max = 600.dp),"},{"type":"DELETE","lineNumber":330,"oldContent":"                    shape = RoundedCornerShape(16.dp),"},{"type":"DELETE","lineNumber":331,"oldContent":"                    color = Color.Black.copy(alpha = 0.85f),"},{"type":"DELETE","lineNumber":332,"oldContent":"                    shadowElevation = 8.dp"},{"type":"INSERT","lineNumber":328,"content":"                    color = Color.Black.copy(alpha = 0.8f)"},{"type":"INSERT","lineNumber":329,"content":"                ) {"},{"type":"INSERT","lineNumber":330,"content":"                    Column("},{"type":"DELETE","lineNumber":334,"oldContent":"                    val scrollState = rememberScrollState()"},{"type":"DELETE","lineNumber":336,"oldContent":"                    "},{"type":"DELETE","lineNumber":337,"oldContent":"                        modifier = Modifier"},{"type":"INSERT","lineNumber":333,"content":"                    ) {"},{"type":"INSERT","lineNumber":334,"content":"                        Text("},{"type":"DELETE","lineNumber":339,"oldContent":"                            .verticalScroll(scrollState)"},{"type":"DELETE","lineNumber":341,"oldContent":"                            .padding(20.dp),"},{"type":"DELETE","lineNumber":343,"oldContent":"                        verticalArrangement = Arrangement.spacedBy(16.dp)"},{"type":"INSERT","lineNumber":338,"content":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":339,"content":"                        )"},{"type":"DELETE","lineNumber":345,"oldContent":"                        // Header"},{"type":"DELETE","lineNumber":348,"oldContent":"                            style = MaterialTheme.typography.titleLarge,"},{"type":"DELETE","lineNumber":349,"oldContent":"                        )"},{"type":"DELETE","lineNumber":350,"oldContent":"                        // Parameter Controls"},{"type":"DELETE","lineNumber":351,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":352,"oldContent":"                            label = \"Line Spacing\","},{"type":"DELETE","lineNumber":353,"oldContent":"                            value = lineSpacing,"},{"type":"INSERT","lineNumber":343,"content":"                            Slider("},{"type":"INSERT","lineNumber":344,"content":"                                value = lineSpacing,"},{"type":"INSERT","lineNumber":345,"content":"                                onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":346,"content":"                                valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":347,"content":"                                steps = 17"},{"type":"INSERT","lineNumber":348,"content":"                            )"},{"type":"INSERT","lineNumber":349,"content":"                        }"},{"type":"INSERT","lineNumber":350,"content":""},{"type":"INSERT","lineNumber":351,"content":"                        Column {"},{"type":"DELETE","lineNumber":355,"oldContent":"                            onValueChange = { lineSpacing = it },"},{"type":"DELETE","lineNumber":356,"oldContent":"                            valueRange = 10f..100f,"},{"type":"DELETE","lineNumber":357,"oldContent":"                            steps = 17,"},{"type":"DELETE","lineNumber":358,"oldContent":"                            unit = \"m\","},{"type":"DELETE","lineNumber":359,"oldContent":"                            description = \"Distance between survey lines\""},{"type":"DELETE","lineNumber":360,"oldContent":"                        )"},{"type":"DELETE","lineNumber":361,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":362,"oldContent":"                            label = \"Grid Angle\","},{"type":"DELETE","lineNumber":363,"oldContent":"                            value = gridAngle,"},{"type":"INSERT","lineNumber":353,"content":"                            Slider("},{"type":"INSERT","lineNumber":354,"content":"                                value = gridAngle,"},{"type":"INSERT","lineNumber":355,"content":"                                onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":356,"content":"                                valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":357,"content":"                                steps = 35"},{"type":"INSERT","lineNumber":358,"content":"                            )"},{"type":"INSERT","lineNumber":359,"content":"                        }"},{"type":"INSERT","lineNumber":360,"content":""},{"type":"INSERT","lineNumber":361,"content":"                        Column {"},{"type":"DELETE","lineNumber":365,"oldContent":"                            onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":366,"oldContent":"                            valueRange = 0f..180f,"},{"type":"DELETE","lineNumber":367,"oldContent":"                            steps = 35,"},{"type":"DELETE","lineNumber":368,"oldContent":"                            unit = \"°\","},{"type":"DELETE","lineNumber":369,"oldContent":"                            description = \"Survey line direction\""},{"type":"DELETE","lineNumber":370,"oldContent":"                        )"},{"type":"DELETE","lineNumber":371,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":372,"oldContent":"                            label = \"Survey Speed\","},{"type":"DELETE","lineNumber":373,"oldContent":"                            value = surveySpeed,"},{"type":"INSERT","lineNumber":363,"content":"                            Slider("},{"type":"INSERT","lineNumber":364,"content":"                                value = surveySpeed,"},{"type":"INSERT","lineNumber":365,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":366,"content":"                                valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":367,"content":"                                steps = 18"},{"type":"INSERT","lineNumber":368,"content":"                            )"},{"type":"INSERT","lineNumber":369,"content":"                        }"},{"type":"INSERT","lineNumber":370,"content":""},{"type":"INSERT","lineNumber":371,"content":"                        Column {"},{"type":"DELETE","lineNumber":375,"oldContent":"                            onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":376,"oldContent":"                            valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":377,"oldContent":"                            steps = 18,"},{"type":"DELETE","lineNumber":378,"oldContent":"                            unit = \"m/s\","},{"type":"DELETE","lineNumber":379,"oldContent":"                            description = \"Flight speed during survey\""},{"type":"DELETE","lineNumber":380,"oldContent":"                        )"},{"type":"DELETE","lineNumber":381,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":382,"oldContent":"                            label = \"Survey Altitude\","},{"type":"DELETE","lineNumber":383,"oldContent":"                            value = surveyAltitude,"},{"type":"DELETE","lineNumber":384,"oldContent":"                            onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":373,"content":"                            Slider("},{"type":"INSERT","lineNumber":374,"content":"                                value = surveyAltitude,"},{"type":"INSERT","lineNumber":375,"content":"                                onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":376,"content":"                                valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":377,"content":"                                steps = 21"},{"type":"INSERT","lineNumber":378,"content":"                            )"},{"type":"INSERT","lineNumber":379,"content":"                        }"},{"type":"INSERT","lineNumber":380,"content":""},{"type":"INSERT","lineNumber":381,"content":"                        gridResult?.let { result ->"},{"type":"DELETE","lineNumber":386,"oldContent":"                            valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":388,"oldContent":"                            steps = 21,"},{"type":"DELETE","lineNumber":389,"oldContent":"                            unit = \"m\","},{"type":"DELETE","lineNumber":390,"oldContent":"                            description = \"Flight altitude above home\""},{"type":"DELETE","lineNumber":391,"oldContent":"                        )"},{"type":"DELETE","lineNumber":392,"oldContent":"                        // Grid Statistics"},{"type":"INSERT","lineNumber":384,"content":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":385,"content":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":386,"content":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":387,"content":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":388,"content":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":389,"content":"                            }"},{"type":"INSERT","lineNumber":390,"content":"                        }"},{"type":"DELETE","lineNumber":394,"oldContent":"                            HorizontalDivider("},{"type":"DELETE","lineNumber":395,"oldContent":"                                color = Color.White.copy(alpha = 0.3f), "},{"type":"DELETE","lineNumber":397,"oldContent":"                                thickness = 1.dp,"},{"type":"DELETE","lineNumber":399,"oldContent":"                                modifier = Modifier.padding(vertical = 8.dp)"},{"type":"INSERT","lineNumber":395,"content":"                                color = Color.Yellow,"},{"type":"INSERT","lineNumber":396,"content":"                                style = MaterialTheme.typography.bodySmall"},{"type":"DELETE","lineNumber":402,"oldContent":"                            "},{"type":"DELETE","lineNumber":403,"oldContent":"                            Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {"},{"type":"DELETE","lineNumber":404,"oldContent":"                                Text("},{"type":"DELETE","lineNumber":405,"oldContent":"                                    \"Grid Statistics\","},{"type":"DELETE","lineNumber":406,"oldContent":"                                    style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":398,"content":"                        }"},{"type":"INSERT","lineNumber":399,"content":""},{"type":"DELETE","lineNumber":408,"oldContent":"                                    color = Color.White,"},{"type":"DELETE","lineNumber":410,"oldContent":"                                    fontWeight = FontWeight.Bold"},{"type":"DELETE","lineNumber":412,"oldContent":"                                )"},{"type":"DELETE","lineNumber":414,"oldContent":"                                "},{"type":"DELETE","lineNumber":415,"oldContent":"                                GridStatItem(\"Waypoints\", \"${result.waypoints.size}\")"},{"type":"INSERT","lineNumber":404,"content":"                            Button("},{"type":"DELETE","lineNumber":417,"oldContent":"                                GridStatItem(\"Survey Lines\", \"${result.numLines}\")"},{"type":"DELETE","lineNumber":418,"oldContent":"                                GridStatItem(\"Total Distance\", String.format(Locale.US, \"%.2f km\", result.totalDistance / 1000))"},{"type":"INSERT","lineNumber":406,"content":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":420,"oldContent":"                                GridStatItem(\"Estimated Time\", String.format(Locale.US, \"%.1f min\", result.estimatedTime / 60))"},{"type":"INSERT","lineNumber":409,"content":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":423,"oldContent":"                        // Instructions"},{"type":"INSERT","lineNumber":411,"content":""},{"type":"DELETE","lineNumber":426,"oldContent":"                            Card("},{"type":"DELETE","lineNumber":428,"oldContent":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"DELETE","lineNumber":430,"oldContent":"                                colors = CardDefaults.cardColors(containerColor = Color(0xFF2D5016).copy(alpha = 0.8f)),"},{"type":"DELETE","lineNumber":432,"oldContent":"                                shape = RoundedCornerShape(8.dp)"},{"type":"DELETE","lineNumber":434,"oldContent":"                            ) {"},{"type":"DELETE","lineNumber":436,"oldContent":"                                Text("},{"type":"DELETE","lineNumber":438,"oldContent":"                                    \"📍 Tap map to add polygon vertices\\n(need ${3 - surveyPolygon.size} more points)\","},{"type":"DELETE","lineNumber":439,"oldContent":"                                    color = Color(0xFFAED581),"},{"type":"DELETE","lineNumber":440,"oldContent":"                                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":442,"oldContent":"                                    modifier = Modifier.padding(12.dp),"},{"type":"DELETE","lineNumber":443,"oldContent":"                                    fontWeight = FontWeight.Medium"},{"type":"INSERT","lineNumber":421,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":422,"content":"                            }"},{"type":"INSERT","lineNumber":423,"content":"                        }"},{"type":"DELETE","lineNumber":445,"oldContent":"                                )"},{"type":"INSERT","lineNumber":425,"content":"                }"},{"type":"DELETE","lineNumber":447,"oldContent":"                            }"},{"type":"DELETE","lineNumber":449,"oldContent":"            // Upload button"},{"type":"DELETE","lineNumber":450,"oldContent":"                        // Action Buttons"},{"type":"DELETE","lineNumber":454,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":457,"oldContent":"                            OutlinedButton("},{"type":"DELETE","lineNumber":461,"oldContent":"                                enabled = surveyPolygon.isNotEmpty(),"},{"type":"DELETE","lineNumber":463,"oldContent":"                                colors = ButtonDefaults.outlinedButtonColors("},{"type":"DELETE","lineNumber":465,"oldContent":"                                    contentColor = Color.White"},{"type":"DELETE","lineNumber":467,"oldContent":"                                ),"},{"type":"DELETE","lineNumber":469,"oldContent":"                                border = ButtonDefaults.outlinedButtonBorder.copy("},{"type":"DELETE","lineNumber":471,"oldContent":"                                    brush = androidx.compose.ui.graphics.SolidColor(Color.White.copy(alpha = 0.5f))"},{"type":"DELETE","lineNumber":473,"oldContent":"                                )"},{"type":"DELETE","lineNumber":476,"oldContent":"                                Text(\"Clear\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":487,"oldContent":"                                enabled = surveyPolygon.size >= 3,"},{"type":"DELETE","lineNumber":489,"oldContent":"                                colors = ButtonDefaults.buttonColors("},{"type":"DELETE","lineNumber":491,"oldContent":"                                    containerColor = MaterialTheme.colorScheme.primary"},{"type":"DELETE","lineNumber":493,"oldContent":"                                )"},{"type":"DELETE","lineNumber":495,"oldContent":"                            }"},{"type":"INSERT","lineNumber":458,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":459,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":460,"content":"                    }"},{"type":"INSERT","lineNumber":461,"content":"                } else {"},{"type":"DELETE","lineNumber":497,"oldContent":"                                Text(\"Auto Angle\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":499,"oldContent":"                }"},{"type":"INSERT","lineNumber":470,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":472,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":529,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":531,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":533,"oldContent":"                    }"},{"type":"DELETE","lineNumber":535,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":545,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":548,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":522,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":569,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691539389,"changes":[{"type":"MODIFY","lineNumber":34,"content":"fun PlanScreen(","oldContent":"fun PlanScreen("},{"type":"MODIFY","lineNumber":71,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":131,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()","oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"MODIFY","lineNumber":149,"content":"                            if (isGridSurveyMode) {","oldContent":"                            if (isGridSurveyMode) {"},{"type":"MODIFY","lineNumber":163,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":166,"content":"                            if (isGridSurveyMode) {","oldContent":"                            if (isGridSurveyMode) {"},{"type":"MODIFY","lineNumber":183,"content":"                    FloatingActionButton(","oldContent":"                    FloatingActionButton("},{"type":"MODIFY","lineNumber":196,"content":"                    }","oldContent":"                    }"},{"type":"MODIFY","lineNumber":199,"content":"                FloatingActionButton(","oldContent":"                FloatingActionButton("},{"type":"MODIFY","lineNumber":210,"content":"            GcsMap(","oldContent":"            GcsMap("},{"type":"MODIFY","lineNumber":213,"content":"                onMapClick = onMapClick,","oldContent":"                onMapClick = onMapClick,"},{"type":"MODIFY","lineNumber":221,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":226,"content":"                    .padding(12.dp)","oldContent":"                    .padding(12.dp)"},{"type":"MODIFY","lineNumber":237,"content":"                )","oldContent":"                )"},{"type":"DELETE","lineNumber":248,"oldContent":"            ) {"},{"type":"MODIFY","lineNumber":250,"content":"            ) {","oldContent":"                Icon("},{"type":"INSERT","lineNumber":251,"content":"                Icon("},{"type":"DELETE","lineNumber":258,"oldContent":"            Column("},{"type":"MODIFY","lineNumber":260,"content":"            Column(","oldContent":"                modifier = Modifier"},{"type":"INSERT","lineNumber":261,"content":"                modifier = Modifier"},{"type":"MODIFY","lineNumber":267,"content":"                    onClick = {","oldContent":"                    onClick = {"},{"type":"MODIFY","lineNumber":272,"content":"                            waypoints.clear()","oldContent":"                            waypoints.clear()"},{"type":"INSERT","lineNumber":287,"content":""},{"type":"DELETE","lineNumber":289,"oldContent":""},{"type":"MODIFY","lineNumber":294,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)","oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"MODIFY","lineNumber":299,"content":"                    },","oldContent":"                    },"},{"type":"INSERT","lineNumber":302,"content":"                    Icon(Icons.Default.Refresh, contentDescription = \"Recenter\")"},{"type":"DELETE","lineNumber":303,"oldContent":"                }"},{"type":"MODIFY","lineNumber":318,"content":"            }","oldContent":"            }"},{"type":"DELETE","lineNumber":326,"oldContent":"                        .width(320.dp),"},{"type":"DELETE","lineNumber":327,"oldContent":"                    color = Color.Black.copy(alpha = 0.8f)"},{"type":"INSERT","lineNumber":326,"content":"                        .width(340.dp)"},{"type":"INSERT","lineNumber":327,"content":"                        .heightIn(max = 600.dp),"},{"type":"INSERT","lineNumber":328,"content":"                    shape = RoundedCornerShape(16.dp),"},{"type":"INSERT","lineNumber":329,"content":"                    color = Color.Black.copy(alpha = 0.85f),"},{"type":"INSERT","lineNumber":330,"content":"                    shadowElevation = 8.dp"},{"type":"DELETE","lineNumber":329,"oldContent":"                    shape = RoundedCornerShape(12.dp),"},{"type":"INSERT","lineNumber":332,"content":"                    val scrollState = rememberScrollState()"},{"type":"INSERT","lineNumber":333,"content":"                    "},{"type":"INSERT","lineNumber":335,"content":"                        modifier = Modifier"},{"type":"INSERT","lineNumber":336,"content":"                            .verticalScroll(scrollState)"},{"type":"INSERT","lineNumber":337,"content":"                            .padding(20.dp),"},{"type":"INSERT","lineNumber":338,"content":"                        verticalArrangement = Arrangement.spacedBy(16.dp)"},{"type":"DELETE","lineNumber":332,"oldContent":"                        modifier = Modifier.padding(16.dp),"},{"type":"INSERT","lineNumber":340,"content":"                        // Header"},{"type":"DELETE","lineNumber":334,"oldContent":"                        verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":335,"oldContent":"                            fontWeight = FontWeight.Bold"},{"type":"DELETE","lineNumber":337,"oldContent":"                        )"},{"type":"DELETE","lineNumber":338,"oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":343,"content":"                            style = MaterialTheme.typography.titleLarge,"},{"type":"DELETE","lineNumber":340,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":341,"oldContent":"                                value = lineSpacing,"},{"type":"INSERT","lineNumber":345,"content":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":346,"content":"                        )"},{"type":"DELETE","lineNumber":343,"oldContent":"                                onValueChange = { lineSpacing = it },"},{"type":"DELETE","lineNumber":344,"oldContent":"                                valueRange = 10f..100f,"},{"type":"DELETE","lineNumber":345,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":346,"oldContent":"                                steps = 17"},{"type":"DELETE","lineNumber":347,"oldContent":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"DELETE","lineNumber":348,"oldContent":"                            )"},{"type":"DELETE","lineNumber":349,"oldContent":"                        }"},{"type":"INSERT","lineNumber":348,"content":"                        // Parameter Controls"},{"type":"INSERT","lineNumber":349,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":350,"content":"                            label = \"Line Spacing\","},{"type":"INSERT","lineNumber":351,"content":"                            value = lineSpacing,"},{"type":"INSERT","lineNumber":352,"content":"                            onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":353,"content":"                            valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":354,"content":"                            steps = 17,"},{"type":"INSERT","lineNumber":355,"content":"                            unit = \"m\","},{"type":"INSERT","lineNumber":356,"content":"                            description = \"Distance between survey lines\""},{"type":"INSERT","lineNumber":357,"content":"                        )"},{"type":"DELETE","lineNumber":351,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":352,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":353,"oldContent":"                                value = gridAngle,"},{"type":"DELETE","lineNumber":354,"oldContent":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"DELETE","lineNumber":355,"oldContent":"                                onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":356,"oldContent":"                                valueRange = 0f..180f,"},{"type":"DELETE","lineNumber":357,"oldContent":"                                steps = 35"},{"type":"DELETE","lineNumber":358,"oldContent":"                            )"},{"type":"MODIFY","lineNumber":359,"content":"                        GridParameterSlider(","oldContent":"                        }"},{"type":"INSERT","lineNumber":360,"content":"                            label = \"Grid Angle\","},{"type":"INSERT","lineNumber":361,"content":"                            value = gridAngle,"},{"type":"INSERT","lineNumber":362,"content":"                            onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":363,"content":"                            valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":364,"content":"                            steps = 35,"},{"type":"INSERT","lineNumber":365,"content":"                            unit = \"°\","},{"type":"INSERT","lineNumber":366,"content":"                            description = \"Survey line direction\""},{"type":"INSERT","lineNumber":367,"content":"                        )"},{"type":"DELETE","lineNumber":361,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":362,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":363,"oldContent":"                                value = surveySpeed,"},{"type":"DELETE","lineNumber":364,"oldContent":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"DELETE","lineNumber":365,"oldContent":"                                onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":366,"oldContent":"                                valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":367,"oldContent":"                                steps = 18"},{"type":"DELETE","lineNumber":368,"oldContent":"                            )"},{"type":"MODIFY","lineNumber":369,"content":"                        GridParameterSlider(","oldContent":"                        }"},{"type":"INSERT","lineNumber":370,"content":"                            label = \"Survey Speed\","},{"type":"INSERT","lineNumber":371,"content":"                            value = surveySpeed,"},{"type":"INSERT","lineNumber":372,"content":"                            onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":373,"content":"                            valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":374,"content":"                            steps = 18,"},{"type":"INSERT","lineNumber":375,"content":"                            unit = \"m/s\","},{"type":"INSERT","lineNumber":376,"content":"                            description = \"Flight speed during survey\""},{"type":"INSERT","lineNumber":377,"content":"                        )"},{"type":"DELETE","lineNumber":371,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":372,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":373,"oldContent":"                                value = surveyAltitude,"},{"type":"DELETE","lineNumber":374,"oldContent":"                            Text(\"Altitude: ${surveyAltitude.toInt()}m\", color = Color.White)"},{"type":"DELETE","lineNumber":375,"oldContent":"                                onValueChange = { surveyAltitude = it },"},{"type":"DELETE","lineNumber":376,"oldContent":"                                valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":377,"oldContent":"                                steps = 21"},{"type":"DELETE","lineNumber":378,"oldContent":"                            )"},{"type":"MODIFY","lineNumber":379,"content":"                        GridParameterSlider(","oldContent":"                        }"},{"type":"INSERT","lineNumber":380,"content":"                            label = \"Survey Altitude\","},{"type":"INSERT","lineNumber":381,"content":"                            value = surveyAltitude,"},{"type":"INSERT","lineNumber":382,"content":"                            onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":383,"content":"                            valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":384,"content":"                            steps = 21,"},{"type":"INSERT","lineNumber":385,"content":"                            unit = \"m\","},{"type":"INSERT","lineNumber":386,"content":"                            description = \"Flight altitude above home\""},{"type":"INSERT","lineNumber":387,"content":"                        )"},{"type":"INSERT","lineNumber":389,"content":"                        // Grid Statistics"},{"type":"DELETE","lineNumber":382,"oldContent":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":383,"oldContent":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":384,"oldContent":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"DELETE","lineNumber":385,"oldContent":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":386,"oldContent":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":387,"oldContent":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"DELETE","lineNumber":388,"oldContent":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":391,"content":"                            HorizontalDivider("},{"type":"INSERT","lineNumber":392,"content":"                                color = Color.White.copy(alpha = 0.3f), "},{"type":"INSERT","lineNumber":393,"content":"                                thickness = 1.dp,"},{"type":"INSERT","lineNumber":394,"content":"                                modifier = Modifier.padding(vertical = 8.dp)"},{"type":"INSERT","lineNumber":395,"content":"                            )"},{"type":"INSERT","lineNumber":396,"content":"                            "},{"type":"INSERT","lineNumber":397,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {"},{"type":"INSERT","lineNumber":398,"content":"                                Text("},{"type":"INSERT","lineNumber":399,"content":"                                    \"Grid Statistics\","},{"type":"INSERT","lineNumber":400,"content":"                                    style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":401,"content":"                                    color = Color.White,"},{"type":"INSERT","lineNumber":402,"content":"                                    fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":403,"content":"                                )"},{"type":"INSERT","lineNumber":404,"content":"                                "},{"type":"INSERT","lineNumber":405,"content":"                                GridStatItem(\"Waypoints\", \"${result.waypoints.size}\")"},{"type":"INSERT","lineNumber":406,"content":"                                GridStatItem(\"Survey Lines\", \"${result.numLines}\")"},{"type":"INSERT","lineNumber":407,"content":"                                GridStatItem(\"Total Distance\", String.format(Locale.US, \"%.2f km\", result.totalDistance / 1000))"},{"type":"INSERT","lineNumber":408,"content":"                                GridStatItem(\"Estimated Time\", String.format(Locale.US, \"%.1f min\", result.estimatedTime / 60))"},{"type":"DELETE","lineNumber":392,"oldContent":"                                color = Color.Yellow,"},{"type":"DELETE","lineNumber":393,"oldContent":"                                style = MaterialTheme.typography.bodySmall"},{"type":"INSERT","lineNumber":412,"content":"                        // Instructions"},{"type":"INSERT","lineNumber":414,"content":"                            Card("},{"type":"INSERT","lineNumber":415,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":416,"content":"                                colors = CardDefaults.cardColors(containerColor = Color(0xFF2D5016).copy(alpha = 0.8f)),"},{"type":"INSERT","lineNumber":417,"content":"                                shape = RoundedCornerShape(8.dp)"},{"type":"INSERT","lineNumber":418,"content":"                            ) {"},{"type":"INSERT","lineNumber":419,"content":"                                Text("},{"type":"INSERT","lineNumber":420,"content":"                                    \"📍 Tap map to add polygon vertices\\n(need ${3 - surveyPolygon.size} more points)\","},{"type":"INSERT","lineNumber":421,"content":"                                    color = Color(0xFFAED581),"},{"type":"INSERT","lineNumber":422,"content":"                                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":423,"content":"                                    modifier = Modifier.padding(12.dp),"},{"type":"INSERT","lineNumber":424,"content":"                                    fontWeight = FontWeight.Medium"},{"type":"INSERT","lineNumber":425,"content":"                                )"},{"type":"INSERT","lineNumber":426,"content":"                            }"},{"type":"DELETE","lineNumber":396,"oldContent":"                            Text("},{"type":"DELETE","lineNumber":398,"oldContent":"                                \"Tap map to add polygon vertices (need ${3 - surveyPolygon.size} more)\","},{"type":"DELETE","lineNumber":399,"oldContent":"                            )"},{"type":"DELETE","lineNumber":400,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":401,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":429,"content":"                        // Action Buttons"},{"type":"DELETE","lineNumber":403,"oldContent":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":405,"oldContent":""},{"type":"DELETE","lineNumber":406,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"INSERT","lineNumber":432,"content":"                            horizontalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"INSERT","lineNumber":434,"content":"                            OutlinedButton("},{"type":"DELETE","lineNumber":409,"oldContent":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"DELETE","lineNumber":410,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":436,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":437,"content":"                                enabled = surveyPolygon.isNotEmpty(),"},{"type":"INSERT","lineNumber":438,"content":"                                colors = ButtonDefaults.outlinedButtonColors("},{"type":"INSERT","lineNumber":439,"content":"                                    contentColor = Color.White"},{"type":"INSERT","lineNumber":440,"content":"                                ),"},{"type":"INSERT","lineNumber":441,"content":"                                border = ButtonDefaults.outlinedButtonBorder.copy("},{"type":"INSERT","lineNumber":442,"content":"                                    brush = androidx.compose.ui.graphics.SolidColor(Color.White.copy(alpha = 0.5f))"},{"type":"INSERT","lineNumber":443,"content":"                                )"},{"type":"INSERT","lineNumber":445,"content":"                                Text(\"Clear\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":413,"oldContent":"                            }"},{"type":"DELETE","lineNumber":414,"oldContent":"                        }"},{"type":"INSERT","lineNumber":447,"content":""},{"type":"DELETE","lineNumber":416,"oldContent":"                }"},{"type":"DELETE","lineNumber":423,"oldContent":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":455,"content":"                                enabled = surveyPolygon.size >= 3,"},{"type":"INSERT","lineNumber":456,"content":"                                colors = ButtonDefaults.buttonColors("},{"type":"INSERT","lineNumber":457,"content":"                                    containerColor = MaterialTheme.colorScheme.primary"},{"type":"INSERT","lineNumber":458,"content":"                                )"},{"type":"INSERT","lineNumber":460,"content":"                                Text(\"Auto Angle\", fontWeight = FontWeight.Medium)"},{"type":"INSERT","lineNumber":461,"content":"                            }"},{"type":"INSERT","lineNumber":462,"content":"                        }"},{"type":"INSERT","lineNumber":464,"content":"                }"},{"type":"INSERT","lineNumber":467,"content":"            // Upload button"},{"type":"DELETE","lineNumber":433,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":435,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":437,"oldContent":"                    }"},{"type":"DELETE","lineNumber":439,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":444,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":446,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":498,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":499,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":500,"content":"                    }"},{"type":"INSERT","lineNumber":501,"content":"                } else {"},{"type":"INSERT","lineNumber":510,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":512,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":488,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":562,"content":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691562061,"changes":[{"type":"INSERT","lineNumber":5,"content":"import androidx.compose.foundation.verticalScroll"},{"type":"INSERT","lineNumber":6,"content":"import androidx.compose.foundation.rememberScrollState"},{"type":"INSERT","lineNumber":35,"content":"@Composable"},{"type":"DELETE","lineNumber":34,"oldContent":"fun PlanScreen("},{"type":"INSERT","lineNumber":72,"content":"    val coroutineScope = rememberCoroutineScope()"},{"type":"DELETE","lineNumber":71,"oldContent":""},{"type":"INSERT","lineNumber":132,"content":"            waypoints.add(item)"},{"type":"DELETE","lineNumber":131,"oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":150,"content":"                            val center = cameraPositionState.position.target"},{"type":"DELETE","lineNumber":149,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":164,"content":"                    }"},{"type":"DELETE","lineNumber":163,"oldContent":""},{"type":"INSERT","lineNumber":167,"content":"                        onClick = {"},{"type":"DELETE","lineNumber":166,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":184,"content":""},{"type":"DELETE","lineNumber":183,"oldContent":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":197,"content":"                        Icon(Icons.Default.ClearAll, contentDescription = \"Clear All\")"},{"type":"DELETE","lineNumber":196,"oldContent":"                    }"},{"type":"INSERT","lineNumber":200,"content":""},{"type":"DELETE","lineNumber":199,"oldContent":"                FloatingActionButton("},{"type":"INSERT","lineNumber":211,"content":"            // Map"},{"type":"DELETE","lineNumber":210,"oldContent":"            GcsMap("},{"type":"INSERT","lineNumber":214,"content":"                points = if (isGridSurveyMode) emptyList() else points,"},{"type":"DELETE","lineNumber":213,"oldContent":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":222,"content":"            )"},{"type":"DELETE","lineNumber":221,"oldContent":""},{"type":"INSERT","lineNumber":227,"content":"                    .align(Alignment.TopEnd)"},{"type":"DELETE","lineNumber":226,"oldContent":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":238,"content":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"DELETE","lineNumber":237,"oldContent":"                )"},{"type":"INSERT","lineNumber":251,"content":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":251,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"INSERT","lineNumber":261,"content":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":261,"oldContent":"            // Left sidebar buttons"},{"type":"INSERT","lineNumber":268,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":267,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":273,"content":"                            points.clear()"},{"type":"DELETE","lineNumber":272,"oldContent":"                            waypoints.clear()"},{"type":"INSERT","lineNumber":295,"content":"                            cameraPositionState.move("},{"type":"DELETE","lineNumber":294,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"INSERT","lineNumber":300,"content":"                        }"},{"type":"DELETE","lineNumber":299,"oldContent":"                    },"},{"type":"INSERT","lineNumber":319,"content":"                }"},{"type":"DELETE","lineNumber":318,"oldContent":"            }"},{"type":"DELETE","lineNumber":326,"oldContent":"                        .width(340.dp)"},{"type":"DELETE","lineNumber":327,"oldContent":"                        .heightIn(max = 600.dp),"},{"type":"MODIFY","lineNumber":328,"content":"                        .width(320.dp),","oldContent":"                    shape = RoundedCornerShape(16.dp),"},{"type":"INSERT","lineNumber":329,"content":"                    shape = RoundedCornerShape(12.dp),"},{"type":"INSERT","lineNumber":330,"content":"                    color = Color.Black.copy(alpha = 0.8f)"},{"type":"DELETE","lineNumber":330,"oldContent":"                    color = Color.Black.copy(alpha = 0.85f),"},{"type":"DELETE","lineNumber":331,"oldContent":"                    shadowElevation = 8.dp"},{"type":"INSERT","lineNumber":333,"content":"                        modifier = Modifier.padding(16.dp),"},{"type":"INSERT","lineNumber":334,"content":"                        verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":334,"oldContent":"                    val scrollState = rememberScrollState()"},{"type":"DELETE","lineNumber":335,"oldContent":"                    "},{"type":"DELETE","lineNumber":337,"oldContent":"                        modifier = Modifier"},{"type":"DELETE","lineNumber":338,"oldContent":"                            .verticalScroll(scrollState)"},{"type":"DELETE","lineNumber":340,"oldContent":"                            .padding(20.dp),"},{"type":"DELETE","lineNumber":341,"oldContent":"                        verticalArrangement = Arrangement.spacedBy(16.dp)"},{"type":"INSERT","lineNumber":338,"content":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"DELETE","lineNumber":343,"oldContent":"                        // Header"},{"type":"DELETE","lineNumber":344,"oldContent":""},{"type":"DELETE","lineNumber":345,"oldContent":"                            style = MaterialTheme.typography.titleLarge,"},{"type":"DELETE","lineNumber":348,"oldContent":"                        // Parameter Controls"},{"type":"DELETE","lineNumber":349,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":350,"oldContent":"                            label = \"Line Spacing\","},{"type":"DELETE","lineNumber":352,"oldContent":"                            value = lineSpacing,"},{"type":"DELETE","lineNumber":353,"oldContent":"                            onValueChange = { lineSpacing = it },"},{"type":"DELETE","lineNumber":354,"oldContent":"                            valueRange = 10f..100f,"},{"type":"DELETE","lineNumber":355,"oldContent":"                            steps = 17,"},{"type":"DELETE","lineNumber":356,"oldContent":"                            unit = \"m\","},{"type":"DELETE","lineNumber":357,"oldContent":"                            description = \"Distance between survey lines\""},{"type":"DELETE","lineNumber":358,"oldContent":"                        )"},{"type":"DELETE","lineNumber":359,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":360,"oldContent":"                            label = \"Grid Angle\","},{"type":"INSERT","lineNumber":343,"content":"                        Column {"},{"type":"INSERT","lineNumber":344,"content":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"INSERT","lineNumber":345,"content":"                            Slider("},{"type":"INSERT","lineNumber":346,"content":"                                value = lineSpacing,"},{"type":"INSERT","lineNumber":347,"content":"                                onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":348,"content":"                                valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":349,"content":"                                steps = 17"},{"type":"INSERT","lineNumber":350,"content":"                            )"},{"type":"INSERT","lineNumber":351,"content":"                        }"},{"type":"DELETE","lineNumber":362,"oldContent":"                            value = gridAngle,"},{"type":"DELETE","lineNumber":363,"oldContent":"                            onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":364,"oldContent":"                            valueRange = 0f..180f,"},{"type":"DELETE","lineNumber":365,"oldContent":"                            steps = 35,"},{"type":"DELETE","lineNumber":366,"oldContent":"                            unit = \"°\","},{"type":"DELETE","lineNumber":367,"oldContent":"                            description = \"Survey line direction\""},{"type":"DELETE","lineNumber":368,"oldContent":"                        )"},{"type":"DELETE","lineNumber":369,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":370,"oldContent":"                            label = \"Survey Speed\","},{"type":"INSERT","lineNumber":353,"content":"                        Column {"},{"type":"INSERT","lineNumber":354,"content":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"INSERT","lineNumber":355,"content":"                            Slider("},{"type":"INSERT","lineNumber":356,"content":"                                value = gridAngle,"},{"type":"INSERT","lineNumber":357,"content":"                                onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":358,"content":"                                valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":359,"content":"                                steps = 35"},{"type":"INSERT","lineNumber":360,"content":"                            )"},{"type":"INSERT","lineNumber":361,"content":"                        }"},{"type":"DELETE","lineNumber":372,"oldContent":"                            value = surveySpeed,"},{"type":"DELETE","lineNumber":373,"oldContent":"                            onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":374,"oldContent":"                            valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":375,"oldContent":"                            steps = 18,"},{"type":"DELETE","lineNumber":376,"oldContent":"                            unit = \"m/s\","},{"type":"DELETE","lineNumber":377,"oldContent":"                            description = \"Flight speed during survey\""},{"type":"DELETE","lineNumber":378,"oldContent":"                        )"},{"type":"DELETE","lineNumber":379,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":380,"oldContent":"                            label = \"Survey Altitude\","},{"type":"INSERT","lineNumber":363,"content":"                        Column {"},{"type":"INSERT","lineNumber":364,"content":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"INSERT","lineNumber":365,"content":"                            Slider("},{"type":"INSERT","lineNumber":366,"content":"                                value = surveySpeed,"},{"type":"INSERT","lineNumber":367,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":368,"content":"                                valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":369,"content":"                                steps = 18"},{"type":"INSERT","lineNumber":370,"content":"                            )"},{"type":"INSERT","lineNumber":371,"content":"                        }"},{"type":"DELETE","lineNumber":382,"oldContent":"                            value = surveyAltitude,"},{"type":"INSERT","lineNumber":373,"content":"                        Column {"},{"type":"INSERT","lineNumber":374,"content":"                            Text(\"Altitude: ${surveyAltitude.toInt()}m\", color = Color.White)"},{"type":"INSERT","lineNumber":375,"content":"                            Slider("},{"type":"INSERT","lineNumber":376,"content":"                                value = surveyAltitude,"},{"type":"INSERT","lineNumber":377,"content":"                                onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":378,"content":"                                valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":379,"content":"                                steps = 21"},{"type":"INSERT","lineNumber":380,"content":"                            )"},{"type":"INSERT","lineNumber":381,"content":"                        }"},{"type":"INSERT","lineNumber":382,"content":""},{"type":"DELETE","lineNumber":384,"oldContent":"                            onValueChange = { surveyAltitude = it },"},{"type":"DELETE","lineNumber":385,"oldContent":"                            valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":386,"oldContent":"                            steps = 21,"},{"type":"DELETE","lineNumber":387,"oldContent":"                            unit = \"m\","},{"type":"DELETE","lineNumber":388,"oldContent":"                            description = \"Flight altitude above home\""},{"type":"DELETE","lineNumber":389,"oldContent":"                        )"},{"type":"DELETE","lineNumber":390,"oldContent":"                        // Grid Statistics"},{"type":"INSERT","lineNumber":384,"content":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":385,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"INSERT","lineNumber":386,"content":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":387,"content":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":388,"content":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":389,"content":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":390,"content":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":393,"oldContent":"                            HorizontalDivider("},{"type":"DELETE","lineNumber":395,"oldContent":"                                color = Color.White.copy(alpha = 0.3f), "},{"type":"DELETE","lineNumber":396,"oldContent":"                                thickness = 1.dp,"},{"type":"DELETE","lineNumber":397,"oldContent":"                                modifier = Modifier.padding(vertical = 8.dp)"},{"type":"INSERT","lineNumber":395,"content":"                            Text("},{"type":"INSERT","lineNumber":396,"content":"                                \"Tap map to add polygon vertices (need ${3 - surveyPolygon.size} more)\","},{"type":"INSERT","lineNumber":397,"content":"                                color = Color.Yellow,"},{"type":"INSERT","lineNumber":398,"content":"                                style = MaterialTheme.typography.bodySmall"},{"type":"DELETE","lineNumber":401,"oldContent":"                            "},{"type":"DELETE","lineNumber":402,"oldContent":"                            Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {"},{"type":"DELETE","lineNumber":404,"oldContent":"                                Text("},{"type":"DELETE","lineNumber":405,"oldContent":"                                    \"Grid Statistics\","},{"type":"DELETE","lineNumber":406,"oldContent":"                                    style = MaterialTheme.typography.titleMedium,"},{"type":"DELETE","lineNumber":407,"oldContent":"                                    color = Color.White,"},{"type":"DELETE","lineNumber":408,"oldContent":"                                    fontWeight = FontWeight.Bold"},{"type":"DELETE","lineNumber":410,"oldContent":"                                )"},{"type":"DELETE","lineNumber":411,"oldContent":"                                "},{"type":"DELETE","lineNumber":413,"oldContent":"                                GridStatItem(\"Waypoints\", \"${result.waypoints.size}\")"},{"type":"DELETE","lineNumber":414,"oldContent":"                                GridStatItem(\"Survey Lines\", \"${result.numLines}\")"},{"type":"DELETE","lineNumber":415,"oldContent":"                                GridStatItem(\"Total Distance\", String.format(Locale.US, \"%.2f km\", result.totalDistance / 1000))"},{"type":"INSERT","lineNumber":404,"content":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":417,"oldContent":"                                GridStatItem(\"Estimated Time\", String.format(Locale.US, \"%.1f min\", result.estimatedTime / 60))"},{"type":"INSERT","lineNumber":406,"content":"                            Button("},{"type":"INSERT","lineNumber":408,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":409,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"DELETE","lineNumber":420,"oldContent":"                        // Instructions"},{"type":"INSERT","lineNumber":411,"content":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":422,"oldContent":"                            Card("},{"type":"DELETE","lineNumber":423,"oldContent":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":413,"content":""},{"type":"DELETE","lineNumber":425,"oldContent":"                                colors = CardDefaults.cardColors(containerColor = Color(0xFF2D5016).copy(alpha = 0.8f)),"},{"type":"DELETE","lineNumber":426,"oldContent":"                                shape = RoundedCornerShape(8.dp)"},{"type":"DELETE","lineNumber":428,"oldContent":"                            ) {"},{"type":"DELETE","lineNumber":430,"oldContent":"                                Text("},{"type":"DELETE","lineNumber":432,"oldContent":"                                    \"📍 Tap map to add polygon vertices\\n(need ${3 - surveyPolygon.size} more points)\","},{"type":"DELETE","lineNumber":434,"oldContent":"                                    color = Color(0xFFAED581),"},{"type":"DELETE","lineNumber":436,"oldContent":"                                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":438,"oldContent":"                                    modifier = Modifier.padding(12.dp),"},{"type":"DELETE","lineNumber":439,"oldContent":"                                    fontWeight = FontWeight.Medium"},{"type":"INSERT","lineNumber":421,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"DELETE","lineNumber":441,"oldContent":"                                )"},{"type":"DELETE","lineNumber":442,"oldContent":"                    }"},{"type":"INSERT","lineNumber":423,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":425,"content":"                        }"},{"type":"INSERT","lineNumber":426,"content":"                    }"},{"type":"INSERT","lineNumber":427,"content":"                }"},{"type":"INSERT","lineNumber":430,"content":"            // Upload button"},{"type":"DELETE","lineNumber":447,"oldContent":"                        // Action Buttons"},{"type":"DELETE","lineNumber":451,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":453,"oldContent":"                            OutlinedButton("},{"type":"DELETE","lineNumber":455,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":457,"oldContent":"                                enabled = surveyPolygon.isNotEmpty(),"},{"type":"DELETE","lineNumber":458,"oldContent":"                                colors = ButtonDefaults.outlinedButtonColors("},{"type":"DELETE","lineNumber":460,"oldContent":"                                    contentColor = Color.White"},{"type":"DELETE","lineNumber":461,"oldContent":"                                ),"},{"type":"DELETE","lineNumber":463,"oldContent":"                                border = ButtonDefaults.outlinedButtonBorder.copy("},{"type":"DELETE","lineNumber":465,"oldContent":"                                    brush = androidx.compose.ui.graphics.SolidColor(Color.White.copy(alpha = 0.5f))"},{"type":"DELETE","lineNumber":467,"oldContent":"                                )"},{"type":"DELETE","lineNumber":469,"oldContent":"                                Text(\"Clear\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":472,"oldContent":""},{"type":"DELETE","lineNumber":480,"oldContent":"                                enabled = surveyPolygon.size >= 3,"},{"type":"DELETE","lineNumber":482,"oldContent":"                                colors = ButtonDefaults.buttonColors("},{"type":"DELETE","lineNumber":484,"oldContent":"                                    containerColor = MaterialTheme.colorScheme.primary"},{"type":"DELETE","lineNumber":486,"oldContent":"                                )"},{"type":"DELETE","lineNumber":489,"oldContent":"                                Text(\"Auto Angle\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":491,"oldContent":"                            }"},{"type":"DELETE","lineNumber":493,"oldContent":"                        }"},{"type":"DELETE","lineNumber":496,"oldContent":"                }"},{"type":"INSERT","lineNumber":461,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":462,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":463,"content":"                    }"},{"type":"INSERT","lineNumber":464,"content":"                } else {"},{"type":"DELETE","lineNumber":500,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":473,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":475,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":531,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":533,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":535,"oldContent":"                    }"},{"type":"DELETE","lineNumber":537,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":547,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":550,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":525,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":569,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691592810,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"import androidx.compose.foundation.verticalScroll"},{"type":"DELETE","lineNumber":7,"oldContent":"import androidx.compose.foundation.rememberScrollState"},{"type":"MODIFY","lineNumber":34,"content":"fun PlanScreen(","oldContent":"fun PlanScreen("},{"type":"MODIFY","lineNumber":71,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":131,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()","oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"MODIFY","lineNumber":149,"content":"                            if (isGridSurveyMode) {","oldContent":"                            if (isGridSurveyMode) {"},{"type":"MODIFY","lineNumber":163,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":166,"content":"                            if (isGridSurveyMode) {","oldContent":"                            if (isGridSurveyMode) {"},{"type":"MODIFY","lineNumber":183,"content":"                    FloatingActionButton(","oldContent":"                    FloatingActionButton("},{"type":"MODIFY","lineNumber":196,"content":"                    }","oldContent":"                    }"},{"type":"MODIFY","lineNumber":199,"content":"                FloatingActionButton(","oldContent":"                FloatingActionButton("},{"type":"MODIFY","lineNumber":210,"content":"            GcsMap(","oldContent":"            GcsMap("},{"type":"MODIFY","lineNumber":213,"content":"                onMapClick = onMapClick,","oldContent":"                onMapClick = onMapClick,"},{"type":"MODIFY","lineNumber":221,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":226,"content":"                    .padding(12.dp)","oldContent":"                    .padding(12.dp)"},{"type":"MODIFY","lineNumber":237,"content":"                )","oldContent":"                )"},{"type":"INSERT","lineNumber":249,"content":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":253,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"INSERT","lineNumber":259,"content":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":263,"oldContent":"            // Left sidebar buttons"},{"type":"MODIFY","lineNumber":267,"content":"                    onClick = {","oldContent":"                    onClick = {"},{"type":"MODIFY","lineNumber":272,"content":"                            waypoints.clear()","oldContent":"                            waypoints.clear()"},{"type":"MODIFY","lineNumber":294,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)","oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"MODIFY","lineNumber":299,"content":"                    },","oldContent":"                    },"},{"type":"MODIFY","lineNumber":318,"content":"            }","oldContent":"            }"},{"type":"MODIFY","lineNumber":329,"content":"                ) {","oldContent":"                ) {"},{"type":"MODIFY","lineNumber":333,"content":"                    ) {","oldContent":"                    ) {"},{"type":"MODIFY","lineNumber":336,"content":"                            style = MaterialTheme.typography.titleMedium,","oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"DELETE","lineNumber":340,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":341,"oldContent":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"DELETE","lineNumber":342,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":343,"oldContent":"                                value = lineSpacing,"},{"type":"DELETE","lineNumber":345,"oldContent":"                                onValueChange = { lineSpacing = it },"},{"type":"DELETE","lineNumber":347,"oldContent":"                                valueRange = 10f..100f,"},{"type":"DELETE","lineNumber":348,"oldContent":"                                steps = 17"},{"type":"DELETE","lineNumber":349,"oldContent":"                            )"},{"type":"DELETE","lineNumber":350,"oldContent":"                        }"},{"type":"INSERT","lineNumber":342,"content":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"INSERT","lineNumber":343,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":344,"content":"                            label = \"Line Spacing\","},{"type":"INSERT","lineNumber":345,"content":"                            value = lineSpacing,"},{"type":"INSERT","lineNumber":346,"content":"                            onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":347,"content":"                            valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":348,"content":"                            steps = 17,"},{"type":"INSERT","lineNumber":349,"content":"                            unit = \"m\","},{"type":"INSERT","lineNumber":350,"content":"                            description = \"Distance between grid lines\""},{"type":"INSERT","lineNumber":351,"content":"                        )"},{"type":"DELETE","lineNumber":354,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":355,"oldContent":"                                value = gridAngle,"},{"type":"DELETE","lineNumber":356,"oldContent":"                                onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":357,"oldContent":"                                valueRange = 0f..180f,"},{"type":"DELETE","lineNumber":358,"oldContent":"                                steps = 35"},{"type":"DELETE","lineNumber":359,"oldContent":"                            )"},{"type":"DELETE","lineNumber":360,"oldContent":"                        }"},{"type":"DELETE","lineNumber":361,"oldContent":""},{"type":"DELETE","lineNumber":362,"oldContent":"                        Column {"},{"type":"INSERT","lineNumber":353,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":354,"content":"                            label = \"Grid Angle\","},{"type":"INSERT","lineNumber":355,"content":"                            value = gridAngle,"},{"type":"INSERT","lineNumber":356,"content":"                            onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":357,"content":"                            valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":358,"content":"                            steps = 35,"},{"type":"INSERT","lineNumber":359,"content":"                            unit = \"°\","},{"type":"INSERT","lineNumber":360,"content":"                            description = \"Angle of grid lines\""},{"type":"INSERT","lineNumber":361,"content":"                        )"},{"type":"DELETE","lineNumber":364,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":365,"oldContent":"                                value = surveySpeed,"},{"type":"DELETE","lineNumber":366,"oldContent":"                                onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":367,"oldContent":"                                valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":368,"oldContent":"                                steps = 18"},{"type":"DELETE","lineNumber":369,"oldContent":"                            )"},{"type":"DELETE","lineNumber":370,"oldContent":"                        }"},{"type":"DELETE","lineNumber":371,"oldContent":""},{"type":"DELETE","lineNumber":372,"oldContent":"                        Column {"},{"type":"INSERT","lineNumber":363,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":364,"content":"                            label = \"Speed\","},{"type":"INSERT","lineNumber":365,"content":"                            value = surveySpeed,"},{"type":"INSERT","lineNumber":366,"content":"                            onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":367,"content":"                            valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":368,"content":"                            steps = 18,"},{"type":"INSERT","lineNumber":369,"content":"                            unit = \"m/s\","},{"type":"INSERT","lineNumber":370,"content":"                            description = \"Survey speed\""},{"type":"INSERT","lineNumber":371,"content":"                        )"},{"type":"DELETE","lineNumber":374,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":375,"oldContent":"                                value = surveyAltitude,"},{"type":"DELETE","lineNumber":376,"oldContent":"                                onValueChange = { surveyAltitude = it },"},{"type":"DELETE","lineNumber":377,"oldContent":"                                valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":378,"oldContent":"                                steps = 21"},{"type":"DELETE","lineNumber":379,"oldContent":"                            )"},{"type":"DELETE","lineNumber":380,"oldContent":"                        }"},{"type":"DELETE","lineNumber":381,"oldContent":""},{"type":"DELETE","lineNumber":382,"oldContent":""},{"type":"DELETE","lineNumber":383,"oldContent":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":373,"content":"                        GridParameterSlider("},{"type":"INSERT","lineNumber":374,"content":"                            label = \"Altitude\","},{"type":"INSERT","lineNumber":375,"content":"                            value = surveyAltitude,"},{"type":"INSERT","lineNumber":376,"content":"                            onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":377,"content":"                            valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":378,"content":"                            steps = 21,"},{"type":"INSERT","lineNumber":379,"content":"                            unit = \"m\","},{"type":"INSERT","lineNumber":380,"content":"                            description = \"Survey altitude\""},{"type":"INSERT","lineNumber":381,"content":"                        )"},{"type":"DELETE","lineNumber":389,"oldContent":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":390,"oldContent":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":391,"oldContent":"                            }"},{"type":"DELETE","lineNumber":392,"oldContent":"                        }"},{"type":"INSERT","lineNumber":387,"content":"                                GridStatItem(\"Waypoints\", \"${result.waypoints.size}\")"},{"type":"INSERT","lineNumber":388,"content":"                                GridStatItem(\"Lines\", \"${result.numLines}\")"},{"type":"INSERT","lineNumber":389,"content":"                                GridStatItem(\"Distance\", \"${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)} km\")"},{"type":"INSERT","lineNumber":390,"content":"                                GridStatItem(\"Time\", \"${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)} min\")"},{"type":"INSERT","lineNumber":392,"content":"                        if (surveyPolygon.size < 3) {"},{"type":"DELETE","lineNumber":398,"oldContent":"                        if (surveyPolygon.size < 3) {"},{"type":"DELETE","lineNumber":402,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":403,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":404,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":405,"oldContent":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"DELETE","lineNumber":407,"oldContent":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":409,"oldContent":""},{"type":"INSERT","lineNumber":402,"content":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"INSERT","lineNumber":404,"content":"                            Button("},{"type":"INSERT","lineNumber":406,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":407,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"DELETE","lineNumber":413,"oldContent":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":409,"content":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":415,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":411,"content":""},{"type":"DELETE","lineNumber":417,"oldContent":"                        }"},{"type":"DELETE","lineNumber":418,"oldContent":"                    }"},{"type":"DELETE","lineNumber":419,"oldContent":"                }"},{"type":"DELETE","lineNumber":422,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":419,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":421,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":423,"content":"                        }"},{"type":"INSERT","lineNumber":424,"content":"                    }"},{"type":"INSERT","lineNumber":425,"content":"                }"},{"type":"INSERT","lineNumber":428,"content":"            // Upload button"},{"type":"DELETE","lineNumber":439,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":440,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":442,"oldContent":"                    }"},{"type":"DELETE","lineNumber":443,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":449,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":452,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":459,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":460,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":461,"content":"                    }"},{"type":"INSERT","lineNumber":462,"content":"                } else {"},{"type":"INSERT","lineNumber":471,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":473,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":494,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":523,"content":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691631945,"changes":[{"type":"INSERT","lineNumber":0,"content":"// Kotlin"},{"type":"DELETE","lineNumber":2,"oldContent":"import androidx.compose.foundation.layout.Column"},{"type":"DELETE","lineNumber":32,"oldContent":"fun PlanScreen("},{"type":"DELETE","lineNumber":33,"oldContent":"fun PlanScreen("},{"type":"INSERT","lineNumber":32,"content":"@Suppress(\"UnusedMaterial3ScaffoldPaddingParameter\")"},{"type":"INSERT","lineNumber":34,"content":"fun PlanScreen("},{"type":"DELETE","lineNumber":69,"oldContent":""},{"type":"DELETE","lineNumber":70,"oldContent":""},{"type":"INSERT","lineNumber":69,"content":"    val waypoints = remember { mutableStateListOf<MissionItemInt>() }"},{"type":"INSERT","lineNumber":71,"content":""},{"type":"DELETE","lineNumber":129,"oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":130,"oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":129,"content":"            points.add(latLng)"},{"type":"INSERT","lineNumber":131,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":147,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":148,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":147,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":149,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":161,"oldContent":""},{"type":"DELETE","lineNumber":162,"oldContent":""},{"type":"INSERT","lineNumber":161,"content":"                        Icon(Icons.Default.Add, contentDescription = \"Add at Crosshair\")"},{"type":"DELETE","lineNumber":164,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":165,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":163,"content":""},{"type":"INSERT","lineNumber":164,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":166,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":181,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":182,"oldContent":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":181,"content":"                    }"},{"type":"INSERT","lineNumber":183,"content":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":194,"oldContent":"                    }"},{"type":"DELETE","lineNumber":195,"oldContent":"                    }"},{"type":"INSERT","lineNumber":194,"content":"                    ) {"},{"type":"DELETE","lineNumber":197,"oldContent":"                FloatingActionButton("},{"type":"DELETE","lineNumber":198,"oldContent":"                FloatingActionButton("},{"type":"INSERT","lineNumber":196,"content":"                    }"},{"type":"INSERT","lineNumber":197,"content":"                }"},{"type":"INSERT","lineNumber":199,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":208,"oldContent":"            GcsMap("},{"type":"DELETE","lineNumber":209,"oldContent":"            GcsMap("},{"type":"INSERT","lineNumber":208,"content":"        Box(modifier = Modifier.fillMaxSize()) {"},{"type":"DELETE","lineNumber":211,"oldContent":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":212,"oldContent":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":210,"content":"            GcsMap("},{"type":"INSERT","lineNumber":211,"content":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":213,"content":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":219,"oldContent":""},{"type":"DELETE","lineNumber":220,"oldContent":""},{"type":"INSERT","lineNumber":219,"content":"                gridWaypoints = gridResult?.waypoints?.map { it.position } ?: emptyList()"},{"type":"INSERT","lineNumber":221,"content":""},{"type":"DELETE","lineNumber":224,"oldContent":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":225,"oldContent":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":224,"content":"                modifier = Modifier"},{"type":"INSERT","lineNumber":226,"content":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":235,"oldContent":"                )"},{"type":"DELETE","lineNumber":236,"oldContent":"                )"},{"type":"INSERT","lineNumber":235,"content":"                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":237,"content":"                )"},{"type":"DELETE","lineNumber":247,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"INSERT","lineNumber":249,"content":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":257,"oldContent":"            // Left sidebar buttons"},{"type":"INSERT","lineNumber":259,"content":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":265,"oldContent":"                    onClick = {"},{"type":"DELETE","lineNumber":266,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":265,"content":"            ) {"},{"type":"INSERT","lineNumber":267,"content":"                    onClick = {"},{"type":"DELETE","lineNumber":270,"oldContent":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":271,"oldContent":"                            waypoints.clear()"},{"type":"INSERT","lineNumber":270,"content":"                        if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":272,"content":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":292,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":293,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"INSERT","lineNumber":292,"content":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":294,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":297,"oldContent":"                    },"},{"type":"DELETE","lineNumber":298,"oldContent":"                    },"},{"type":"INSERT","lineNumber":297,"content":"                            Toast.makeText(context, \"No GPS location available\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":299,"content":"                    },"},{"type":"DELETE","lineNumber":316,"oldContent":"            }"},{"type":"DELETE","lineNumber":317,"oldContent":"            }"},{"type":"INSERT","lineNumber":316,"content":"                    Icon(Icons.Default.Map, contentDescription = \"Toggle Map\")"},{"type":"INSERT","lineNumber":318,"content":"            }"},{"type":"MODIFY","lineNumber":326,"content":"                        .width(340.dp)","oldContent":"                        .width(320.dp),"},{"type":"INSERT","lineNumber":327,"content":"                        .heightIn(max = 600.dp),"},{"type":"INSERT","lineNumber":328,"content":"                    shape = RoundedCornerShape(16.dp),"},{"type":"INSERT","lineNumber":329,"content":"                    color = Color.Black.copy(alpha = 0.85f),"},{"type":"INSERT","lineNumber":330,"content":"                    shadowElevation = 8.dp"},{"type":"DELETE","lineNumber":328,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":329,"oldContent":"                    color = Color.Black.copy(alpha = 0.8f)"},{"type":"INSERT","lineNumber":332,"content":"                    val scrollState = rememberScrollState()"},{"type":"INSERT","lineNumber":333,"content":"                    "},{"type":"INSERT","lineNumber":335,"content":"                        modifier = Modifier"},{"type":"INSERT","lineNumber":336,"content":"                            .verticalScroll(scrollState)"},{"type":"INSERT","lineNumber":337,"content":"                            .padding(20.dp),"},{"type":"INSERT","lineNumber":338,"content":"                        verticalArrangement = Arrangement.spacedBy(16.dp)"},{"type":"DELETE","lineNumber":332,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":333,"oldContent":"                        verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":334,"oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"DELETE","lineNumber":335,"oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":340,"content":"                        // Header"},{"type":"INSERT","lineNumber":341,"content":"                        Text("},{"type":"INSERT","lineNumber":343,"content":"                            style = MaterialTheme.typography.titleLarge,"},{"type":"DELETE","lineNumber":338,"oldContent":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"DELETE","lineNumber":339,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":340,"oldContent":"                            label = \"Line Spacing\","},{"type":"DELETE","lineNumber":342,"oldContent":"                            value = lineSpacing,"},{"type":"DELETE","lineNumber":343,"oldContent":"                            onValueChange = { lineSpacing = it },"},{"type":"DELETE","lineNumber":345,"oldContent":"                            valueRange = 10f..100f,"},{"type":"DELETE","lineNumber":346,"oldContent":"                            steps = 17,"},{"type":"DELETE","lineNumber":347,"oldContent":"                            unit = \"m\","},{"type":"DELETE","lineNumber":348,"oldContent":"                            description = \"Distance between grid lines\""},{"type":"DELETE","lineNumber":349,"oldContent":"                        )"},{"type":"INSERT","lineNumber":348,"content":"                        // Parameter Controls"},{"type":"INSERT","lineNumber":349,"content":"                            Slider("},{"type":"INSERT","lineNumber":350,"content":"                                value = lineSpacing,"},{"type":"INSERT","lineNumber":351,"content":"                                onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":352,"content":"                                valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":353,"content":"                                steps = 17"},{"type":"INSERT","lineNumber":354,"content":"                            )"},{"type":"INSERT","lineNumber":355,"content":"                        }"},{"type":"INSERT","lineNumber":356,"content":"                            description = \"Distance between survey lines\""},{"type":"DELETE","lineNumber":352,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":353,"oldContent":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"DELETE","lineNumber":354,"oldContent":"                            label = \"Grid Angle\","},{"type":"DELETE","lineNumber":355,"oldContent":"                            value = gridAngle,"},{"type":"DELETE","lineNumber":356,"oldContent":"                            onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":357,"oldContent":"                            valueRange = 0f..180f,"},{"type":"DELETE","lineNumber":358,"oldContent":"                            steps = 35,"},{"type":"DELETE","lineNumber":359,"oldContent":"                            unit = \"°\","},{"type":"DELETE","lineNumber":360,"oldContent":"                            description = \"Angle of grid lines\""},{"type":"DELETE","lineNumber":361,"oldContent":"                        )"},{"type":"DELETE","lineNumber":362,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":363,"oldContent":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"DELETE","lineNumber":364,"oldContent":"                            label = \"Speed\","},{"type":"DELETE","lineNumber":365,"oldContent":"                            value = surveySpeed,"},{"type":"DELETE","lineNumber":366,"oldContent":"                            onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":367,"oldContent":"                            valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":368,"oldContent":"                            steps = 18,"},{"type":"DELETE","lineNumber":369,"oldContent":"                            unit = \"m/s\","},{"type":"DELETE","lineNumber":370,"oldContent":"                            description = \"Survey speed\""},{"type":"DELETE","lineNumber":371,"oldContent":"                        )"},{"type":"DELETE","lineNumber":372,"oldContent":"                        GridParameterSlider("},{"type":"DELETE","lineNumber":373,"oldContent":"                            Text(\"Altitude: ${surveyAltitude.toInt()}m\", color = Color.White)"},{"type":"DELETE","lineNumber":374,"oldContent":"                            label = \"Altitude\","},{"type":"DELETE","lineNumber":375,"oldContent":"                            value = surveyAltitude,"},{"type":"DELETE","lineNumber":376,"oldContent":"                            onValueChange = { surveyAltitude = it },"},{"type":"DELETE","lineNumber":377,"oldContent":"                            valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":378,"oldContent":"                            steps = 21,"},{"type":"DELETE","lineNumber":379,"oldContent":"                            unit = \"m\","},{"type":"DELETE","lineNumber":380,"oldContent":"                            description = \"Survey altitude\""},{"type":"DELETE","lineNumber":381,"oldContent":"                        )"},{"type":"DELETE","lineNumber":382,"oldContent":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"DELETE","lineNumber":383,"oldContent":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"DELETE","lineNumber":384,"oldContent":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":385,"oldContent":"                                GridStatItem(\"Waypoints\", \"${result.waypoints.size}\")"},{"type":"DELETE","lineNumber":386,"oldContent":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":387,"oldContent":"                                GridStatItem(\"Lines\", \"${result.numLines}\")"},{"type":"DELETE","lineNumber":388,"oldContent":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":389,"oldContent":"                                GridStatItem(\"Distance\", \"${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)} km\")"},{"type":"DELETE","lineNumber":390,"oldContent":"                                GridStatItem(\"Time\", \"${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)} min\")"},{"type":"DELETE","lineNumber":391,"oldContent":"                        if (surveyPolygon.size < 3) {"},{"type":"DELETE","lineNumber":393,"oldContent":"                            Text("},{"type":"DELETE","lineNumber":394,"oldContent":"                                \"Tap map to add polygon vertices (need ${3 - surveyPolygon.size} more)\","},{"type":"DELETE","lineNumber":395,"oldContent":"                                color = Color.Yellow,"},{"type":"DELETE","lineNumber":396,"oldContent":"                                style = MaterialTheme.typography.bodySmall"},{"type":"INSERT","lineNumber":359,"content":"                            Slider("},{"type":"INSERT","lineNumber":360,"content":"                                value = gridAngle,"},{"type":"INSERT","lineNumber":361,"content":"                                onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":362,"content":"                                valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":363,"content":"                                steps = 35"},{"type":"INSERT","lineNumber":366,"content":"                            description = \"Survey line direction\""},{"type":"INSERT","lineNumber":367,"content":"                        Column {"},{"type":"DELETE","lineNumber":400,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":401,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":402,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":369,"content":"                            Slider("},{"type":"INSERT","lineNumber":370,"content":"                            label = \"Survey Speed\","},{"type":"INSERT","lineNumber":371,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":372,"content":"                                valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":373,"content":"                                steps = 18"},{"type":"INSERT","lineNumber":374,"content":"                            )"},{"type":"INSERT","lineNumber":375,"content":"                        }"},{"type":"INSERT","lineNumber":376,"content":"                            description = \"Flight speed during survey\""},{"type":"INSERT","lineNumber":377,"content":"                        Column {"},{"type":"INSERT","lineNumber":378,"content":""},{"type":"INSERT","lineNumber":379,"content":"                            Slider("},{"type":"INSERT","lineNumber":380,"content":"                            label = \"Survey Altitude\","},{"type":"INSERT","lineNumber":381,"content":"                                onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":382,"content":"                                valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":383,"content":"                                steps = 21"},{"type":"INSERT","lineNumber":384,"content":"                            )"},{"type":"INSERT","lineNumber":385,"content":"                        }"},{"type":"INSERT","lineNumber":386,"content":"                            description = \"Flight altitude above home\""},{"type":"INSERT","lineNumber":387,"content":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":388,"content":""},{"type":"INSERT","lineNumber":389,"content":"                        // Grid Statistics"},{"type":"INSERT","lineNumber":390,"content":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":391,"content":"                            HorizontalDivider("},{"type":"INSERT","lineNumber":392,"content":"                                color = Color.White.copy(alpha = 0.3f), "},{"type":"INSERT","lineNumber":393,"content":"                                thickness = 1.dp,"},{"type":"INSERT","lineNumber":394,"content":"                                modifier = Modifier.padding(vertical = 8.dp)"},{"type":"INSERT","lineNumber":395,"content":"                            )"},{"type":"INSERT","lineNumber":396,"content":"                            "},{"type":"INSERT","lineNumber":397,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {"},{"type":"INSERT","lineNumber":398,"content":"                                Text("},{"type":"INSERT","lineNumber":399,"content":"                                    \"Grid Statistics\","},{"type":"INSERT","lineNumber":400,"content":"                                    style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":401,"content":"                                    color = Color.White,"},{"type":"INSERT","lineNumber":402,"content":"                                    fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":403,"content":"                                )"},{"type":"INSERT","lineNumber":404,"content":"                                "},{"type":"INSERT","lineNumber":405,"content":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":406,"content":"                                GridStatItem(\"Survey Lines\", \"${result.numLines}\")"},{"type":"INSERT","lineNumber":407,"content":"                                GridStatItem(\"Total Distance\", String.format(Locale.US, \"%.2f km\", result.totalDistance / 1000))"},{"type":"INSERT","lineNumber":408,"content":"                                GridStatItem(\"Estimated Time\", String.format(Locale.US, \"%.1f min\", result.estimatedTime / 60))"},{"type":"INSERT","lineNumber":409,"content":"                            }"},{"type":"INSERT","lineNumber":410,"content":"                        }"},{"type":"INSERT","lineNumber":411,"content":""},{"type":"INSERT","lineNumber":412,"content":"                        // Instructions"},{"type":"INSERT","lineNumber":413,"content":"                        if (surveyPolygon.size < 3) {"},{"type":"INSERT","lineNumber":414,"content":"                            Card("},{"type":"INSERT","lineNumber":415,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":416,"content":"                                colors = CardDefaults.cardColors(containerColor = Color(0xFF2D5016).copy(alpha = 0.8f)),"},{"type":"INSERT","lineNumber":417,"content":"                                shape = RoundedCornerShape(8.dp)"},{"type":"INSERT","lineNumber":418,"content":"                            ) {"},{"type":"INSERT","lineNumber":419,"content":"                                Text("},{"type":"INSERT","lineNumber":420,"content":"                                    \"📍 Tap map to add polygon vertices\\n(need ${3 - surveyPolygon.size} more points)\","},{"type":"INSERT","lineNumber":421,"content":"                                    color = Color(0xFFAED581),"},{"type":"INSERT","lineNumber":422,"content":"                                    style = MaterialTheme.typography.bodySmall,"},{"type":"INSERT","lineNumber":423,"content":"                                    modifier = Modifier.padding(12.dp),"},{"type":"INSERT","lineNumber":424,"content":"                                    fontWeight = FontWeight.Medium"},{"type":"INSERT","lineNumber":425,"content":"                                )"},{"type":"INSERT","lineNumber":426,"content":"                            }"},{"type":"INSERT","lineNumber":427,"content":"                        }"},{"type":"INSERT","lineNumber":428,"content":""},{"type":"INSERT","lineNumber":429,"content":"                        // Action Buttons"},{"type":"DELETE","lineNumber":404,"oldContent":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"DELETE","lineNumber":406,"oldContent":"                                Text(\"Clear\")"},{"type":"INSERT","lineNumber":432,"content":"                            horizontalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":408,"oldContent":""},{"type":"INSERT","lineNumber":434,"content":"                            OutlinedButton("},{"type":"INSERT","lineNumber":436,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":437,"content":"                                enabled = surveyPolygon.isNotEmpty(),"},{"type":"INSERT","lineNumber":438,"content":"                                colors = ButtonDefaults.outlinedButtonColors("},{"type":"INSERT","lineNumber":439,"content":"                                    contentColor = Color.White"},{"type":"INSERT","lineNumber":440,"content":"                                ),"},{"type":"INSERT","lineNumber":441,"content":"                                border = ButtonDefaults.outlinedButtonBorder.copy("},{"type":"INSERT","lineNumber":442,"content":"                                    brush = androidx.compose.ui.graphics.SolidColor(Color.White.copy(alpha = 0.5f))"},{"type":"INSERT","lineNumber":443,"content":"                                )"},{"type":"INSERT","lineNumber":445,"content":"                                Text(\"Clear\", fontWeight = FontWeight.Medium)"},{"type":"INSERT","lineNumber":447,"content":""},{"type":"DELETE","lineNumber":413,"oldContent":"                                enabled = surveyPolygon.size >= 3"},{"type":"DELETE","lineNumber":415,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":417,"oldContent":"                        }"},{"type":"DELETE","lineNumber":419,"oldContent":"                    }"},{"type":"DELETE","lineNumber":421,"oldContent":"                }"},{"type":"INSERT","lineNumber":455,"content":"                                enabled = surveyPolygon.size >= 3,"},{"type":"INSERT","lineNumber":456,"content":"                                colors = ButtonDefaults.buttonColors("},{"type":"INSERT","lineNumber":457,"content":"                                    containerColor = MaterialTheme.colorScheme.primary"},{"type":"INSERT","lineNumber":458,"content":"                                )"},{"type":"DELETE","lineNumber":425,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":460,"content":"                                Text(\"Auto Angle\", fontWeight = FontWeight.Medium)"},{"type":"INSERT","lineNumber":462,"content":"                        }"},{"type":"INSERT","lineNumber":463,"content":"                    }"},{"type":"INSERT","lineNumber":464,"content":"                }"},{"type":"INSERT","lineNumber":467,"content":"            // Upload button"},{"type":"DELETE","lineNumber":451,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":453,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":455,"oldContent":"                    }"},{"type":"DELETE","lineNumber":457,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":498,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":499,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":500,"content":"                    }"},{"type":"INSERT","lineNumber":501,"content":"                } else {"},{"type":"DELETE","lineNumber":467,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":470,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":510,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":512,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":520,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":562,"content":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691657346,"changes":[{"type":"INSERT","lineNumber":5,"content":"import androidx.compose.foundation.verticalScroll"},{"type":"INSERT","lineNumber":6,"content":"import androidx.compose.foundation.rememberScrollState"},{"type":"DELETE","lineNumber":33,"oldContent":"fun PlanScreen("},{"type":"INSERT","lineNumber":36,"content":"fun PlanScreen("},{"type":"DELETE","lineNumber":70,"oldContent":""},{"type":"INSERT","lineNumber":73,"content":""},{"type":"DELETE","lineNumber":92,"oldContent":"                // Map type toggle"},{"type":"DELETE","lineNumber":93,"oldContent":"                    onClick = { telemetryViewModel.arm() },"},{"type":"MODIFY","lineNumber":94,"content":"            targetComponent = 0u,","oldContent":"                FloatingActionButton("},{"type":"INSERT","lineNumber":95,"content":"            seq = seq.toUShort(),"},{"type":"INSERT","lineNumber":96,"content":"            frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":130,"oldContent":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":133,"content":"            Toast.makeText(context, \"Waypoints: ${points.joinToString { \"(${it.latitude},${it.longitude})\" }}\", Toast.LENGTH_SHORT).show()"},{"type":"DELETE","lineNumber":148,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":151,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":162,"oldContent":""},{"type":"INSERT","lineNumber":165,"content":""},{"type":"DELETE","lineNumber":165,"oldContent":"                            if (isGridSurveyMode) {"},{"type":"INSERT","lineNumber":168,"content":"                            if (isGridSurveyMode) {"},{"type":"DELETE","lineNumber":182,"oldContent":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":185,"content":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":195,"oldContent":"                    }"},{"type":"INSERT","lineNumber":198,"content":"                    }"},{"type":"DELETE","lineNumber":198,"oldContent":"                FloatingActionButton("},{"type":"INSERT","lineNumber":201,"content":"                FloatingActionButton("},{"type":"DELETE","lineNumber":209,"oldContent":"            GcsMap("},{"type":"INSERT","lineNumber":212,"content":"            GcsMap("},{"type":"DELETE","lineNumber":212,"oldContent":"                onMapClick = onMapClick,"},{"type":"INSERT","lineNumber":215,"content":"                onMapClick = onMapClick,"},{"type":"DELETE","lineNumber":220,"oldContent":""},{"type":"INSERT","lineNumber":223,"content":""},{"type":"DELETE","lineNumber":225,"oldContent":"                    .padding(12.dp)"},{"type":"INSERT","lineNumber":228,"content":"                    .padding(12.dp)"},{"type":"DELETE","lineNumber":236,"oldContent":"                )"},{"type":"INSERT","lineNumber":239,"content":"                )"},{"type":"DELETE","lineNumber":248,"oldContent":"                contentAlignment = Alignment.Center"},{"type":"INSERT","lineNumber":251,"content":"                contentAlignment = Alignment.Center"},{"type":"DELETE","lineNumber":258,"oldContent":"            // Left sidebar buttons"},{"type":"INSERT","lineNumber":261,"content":"            // Left sidebar buttons"},{"type":"DELETE","lineNumber":266,"oldContent":"                    onClick = {"},{"type":"INSERT","lineNumber":269,"content":"                    onClick = {"},{"type":"DELETE","lineNumber":271,"oldContent":"                            waypoints.clear()"},{"type":"INSERT","lineNumber":274,"content":"                            waypoints.clear()"},{"type":"DELETE","lineNumber":293,"oldContent":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"INSERT","lineNumber":296,"content":"                                CameraUpdateFactory.newLatLngZoom(LatLng(lat, lon), 16f)"},{"type":"DELETE","lineNumber":298,"oldContent":"                    },"},{"type":"INSERT","lineNumber":301,"content":"                    },"},{"type":"DELETE","lineNumber":317,"oldContent":"            }"},{"type":"INSERT","lineNumber":320,"content":"            }"},{"type":"DELETE","lineNumber":326,"oldContent":"                        .width(340.dp)"},{"type":"MODIFY","lineNumber":328,"content":"                        .width(320.dp),","oldContent":"                        .heightIn(max = 600.dp),"},{"type":"INSERT","lineNumber":329,"content":"                    shape = RoundedCornerShape(12.dp),"},{"type":"INSERT","lineNumber":330,"content":"                    color = Color.Black.copy(alpha = 0.8f)"},{"type":"DELETE","lineNumber":329,"oldContent":"                    shape = RoundedCornerShape(16.dp),"},{"type":"DELETE","lineNumber":330,"oldContent":"                    color = Color.Black.copy(alpha = 0.85f),"},{"type":"DELETE","lineNumber":331,"oldContent":"                    shadowElevation = 8.dp"},{"type":"INSERT","lineNumber":333,"content":"                        modifier = Modifier.padding(16.dp),"},{"type":"INSERT","lineNumber":334,"content":"                        verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":334,"oldContent":"                    val scrollState = rememberScrollState()"},{"type":"DELETE","lineNumber":335,"oldContent":"                    "},{"type":"DELETE","lineNumber":336,"oldContent":"                        modifier = Modifier"},{"type":"DELETE","lineNumber":337,"oldContent":"                            .verticalScroll(scrollState)"},{"type":"INSERT","lineNumber":336,"content":"                        Text("},{"type":"DELETE","lineNumber":339,"oldContent":"                            .padding(20.dp),"},{"type":"INSERT","lineNumber":338,"content":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"DELETE","lineNumber":341,"oldContent":"                        verticalArrangement = Arrangement.spacedBy(16.dp)"},{"type":"DELETE","lineNumber":342,"oldContent":"                        // Header"},{"type":"DELETE","lineNumber":343,"oldContent":"                        Text("},{"type":"DELETE","lineNumber":345,"oldContent":"                            style = MaterialTheme.typography.titleLarge,"},{"type":"DELETE","lineNumber":347,"oldContent":"                        // Parameter Controls"},{"type":"INSERT","lineNumber":342,"content":""},{"type":"INSERT","lineNumber":343,"content":"                        Column {"},{"type":"INSERT","lineNumber":344,"content":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"DELETE","lineNumber":350,"oldContent":""},{"type":"DELETE","lineNumber":352,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":357,"oldContent":"                            description = \"Distance between survey lines\""},{"type":"INSERT","lineNumber":352,"content":""},{"type":"INSERT","lineNumber":353,"content":"                        Column {"},{"type":"INSERT","lineNumber":354,"content":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"DELETE","lineNumber":363,"oldContent":"                            description = \"Survey line direction\""},{"type":"INSERT","lineNumber":360,"content":"                            )"},{"type":"INSERT","lineNumber":361,"content":"                        }"},{"type":"INSERT","lineNumber":362,"content":""},{"type":"INSERT","lineNumber":364,"content":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"MODIFY","lineNumber":366,"content":"                                value = surveySpeed,","oldContent":"                            label = \"Survey Speed\","},{"type":"DELETE","lineNumber":372,"oldContent":"                            description = \"Flight speed during survey\""},{"type":"MODIFY","lineNumber":373,"content":"                        Column {","oldContent":"                        Column {"},{"type":"INSERT","lineNumber":374,"content":"                            Text(\"Altitude: ${surveyAltitude.toInt()}m\", color = Color.White)"},{"type":"MODIFY","lineNumber":376,"content":"                                value = surveyAltitude,","oldContent":"                            label = \"Survey Altitude\","},{"type":"DELETE","lineNumber":382,"oldContent":"                            description = \"Flight altitude above home\""},{"type":"DELETE","lineNumber":383,"oldContent":"                        gridResult?.let { result ->"},{"type":"DELETE","lineNumber":385,"oldContent":"                        // Grid Statistics"},{"type":"DELETE","lineNumber":387,"oldContent":"                            HorizontalDivider("},{"type":"DELETE","lineNumber":388,"oldContent":"                                color = Color.White.copy(alpha = 0.3f), "},{"type":"INSERT","lineNumber":384,"content":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":385,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"INSERT","lineNumber":386,"content":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":387,"content":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":388,"content":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":389,"content":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":390,"content":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":391,"content":"                            }"},{"type":"INSERT","lineNumber":392,"content":"                        }"},{"type":"DELETE","lineNumber":390,"oldContent":"                                thickness = 1.dp,"},{"type":"DELETE","lineNumber":391,"oldContent":"                                modifier = Modifier.padding(vertical = 8.dp)"},{"type":"INSERT","lineNumber":394,"content":"                        if (surveyPolygon.size < 3) {"},{"type":"INSERT","lineNumber":395,"content":"                            Text("},{"type":"INSERT","lineNumber":396,"content":"                                \"Tap map to add polygon vertices (need ${3 - surveyPolygon.size} more)\","},{"type":"INSERT","lineNumber":397,"content":"                                color = Color.Yellow,"},{"type":"INSERT","lineNumber":398,"content":"                                style = MaterialTheme.typography.bodySmall"},{"type":"DELETE","lineNumber":393,"oldContent":"                            "},{"type":"DELETE","lineNumber":394,"oldContent":"                            Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {"},{"type":"DELETE","lineNumber":395,"oldContent":"                            )"},{"type":"DELETE","lineNumber":396,"oldContent":"                                Text("},{"type":"DELETE","lineNumber":398,"oldContent":"                                    \"Grid Statistics\","},{"type":"DELETE","lineNumber":400,"oldContent":"                                    style = MaterialTheme.typography.titleMedium,"},{"type":"DELETE","lineNumber":401,"oldContent":"                                    color = Color.White,"},{"type":"DELETE","lineNumber":402,"oldContent":"                                    fontWeight = FontWeight.Bold"},{"type":"DELETE","lineNumber":403,"oldContent":"                                )"},{"type":"DELETE","lineNumber":405,"oldContent":"                                "},{"type":"DELETE","lineNumber":406,"oldContent":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":408,"oldContent":"                                GridStatItem(\"Survey Lines\", \"${result.numLines}\")"},{"type":"DELETE","lineNumber":409,"oldContent":"                                GridStatItem(\"Total Distance\", String.format(Locale.US, \"%.2f km\", result.totalDistance / 1000))"},{"type":"INSERT","lineNumber":404,"content":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":411,"oldContent":"                                GridStatItem(\"Estimated Time\", String.format(Locale.US, \"%.1f min\", result.estimatedTime / 60))"},{"type":"DELETE","lineNumber":412,"oldContent":"                            }"},{"type":"INSERT","lineNumber":406,"content":"                            Button("},{"type":"DELETE","lineNumber":414,"oldContent":"                        }"},{"type":"INSERT","lineNumber":408,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":409,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"DELETE","lineNumber":416,"oldContent":""},{"type":"INSERT","lineNumber":411,"content":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":418,"oldContent":"                        // Instructions"},{"type":"INSERT","lineNumber":413,"content":""},{"type":"DELETE","lineNumber":420,"oldContent":"                        if (surveyPolygon.size < 3) {"},{"type":"DELETE","lineNumber":421,"oldContent":"                            Card("},{"type":"DELETE","lineNumber":423,"oldContent":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"DELETE","lineNumber":424,"oldContent":"                                colors = CardDefaults.cardColors(containerColor = Color(0xFF2D5016).copy(alpha = 0.8f)),"},{"type":"DELETE","lineNumber":426,"oldContent":"                                shape = RoundedCornerShape(8.dp)"},{"type":"DELETE","lineNumber":427,"oldContent":"                            ) {"},{"type":"DELETE","lineNumber":429,"oldContent":"                                Text("},{"type":"DELETE","lineNumber":430,"oldContent":"                                    \"📍 Tap map to add polygon vertices\\n(need ${3 - surveyPolygon.size} more points)\","},{"type":"DELETE","lineNumber":432,"oldContent":"                                    color = Color(0xFFAED581),"},{"type":"DELETE","lineNumber":433,"oldContent":"                                    style = MaterialTheme.typography.bodySmall,"},{"type":"DELETE","lineNumber":435,"oldContent":"                                    modifier = Modifier.padding(12.dp),"},{"type":"DELETE","lineNumber":437,"oldContent":"                                    fontWeight = FontWeight.Medium"},{"type":"INSERT","lineNumber":421,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"DELETE","lineNumber":439,"oldContent":"                                )"},{"type":"INSERT","lineNumber":423,"content":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":441,"oldContent":"                            }"},{"type":"INSERT","lineNumber":426,"content":"                    }"},{"type":"INSERT","lineNumber":427,"content":"                }"},{"type":"DELETE","lineNumber":445,"oldContent":""},{"type":"DELETE","lineNumber":446,"oldContent":"                        // Action Buttons"},{"type":"INSERT","lineNumber":430,"content":"            // Upload button"},{"type":"DELETE","lineNumber":450,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"DELETE","lineNumber":453,"oldContent":"                            OutlinedButton("},{"type":"DELETE","lineNumber":456,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":458,"oldContent":"                                enabled = surveyPolygon.isNotEmpty(),"},{"type":"DELETE","lineNumber":460,"oldContent":"                                colors = ButtonDefaults.outlinedButtonColors("},{"type":"DELETE","lineNumber":462,"oldContent":"                                    contentColor = Color.White"},{"type":"DELETE","lineNumber":464,"oldContent":"                                ),"},{"type":"DELETE","lineNumber":466,"oldContent":"                                border = ButtonDefaults.outlinedButtonBorder.copy("},{"type":"DELETE","lineNumber":468,"oldContent":"                                    brush = androidx.compose.ui.graphics.SolidColor(Color.White.copy(alpha = 0.5f))"},{"type":"DELETE","lineNumber":470,"oldContent":"                                )"},{"type":"DELETE","lineNumber":473,"oldContent":"                                Text(\"Clear\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":476,"oldContent":""},{"type":"DELETE","lineNumber":483,"oldContent":"                                enabled = surveyPolygon.size >= 3,"},{"type":"DELETE","lineNumber":484,"oldContent":"                                colors = ButtonDefaults.buttonColors("},{"type":"DELETE","lineNumber":486,"oldContent":"                                    containerColor = MaterialTheme.colorScheme.primary"},{"type":"DELETE","lineNumber":487,"oldContent":"                                )"},{"type":"DELETE","lineNumber":490,"oldContent":"                                Text(\"Auto Angle\", fontWeight = FontWeight.Medium)"},{"type":"DELETE","lineNumber":493,"oldContent":"                        }"},{"type":"INSERT","lineNumber":461,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":462,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":464,"content":"                } else {"},{"type":"DELETE","lineNumber":497,"oldContent":"                }"},{"type":"DELETE","lineNumber":501,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":473,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":475,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":531,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":533,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":535,"oldContent":"                    }"},{"type":"DELETE","lineNumber":537,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":547,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":550,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":525,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":569,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691786188,"changes":[{"type":"DELETE","lineNumber":5,"oldContent":"import androidx.compose.foundation.verticalScroll"},{"type":"DELETE","lineNumber":7,"oldContent":"import androidx.compose.foundation.rememberScrollState"},{"type":"DELETE","lineNumber":30,"oldContent":"    ) { paddingValues ->"},{"type":"INSERT","lineNumber":28,"content":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"MODIFY","lineNumber":35,"content":"    telemetryViewModel: SharedViewModel,","oldContent":"    telemetryViewModel: SharedViewModel,"},{"type":"MODIFY","lineNumber":72,"content":"    // Center map once when screen opens","oldContent":"    // Center map once when screen opens"},{"type":"MODIFY","lineNumber":95,"content":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),","oldContent":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"MODIFY","lineNumber":132,"content":"        }","oldContent":"        }"},{"type":"MODIFY","lineNumber":150,"content":"                                surveyPolygon = surveyPolygon + center","oldContent":"                                surveyPolygon = surveyPolygon + center"},{"type":"MODIFY","lineNumber":164,"content":"                    FloatingActionButton(","oldContent":"                    FloatingActionButton("},{"type":"MODIFY","lineNumber":167,"content":"                                if (surveyPolygon.isNotEmpty()) {","oldContent":"                                if (surveyPolygon.isNotEmpty()) {"},{"type":"MODIFY","lineNumber":184,"content":"                        onClick = {","oldContent":"                        onClick = {"},{"type":"MODIFY","lineNumber":197,"content":"                }","oldContent":"                }"},{"type":"MODIFY","lineNumber":200,"content":"                    onClick = { showPlanActions = !showPlanActions },","oldContent":"                    onClick = { showPlanActions = !showPlanActions },"},{"type":"MODIFY","lineNumber":211,"content":"                telemetryState = telemetryState,","oldContent":"                telemetryState = telemetryState,"},{"type":"MODIFY","lineNumber":214,"content":"                cameraPositionState = cameraPositionState,","oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"MODIFY","lineNumber":222,"content":"            // Status indicator","oldContent":"            // Status indicator"},{"type":"MODIFY","lineNumber":227,"content":"            ) {","oldContent":"            ) {"},{"type":"MODIFY","lineNumber":238,"content":"                Text(","oldContent":"                Text("},{"type":"MODIFY","lineNumber":250,"content":"            ) {","oldContent":"            ) {"},{"type":"MODIFY","lineNumber":260,"content":"            Column(","oldContent":"            Column("},{"type":"MODIFY","lineNumber":268,"content":"                        isGridSurveyMode = !isGridSurveyMode","oldContent":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"MODIFY","lineNumber":273,"content":"                        } else {","oldContent":"                        } else {"},{"type":"MODIFY","lineNumber":295,"content":"                            )","oldContent":"                            )"},{"type":"MODIFY","lineNumber":300,"content":"                    modifier = Modifier.size(56.dp)","oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"MODIFY","lineNumber":319,"content":"","oldContent":""},{"type":"DELETE","lineNumber":328,"oldContent":"                        .heightIn(max = 600.dp),"},{"type":"INSERT","lineNumber":329,"content":"                ) {"},{"type":"MODIFY","lineNumber":333,"content":"                    ) {","oldContent":"                    ) {"},{"type":"MODIFY","lineNumber":336,"content":"                            style = MaterialTheme.typography.titleMedium,","oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":338,"content":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":339,"content":"                        )"},{"type":"DELETE","lineNumber":343,"oldContent":"                            fontWeight = FontWeight.Bold"},{"type":"DELETE","lineNumber":344,"oldContent":"                        )"},{"type":"DELETE","lineNumber":348,"oldContent":""},{"type":"DELETE","lineNumber":349,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":351,"oldContent":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"INSERT","lineNumber":350,"content":""},{"type":"INSERT","lineNumber":351,"content":"                        Column {"},{"type":"INSERT","lineNumber":352,"content":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"DELETE","lineNumber":357,"oldContent":"                            )"},{"type":"DELETE","lineNumber":359,"oldContent":"                        }"},{"type":"DELETE","lineNumber":361,"oldContent":""},{"type":"DELETE","lineNumber":363,"oldContent":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"INSERT","lineNumber":358,"content":"                            )"},{"type":"INSERT","lineNumber":359,"content":"                        }"},{"type":"INSERT","lineNumber":360,"content":""},{"type":"INSERT","lineNumber":362,"content":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"INSERT","lineNumber":370,"content":""},{"type":"DELETE","lineNumber":374,"oldContent":""},{"type":"DELETE","lineNumber":382,"oldContent":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":381,"content":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":382,"content":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"DELETE","lineNumber":386,"oldContent":"                        gridResult?.let { result ->"},{"type":"DELETE","lineNumber":390,"oldContent":"                                            popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"DELETE","lineNumber":394,"oldContent":"                            )"},{"type":"INSERT","lineNumber":391,"content":""},{"type":"DELETE","lineNumber":399,"oldContent":"                        }"},{"type":"INSERT","lineNumber":397,"content":"                            )"},{"type":"INSERT","lineNumber":398,"content":"                        }"},{"type":"DELETE","lineNumber":402,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":404,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":406,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":407,"oldContent":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":402,"content":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":409,"oldContent":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":410,"oldContent":""},{"type":"INSERT","lineNumber":404,"content":"                            Button("},{"type":"INSERT","lineNumber":406,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":407,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":409,"content":"                                Text(\"Clear\")"},{"type":"INSERT","lineNumber":411,"content":""},{"type":"DELETE","lineNumber":415,"oldContent":"                                enabled = surveyPolygon.size >= 3"},{"type":"DELETE","lineNumber":417,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":419,"oldContent":"                    }"},{"type":"DELETE","lineNumber":420,"oldContent":"                }"},{"type":"DELETE","lineNumber":422,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":419,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":421,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":424,"content":"                    }"},{"type":"INSERT","lineNumber":425,"content":"                }"},{"type":"INSERT","lineNumber":428,"content":"            // Upload button"},{"type":"DELETE","lineNumber":440,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":442,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":444,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":450,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":452,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":459,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":460,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":462,"content":"                } else {"},{"type":"INSERT","lineNumber":471,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":473,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":494,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":523,"content":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691865527,"changes":[{"type":"DELETE","lineNumber":26,"oldContent":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"INSERT","lineNumber":28,"content":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"DELETE","lineNumber":33,"oldContent":"    telemetryViewModel: SharedViewModel,"},{"type":"DELETE","lineNumber":34,"oldContent":"    telemetryViewModel: SharedViewModel,"},{"type":"INSERT","lineNumber":33,"content":"@Composable"},{"type":"INSERT","lineNumber":35,"content":"    telemetryViewModel: SharedViewModel,"},{"type":"DELETE","lineNumber":70,"oldContent":"    // Center map once when screen opens"},{"type":"DELETE","lineNumber":71,"oldContent":"    // Center map once when screen opens"},{"type":"INSERT","lineNumber":70,"content":"    val coroutineScope = rememberCoroutineScope()"},{"type":"INSERT","lineNumber":72,"content":"    // Center map once when screen opens"},{"type":"DELETE","lineNumber":93,"oldContent":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":94,"oldContent":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":93,"content":"            seq = seq.toUShort(),"},{"type":"INSERT","lineNumber":95,"content":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":130,"oldContent":"        }"},{"type":"DELETE","lineNumber":131,"oldContent":"        }"},{"type":"INSERT","lineNumber":130,"content":"            waypoints.add(item)"},{"type":"INSERT","lineNumber":132,"content":"        }"},{"type":"DELETE","lineNumber":148,"oldContent":"                                surveyPolygon = surveyPolygon + center"},{"type":"DELETE","lineNumber":149,"oldContent":"                                surveyPolygon = surveyPolygon + center"},{"type":"INSERT","lineNumber":148,"content":"                            val center = cameraPositionState.position.target"},{"type":"INSERT","lineNumber":150,"content":"                                surveyPolygon = surveyPolygon + center"},{"type":"DELETE","lineNumber":162,"oldContent":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":163,"oldContent":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":162,"content":"                    }"},{"type":"DELETE","lineNumber":165,"oldContent":"                                if (surveyPolygon.isNotEmpty()) {"},{"type":"DELETE","lineNumber":166,"oldContent":"                                if (surveyPolygon.isNotEmpty()) {"},{"type":"INSERT","lineNumber":164,"content":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":165,"content":"                        onClick = {"},{"type":"INSERT","lineNumber":167,"content":"                                if (surveyPolygon.isNotEmpty()) {"},{"type":"DELETE","lineNumber":182,"oldContent":"                        onClick = {"},{"type":"DELETE","lineNumber":183,"oldContent":"                        onClick = {"},{"type":"INSERT","lineNumber":182,"content":""},{"type":"INSERT","lineNumber":184,"content":"                        onClick = {"},{"type":"DELETE","lineNumber":195,"oldContent":"                }"},{"type":"DELETE","lineNumber":196,"oldContent":"                }"},{"type":"INSERT","lineNumber":195,"content":"                        Icon(Icons.Default.ClearAll, contentDescription = \"Clear All\")"},{"type":"DELETE","lineNumber":198,"oldContent":"                    onClick = { showPlanActions = !showPlanActions },"},{"type":"DELETE","lineNumber":199,"oldContent":"                    onClick = { showPlanActions = !showPlanActions },"},{"type":"INSERT","lineNumber":197,"content":"                }"},{"type":"INSERT","lineNumber":198,"content":""},{"type":"INSERT","lineNumber":200,"content":"                    onClick = { showPlanActions = !showPlanActions },"},{"type":"DELETE","lineNumber":209,"oldContent":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":210,"oldContent":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":209,"content":"            // Map"},{"type":"DELETE","lineNumber":212,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":213,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":211,"content":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":212,"content":"                points = if (isGridSurveyMode) emptyList() else points,"},{"type":"INSERT","lineNumber":214,"content":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":220,"oldContent":"            // Status indicator"},{"type":"DELETE","lineNumber":221,"oldContent":"            // Status indicator"},{"type":"INSERT","lineNumber":220,"content":"            )"},{"type":"INSERT","lineNumber":222,"content":"            // Status indicator"},{"type":"DELETE","lineNumber":225,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":226,"oldContent":"            ) {"},{"type":"INSERT","lineNumber":225,"content":"                    .align(Alignment.TopEnd)"},{"type":"INSERT","lineNumber":227,"content":"            ) {"},{"type":"DELETE","lineNumber":236,"oldContent":"                Text("},{"type":"DELETE","lineNumber":237,"oldContent":"                Text("},{"type":"INSERT","lineNumber":236,"content":"                    color = MaterialTheme.colorScheme.onSurface"},{"type":"INSERT","lineNumber":238,"content":"                Text("},{"type":"DELETE","lineNumber":248,"oldContent":"            ) {"},{"type":"DELETE","lineNumber":249,"oldContent":"            ) {"},{"type":"INSERT","lineNumber":248,"content":"                modifier = Modifier.size(36.dp).align(Alignment.Center),"},{"type":"INSERT","lineNumber":250,"content":"            ) {"},{"type":"DELETE","lineNumber":258,"oldContent":"            Column("},{"type":"DELETE","lineNumber":259,"oldContent":"            Column("},{"type":"INSERT","lineNumber":258,"content":""},{"type":"INSERT","lineNumber":260,"content":"            Column("},{"type":"DELETE","lineNumber":266,"oldContent":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"DELETE","lineNumber":267,"oldContent":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"INSERT","lineNumber":266,"content":"                FloatingActionButton("},{"type":"INSERT","lineNumber":268,"content":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"DELETE","lineNumber":271,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":272,"oldContent":"                        } else {"},{"type":"INSERT","lineNumber":271,"content":"                            points.clear()"},{"type":"INSERT","lineNumber":273,"content":"                        } else {"},{"type":"DELETE","lineNumber":293,"oldContent":"                            )"},{"type":"DELETE","lineNumber":294,"oldContent":"                            )"},{"type":"INSERT","lineNumber":293,"content":"                            cameraPositionState.move("},{"type":"INSERT","lineNumber":295,"content":"                            )"},{"type":"DELETE","lineNumber":298,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":299,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":298,"content":"                        }"},{"type":"INSERT","lineNumber":300,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":317,"oldContent":""},{"type":"DELETE","lineNumber":318,"oldContent":""},{"type":"INSERT","lineNumber":317,"content":"                }"},{"type":"INSERT","lineNumber":319,"content":""},{"type":"DELETE","lineNumber":326,"oldContent":"                ) {"},{"type":"INSERT","lineNumber":329,"content":"                ) {"},{"type":"INSERT","lineNumber":331,"content":"                        modifier = Modifier"},{"type":"INSERT","lineNumber":332,"content":"                            .padding(16.dp)"},{"type":"INSERT","lineNumber":333,"content":"                            .verticalScroll(rememberScrollState()),"},{"type":"INSERT","lineNumber":334,"content":"                        verticalArrangement = Arrangement.spacedBy(18.dp) // More spacing for clarity"},{"type":"DELETE","lineNumber":332,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":333,"oldContent":"                        verticalArrangement = Arrangement.spacedBy(12.dp)"},{"type":"INSERT","lineNumber":336,"content":"                        Text("},{"type":"INSERT","lineNumber":337,"content":"                            \"Grid Survey Parameters\","},{"type":"DELETE","lineNumber":335,"oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":339,"content":"                            color = Color.White,"},{"type":"DELETE","lineNumber":337,"oldContent":"                            \"Grid Survey Parameters\","},{"type":"DELETE","lineNumber":339,"oldContent":"                            color = Color.White,"},{"type":"DELETE","lineNumber":341,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":342,"oldContent":"                            Text(\"Line Spacing: ${lineSpacing.toInt()}m\", color = Color.White)"},{"type":"INSERT","lineNumber":343,"content":"                        // Line Spacing"},{"type":"INSERT","lineNumber":344,"content":"                        Column(modifier = Modifier.padding(vertical = 4.dp)) {"},{"type":"INSERT","lineNumber":345,"content":"                            Row(verticalAlignment = Alignment.CenterVertically) {"},{"type":"INSERT","lineNumber":346,"content":"                                Text(\"Line Spacing\", color = Color.White, modifier = Modifier.weight(1f))"},{"type":"INSERT","lineNumber":347,"content":"                                Text(\"${lineSpacing.toInt()} m\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":348,"content":"                            }"},{"type":"DELETE","lineNumber":346,"oldContent":""},{"type":"DELETE","lineNumber":348,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":349,"oldContent":"                            Text(\"Grid Angle: ${gridAngle.toInt()}°\", color = Color.White)"},{"type":"DELETE","lineNumber":350,"oldContent":"                                steps = 17"},{"type":"INSERT","lineNumber":353,"content":"                                steps = 17,"},{"type":"INSERT","lineNumber":354,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":355,"content":"                                colors = SliderDefaults.colors("},{"type":"INSERT","lineNumber":356,"content":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":357,"content":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":358,"content":"                                    inactiveTrackColor = Color.Gray"},{"type":"INSERT","lineNumber":359,"content":"                                )"},{"type":"INSERT","lineNumber":362,"content":""},{"type":"INSERT","lineNumber":363,"content":"                        // Grid Angle"},{"type":"INSERT","lineNumber":364,"content":"                        Column(modifier = Modifier.padding(vertical = 4.dp)) {"},{"type":"INSERT","lineNumber":365,"content":"                            Row(verticalAlignment = Alignment.CenterVertically) {"},{"type":"INSERT","lineNumber":366,"content":"                                Text(\"Grid Angle\", color = Color.White, modifier = Modifier.weight(1f))"},{"type":"INSERT","lineNumber":367,"content":"                                Text(\"${gridAngle.toInt()}°\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":368,"content":"                            }"},{"type":"DELETE","lineNumber":355,"oldContent":"                            )"},{"type":"INSERT","lineNumber":372,"content":"                                valueRange = 0f..180f,"},{"type":"INSERT","lineNumber":373,"content":"                                steps = 35,"},{"type":"INSERT","lineNumber":374,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":375,"content":"                                colors = SliderDefaults.colors("},{"type":"INSERT","lineNumber":376,"content":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":377,"content":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":378,"content":"                                    inactiveTrackColor = Color.Gray"},{"type":"INSERT","lineNumber":379,"content":"                                )"},{"type":"INSERT","lineNumber":380,"content":"                            )"},{"type":"DELETE","lineNumber":359,"oldContent":"                                valueRange = 0f..180f,"},{"type":"DELETE","lineNumber":360,"oldContent":"                            Text(\"Speed: ${surveySpeed.toInt()}m/s\", color = Color.White)"},{"type":"DELETE","lineNumber":361,"oldContent":"                                steps = 35"},{"type":"DELETE","lineNumber":362,"oldContent":"                        Column {"},{"type":"INSERT","lineNumber":383,"content":"                        // Survey Speed"},{"type":"INSERT","lineNumber":384,"content":"                        Column(modifier = Modifier.padding(vertical = 4.dp)) {"},{"type":"INSERT","lineNumber":385,"content":"                            Row(verticalAlignment = Alignment.CenterVertically) {"},{"type":"INSERT","lineNumber":386,"content":"                                Text(\"Speed\", color = Color.White, modifier = Modifier.weight(1f))"},{"type":"INSERT","lineNumber":387,"content":"                                Text(\"${surveySpeed.toInt()} m/s\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":388,"content":"                            }"},{"type":"DELETE","lineNumber":367,"oldContent":"                                steps = 18"},{"type":"DELETE","lineNumber":368,"oldContent":""},{"type":"INSERT","lineNumber":393,"content":"                                steps = 18,"},{"type":"INSERT","lineNumber":394,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":395,"content":"                                colors = SliderDefaults.colors("},{"type":"INSERT","lineNumber":396,"content":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":397,"content":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":398,"content":"                                    inactiveTrackColor = Color.Gray"},{"type":"INSERT","lineNumber":399,"content":"                                )"},{"type":"DELETE","lineNumber":371,"oldContent":"                        Column {"},{"type":"DELETE","lineNumber":372,"oldContent":"                            Text(\"Altitude: ${surveyAltitude.toInt()}m\", color = Color.White)"},{"type":"INSERT","lineNumber":402,"content":""},{"type":"INSERT","lineNumber":403,"content":"                        // Survey Altitude"},{"type":"INSERT","lineNumber":404,"content":"                        Column(modifier = Modifier.padding(vertical = 4.dp)) {"},{"type":"INSERT","lineNumber":405,"content":"                            Row(verticalAlignment = Alignment.CenterVertically) {"},{"type":"INSERT","lineNumber":406,"content":"                                Text(\"Altitude\", color = Color.White, modifier = Modifier.weight(1f))"},{"type":"INSERT","lineNumber":407,"content":"                                Text(\"${surveyAltitude.toInt()} m\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":408,"content":"                            }"},{"type":"DELETE","lineNumber":377,"oldContent":"                                steps = 21"},{"type":"INSERT","lineNumber":413,"content":"                                steps = 21,"},{"type":"INSERT","lineNumber":414,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":415,"content":"                                colors = SliderDefaults.colors("},{"type":"INSERT","lineNumber":416,"content":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":417,"content":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":418,"content":"                                    inactiveTrackColor = Color.Gray"},{"type":"INSERT","lineNumber":419,"content":"                                )"},{"type":"DELETE","lineNumber":379,"oldContent":"                        gridResult?.let { result ->"},{"type":"DELETE","lineNumber":381,"oldContent":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":423,"content":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":424,"content":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"DELETE","lineNumber":388,"oldContent":""},{"type":"INSERT","lineNumber":433,"content":""},{"type":"DELETE","lineNumber":394,"oldContent":"                            )"},{"type":"DELETE","lineNumber":396,"oldContent":"                        }"},{"type":"INSERT","lineNumber":439,"content":"                            )"},{"type":"INSERT","lineNumber":440,"content":"                        }"},{"type":"DELETE","lineNumber":400,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":402,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":404,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":405,"oldContent":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":444,"content":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":407,"oldContent":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":408,"oldContent":""},{"type":"INSERT","lineNumber":446,"content":"                            Button("},{"type":"INSERT","lineNumber":448,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":449,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":451,"content":"                                Text(\"Clear\")"},{"type":"INSERT","lineNumber":453,"content":""},{"type":"DELETE","lineNumber":415,"oldContent":"                                enabled = surveyPolygon.size >= 3"},{"type":"DELETE","lineNumber":416,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":419,"oldContent":"                    }"},{"type":"DELETE","lineNumber":421,"oldContent":"                }"},{"type":"INSERT","lineNumber":461,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":463,"content":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":425,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":466,"content":"                    }"},{"type":"INSERT","lineNumber":467,"content":"                }"},{"type":"INSERT","lineNumber":470,"content":"            // Upload button"},{"type":"DELETE","lineNumber":452,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":454,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":457,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":501,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":502,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":504,"content":"                } else {"},{"type":"DELETE","lineNumber":467,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":470,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":513,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":515,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":520,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":565,"content":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691983559,"changes":[{"type":"INSERT","lineNumber":5,"content":"import androidx.compose.foundation.rememberScrollState"},{"type":"DELETE","lineNumber":18,"oldContent":""},{"type":"INSERT","lineNumber":19,"content":"import com.example.aerogcsclone.authentication.AuthViewModel"},{"type":"INSERT","lineNumber":28,"content":"import kotlinx.coroutines.launch"},{"type":"DELETE","lineNumber":28,"oldContent":"            FloatingActionButton(onClick = { /* TODO */ }) {"},{"type":"DELETE","lineNumber":34,"oldContent":"    telemetryViewModel: SharedViewModel,"},{"type":"INSERT","lineNumber":36,"content":"    telemetryViewModel: SharedViewModel,"},{"type":"DELETE","lineNumber":71,"oldContent":"    // Center map once when screen opens"},{"type":"INSERT","lineNumber":73,"content":"    // Center map once when screen opens"},{"type":"DELETE","lineNumber":88,"oldContent":"                                    popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"DELETE","lineNumber":89,"oldContent":"                                navController.navigate(Screen.Main.route) {"},{"type":"DELETE","lineNumber":90,"oldContent":"                                    .show()"},{"type":"DELETE","lineNumber":91,"oldContent":"                                Toast.makeText(context, \"Mission uploaded\", Toast.LENGTH_SHORT)"},{"type":"INSERT","lineNumber":89,"content":"        alt: Float = 10f"},{"type":"INSERT","lineNumber":90,"content":"    ): MissionItemInt {"},{"type":"INSERT","lineNumber":91,"content":"        return MissionItemInt("},{"type":"INSERT","lineNumber":92,"content":"            targetSystem = 0u,"},{"type":"DELETE","lineNumber":94,"oldContent":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":96,"content":"            command = if (isTakeoff) MavEnumValue.of(MavCmd.NAV_TAKEOFF) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":131,"oldContent":"        }"},{"type":"INSERT","lineNumber":133,"content":"        }"},{"type":"DELETE","lineNumber":149,"oldContent":"                                surveyPolygon = surveyPolygon + center"},{"type":"INSERT","lineNumber":151,"content":"                                surveyPolygon = surveyPolygon + center"},{"type":"DELETE","lineNumber":163,"oldContent":"                    FloatingActionButton("},{"type":"INSERT","lineNumber":165,"content":"                    FloatingActionButton("},{"type":"DELETE","lineNumber":166,"oldContent":"                                if (surveyPolygon.isNotEmpty()) {"},{"type":"INSERT","lineNumber":168,"content":"                                if (surveyPolygon.isNotEmpty()) {"},{"type":"DELETE","lineNumber":183,"oldContent":"                        onClick = {"},{"type":"INSERT","lineNumber":185,"content":"                        onClick = {"},{"type":"DELETE","lineNumber":196,"oldContent":"                }"},{"type":"INSERT","lineNumber":198,"content":"                }"},{"type":"DELETE","lineNumber":199,"oldContent":"                    onClick = { showPlanActions = !showPlanActions },"},{"type":"INSERT","lineNumber":201,"content":"                    onClick = { showPlanActions = !showPlanActions },"},{"type":"DELETE","lineNumber":210,"oldContent":"                telemetryState = telemetryState,"},{"type":"INSERT","lineNumber":212,"content":"                telemetryState = telemetryState,"},{"type":"DELETE","lineNumber":213,"oldContent":"                cameraPositionState = cameraPositionState,"},{"type":"INSERT","lineNumber":215,"content":"                cameraPositionState = cameraPositionState,"},{"type":"DELETE","lineNumber":221,"oldContent":"            // Status indicator"},{"type":"INSERT","lineNumber":223,"content":"            // Status indicator"},{"type":"DELETE","lineNumber":226,"oldContent":"            ) {"},{"type":"INSERT","lineNumber":228,"content":"            ) {"},{"type":"DELETE","lineNumber":237,"oldContent":"                Text("},{"type":"INSERT","lineNumber":239,"content":"                Text("},{"type":"DELETE","lineNumber":249,"oldContent":"            ) {"},{"type":"INSERT","lineNumber":251,"content":"            ) {"},{"type":"DELETE","lineNumber":259,"oldContent":"            Column("},{"type":"INSERT","lineNumber":261,"content":"            Column("},{"type":"DELETE","lineNumber":267,"oldContent":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"INSERT","lineNumber":269,"content":"                        isGridSurveyMode = !isGridSurveyMode"},{"type":"DELETE","lineNumber":272,"oldContent":"                        } else {"},{"type":"INSERT","lineNumber":274,"content":"                        } else {"},{"type":"DELETE","lineNumber":294,"oldContent":"                            )"},{"type":"INSERT","lineNumber":296,"content":"                            )"},{"type":"DELETE","lineNumber":299,"oldContent":"                    modifier = Modifier.size(56.dp)"},{"type":"INSERT","lineNumber":301,"content":"                    modifier = Modifier.size(56.dp)"},{"type":"DELETE","lineNumber":318,"oldContent":""},{"type":"INSERT","lineNumber":320,"content":""},{"type":"DELETE","lineNumber":328,"oldContent":"                ) {"},{"type":"INSERT","lineNumber":330,"content":"                ) {"},{"type":"DELETE","lineNumber":332,"oldContent":"                    ) {"},{"type":"MODIFY","lineNumber":336,"content":"                    ) {","oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"DELETE","lineNumber":338,"oldContent":"                            fontWeight = FontWeight.Bold"},{"type":"DELETE","lineNumber":340,"oldContent":"                        )"},{"type":"INSERT","lineNumber":339,"content":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"INSERT","lineNumber":341,"content":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":342,"content":"                        )"},{"type":"DELETE","lineNumber":344,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":346,"oldContent":"                                value = lineSpacing,"},{"type":"DELETE","lineNumber":348,"oldContent":"                                onValueChange = { lineSpacing = it },"},{"type":"DELETE","lineNumber":351,"oldContent":"                                valueRange = 10f..100f,"},{"type":"DELETE","lineNumber":353,"oldContent":"                            )"},{"type":"DELETE","lineNumber":354,"oldContent":"                        }"},{"type":"DELETE","lineNumber":355,"oldContent":"                                steps = 17,"},{"type":"INSERT","lineNumber":351,"content":"                                value = lineSpacing,"},{"type":"INSERT","lineNumber":352,"content":"                                onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":353,"content":"                                valueRange = 10f..100f,"},{"type":"INSERT","lineNumber":354,"content":"                                steps = 17,"},{"type":"DELETE","lineNumber":358,"oldContent":"                                value = gridAngle,"},{"type":"DELETE","lineNumber":361,"oldContent":"                                onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":363,"oldContent":"                        }"},{"type":"DELETE","lineNumber":365,"oldContent":""},{"type":"INSERT","lineNumber":361,"content":"                            )"},{"type":"INSERT","lineNumber":362,"content":"                        }"},{"type":"DELETE","lineNumber":369,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":371,"oldContent":"                                value = surveySpeed,"},{"type":"DELETE","lineNumber":373,"oldContent":"                                onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":375,"oldContent":"                                valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":378,"oldContent":"                            )"},{"type":"DELETE","lineNumber":379,"oldContent":"                        }"},{"type":"INSERT","lineNumber":370,"content":"                            Slider("},{"type":"INSERT","lineNumber":371,"content":"                                value = gridAngle,"},{"type":"INSERT","lineNumber":372,"content":"                                onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":382,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":384,"oldContent":"                                value = surveyAltitude,"},{"type":"DELETE","lineNumber":386,"oldContent":"                                onValueChange = { surveyAltitude = it },"},{"type":"DELETE","lineNumber":388,"oldContent":"                                valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":391,"oldContent":"                            )"},{"type":"DELETE","lineNumber":397,"oldContent":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"DELETE","lineNumber":399,"oldContent":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":401,"oldContent":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":403,"oldContent":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":405,"oldContent":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":407,"oldContent":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"DELETE","lineNumber":408,"oldContent":"                            }"},{"type":"DELETE","lineNumber":409,"oldContent":"                        }"},{"type":"DELETE","lineNumber":410,"oldContent":"                        if (surveyPolygon.size < 3) {"},{"type":"INSERT","lineNumber":390,"content":"                            Slider("},{"type":"INSERT","lineNumber":391,"content":"                                value = surveySpeed,"},{"type":"INSERT","lineNumber":392,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":393,"content":"                                valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":412,"oldContent":"                            Text("},{"type":"DELETE","lineNumber":415,"oldContent":"                                \"Tap map to add polygon vertices (need ${3 - surveyPolygon.size} more)\","},{"type":"DELETE","lineNumber":418,"oldContent":"                                color = Color.Yellow,"},{"type":"DELETE","lineNumber":420,"oldContent":"                                style = MaterialTheme.typography.bodySmall"},{"type":"INSERT","lineNumber":401,"content":"                            )"},{"type":"INSERT","lineNumber":402,"content":"                        }"},{"type":"DELETE","lineNumber":423,"oldContent":"                        Row("},{"type":"DELETE","lineNumber":424,"oldContent":""},{"type":"DELETE","lineNumber":426,"oldContent":"                            modifier = Modifier.fillMaxWidth(),"},{"type":"DELETE","lineNumber":430,"oldContent":"                        ) {"},{"type":"INSERT","lineNumber":410,"content":"                            Slider("},{"type":"INSERT","lineNumber":411,"content":"                                value = surveyAltitude,"},{"type":"INSERT","lineNumber":412,"content":"                                onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":413,"content":"                                valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":414,"content":"                                steps = 21,"},{"type":"INSERT","lineNumber":415,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":416,"content":"                                colors = SliderDefaults.colors("},{"type":"INSERT","lineNumber":417,"content":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":418,"content":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":419,"content":"                                    inactiveTrackColor = Color.Gray"},{"type":"INSERT","lineNumber":420,"content":"                                )"},{"type":"INSERT","lineNumber":421,"content":"                            )"},{"type":"INSERT","lineNumber":422,"content":"                        }"},{"type":"INSERT","lineNumber":423,"content":""},{"type":"INSERT","lineNumber":424,"content":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":425,"content":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":426,"content":"                            Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {"},{"type":"INSERT","lineNumber":427,"content":"                                Text(\"Grid Statistics:\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":428,"content":"                                Text(\"Waypoints: ${result.waypoints.size}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":429,"content":"                                Text(\"Lines: ${result.numLines}\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":430,"content":"                                Text(\"Distance: ${String.format(Locale.US, \"%.1f\", result.totalDistance / 1000)}km\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":431,"content":"                                Text(\"Time: ${String.format(Locale.US, \"%.1f\", result.estimatedTime / 60)}min\", color = Color.White, style = MaterialTheme.typography.bodySmall)"},{"type":"INSERT","lineNumber":432,"content":"                            }"},{"type":"INSERT","lineNumber":433,"content":"                        }"},{"type":"INSERT","lineNumber":434,"content":""},{"type":"INSERT","lineNumber":435,"content":"                        if (surveyPolygon.size < 3) {"},{"type":"INSERT","lineNumber":436,"content":"                            Text("},{"type":"INSERT","lineNumber":437,"content":"                                \"Tap map to add polygon vertices (need ${3 - surveyPolygon.size} more)\","},{"type":"INSERT","lineNumber":438,"content":"                                color = Color.Yellow,"},{"type":"INSERT","lineNumber":439,"content":"                                style = MaterialTheme.typography.bodySmall"},{"type":"INSERT","lineNumber":440,"content":"                            )"},{"type":"INSERT","lineNumber":441,"content":"                        }"},{"type":"INSERT","lineNumber":442,"content":""},{"type":"INSERT","lineNumber":443,"content":"                        Row("},{"type":"INSERT","lineNumber":444,"content":"                            modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":445,"content":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"INSERT","lineNumber":446,"content":"                        ) {"},{"type":"INSERT","lineNumber":447,"content":"                            Button("},{"type":"INSERT","lineNumber":449,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":450,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":452,"content":"                                Text(\"Clear\")"},{"type":"INSERT","lineNumber":454,"content":""},{"type":"DELETE","lineNumber":437,"oldContent":"                                steps = 21,"},{"type":"DELETE","lineNumber":439,"oldContent":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"DELETE","lineNumber":441,"oldContent":"                                colors = SliderDefaults.colors("},{"type":"DELETE","lineNumber":442,"oldContent":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":443,"oldContent":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":445,"oldContent":"                                    inactiveTrackColor = Color.Gray"},{"type":"DELETE","lineNumber":447,"oldContent":"                                )"},{"type":"DELETE","lineNumber":450,"oldContent":"                        gridResult?.let { result ->"},{"type":"INSERT","lineNumber":462,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"DELETE","lineNumber":452,"oldContent":"                            HorizontalDivider(color = Color.Gray, thickness = 1.dp)"},{"type":"INSERT","lineNumber":464,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":467,"content":"                    }"},{"type":"INSERT","lineNumber":468,"content":"                }"},{"type":"INSERT","lineNumber":471,"content":"            // Upload button"},{"type":"DELETE","lineNumber":461,"oldContent":""},{"type":"DELETE","lineNumber":468,"oldContent":"                            )"},{"type":"DELETE","lineNumber":470,"oldContent":"                        }"},{"type":"DELETE","lineNumber":475,"oldContent":"                            horizontalArrangement = Arrangement.spacedBy(8.dp)"},{"type":"DELETE","lineNumber":478,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":481,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":483,"oldContent":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"DELETE","lineNumber":486,"oldContent":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":488,"oldContent":""},{"type":"DELETE","lineNumber":495,"oldContent":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":502,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":503,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":498,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":505,"content":"                } else {"},{"type":"DELETE","lineNumber":502,"oldContent":"                    }"},{"type":"DELETE","lineNumber":504,"oldContent":"                }"},{"type":"DELETE","lineNumber":507,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":514,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":516,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":538,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":540,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":543,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":553,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":556,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":566,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":572,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"}]},{"timestamp":1758691987439,"changes":[{"type":"MODIFY","lineNumber":6,"content":"import androidx.compose.foundation.shape.RoundedCornerShape","oldContent":"import androidx.compose.material3.Scaffold"},{"type":"INSERT","lineNumber":7,"content":"import androidx.compose.foundation.verticalScroll"},{"type":"MODIFY","lineNumber":9,"content":"import androidx.compose.material.icons.Icons","oldContent":"import androidx.compose.runtime.collectAsState"},{"type":"DELETE","lineNumber":13,"oldContent":""},{"type":"INSERT","lineNumber":14,"content":"import androidx.compose.ui.graphics.Color"},{"type":"DELETE","lineNumber":28,"oldContent":"import com.google.android.gms.maps.CameraUpdateFactory"},{"type":"MODIFY","lineNumber":30,"content":"import com.google.android.gms.maps.CameraUpdateFactory","oldContent":"        Column("},{"type":"INSERT","lineNumber":31,"content":"import com.example.aerogcsclone.grid.*"},{"type":"DELETE","lineNumber":98,"oldContent":"                        Icon(Icons.Default.Delete, contentDescription = \"Delete Waypoints\")"},{"type":"INSERT","lineNumber":99,"content":"            autocontinue = 1u,"},{"type":"DELETE","lineNumber":100,"oldContent":"                    ) {"},{"type":"MODIFY","lineNumber":101,"content":"            x = (latLng.latitude * 1E7).toInt(),","oldContent":"                            .padding(bottom = 12.dp)"},{"type":"INSERT","lineNumber":102,"content":"            y = (latLng.longitude * 1E7).toInt(),"},{"type":"DELETE","lineNumber":338,"oldContent":"                            style = MaterialTheme.typography.titleMedium,"},{"type":"MODIFY","lineNumber":340,"content":"                            style = MaterialTheme.typography.titleMedium,","oldContent":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":342,"content":"                            fontWeight = FontWeight.Bold"},{"type":"INSERT","lineNumber":350,"content":"                            }"},{"type":"INSERT","lineNumber":351,"content":"                            Slider("},{"type":"DELETE","lineNumber":351,"oldContent":"                            }"},{"type":"DELETE","lineNumber":354,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":358,"oldContent":"                            )"},{"type":"DELETE","lineNumber":359,"oldContent":"                        }"},{"type":"INSERT","lineNumber":362,"content":"                            )"},{"type":"INSERT","lineNumber":363,"content":"                        }"},{"type":"DELETE","lineNumber":365,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":367,"oldContent":"                                value = gridAngle,"},{"type":"DELETE","lineNumber":368,"oldContent":"                                onValueChange = { gridAngle = it },"},{"type":"INSERT","lineNumber":371,"content":"                            Slider("},{"type":"INSERT","lineNumber":372,"content":"                                value = gridAngle,"},{"type":"INSERT","lineNumber":373,"content":"                                onValueChange = { gridAngle = it },"},{"type":"DELETE","lineNumber":379,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":381,"oldContent":"                                value = surveySpeed,"},{"type":"DELETE","lineNumber":382,"oldContent":"                                onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":384,"oldContent":"                                valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":391,"oldContent":"                            )"},{"type":"DELETE","lineNumber":392,"oldContent":"                        }"},{"type":"DELETE","lineNumber":397,"oldContent":"                                value = surveyAltitude,"},{"type":"INSERT","lineNumber":392,"content":"                                value = surveySpeed,"},{"type":"INSERT","lineNumber":393,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":394,"content":"                                valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":396,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":397,"content":"                                colors = SliderDefaults.colors("},{"type":"INSERT","lineNumber":398,"content":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":399,"content":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":400,"content":"                                    inactiveTrackColor = Color.Gray"},{"type":"INSERT","lineNumber":401,"content":"                                )"},{"type":"INSERT","lineNumber":402,"content":"                            )"},{"type":"INSERT","lineNumber":403,"content":"                        }"},{"type":"INSERT","lineNumber":404,"content":""},{"type":"INSERT","lineNumber":405,"content":"                        // Survey Altitude"},{"type":"INSERT","lineNumber":406,"content":"                        Column(modifier = Modifier.padding(vertical = 4.dp)) {"},{"type":"INSERT","lineNumber":407,"content":"                            Row(verticalAlignment = Alignment.CenterVertically) {"},{"type":"INSERT","lineNumber":408,"content":"                                Text(\"Altitude\", color = Color.White, modifier = Modifier.weight(1f))"},{"type":"INSERT","lineNumber":409,"content":"                                Text(\"${surveyAltitude.toInt()} m\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"INSERT","lineNumber":410,"content":"                            }"},{"type":"INSERT","lineNumber":411,"content":"                            Slider("},{"type":"INSERT","lineNumber":412,"content":"                                value = surveyAltitude,"},{"type":"DELETE","lineNumber":401,"oldContent":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"DELETE","lineNumber":403,"oldContent":"                                colors = SliderDefaults.colors("},{"type":"DELETE","lineNumber":407,"oldContent":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":409,"oldContent":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":411,"oldContent":"                                    inactiveTrackColor = Color.Gray"},{"type":"DELETE","lineNumber":414,"oldContent":"                                )"},{"type":"DELETE","lineNumber":417,"oldContent":""},{"type":"DELETE","lineNumber":420,"oldContent":"                        // Survey Altitude"},{"type":"DELETE","lineNumber":423,"oldContent":"                        Column(modifier = Modifier.padding(vertical = 4.dp)) {"},{"type":"DELETE","lineNumber":425,"oldContent":"                            Row(verticalAlignment = Alignment.CenterVertically) {"},{"type":"DELETE","lineNumber":427,"oldContent":"                                Text(\"Altitude\", color = Color.White, modifier = Modifier.weight(1f))"},{"type":"DELETE","lineNumber":430,"oldContent":"                                Text(\"${surveyAltitude.toInt()} m\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":432,"oldContent":"                            }"},{"type":"DELETE","lineNumber":434,"oldContent":"                                onClick = { surveyPolygon = emptyList(); gridResult = null },"},{"type":"DELETE","lineNumber":436,"oldContent":"                            ) {"},{"type":"DELETE","lineNumber":438,"oldContent":"                            }"},{"type":"DELETE","lineNumber":440,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":443,"oldContent":"                                onClick = {"},{"type":"DELETE","lineNumber":446,"oldContent":"                                    if (surveyPolygon.size >= 3) {"},{"type":"DELETE","lineNumber":451,"oldContent":"                                        gridAngle = gridGenerator.calculateOptimalGridAngle(surveyPolygon)"},{"type":"DELETE","lineNumber":454,"oldContent":"                                    }"},{"type":"DELETE","lineNumber":456,"oldContent":"                                },"},{"type":"INSERT","lineNumber":449,"content":"                                onClick = { surveyPolygon = emptyList(); gridResult = null },"},{"type":"DELETE","lineNumber":458,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":456,"content":"                            Button("},{"type":"INSERT","lineNumber":457,"content":"                                onClick = {"},{"type":"INSERT","lineNumber":458,"content":"                                    if (surveyPolygon.size >= 3) {"},{"type":"INSERT","lineNumber":459,"content":"                                        gridAngle = gridGenerator.calculateOptimalGridAngle(surveyPolygon)"},{"type":"INSERT","lineNumber":460,"content":"                                    }"},{"type":"INSERT","lineNumber":461,"content":"                                },"},{"type":"INSERT","lineNumber":462,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":463,"content":"                                enabled = surveyPolygon.size >= 3"},{"type":"INSERT","lineNumber":464,"content":"                            ) {"},{"type":"INSERT","lineNumber":465,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":466,"content":"                            }"},{"type":"INSERT","lineNumber":468,"content":"                    }"},{"type":"INSERT","lineNumber":469,"content":"                }"},{"type":"INSERT","lineNumber":472,"content":"            // Upload button"},{"type":"DELETE","lineNumber":471,"oldContent":"                                enabled = surveyPolygon.size >= 3"},{"type":"DELETE","lineNumber":474,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"DELETE","lineNumber":478,"oldContent":"                    }"},{"type":"DELETE","lineNumber":480,"oldContent":"                }"},{"type":"DELETE","lineNumber":482,"oldContent":"            // Upload button"},{"type":"INSERT","lineNumber":503,"content":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"INSERT","lineNumber":504,"content":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"INSERT","lineNumber":506,"content":"                } else {"},{"type":"DELETE","lineNumber":506,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":507,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":509,"oldContent":"                } else {"},{"type":"INSERT","lineNumber":515,"content":"                                MissionItemInt("},{"type":"INSERT","lineNumber":517,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":518,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":521,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":567,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":568,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":569,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":570,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":571,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":568,"content":"                    }"},{"type":"INSERT","lineNumber":569,"content":"                }"},{"type":"INSERT","lineNumber":570,"content":"            }"},{"type":"INSERT","lineNumber":571,"content":"        }"},{"type":"INSERT","lineNumber":572,"content":"    }"},{"type":"INSERT","lineNumber":573,"content":"}"},{"type":"INSERT","lineNumber":574,"content":""}]},{"timestamp":1758692402041,"changes":[{"type":"MODIFY","lineNumber":4,"content":"import androidx.compose.foundation.layout.*","oldContent":"import androidx.compose.material3.FloatingActionButton"},{"type":"DELETE","lineNumber":9,"oldContent":"import androidx.compose.runtime.Composable"},{"type":"MODIFY","lineNumber":10,"content":"import androidx.compose.material.icons.filled.*","oldContent":"import androidx.compose.runtime.collectAsState"},{"type":"INSERT","lineNumber":11,"content":"import androidx.compose.runtime.*"},{"type":"INSERT","lineNumber":17,"content":"import androidx.compose.ui.unit.dp"},{"type":"INSERT","lineNumber":18,"content":"import androidx.navigation.NavHostController"},{"type":"INSERT","lineNumber":19,"content":"import com.example.aerogcsclone.Telemetry.SharedViewModel"},{"type":"DELETE","lineNumber":18,"oldContent":""},{"type":"DELETE","lineNumber":19,"oldContent":"fun PlanScreen("},{"type":"DELETE","lineNumber":20,"oldContent":"import com.example.aerogcsclone.authentication.AuthViewModel"},{"type":"MODIFY","lineNumber":53,"content":"    var isGridSurveyMode by remember { mutableStateOf(false) }","oldContent":"                                telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"DELETE","lineNumber":350,"oldContent":"                                value = lineSpacing,"},{"type":"MODIFY","lineNumber":352,"content":"                                value = lineSpacing,","oldContent":"                                onValueChange = { lineSpacing = it },"},{"type":"INSERT","lineNumber":353,"content":"                                onValueChange = { lineSpacing = it },"},{"type":"MODIFY","lineNumber":362,"content":"                            )","oldContent":"                            )"},{"type":"DELETE","lineNumber":369,"oldContent":"                            Slider("},{"type":"MODIFY","lineNumber":371,"content":"                            Slider(","oldContent":"                                value = gridAngle,"},{"type":"INSERT","lineNumber":372,"content":"                                value = gridAngle,"},{"type":"DELETE","lineNumber":388,"oldContent":"                                value = surveySpeed,"},{"type":"DELETE","lineNumber":389,"oldContent":"                                onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":391,"oldContent":"                                valueRange = 1f..20f,"},{"type":"DELETE","lineNumber":394,"oldContent":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":392,"content":"                                value = surveySpeed,"},{"type":"INSERT","lineNumber":393,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":394,"content":"                                valueRange = 1f..20f,"},{"type":"INSERT","lineNumber":395,"content":"                                steps = 18,"},{"type":"INSERT","lineNumber":396,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"DELETE","lineNumber":398,"oldContent":"                                steps = 18,"},{"type":"DELETE","lineNumber":400,"oldContent":"                                onValueChange = { surveyAltitude = it },"},{"type":"DELETE","lineNumber":402,"oldContent":"                                valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":405,"oldContent":"                                steps = 21,"},{"type":"DELETE","lineNumber":408,"oldContent":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"DELETE","lineNumber":410,"oldContent":"                                colors = SliderDefaults.colors("},{"type":"DELETE","lineNumber":412,"oldContent":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":415,"oldContent":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"DELETE","lineNumber":418,"oldContent":"                                    inactiveTrackColor = Color.Gray"},{"type":"INSERT","lineNumber":413,"content":"                                onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":414,"content":"                                valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":415,"content":"                                steps = 21,"},{"type":"INSERT","lineNumber":416,"content":"                                modifier = Modifier.fillMaxWidth(),"},{"type":"INSERT","lineNumber":417,"content":"                                colors = SliderDefaults.colors("},{"type":"INSERT","lineNumber":418,"content":"                                    thumbColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":419,"content":"                                    activeTrackColor = MaterialTheme.colorScheme.primary,"},{"type":"INSERT","lineNumber":420,"content":"                                    inactiveTrackColor = Color.Gray"},{"type":"DELETE","lineNumber":444,"oldContent":"                                onClick = { surveyPolygon = emptyList(); gridResult = null },"},{"type":"INSERT","lineNumber":449,"content":"                                onClick = { surveyPolygon = emptyList(); gridResult = null },"},{"type":"INSERT","lineNumber":450,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":451,"content":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":452,"content":"                            ) {"},{"type":"INSERT","lineNumber":453,"content":"                                Text(\"Clear\")"},{"type":"INSERT","lineNumber":454,"content":"                            }"},{"type":"INSERT","lineNumber":455,"content":""},{"type":"DELETE","lineNumber":452,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":454,"oldContent":"                                        gridAngle = gridGenerator.calculateOptimalGridAngle(surveyPolygon)"},{"type":"DELETE","lineNumber":455,"oldContent":"                                enabled = surveyPolygon.isNotEmpty()"},{"type":"INSERT","lineNumber":459,"content":"                                        // Set grid angle perpendicular to longest side for agricultural spraying"},{"type":"INSERT","lineNumber":460,"content":"                                        val longestSideAngle = gridGenerator.calculateOptimalGridAngle(surveyPolygon)"},{"type":"INSERT","lineNumber":461,"content":"                                        gridAngle = (longestSideAngle + 90f) % 360f"},{"type":"DELETE","lineNumber":457,"oldContent":"                            ) {"},{"type":"DELETE","lineNumber":459,"oldContent":"                                Text(\"Clear\")"},{"type":"DELETE","lineNumber":461,"oldContent":"                            }"},{"type":"DELETE","lineNumber":463,"oldContent":""},{"type":"INSERT","lineNumber":467,"content":"                                Text(\"Auto Angle (Perpendicular)\")"},{"type":"INSERT","lineNumber":468,"content":"                            }"},{"type":"DELETE","lineNumber":466,"oldContent":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":470,"content":"                    }"},{"type":"INSERT","lineNumber":471,"content":"                }"},{"type":"DELETE","lineNumber":468,"oldContent":"                            }"},{"type":"INSERT","lineNumber":474,"content":"            // Upload button"},{"type":"DELETE","lineNumber":471,"oldContent":"                    }"},{"type":"DELETE","lineNumber":473,"oldContent":"                }"},{"type":"DELETE","lineNumber":476,"oldContent":"            // Upload button"},{"type":"DELETE","lineNumber":503,"oldContent":"                    }"},{"type":"DELETE","lineNumber":505,"oldContent":"                    Button("},{"type":"INSERT","lineNumber":507,"content":"                    }"},{"type":"INSERT","lineNumber":508,"content":"                } else {"},{"type":"INSERT","lineNumber":509,"content":"                    Button("},{"type":"DELETE","lineNumber":509,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":515,"oldContent":"                                    targetSystem = 0u, targetComponent = 0u, seq = 0u,"},{"type":"INSERT","lineNumber":518,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 0u,"},{"type":"INSERT","lineNumber":519,"content":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":519,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":560,"oldContent":"                        modifier = Modifier.fillMaxWidth()"},{"type":"DELETE","lineNumber":561,"oldContent":"                    ) {"},{"type":"INSERT","lineNumber":562,"content":"                                    Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":563,"content":"                                }"},{"type":"INSERT","lineNumber":564,"content":"                            }"},{"type":"INSERT","lineNumber":565,"content":"                        },"},{"type":"INSERT","lineNumber":566,"content":"                        enabled = points.isNotEmpty(),"},{"type":"INSERT","lineNumber":568,"content":"                    ) {"},{"type":"DELETE","lineNumber":564,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":565,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":566,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":567,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":574,"content":"    }"},{"type":"INSERT","lineNumber":575,"content":"}"},{"type":"INSERT","lineNumber":576,"content":""}]},{"timestamp":1758692424153,"changes":[{"type":"INSERT","lineNumber":9,"content":"import androidx.compose.material.icons.Icons"},{"type":"DELETE","lineNumber":11,"oldContent":"import androidx.compose.runtime.collectAsState"},{"type":"MODIFY","lineNumber":16,"content":"import androidx.compose.ui.text.font.FontWeight","oldContent":"import com.example.aerogcsclone.authentication.AuthViewModel"},{"type":"DELETE","lineNumber":18,"oldContent":""},{"type":"INSERT","lineNumber":20,"content":"import com.example.aerogcsclone.authentication.AuthViewModel"},{"type":"INSERT","lineNumber":351,"content":"                            Slider("},{"type":"DELETE","lineNumber":353,"oldContent":"                            Slider("},{"type":"INSERT","lineNumber":361,"content":"                                )"},{"type":"DELETE","lineNumber":362,"oldContent":"                            )"},{"type":"INSERT","lineNumber":370,"content":"                            }"},{"type":"DELETE","lineNumber":372,"oldContent":"                            }"},{"type":"DELETE","lineNumber":389,"oldContent":"                                value = surveySpeed,"},{"type":"MODIFY","lineNumber":391,"content":"                            Slider(","oldContent":"                                onValueChange = { surveySpeed = it },"},{"type":"INSERT","lineNumber":392,"content":"                                value = surveySpeed,"},{"type":"INSERT","lineNumber":393,"content":"                                onValueChange = { surveySpeed = it },"},{"type":"DELETE","lineNumber":395,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":407,"oldContent":"                                onValueChange = { surveyAltitude = it },"},{"type":"MODIFY","lineNumber":409,"content":"                                Text(\"${surveyAltitude.toInt()} m\", color = Color.White, fontWeight = FontWeight.Bold)","oldContent":"                                valueRange = 10f..120f,"},{"type":"INSERT","lineNumber":410,"content":"                            }"},{"type":"INSERT","lineNumber":411,"content":"                            Slider("},{"type":"INSERT","lineNumber":412,"content":"                                value = surveyAltitude,"},{"type":"INSERT","lineNumber":413,"content":"                                onValueChange = { surveyAltitude = it },"},{"type":"INSERT","lineNumber":414,"content":"                                valueRange = 10f..120f,"},{"type":"DELETE","lineNumber":413,"oldContent":"                                Text(\"${surveyAltitude.toInt()} m\", color = Color.White, fontWeight = FontWeight.Bold)"},{"type":"DELETE","lineNumber":415,"oldContent":"                            }"},{"type":"DELETE","lineNumber":418,"oldContent":"                            Slider("},{"type":"DELETE","lineNumber":420,"oldContent":"                                value = surveyAltitude,"},{"type":"MODIFY","lineNumber":449,"content":"                                onClick = { surveyPolygon = emptyList(); gridResult = null },","oldContent":"                                onClick = { surveyPolygon = emptyList(); gridResult = null },"},{"type":"DELETE","lineNumber":451,"oldContent":"                            Button("},{"type":"DELETE","lineNumber":453,"oldContent":"                                onClick = {"},{"type":"DELETE","lineNumber":456,"oldContent":"                                    if (surveyPolygon.size >= 3) {"},{"type":"DELETE","lineNumber":459,"oldContent":"                                    }"},{"type":"DELETE","lineNumber":460,"oldContent":"                                },"},{"type":"INSERT","lineNumber":456,"content":"                            Button("},{"type":"INSERT","lineNumber":457,"content":"                                onClick = {"},{"type":"INSERT","lineNumber":458,"content":"                                    if (surveyPolygon.size >= 3) {"},{"type":"DELETE","lineNumber":463,"oldContent":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":462,"content":"                                    }"},{"type":"INSERT","lineNumber":463,"content":"                                },"},{"type":"INSERT","lineNumber":464,"content":"                                modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":467,"content":"                                Text(\"Auto Angle\")"},{"type":"INSERT","lineNumber":468,"content":"                            }"},{"type":"DELETE","lineNumber":468,"oldContent":"                                Text(\"Auto Angle (Perpendicular)\")"},{"type":"INSERT","lineNumber":470,"content":"                    }"},{"type":"INSERT","lineNumber":471,"content":"                }"},{"type":"DELETE","lineNumber":470,"oldContent":"                            }"},{"type":"DELETE","lineNumber":472,"oldContent":"                    }"},{"type":"INSERT","lineNumber":474,"content":"            // Upload button"},{"type":"DELETE","lineNumber":474,"oldContent":"                }"},{"type":"DELETE","lineNumber":476,"oldContent":"            // Upload button"},{"type":"DELETE","lineNumber":486,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":487,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":486,"content":"                                val homePosition = LatLng(homeLat, homeLon)"},{"type":"INSERT","lineNumber":487,"content":"                                val builtMission = GridMissionConverter.convertToMissionItems(result, homePosition)"},{"type":"DELETE","lineNumber":489,"oldContent":""},{"type":"DELETE","lineNumber":490,"oldContent":"                            )"},{"type":"DELETE","lineNumber":491,"oldContent":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = homeAlt"},{"type":"DELETE","lineNumber":492,"oldContent":"                                    current = 1u, autocontinue = 1u,"},{"type":"DELETE","lineNumber":493,"oldContent":"                                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":494,"oldContent":"                                MissionItemInt("},{"type":"INSERT","lineNumber":489,"content":"                                telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"INSERT","lineNumber":490,"content":"                                    if (success) {"},{"type":"INSERT","lineNumber":491,"content":"                                        Toast.makeText(context, \"Grid survey uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":492,"content":"                                        coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"INSERT","lineNumber":493,"content":"                                        navController.navigate(Screen.Main.route) {"},{"type":"INSERT","lineNumber":494,"content":"                                            popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"DELETE","lineNumber":508,"oldContent":"                        onClick = {"},{"type":"MODIFY","lineNumber":510,"content":"                        onClick = {","oldContent":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"INSERT","lineNumber":511,"content":"                            val builtMission = mutableListOf<MissionItemInt>()"},{"type":"MODIFY","lineNumber":515,"content":"","oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":516,"content":"                            builtMission.add("},{"type":"DELETE","lineNumber":517,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":518,"oldContent":"                    }"},{"type":"DELETE","lineNumber":520,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":522,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":523,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":524,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":520,"content":"                                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":521,"content":"                                    current = 1u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":522,"content":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":523,"content":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = homeAlt"},{"type":"INSERT","lineNumber":524,"content":"                                )"},{"type":"INSERT","lineNumber":525,"content":"                            )"},{"type":"INSERT","lineNumber":526,"content":""},{"type":"INSERT","lineNumber":527,"content":"                            builtMission.add("},{"type":"DELETE","lineNumber":526,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":527,"oldContent":"                    }"},{"type":"DELETE","lineNumber":528,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":529,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":530,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":531,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":532,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":529,"content":"                                    targetSystem = 0u, targetComponent = 0u, seq = 1u,"},{"type":"DELETE","lineNumber":534,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":535,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":536,"oldContent":"                    }"},{"type":"DELETE","lineNumber":537,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":538,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":539,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":540,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"DELETE","lineNumber":541,"oldContent":"                                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":542,"oldContent":"                                MissionItemInt("},{"type":"DELETE","lineNumber":543,"oldContent":"                } else {"},{"type":"DELETE","lineNumber":544,"oldContent":"                        Text(\"Upload Grid Survey ($count waypoints)\")"},{"type":"DELETE","lineNumber":545,"oldContent":"                        val count = gridResult?.waypoints?.size ?: 0"},{"type":"DELETE","lineNumber":546,"oldContent":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":531,"content":"                                    command = MavEnumValue.of(MavCmd.NAV_TAKEOFF),"},{"type":"INSERT","lineNumber":532,"content":"                                    current = 0u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":533,"content":"                                    param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":534,"content":"                                    x = (homeLat * 1E7).toInt(), y = (homeLon * 1E7).toInt(), z = 10f"},{"type":"INSERT","lineNumber":535,"content":"                                )"},{"type":"INSERT","lineNumber":536,"content":"                            )"},{"type":"DELETE","lineNumber":548,"oldContent":"}"},{"type":"DELETE","lineNumber":549,"oldContent":"    }"},{"type":"DELETE","lineNumber":550,"oldContent":"        }"},{"type":"DELETE","lineNumber":551,"oldContent":"            }"},{"type":"DELETE","lineNumber":552,"oldContent":"                }"},{"type":"DELETE","lineNumber":553,"oldContent":"                    }"},{"type":"DELETE","lineNumber":554,"oldContent":""},{"type":"DELETE","lineNumber":555,"oldContent":"}"},{"type":"DELETE","lineNumber":556,"oldContent":"    }"},{"type":"DELETE","lineNumber":557,"oldContent":"                    ) {"},{"type":"DELETE","lineNumber":558,"oldContent":"                        enabled = points.isNotEmpty(),"},{"type":"DELETE","lineNumber":559,"oldContent":"                        },"},{"type":"INSERT","lineNumber":538,"content":"                            points.forEachIndexed { idx, latLng ->"},{"type":"INSERT","lineNumber":539,"content":"                                val seq = idx + 2"},{"type":"INSERT","lineNumber":540,"content":"                                val isLast = idx == points.lastIndex"},{"type":"INSERT","lineNumber":541,"content":"                                builtMission.add("},{"type":"INSERT","lineNumber":542,"content":"                                    MissionItemInt("},{"type":"INSERT","lineNumber":543,"content":"                                        targetSystem = 0u, targetComponent = 0u, seq = seq.toUShort(),"},{"type":"INSERT","lineNumber":544,"content":"                                        frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":545,"content":"                                        command = if (isLast) MavEnumValue.of(MavCmd.NAV_LAND) else MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":546,"content":"                                        current = 0u, autocontinue = 1u,"},{"type":"INSERT","lineNumber":547,"content":"                                        param1 = 0f, param2 = 0f, param3 = 0f, param4 = 0f,"},{"type":"INSERT","lineNumber":548,"content":"                                        x = (latLng.latitude * 1E7).toInt(),"},{"type":"INSERT","lineNumber":549,"content":"                                        y = (latLng.longitude * 1E7).toInt(), z = 10f"},{"type":"INSERT","lineNumber":550,"content":"                                    )"},{"type":"INSERT","lineNumber":551,"content":"                                )"},{"type":"INSERT","lineNumber":553,"content":""},{"type":"INSERT","lineNumber":554,"content":"                            telemetryViewModel.uploadMission(builtMission) { success, error ->"},{"type":"INSERT","lineNumber":555,"content":"                                if (success) {"},{"type":"INSERT","lineNumber":556,"content":"                                    Toast.makeText(context, \"Mission uploaded\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":557,"content":"                                    coroutineScope.launch { telemetryViewModel.readMissionFromFcu() }"},{"type":"INSERT","lineNumber":558,"content":"                                    navController.navigate(Screen.Main.route) {"},{"type":"INSERT","lineNumber":559,"content":"                                        popUpTo(Screen.Plan.route) { inclusive = true }"},{"type":"INSERT","lineNumber":560,"content":"                                    }"},{"type":"INSERT","lineNumber":561,"content":"                                } else {"},{"type":"INSERT","lineNumber":562,"content":"                                    Toast.makeText(context, error ?: \"Upload failed\", Toast.LENGTH_SHORT).show()"},{"type":"INSERT","lineNumber":564,"content":"                            }"},{"type":"INSERT","lineNumber":565,"content":"                        },"},{"type":"INSERT","lineNumber":566,"content":"                        enabled = points.isNotEmpty(),"},{"type":"INSERT","lineNumber":567,"content":"                        modifier = Modifier.widthIn(min = 180.dp, max = 340.dp).align(Alignment.CenterHorizontally)"},{"type":"INSERT","lineNumber":568,"content":"                    ) {"},{"type":"INSERT","lineNumber":569,"content":"                        Text(\"Upload Mission (${points.size})\")"},{"type":"INSERT","lineNumber":570,"content":"                    }"},{"type":"INSERT","lineNumber":571,"content":"                }"},{"type":"INSERT","lineNumber":572,"content":"            }"},{"type":"INSERT","lineNumber":573,"content":"        }"},{"type":"INSERT","lineNumber":574,"content":"    }"},{"type":"INSERT","lineNumber":575,"content":"}"},{"type":"INSERT","lineNumber":576,"content":""}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/TelemetryRepository.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/TelemetryRepository.kt","baseContent":"package com.example.aerogcsclone.Telemetry\n\nimport android.util.Log\nimport com.divpundir.mavlink.adapters.coroutines.asCoroutine\nimport com.divpundir.mavlink.adapters.coroutines.tryConnect\nimport com.divpundir.mavlink.adapters.coroutines.trySendUnsignedV2\nimport com.divpundir.mavlink.api.wrap\nimport com.divpundir.mavlink.connection.StreamState\nimport com.divpundir.mavlink.connection.tcp.TcpClientMavConnection\nimport com.divpundir.mavlink.definitions.common.*\nimport com.divpundir.mavlink.definitions.minimal.*\nimport com.google.android.gms.maps.model.LatLng\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.flow.*\nimport kotlinx.coroutines.isActive\nimport kotlinx.coroutines.launch\n\nclass MavlinkTelemetryRepository(\n    private val host: String,\n    private val port: Int\n) {\n    private var mission by mutableStateOf<List<LatLng>>(emptyList())\n    private val gcsSystemId: UByte = 200u\n    private val gcsComponentId: UByte = 1u\n    private val _state = MutableStateFlow(TelemetryState())\n    val state: StateFlow<TelemetryState> = _state.asStateFlow()\n\n    private var fcuSystemId: UByte = 0u\n    private var fcuComponentId: UByte = 0u\n\n    // Diagnostic info\n    private val _lastFailure = MutableStateFlow<Throwable?>(null)\n    val lastFailure: StateFlow<Throwable?> = _lastFailure.asStateFlow()\n\n    // Connection\n    private val connection = TcpClientMavConnection(host, port, CommonDialect).asCoroutine()\n\n    fun start() {\n        val scope = AppScope\n\n        suspend fun reconnect(scope: kotlinx.coroutines.CoroutineScope) {\n            while (scope.isActive) {\n                try {\n                    if (connection.tryConnect(scope)) {\n                        return // Exit on successful connection\n                    }\n                } catch (e: Exception) {\n                    Log.e(\"MavlinkRepo\", \"Connection attempt failed\", e)\n                    _lastFailure.value = e\n                }\n                delay(1000)\n            }\n        }\n\n        // Manage connection state + reconnects\n        scope.launch {\n            reconnect(this) // Initial connection attempt\n            connection.streamState.collect { st ->\n                when (st) {\n                    is StreamState.Active -> {\n                        if (!state.value.connected) {\n                            Log.i(\"MavlinkRepo\", \"Connection Active\")\n                            _state.update { it.copy(connected = true) }\n                        }\n                    }\n                    is StreamState.Inactive -> {\n                        if (state.value.connected) {\n                            Log.i(\"MavlinkRepo\", \"Connection Inactive, reconnecting...\")\n                            _state.update { it.copy(connected = false, fcuDetected = false) }\n                            reconnect(this)\n                        }\n                    }\n                }\n            }\n        }\n\n        // Send GCS heartbeat\n        scope.launch {\n            val heartbeat = Heartbeat(\n                type = MavType.GCS.wrap(),\n                autopilot = MavAutopilot.INVALID.wrap(),\n                baseMode = emptyList<MavModeFlag>().wrap(),\n                customMode = 0u,\n                mavlinkVersion = 3u\n            )\n            while (isActive) {\n                if (state.value.connected) {\n                    try {\n                        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, heartbeat)\n                    } catch (e: Exception) {\n                        Log.e(\"MavlinkRepo\", \"Failed to send heartbeat\", e)\n                        _lastFailure.value = e\n                    }\n                }\n                delay(1000)\n            }\n        }\n\n        // Shared message stream\n        val mavFrameStream = connection.mavFrame\n            .shareIn(scope, SharingStarted.Eagerly, replay = 0)\n\n        // Log raw messages\n        scope.launch {\n            mavFrameStream.collect {\n                Log.d(\"MavlinkRepo\", \"Frame: ${it.message.javaClass.simpleName} (sysId=${it.systemId}, compId=${it.componentId})\")\n            }\n        }\n\n        // Detect FCU\n        scope.launch {\n            mavFrameStream\n                .filter { it.message is Heartbeat && (it.message as Heartbeat).type != MavType.GCS.wrap() }\n                .collect {\n                    if (!state.value.fcuDetected) {\n                        fcuSystemId = it.systemId\n                        fcuComponentId = it.componentId\n                        Log.i(\"MavlinkRepo\", \"FCU detected sysId=$fcuSystemId compId=$fcuComponentId\")\n                        _state.update { it.copy(fcuDetected = true) }\n\n                        // Set message intervals\n                        launch {\n                            suspend fun setMessageRate(messageId: UInt, hz: Float) {\n                                val intervalUsec = if (hz <= 0f) 0f else (1_000_000f / hz)\n                                val cmd = CommandLong(\n                                    targetSystem = fcuSystemId,\n                                    targetComponent = fcuComponentId,\n                                    command = MavCmd.SET_MESSAGE_INTERVAL.wrap(),\n                                    confirmation = 0u,\n                                    param1 = messageId.toFloat(),\n                                    param2 = intervalUsec,\n                                    param3 = 0f,\n                                    param4 = 0f,\n                                    param5 = 0f,\n                                    param6 = 0f,\n                                    param7 = 0f\n                                )\n                                try {\n                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)\n                                } catch (e: Exception) {\n                                    Log.e(\"MavlinkRepo\", \"Failed to send SET_MESSAGE_INTERVAL\", e)\n                                    _lastFailure.value = e\n                                }\n                            }\n\n                            setMessageRate(1u, 1f)   // SYS_STATUS\n                            setMessageRate(24u, 1f)  // GPS_RAW_INT\n                            setMessageRate(33u, 5f)  // GLOBAL_POSITION_INT\n                            setMessageRate(74u, 5f)  // VFR_HUD\n                            setMessageRate(147u, 1f) // BATTERY_STATUS\n                        }\n                    }\n                }\n        }\n\n        // Collectors\n\n        // VFR_HUD\n        scope.launch {\n            mavFrameStream\n                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }\n                .map { it.message }\n                .filterIsInstance<VfrHud>()\n                .collect { hud ->\n                    _state.update {\n                        it.copy(\n                            altitudeMsl = hud.alt,\n                            airspeed = hud.airspeed.takeIf { v -> v > 0f },\n                            groundspeed = hud.groundspeed.takeIf { v -> v > 0f }\n                        )\n                    }\n                }\n        }\n\n        // GLOBAL_POSITION_INT\n        scope.launch {\n            mavFrameStream\n                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }\n                .map { it.message }\n                .filterIsInstance<GlobalPositionInt>()\n                .collect { gp ->\n                    val altAMSLm = gp.alt / 1000f\n                    val relAltM = gp.relativeAlt / 1000f\n                    val lat = gp.lat.takeIf { it != Int.MIN_VALUE }?.let { it / 10_000_000.0 }\n                    val lon = gp.lon.takeIf { it != Int.MIN_VALUE }?.let { it / 10_000_000.0 }\n                    _state.update {\n                        it.copy(\n                            altitudeMsl = altAMSLm,\n                            altitudeRelative = relAltM,\n                            latitude = lat,\n                            longitude = lon\n                        )\n                    }\n                }\n        }\n\n        // BATTERY_STATUS\n        scope.launch {\n            mavFrameStream\n                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }\n                .map { it.message }\n                .filterIsInstance<BatteryStatus>()\n                .collect { b ->\n                    val currentA = if (b.currentBattery.toInt() == -1) null else b.currentBattery / 100f\n                    _state.update { it.copy(currentA = currentA) }\n                }\n        }\n        //HEARTBEAT for mode, armed, armable\n        scope.launch {\n            mavFrameStream\n                .filter{ frame-> state.value.fcuDetected && frame.systemId == fcuSystemId }\n                .map{frame -> frame.message}\n                .filterIsInstance<Heartbeat>()\n                .collect{ hb->\n                    val armed = (hb.baseMode.value and MavModeFlag.SAFETY_ARMED.value )!= 0u\n                    val mode = when (hb.customMode) {\n                        0u -> \"Stabilize\"\n                        1u -> \"Acro\"\n                        2u -> \"Alt Hold\"\n                        3u -> \"Auto\"\n                        4u -> \"Guided\"\n                        5u -> \"Loiter\"\n                        6u -> \"RTL\"\n                        7u -> \"Circle\"\n                        9u -> \"Land\"\n                        11u -> \"Drift\"\n                        13u -> \"Sport\"\n                        14u -> \"Flip\"\n                        15u -> \"AutoTune\"\n                        16u -> \"Pos Hold\"\n                        17u -> \"Brake\"\n                        18u -> \"Throw\"\n                        19u -> \"Avoid_ADSB\"\n                        20u -> \"Guided_NoGPS\"\n                        21u -> \"Smart_RTL\"\n                        22u -> \"FlowHold\"\n                        23u -> \"Follow\"\n                        24u -> \"ZigZag\"\n                        25u -> \"SystemID\"\n                        26u -> \"AutoRotate\"\n                        27u -> \"Auto_RTL\"\n                        else -> \"Unknown\"\n                    }\n                    _state.update { it.copy(armed=armed , mode = mode)}\n                }\n        }\n        // SYS_STATUS\n        scope.launch {\n            mavFrameStream\n                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }\n                .map { it.message }\n                .filterIsInstance<SysStatus>()\n                .collect { s ->\n                    val vBatt = if (s.voltageBattery.toUInt() == 0xFFFFu) null else s.voltageBattery.toFloat() / 1000f\n                    val pct = if (s.batteryRemaining.toInt() == -1) null else s.batteryRemaining.toInt()\n                    val SENSOR_3D_GYRO = 1u\n                    val present = (s.onboardControlSensorsPresent.value and SENSOR_3D_GYRO) != 0u\n                    val enabled = (s.onboardControlSensorsEnabled.value and SENSOR_3D_GYRO) != 0u\n                    val healthy = (s.onboardControlSensorsHealth.value and SENSOR_3D_GYRO) != 0u\n                    val armable = present && enabled && healthy\n                    _state.update { it.copy(voltage = vBatt, batteryPercent = pct , armable = armable) }\n                }\n        }\n\n        // GPS_RAW_INT\n        scope.launch {\n            mavFrameStream\n                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }\n                .map { it.message }\n                .filterIsInstance<GpsRawInt>()\n                .collect { gps ->\n                    val sats = gps.satellitesVisible.toInt().takeIf { it >= 0 }\n                    val hdop = if (gps.eph.toUInt() == 0xFFFFu) null else gps.eph.toFloat() / 100f\n                    _state.update { it.copy(sats = sats, hdop = hdop) }\n                }\n        }\n\n        // Mission handling\n        scope.launch {\n            mavFrameStream\n                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }\n                .map { it.message }\n                .collect { message ->\n                    when (message) {\n                        is MissionRequest -> {\n                            val seq = message.seq.toInt()\n                            if (seq < mission.size) {\n                                val waypoint = mission[seq]\n                                val missionItem = MissionItemInt(\n                                    targetSystem = fcuSystemId,\n                                    targetComponent = fcuComponentId,\n                                    seq = seq.toUShort(),\n                                    frame = MavFrame.GLOBAL_RELATIVE_ALT.wrap(),\n                                    command = MavCmd.NAV_WAYPOINT.wrap(),\n                                    current = if (seq == 0) 1u else 0u,\n                                    autocontinue = 1u,\n                                    param1 = 0f,\n                                    param2 = 0f,\n                                    param3 = 0f,\n                                    param4 = 0f,\n                                    x = (waypoint.latitude * 1e7).toInt(),\n                                    y = (waypoint.longitude * 1e7).toInt(),\n                                    z = 100f, // Default altitude\n                                    missionType = MavMissionType.MISSION.wrap()\n                                )\n                                try {\n                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionItem)\n                                } catch (e: Exception) {\n                                    Log.e(\"MavlinkRepo\", \"Failed to send mission item\", e)\n                                    _lastFailure.value = e\n                                }\n                            }\n                        }\n                        is MissionAck -> {\n                            Log.i(\"MavlinkRepo\", \"Mission upload acknowledged with result: ${message.type.value}\")\n                            if (message.type == MavMissionResult.MAV_MISSION_ACCEPTED.wrap()) {\n                                _state.update { it.copy(missionLoaded = true) }\n                            }\n                        }\n                    }\n                }\n        }\n    }\n\n    suspend fun sendCommand(command: MavCmd, param1: Float = 0f, param2: Float = 0f, param3: Float = 0f, param4: Float = 0f, param5: Float = 0f, param6: Float = 0f, param7: Float = 0f) {\n        val commandLong = CommandLong(\n            targetSystem = fcuSystemId,\n            targetComponent = fcuComponentId,\n            command = command.wrap(),\n            confirmation = 0u,\n            param1 = param1,\n            param2 = param2,\n            param3 = param3,\n            param4 = param4,\n            param5 = param5,\n            param6 = param6,\n            param7 = param7\n        )\n        try {\n            connection.trySendUnsignedV2(\n               gcsSystemId,\n                gcsComponentId, commandLong)\n        } catch (e: Exception) {\n            Log.e(\"MavlinkRepo\", \"Failed to send command\", e)\n            _lastFailure.value = e\n        }\n    }\n\n    suspend fun arm() {\n        if (state.value.armable) {\n            sendCommand(\n                MavCmd.COMPONENT_ARM_DISARM,\n                1f\n            )\n        } else {\n            Log.w(\"MavlinkRepo\", \"Arm command rejected, vehicle not armable\")\n        }\n    }\n\n    suspend fun disarm() {\n        sendCommand(\n            MavCmd.COMPONENT_ARM_DISARM,\n            0f\n        )\n    }\n\n    suspend fun changeMode(mode: MavMode) {\n        sendCommand(\n            MavCmd.DO_SET_MODE,\n            mode.value.toFloat(),\n            0f\n        )\n    }\n\n    suspend fun takeoff(altitude: Float) {\n        sendCommand(\n            MavCmd.NAV_TAKEOFF,\n            -1f,\n            0f,\n            0f,\n            0f,\n            0f,\n            0f,\n            altitude\n        )\n    }\n\n    suspend fun land() {\n        sendCommand(MavCmd.NAV_LAND)\n    }\n\n    suspend fun loadMission(waypoints: List<LatLng>) {\n        mission = waypoints\n        val missionCount = MissionCount(\n            targetSystem = fcuSystemId,\n            targetComponent = fcuComponentId,\n            count = mission.size.toUShort(),\n            missionType = MavMissionType.MISSION.wrap()\n        )\n        try {\n            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionCount)\n        } catch (e: Exception) {\n            Log.e(\"MavlinkRepo\", \"Failed to send mission count\", e)\n            _lastFailure.value = e\n        }\n    }\n\n    suspend fun startMission() {\n        sendCommand(MavCmd.MISSION_START)\n    }\n}\n","baseTimestamp":1757909141732,"deltas":[{"timestamp":1758187740516,"changes":[{"type":"MODIFY","lineNumber":17,"content":"import kotlin.math.absoluteValue","oldContent":"class MavlinkTelemetryRepository("},{"type":"DELETE","lineNumber":28,"oldContent":"    private var fcuSystemId: UByte = 0u"},{"type":"DELETE","lineNumber":29,"oldContent":"    private var fcuComponentId: UByte = 0u"},{"type":"DELETE","lineNumber":30,"oldContent":""},{"type":"INSERT","lineNumber":28,"content":"class MavlinkTelemetryRepository("},{"type":"INSERT","lineNumber":29,"content":"    private val host: String,"},{"type":"INSERT","lineNumber":30,"content":"    private val port: Int"},{"type":"DELETE","lineNumber":33,"oldContent":"    val lastFailure: StateFlow<Throwable?> = _lastFailure.asStateFlow()"},{"type":"DELETE","lineNumber":34,"oldContent":""},{"type":"INSERT","lineNumber":33,"content":"    private val gcsComponentId: UByte = 1u"},{"type":"INSERT","lineNumber":34,"content":"    private val _state = MutableStateFlow(TelemetryState())"},{"type":"MODIFY","lineNumber":37,"content":"    private var fcuSystemId: UByte = 0u","oldContent":""},{"type":"INSERT","lineNumber":50,"content":"    // For total distance tracking"},{"type":"INSERT","lineNumber":51,"content":"    private val positionHistory = mutableListOf<Pair<Double, Double>>()"},{"type":"INSERT","lineNumber":52,"content":"    private var totalDistanceMeters: Float = 0f"},{"type":"INSERT","lineNumber":53,"content":"    private var lastMissionRunning = false"},{"type":"INSERT","lineNumber":54,"content":""},{"type":"DELETE","lineNumber":66,"oldContent":"                            _state.update { it.copy(connected = true) }"},{"type":"INSERT","lineNumber":71,"content":""},{"type":"DELETE","lineNumber":159,"oldContent":"        // Collectors"},{"type":"INSERT","lineNumber":164,"content":"                            setMessageRate(24u, 1f)  // GPS_RAW_INT"},{"type":"DELETE","lineNumber":214,"oldContent":"                    _state.update {"},{"type":"DELETE","lineNumber":215,"oldContent":"                        it.copy("},{"type":"DELETE","lineNumber":216,"oldContent":"                            altitudeMsl = altAMSLm,"},{"type":"DELETE","lineNumber":217,"oldContent":"                            altitudeRelative = relAltM,"},{"type":"DELETE","lineNumber":218,"oldContent":"                            latitude = lat,"},{"type":"DELETE","lineNumber":219,"oldContent":"                            longitude = lon"},{"type":"DELETE","lineNumber":220,"oldContent":"                        )"},{"type":"INSERT","lineNumber":219,"content":""},{"type":"INSERT","lineNumber":220,"content":"                    val missionRunning = state.value.mode?.equals(\"Auto\", ignoreCase = true) == true && state.value.armed"},{"type":"INSERT","lineNumber":221,"content":"                    if (missionRunning) {"},{"type":"INSERT","lineNumber":222,"content":"                        if (!lastMissionRunning) {"},{"type":"INSERT","lineNumber":223,"content":"                            positionHistory.clear()"},{"type":"INSERT","lineNumber":224,"content":"                            totalDistanceMeters = 0f"},{"type":"INSERT","lineNumber":225,"content":"                        }"},{"type":"INSERT","lineNumber":226,"content":"                        if (lat != null && lon != null) {"},{"type":"INSERT","lineNumber":227,"content":"                            if (positionHistory.isNotEmpty()) {"},{"type":"INSERT","lineNumber":228,"content":"                                val (prevLat, prevLon) = positionHistory.last()"},{"type":"INSERT","lineNumber":229,"content":"                                val dist = haversine(prevLat, prevLon, lat, lon)"},{"type":"INSERT","lineNumber":230,"content":"                                totalDistanceMeters += dist"},{"type":"INSERT","lineNumber":231,"content":"                            }"},{"type":"INSERT","lineNumber":232,"content":"                            positionHistory.add(lat to lon)"},{"type":"INSERT","lineNumber":233,"content":"                        }"},{"type":"INSERT","lineNumber":234,"content":"                        _state.update {"},{"type":"INSERT","lineNumber":235,"content":"                            it.copy("},{"type":"INSERT","lineNumber":236,"content":"                                altitudeMsl = altAMSLm,"},{"type":"INSERT","lineNumber":237,"content":"                                altitudeRelative = relAltM,"},{"type":"INSERT","lineNumber":238,"content":"                                latitude = lat,"},{"type":"INSERT","lineNumber":239,"content":"                                longitude = lon,"},{"type":"INSERT","lineNumber":240,"content":"                                totalDistanceMeters = totalDistanceMeters"},{"type":"INSERT","lineNumber":241,"content":"                            )"},{"type":"INSERT","lineNumber":242,"content":"                        }"},{"type":"INSERT","lineNumber":243,"content":"                    } else {"},{"type":"INSERT","lineNumber":244,"content":"                        _state.update {"},{"type":"INSERT","lineNumber":245,"content":"                            it.copy("},{"type":"INSERT","lineNumber":246,"content":"                                altitudeMsl = altAMSLm,"},{"type":"INSERT","lineNumber":247,"content":"                                altitudeRelative = relAltM,"},{"type":"INSERT","lineNumber":248,"content":"                                latitude = lat,"},{"type":"INSERT","lineNumber":249,"content":"                                longitude = lon,"},{"type":"INSERT","lineNumber":250,"content":"                                totalDistanceMeters = if (positionHistory.isNotEmpty()) totalDistanceMeters else null"},{"type":"INSERT","lineNumber":251,"content":"                            )"},{"type":"INSERT","lineNumber":252,"content":"                        }"},{"type":"INSERT","lineNumber":254,"content":"                    lastMissionRunning = missionRunning"},{"type":"DELETE","lineNumber":235,"oldContent":"                        18u -> \"Throw\""},{"type":"INSERT","lineNumber":268,"content":"        }"},{"type":"INSERT","lineNumber":271,"content":"        var lastMode: String? = null"},{"type":"DELETE","lineNumber":239,"oldContent":"        var lastArmed: Boolean? = null"},{"type":"DELETE","lineNumber":241,"oldContent":"                        21u -> \"Smart_RTL\""},{"type":"INSERT","lineNumber":274,"content":"            mavFrameStream"},{"type":"DELETE","lineNumber":277,"oldContent":"                    if (lastMode != mode || lastArmed != armed) {"},{"type":"INSERT","lineNumber":311,"content":"                    if (lastMode != mode || lastArmed != armed) {"},{"type":"DELETE","lineNumber":280,"oldContent":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false) }"},{"type":"INSERT","lineNumber":316,"content":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false) }"},{"type":"DELETE","lineNumber":285,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":319,"content":"                                    elapsed += 1"},{"type":"INSERT","lineNumber":320,"content":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"INSERT","lineNumber":321,"content":"                                }"},{"type":"INSERT","lineNumber":322,"content":"                                // Mission ended"},{"type":"INSERT","lineNumber":323,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":289,"oldContent":"                                    elapsed += 1"},{"type":"DELETE","lineNumber":291,"oldContent":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"DELETE","lineNumber":294,"oldContent":"                                }"},{"type":"DELETE","lineNumber":296,"oldContent":"                                // Mission ended"},{"type":"DELETE","lineNumber":303,"oldContent":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":337,"content":"                            missionTimerJob = null"},{"type":"INSERT","lineNumber":338,"content":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":307,"oldContent":"                            missionTimerJob = null"},{"type":"DELETE","lineNumber":311,"oldContent":"                        }"},{"type":"DELETE","lineNumber":313,"oldContent":"                        lastMode = mode"},{"type":"INSERT","lineNumber":347,"content":"                        }"},{"type":"INSERT","lineNumber":348,"content":"                        lastMode = mode"},{"type":"DELETE","lineNumber":321,"oldContent":"                }"},{"type":"DELETE","lineNumber":322,"oldContent":"        }"},{"type":"DELETE","lineNumber":325,"oldContent":""},{"type":"DELETE","lineNumber":327,"oldContent":"        // GPS_RAW_INT"},{"type":"DELETE","lineNumber":329,"oldContent":"        scope.launch {"},{"type":"DELETE","lineNumber":331,"oldContent":"            mavFrameStream"},{"type":"DELETE","lineNumber":333,"oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":336,"oldContent":"                .map { it.message }"},{"type":"DELETE","lineNumber":338,"oldContent":"                .filterIsInstance<GpsRawInt>()"},{"type":"DELETE","lineNumber":340,"oldContent":"                .collect { gps ->"},{"type":"DELETE","lineNumber":342,"oldContent":"                    val sats = gps.satellitesVisible.toInt().takeIf { it >= 0 }"},{"type":"DELETE","lineNumber":344,"oldContent":"                    val hdop = if (gps.eph.toUInt() == 0xFFFFu) null else gps.eph.toFloat() / 100f"},{"type":"DELETE","lineNumber":346,"oldContent":"                    _state.update { it.copy(sats = sats, hdop = hdop) }"},{"type":"DELETE","lineNumber":350,"oldContent":"                                    y = (waypoint.longitude * 1e7).toInt(),"},{"type":"INSERT","lineNumber":370,"content":""},{"type":"INSERT","lineNumber":371,"content":"        // GPS_RAW_INT"},{"type":"INSERT","lineNumber":372,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":373,"content":"            mavFrameStream"},{"type":"INSERT","lineNumber":374,"content":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":375,"content":"                .map { it.message }"},{"type":"INSERT","lineNumber":376,"content":"                .filterIsInstance<GpsRawInt>()"},{"type":"INSERT","lineNumber":377,"content":"                .collect { gps ->"},{"type":"INSERT","lineNumber":378,"content":"                    val sats = gps.satellitesVisible.toInt().takeIf { it >= 0 }"},{"type":"INSERT","lineNumber":379,"content":"                    val hdop = if (gps.eph.toUInt() == 0xFFFFu) null else gps.eph.toFloat() / 100f"},{"type":"INSERT","lineNumber":380,"content":"                    _state.update { it.copy(sats = sats, hdop = hdop) }"},{"type":"INSERT","lineNumber":381,"content":"                }"},{"type":"INSERT","lineNumber":382,"content":"        }"},{"type":"INSERT","lineNumber":383,"content":""},{"type":"INSERT","lineNumber":386,"content":""},{"type":"DELETE","lineNumber":366,"oldContent":""},{"type":"INSERT","lineNumber":424,"content":"        val commandLong = CommandLong("},{"type":"INSERT","lineNumber":425,"content":"            targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":403,"oldContent":"        val commandLong = CommandLong("},{"type":"DELETE","lineNumber":405,"oldContent":"            targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":462,"content":"     */"},{"type":"INSERT","lineNumber":463,"content":"    suspend fun changeMode(customMode: UInt): Boolean {"},{"type":"INSERT","lineNumber":464,"content":"        sendCommand("},{"type":"INSERT","lineNumber":465,"content":"            MavCmd.DO_SET_MODE,"},{"type":"INSERT","lineNumber":469,"content":"        )"},{"type":"DELETE","lineNumber":438,"oldContent":"     */"},{"type":"DELETE","lineNumber":440,"oldContent":"    suspend fun changeMode(customMode: UInt): Boolean {"},{"type":"DELETE","lineNumber":442,"oldContent":"        sendCommand("},{"type":"DELETE","lineNumber":444,"oldContent":"            MavCmd.DO_SET_MODE,"},{"type":"DELETE","lineNumber":449,"oldContent":"        )"},{"type":"INSERT","lineNumber":509,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":517,"content":"                    .collect { ack ->"},{"type":"INSERT","lineNumber":518,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":519,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":488,"oldContent":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":495,"oldContent":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":497,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":499,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":622,"content":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":626,"content":"                delay(100)"},{"type":"INSERT","lineNumber":627,"content":"            }"},{"type":"INSERT","lineNumber":628,"content":""},{"type":"DELETE","lineNumber":599,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":637,"content":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":604,"oldContent":"                delay(100)"},{"type":"DELETE","lineNumber":606,"oldContent":"            }"},{"type":"DELETE","lineNumber":608,"oldContent":""},{"type":"INSERT","lineNumber":648,"content":"                    }"},{"type":"DELETE","lineNumber":617,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":628,"oldContent":"                    }"},{"type":"INSERT","lineNumber":680,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":683,"content":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":659,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":663,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"INSERT","lineNumber":734,"content":"                }"},{"type":"DELETE","lineNumber":714,"oldContent":"                }"},{"type":"DELETE","lineNumber":731,"oldContent":"                Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to switch to AUTO mode\")"},{"type":"INSERT","lineNumber":764,"content":"     */"},{"type":"INSERT","lineNumber":775,"content":"            arm()"},{"type":"INSERT","lineNumber":785,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":755,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":794,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":765,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":774,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":785,"oldContent":"    }"},{"type":"DELETE","lineNumber":786,"oldContent":"            }"},{"type":"INSERT","lineNumber":818,"content":"            targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":819,"content":"            targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":820,"content":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"INSERT","lineNumber":821,"content":"            confirmation = 0u,"},{"type":"INSERT","lineNumber":822,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":823,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":824,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":827,"content":"            param6 = 0f,"},{"type":"DELETE","lineNumber":791,"oldContent":"}"},{"type":"DELETE","lineNumber":792,"oldContent":"    }"},{"type":"DELETE","lineNumber":793,"oldContent":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"DELETE","lineNumber":795,"oldContent":"            confirmation = 0u,"},{"type":"DELETE","lineNumber":796,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":797,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":798,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":799,"oldContent":"            param2 = 0f,"},{"type":"INSERT","lineNumber":831,"content":"    }"},{"type":"INSERT","lineNumber":832,"content":""},{"type":"INSERT","lineNumber":833,"content":"    // Haversine formula for distance in meters"},{"type":"INSERT","lineNumber":834,"content":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"INSERT","lineNumber":835,"content":"        val R = 6371000.0 // Earth radius in meters"},{"type":"INSERT","lineNumber":836,"content":"        val dLat = Math.toRadians(lat2 - lat1)"},{"type":"INSERT","lineNumber":837,"content":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"INSERT","lineNumber":838,"content":"        val a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +"},{"type":"INSERT","lineNumber":839,"content":"                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *"},{"type":"INSERT","lineNumber":840,"content":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)"},{"type":"INSERT","lineNumber":841,"content":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"INSERT","lineNumber":842,"content":"        return (R * c).toFloat()"},{"type":"INSERT","lineNumber":843,"content":"    }"},{"type":"INSERT","lineNumber":844,"content":"}"}]},{"timestamp":1758189905650,"changes":[{"type":"DELETE","lineNumber":25,"oldContent":"    private val _state = MutableStateFlow(TelemetryState())"},{"type":"DELETE","lineNumber":26,"oldContent":"    val state: StateFlow<TelemetryState> = _state.asStateFlow()"},{"type":"INSERT","lineNumber":25,"content":"    // Add other modes as needed"},{"type":"INSERT","lineNumber":26,"content":"}"},{"type":"MODIFY","lineNumber":31,"content":") {","oldContent":"    // Diagnostic info"},{"type":"DELETE","lineNumber":51,"oldContent":"    fun start() {"},{"type":"DELETE","lineNumber":53,"oldContent":"        val scope = AppScope"},{"type":"DELETE","lineNumber":55,"oldContent":""},{"type":"DELETE","lineNumber":57,"oldContent":"        suspend fun reconnect(scope: kotlinx.coroutines.CoroutineScope) {"},{"type":"INSERT","lineNumber":55,"content":"    fun start() {"},{"type":"INSERT","lineNumber":56,"content":"        val scope = AppScope"},{"type":"INSERT","lineNumber":57,"content":""},{"type":"INSERT","lineNumber":58,"content":"        suspend fun reconnect(scope: kotlinx.coroutines.CoroutineScope) {"},{"type":"INSERT","lineNumber":71,"content":""},{"type":"DELETE","lineNumber":75,"oldContent":""},{"type":"INSERT","lineNumber":164,"content":"                            setMessageRate(24u, 1f)  // GPS_RAW_INT"},{"type":"DELETE","lineNumber":168,"oldContent":"                            setMessageRate(24u, 1f)  // GPS_RAW_INT"},{"type":"DELETE","lineNumber":222,"oldContent":"                    }"},{"type":"DELETE","lineNumber":224,"oldContent":"                }"},{"type":"DELETE","lineNumber":226,"oldContent":"        }"},{"type":"DELETE","lineNumber":228,"oldContent":""},{"type":"DELETE","lineNumber":230,"oldContent":"        // BATTERY_STATUS"},{"type":"DELETE","lineNumber":232,"oldContent":"        scope.launch {"},{"type":"DELETE","lineNumber":234,"oldContent":"            mavFrameStream"},{"type":"DELETE","lineNumber":236,"oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":238,"oldContent":"                .map { it.message }"},{"type":"DELETE","lineNumber":240,"oldContent":"                .filterIsInstance<BatteryStatus>()"},{"type":"DELETE","lineNumber":242,"oldContent":"                .collect { b ->"},{"type":"DELETE","lineNumber":244,"oldContent":"                    val currentA = if (b.currentBattery.toInt() == -1) null else b.currentBattery / 100f"},{"type":"DELETE","lineNumber":246,"oldContent":"                    _state.update { it.copy(currentA = currentA) }"},{"type":"DELETE","lineNumber":248,"oldContent":"                }"},{"type":"DELETE","lineNumber":251,"oldContent":"        // HEARTBEAT for mode, armed, armable"},{"type":"DELETE","lineNumber":253,"oldContent":"        var missionTimerJob: kotlinx.coroutines.Job? = null"},{"type":"DELETE","lineNumber":255,"oldContent":"        var lastArmed: Boolean? = null"},{"type":"DELETE","lineNumber":258,"oldContent":"        scope.launch {"},{"type":"DELETE","lineNumber":261,"oldContent":"                .filter { frame -> state.value.fcuDetected && frame.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":263,"oldContent":"                .map { frame -> frame.message }"},{"type":"DELETE","lineNumber":265,"oldContent":"                .filterIsInstance<Heartbeat>()"},{"type":"DELETE","lineNumber":267,"oldContent":"                .collect { hb ->"},{"type":"DELETE","lineNumber":269,"oldContent":"                    val armed = (hb.baseMode.value and MavModeFlag.SAFETY_ARMED.value) != 0u"},{"type":"DELETE","lineNumber":271,"oldContent":"                    val mode = when (hb.customMode) {"},{"type":"DELETE","lineNumber":273,"oldContent":"                        0u -> \"Stabilize\""},{"type":"DELETE","lineNumber":275,"oldContent":"                        1u -> \"Acro\""},{"type":"DELETE","lineNumber":277,"oldContent":"                        2u -> \"Alt Hold\""},{"type":"DELETE","lineNumber":279,"oldContent":"                        3u -> \"Auto\""},{"type":"INSERT","lineNumber":253,"content":"                    }"},{"type":"INSERT","lineNumber":254,"content":"                    lastMissionRunning = missionRunning"},{"type":"INSERT","lineNumber":255,"content":"                }"},{"type":"INSERT","lineNumber":256,"content":"        }"},{"type":"INSERT","lineNumber":257,"content":""},{"type":"INSERT","lineNumber":258,"content":"        // BATTERY_STATUS"},{"type":"INSERT","lineNumber":259,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":260,"content":"            mavFrameStream"},{"type":"INSERT","lineNumber":261,"content":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":262,"content":"                .map { it.message }"},{"type":"INSERT","lineNumber":263,"content":"                .filterIsInstance<BatteryStatus>()"},{"type":"INSERT","lineNumber":264,"content":"                .collect { b ->"},{"type":"INSERT","lineNumber":265,"content":"                    val currentA = if (b.currentBattery.toInt() == -1) null else b.currentBattery / 100f"},{"type":"INSERT","lineNumber":266,"content":"                    _state.update { it.copy(currentA = currentA) }"},{"type":"INSERT","lineNumber":267,"content":"                }"},{"type":"INSERT","lineNumber":268,"content":"        }"},{"type":"INSERT","lineNumber":269,"content":"        // HEARTBEAT for mode, armed, armable"},{"type":"INSERT","lineNumber":270,"content":"        var missionTimerJob: kotlinx.coroutines.Job? = null"},{"type":"INSERT","lineNumber":271,"content":"        var lastMode: String? = null"},{"type":"INSERT","lineNumber":272,"content":"        var lastArmed: Boolean? = null"},{"type":"INSERT","lineNumber":273,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":274,"content":"            mavFrameStream"},{"type":"INSERT","lineNumber":275,"content":"                .filter { frame -> state.value.fcuDetected && frame.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":276,"content":"                .map { frame -> frame.message }"},{"type":"INSERT","lineNumber":277,"content":"                .filterIsInstance<Heartbeat>()"},{"type":"INSERT","lineNumber":278,"content":"                .collect { hb ->"},{"type":"INSERT","lineNumber":279,"content":"                    val armed = (hb.baseMode.value and MavModeFlag.SAFETY_ARMED.value) != 0u"},{"type":"INSERT","lineNumber":280,"content":"                    val mode = when (hb.customMode) {"},{"type":"INSERT","lineNumber":281,"content":"                        0u -> \"Stabilize\""},{"type":"INSERT","lineNumber":282,"content":"                        1u -> \"Acro\""},{"type":"INSERT","lineNumber":283,"content":"                        2u -> \"Alt Hold\""},{"type":"INSERT","lineNumber":284,"content":"                        3u -> \"Auto\""},{"type":"DELETE","lineNumber":283,"oldContent":"                    lastMissionRunning = missionRunning"},{"type":"DELETE","lineNumber":298,"oldContent":"        }"},{"type":"DELETE","lineNumber":302,"oldContent":"        var lastMode: String? = null"},{"type":"DELETE","lineNumber":305,"oldContent":"            mavFrameStream"},{"type":"MODIFY","lineNumber":306,"content":"                        else -> \"Unknown\"","oldContent":"            mavFrameStream"},{"type":"INSERT","lineNumber":311,"content":"                    if (lastMode != mode || lastArmed != armed) {"},{"type":"INSERT","lineNumber":316,"content":"                                val startTs = System.currentTimeMillis() / 1000L"},{"type":"INSERT","lineNumber":317,"content":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false, missionStartTimestamp = startTs, missionEndTimestamp = null) }"},{"type":"INSERT","lineNumber":320,"content":"                                    elapsed += 1"},{"type":"INSERT","lineNumber":321,"content":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"INSERT","lineNumber":322,"content":"                                }"},{"type":"INSERT","lineNumber":323,"content":"                                // Mission ended"},{"type":"INSERT","lineNumber":324,"content":"                                val endTs = System.currentTimeMillis() / 1000L"},{"type":"INSERT","lineNumber":325,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true, missionEndTimestamp = endTs) }"},{"type":"INSERT","lineNumber":339,"content":"                            missionTimerJob = null"},{"type":"INSERT","lineNumber":340,"content":"                            val endTs = System.currentTimeMillis() / 1000L"},{"type":"INSERT","lineNumber":341,"content":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true, missionEndTimestamp = endTs) }"},{"type":"DELETE","lineNumber":335,"oldContent":"                    if (lastMode != mode || lastArmed != armed) {"},{"type":"DELETE","lineNumber":339,"oldContent":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false) }"},{"type":"INSERT","lineNumber":350,"content":"                        }"},{"type":"INSERT","lineNumber":351,"content":"                        lastMode = mode"},{"type":"DELETE","lineNumber":343,"oldContent":"                                    elapsed += 1"},{"type":"DELETE","lineNumber":345,"oldContent":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"DELETE","lineNumber":347,"oldContent":"                                }"},{"type":"DELETE","lineNumber":348,"oldContent":"                                // Mission ended"},{"type":"DELETE","lineNumber":349,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":358,"oldContent":"                            missionTimerJob = null"},{"type":"DELETE","lineNumber":360,"oldContent":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":365,"oldContent":"                        }"},{"type":"DELETE","lineNumber":367,"oldContent":"                        lastMode = mode"},{"type":"DELETE","lineNumber":370,"oldContent":"                                    z = 100f, // Default altitude"},{"type":"INSERT","lineNumber":374,"content":"        // GPS_RAW_INT"},{"type":"INSERT","lineNumber":375,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":376,"content":"            mavFrameStream"},{"type":"INSERT","lineNumber":377,"content":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":378,"content":"                .map { it.message }"},{"type":"INSERT","lineNumber":379,"content":"                .filterIsInstance<GpsRawInt>()"},{"type":"INSERT","lineNumber":380,"content":"                .collect { gps ->"},{"type":"INSERT","lineNumber":381,"content":"                    val sats = gps.satellitesVisible.toInt().takeIf { it >= 0 }"},{"type":"INSERT","lineNumber":382,"content":"                    val hdop = if (gps.eph.toUInt() == 0xFFFFu) null else gps.eph.toFloat() / 100f"},{"type":"INSERT","lineNumber":383,"content":"                    _state.update { it.copy(sats = sats, hdop = hdop) }"},{"type":"INSERT","lineNumber":384,"content":"                }"},{"type":"INSERT","lineNumber":385,"content":"        }"},{"type":"INSERT","lineNumber":386,"content":""},{"type":"INSERT","lineNumber":387,"content":"        // Mission progress logging: MISSION_ITEM_REACHED, MISSION_CURRENT, and mode"},{"type":"INSERT","lineNumber":388,"content":""},{"type":"INSERT","lineNumber":389,"content":""},{"type":"DELETE","lineNumber":388,"oldContent":""},{"type":"DELETE","lineNumber":390,"oldContent":"        // GPS_RAW_INT"},{"type":"DELETE","lineNumber":392,"oldContent":"        scope.launch {"},{"type":"DELETE","lineNumber":394,"oldContent":"            mavFrameStream"},{"type":"DELETE","lineNumber":396,"oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":398,"oldContent":"                .map { it.message }"},{"type":"DELETE","lineNumber":400,"oldContent":"                .filterIsInstance<GpsRawInt>()"},{"type":"DELETE","lineNumber":402,"oldContent":"                .collect { gps ->"},{"type":"DELETE","lineNumber":404,"oldContent":"                    val sats = gps.satellitesVisible.toInt().takeIf { it >= 0 }"},{"type":"DELETE","lineNumber":406,"oldContent":"                    val hdop = if (gps.eph.toUInt() == 0xFFFFu) null else gps.eph.toFloat() / 100f"},{"type":"DELETE","lineNumber":408,"oldContent":"                    _state.update { it.copy(sats = sats, hdop = hdop) }"},{"type":"DELETE","lineNumber":410,"oldContent":"                }"},{"type":"DELETE","lineNumber":412,"oldContent":"        }"},{"type":"DELETE","lineNumber":414,"oldContent":""},{"type":"DELETE","lineNumber":418,"oldContent":""},{"type":"INSERT","lineNumber":427,"content":"        val commandLong = CommandLong("},{"type":"INSERT","lineNumber":428,"content":"            targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":455,"oldContent":"        val commandLong = CommandLong("},{"type":"DELETE","lineNumber":457,"oldContent":"            targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":465,"content":"     */"},{"type":"INSERT","lineNumber":466,"content":"    suspend fun changeMode(customMode: UInt): Boolean {"},{"type":"INSERT","lineNumber":467,"content":"        sendCommand("},{"type":"INSERT","lineNumber":468,"content":"            MavCmd.DO_SET_MODE,"},{"type":"INSERT","lineNumber":472,"content":"        )"},{"type":"DELETE","lineNumber":490,"oldContent":"     */"},{"type":"DELETE","lineNumber":492,"oldContent":"    suspend fun changeMode(customMode: UInt): Boolean {"},{"type":"DELETE","lineNumber":494,"oldContent":"        sendCommand("},{"type":"DELETE","lineNumber":496,"oldContent":"            MavCmd.DO_SET_MODE,"},{"type":"DELETE","lineNumber":501,"oldContent":"        )"},{"type":"INSERT","lineNumber":512,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":520,"content":"                    .collect { ack ->"},{"type":"INSERT","lineNumber":521,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":522,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":538,"oldContent":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":547,"oldContent":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":549,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":551,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":625,"content":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":629,"content":"                delay(100)"},{"type":"INSERT","lineNumber":630,"content":"            }"},{"type":"INSERT","lineNumber":631,"content":""},{"type":"INSERT","lineNumber":640,"content":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":651,"content":"                    }"},{"type":"DELETE","lineNumber":650,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"DELETE","lineNumber":655,"oldContent":"                delay(100)"},{"type":"DELETE","lineNumber":657,"oldContent":"            }"},{"type":"DELETE","lineNumber":659,"oldContent":""},{"type":"DELETE","lineNumber":668,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":683,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":680,"oldContent":"                    }"},{"type":"INSERT","lineNumber":686,"content":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":711,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":715,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"INSERT","lineNumber":737,"content":"                }"},{"type":"DELETE","lineNumber":756,"oldContent":"    }"},{"type":"INSERT","lineNumber":760,"content":""},{"type":"INSERT","lineNumber":767,"content":"     */"},{"type":"DELETE","lineNumber":765,"oldContent":"                }"},{"type":"INSERT","lineNumber":778,"content":"            arm()"},{"type":"INSERT","lineNumber":788,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":797,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":795,"oldContent":"     */"},{"type":"DELETE","lineNumber":805,"oldContent":"            arm()"},{"type":"DELETE","lineNumber":812,"oldContent":"    }"},{"type":"DELETE","lineNumber":813,"oldContent":"            }"},{"type":"DELETE","lineNumber":814,"oldContent":"                    else -> {}"},{"type":"DELETE","lineNumber":815,"oldContent":"                    }"},{"type":"DELETE","lineNumber":816,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":817,"content":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"INSERT","lineNumber":818,"content":"     */"},{"type":"INSERT","lineNumber":819,"content":"    suspend fun sendMissionStartCommand() {"},{"type":"INSERT","lineNumber":820,"content":"        val cmd = CommandLong("},{"type":"INSERT","lineNumber":821,"content":"            targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":822,"content":"            targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":823,"content":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"INSERT","lineNumber":824,"content":"            confirmation = 0u,"},{"type":"INSERT","lineNumber":825,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":826,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":827,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":830,"content":"            param6 = 0f,"},{"type":"DELETE","lineNumber":821,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":823,"oldContent":"}"},{"type":"DELETE","lineNumber":825,"oldContent":"        return (R * c).toFloat()"},{"type":"DELETE","lineNumber":826,"oldContent":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"DELETE","lineNumber":827,"oldContent":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)"},{"type":"DELETE","lineNumber":828,"oldContent":"                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *"},{"type":"DELETE","lineNumber":829,"oldContent":"        val a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +"},{"type":"DELETE","lineNumber":830,"oldContent":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"DELETE","lineNumber":831,"oldContent":"        val dLat = Math.toRadians(lat2 - lat1)"},{"type":"DELETE","lineNumber":832,"oldContent":"        val R = 6371000.0 // Earth radius in meters"},{"type":"DELETE","lineNumber":833,"oldContent":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"DELETE","lineNumber":834,"oldContent":"    // Haversine formula for distance in meters"},{"type":"INSERT","lineNumber":836,"content":"    // Haversine formula for distance in meters"},{"type":"INSERT","lineNumber":837,"content":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"INSERT","lineNumber":838,"content":"        val R = 6371000.0 // Earth radius in meters"},{"type":"INSERT","lineNumber":839,"content":"        val dLat = Math.toRadians(lat2 - lat1)"},{"type":"INSERT","lineNumber":840,"content":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"INSERT","lineNumber":841,"content":"        val a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +"},{"type":"INSERT","lineNumber":842,"content":"                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *"},{"type":"INSERT","lineNumber":843,"content":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)"},{"type":"INSERT","lineNumber":844,"content":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"INSERT","lineNumber":845,"content":"        return (R * c).toFloat()"},{"type":"DELETE","lineNumber":837,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":838,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":839,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":840,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":841,"oldContent":"            targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":842,"oldContent":"            confirmation = 0u,"},{"type":"DELETE","lineNumber":843,"oldContent":"            targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":844,"oldContent":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"INSERT","lineNumber":847,"content":"}"}]},{"timestamp":1758190130735,"changes":[{"type":"INSERT","lineNumber":53,"content":"    private var lastMissionRunning = false"},{"type":"INSERT","lineNumber":54,"content":""},{"type":"DELETE","lineNumber":55,"oldContent":"    private var lastMissionRunning = false"},{"type":"DELETE","lineNumber":58,"oldContent":""},{"type":"INSERT","lineNumber":238,"content":"                                latitude = lat,"},{"type":"INSERT","lineNumber":239,"content":"                                longitude = lon,"},{"type":"INSERT","lineNumber":240,"content":"                                totalDistanceMeters = totalDistanceMeters"},{"type":"INSERT","lineNumber":241,"content":"                            )"},{"type":"INSERT","lineNumber":242,"content":"                        }"},{"type":"INSERT","lineNumber":243,"content":"                    } else {"},{"type":"INSERT","lineNumber":244,"content":"                        _state.update {"},{"type":"INSERT","lineNumber":245,"content":"                            it.copy("},{"type":"INSERT","lineNumber":246,"content":"                                altitudeMsl = altAMSLm,"},{"type":"INSERT","lineNumber":247,"content":"                                altitudeRelative = relAltM,"},{"type":"INSERT","lineNumber":248,"content":"                                latitude = lat,"},{"type":"INSERT","lineNumber":249,"content":"                                longitude = lon,"},{"type":"INSERT","lineNumber":250,"content":"                                totalDistanceMeters = if (positionHistory.isNotEmpty()) totalDistanceMeters else null"},{"type":"INSERT","lineNumber":251,"content":"                            )"},{"type":"INSERT","lineNumber":252,"content":"                        }"},{"type":"DELETE","lineNumber":240,"oldContent":"                                latitude = lat,"},{"type":"DELETE","lineNumber":243,"oldContent":"                                longitude = lon,"},{"type":"DELETE","lineNumber":245,"oldContent":"                                totalDistanceMeters = totalDistanceMeters"},{"type":"DELETE","lineNumber":248,"oldContent":"                            )"},{"type":"DELETE","lineNumber":250,"oldContent":"                        }"},{"type":"DELETE","lineNumber":253,"oldContent":"                    } else {"},{"type":"DELETE","lineNumber":256,"oldContent":"                        _state.update {"},{"type":"DELETE","lineNumber":259,"oldContent":"                            it.copy("},{"type":"DELETE","lineNumber":262,"oldContent":"                                altitudeMsl = altAMSLm,"},{"type":"DELETE","lineNumber":265,"oldContent":"                                altitudeRelative = relAltM,"},{"type":"DELETE","lineNumber":268,"oldContent":"                                latitude = lat,"},{"type":"DELETE","lineNumber":271,"oldContent":"                                longitude = lon,"},{"type":"DELETE","lineNumber":274,"oldContent":"                                totalDistanceMeters = if (positionHistory.isNotEmpty()) totalDistanceMeters else null"},{"type":"DELETE","lineNumber":277,"oldContent":"                            )"},{"type":"DELETE","lineNumber":280,"oldContent":"                        }"},{"type":"DELETE","lineNumber":282,"oldContent":"                        4u -> \"Guided\""},{"type":"MODIFY","lineNumber":285,"content":"                        4u -> \"Guided\"","oldContent":"                        5u -> \"Loiter\""},{"type":"INSERT","lineNumber":286,"content":"                        5u -> \"Loiter\""},{"type":"INSERT","lineNumber":316,"content":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false) }"},{"type":"DELETE","lineNumber":317,"oldContent":"                                val startTs = System.currentTimeMillis() / 1000L"},{"type":"MODIFY","lineNumber":319,"content":"                                    elapsed += 1","oldContent":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false, missionStartTimestamp = startTs, missionEndTimestamp = null) }"},{"type":"INSERT","lineNumber":320,"content":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"INSERT","lineNumber":321,"content":"                                }"},{"type":"INSERT","lineNumber":322,"content":"                                // Mission ended"},{"type":"INSERT","lineNumber":323,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":323,"oldContent":"                                    elapsed += 1"},{"type":"DELETE","lineNumber":325,"oldContent":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"DELETE","lineNumber":327,"oldContent":"                                }"},{"type":"DELETE","lineNumber":329,"oldContent":"                                // Mission ended"},{"type":"DELETE","lineNumber":331,"oldContent":"                                val endTs = System.currentTimeMillis() / 1000L"},{"type":"DELETE","lineNumber":333,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true, missionEndTimestamp = endTs) }"},{"type":"INSERT","lineNumber":337,"content":"                            missionTimerJob = null"},{"type":"INSERT","lineNumber":338,"content":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":347,"oldContent":"                            missionTimerJob = null"},{"type":"DELETE","lineNumber":348,"oldContent":"                            val endTs = System.currentTimeMillis() / 1000L"},{"type":"INSERT","lineNumber":347,"content":"                        }"},{"type":"INSERT","lineNumber":348,"content":"                        lastMode = mode"},{"type":"DELETE","lineNumber":350,"oldContent":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true, missionEndTimestamp = endTs) }"},{"type":"DELETE","lineNumber":355,"oldContent":"                        }"},{"type":"DELETE","lineNumber":357,"oldContent":"                        lastMode = mode"},{"type":"DELETE","lineNumber":374,"oldContent":"        // Helper to request mission items from FCU and return as list"},{"type":"DELETE","lineNumber":375,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":377,"oldContent":"            val items = mutableListOf<MissionItemInt>()"},{"type":"DELETE","lineNumber":379,"oldContent":"            val expectedCountDeferred = CompletableDeferred<Int?>()"},{"type":"DELETE","lineNumber":381,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":383,"oldContent":"            val job = AppScope.launch {"},{"type":"DELETE","lineNumber":385,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":387,"oldContent":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":389,"oldContent":"                        is MissionCount -> {"},{"type":"DELETE","lineNumber":391,"oldContent":"                            expectedCountDeferred.complete(msg.count.toInt())"},{"type":"DELETE","lineNumber":393,"oldContent":"                        }"},{"type":"DELETE","lineNumber":395,"oldContent":"                        is MissionItemInt -> {"},{"type":"DELETE","lineNumber":397,"oldContent":"                            items.add(msg)"},{"type":"DELETE","lineNumber":399,"oldContent":"                            perSeqMap[msg.seq.toInt()]?.let { d -> if (!d.isCompleted) d.complete(Unit) }"},{"type":"DELETE","lineNumber":401,"oldContent":"                        }"},{"type":"DELETE","lineNumber":403,"oldContent":"                        else -> {}"},{"type":"INSERT","lineNumber":387,"content":"        // Helper to request mission items from FCU and return as list"},{"type":"INSERT","lineNumber":388,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":389,"content":"            val items = mutableListOf<MissionItemInt>()"},{"type":"INSERT","lineNumber":390,"content":"            val expectedCountDeferred = CompletableDeferred<Int?>()"},{"type":"INSERT","lineNumber":391,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":392,"content":"            val job = AppScope.launch {"},{"type":"INSERT","lineNumber":393,"content":"                connection.mavFrame.collect { frame ->"},{"type":"INSERT","lineNumber":394,"content":"                    when (val msg = frame.message) {"},{"type":"INSERT","lineNumber":395,"content":"                        is MissionCount -> {"},{"type":"INSERT","lineNumber":396,"content":"                            expectedCountDeferred.complete(msg.count.toInt())"},{"type":"INSERT","lineNumber":397,"content":"                        }"},{"type":"INSERT","lineNumber":398,"content":"                        is MissionItemInt -> {"},{"type":"INSERT","lineNumber":399,"content":"                            items.add(msg)"},{"type":"INSERT","lineNumber":400,"content":"                            perSeqMap[msg.seq.toInt()]?.let { d -> if (!d.isCompleted) d.complete(Unit) }"},{"type":"INSERT","lineNumber":401,"content":"                        }"},{"type":"INSERT","lineNumber":402,"content":"                        else -> {}"},{"type":"INSERT","lineNumber":424,"content":"        val commandLong = CommandLong("},{"type":"INSERT","lineNumber":425,"content":"            targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":430,"oldContent":"        val commandLong = CommandLong("},{"type":"DELETE","lineNumber":432,"oldContent":"            targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":462,"oldContent":"            mode.value.toFloat(),"},{"type":"INSERT","lineNumber":459,"content":"    /**"},{"type":"INSERT","lineNumber":462,"content":"     */"},{"type":"INSERT","lineNumber":463,"content":"    suspend fun changeMode(customMode: UInt): Boolean {"},{"type":"INSERT","lineNumber":464,"content":"        sendCommand("},{"type":"INSERT","lineNumber":465,"content":"            MavCmd.DO_SET_MODE,"},{"type":"DELETE","lineNumber":468,"oldContent":"     */"},{"type":"INSERT","lineNumber":469,"content":"        )"},{"type":"DELETE","lineNumber":470,"oldContent":"    suspend fun changeMode(customMode: UInt): Boolean {"},{"type":"DELETE","lineNumber":472,"oldContent":"        sendCommand("},{"type":"DELETE","lineNumber":474,"oldContent":"            MavCmd.DO_SET_MODE,"},{"type":"DELETE","lineNumber":479,"oldContent":"        )"},{"type":"INSERT","lineNumber":509,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":515,"oldContent":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":517,"content":"                    .collect { ack ->"},{"type":"INSERT","lineNumber":518,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":519,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":524,"oldContent":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":526,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":528,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":622,"content":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"DELETE","lineNumber":628,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":626,"content":"                delay(100)"},{"type":"INSERT","lineNumber":627,"content":"            }"},{"type":"INSERT","lineNumber":628,"content":""},{"type":"DELETE","lineNumber":633,"oldContent":"                delay(100)"},{"type":"DELETE","lineNumber":635,"oldContent":"            }"},{"type":"MODIFY","lineNumber":637,"content":"                        targetComponent = fcuComponentId,","oldContent":""},{"type":"DELETE","lineNumber":647,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":648,"content":"                    }"},{"type":"DELETE","lineNumber":658,"oldContent":"                    }"},{"type":"INSERT","lineNumber":680,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":683,"content":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":686,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":690,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"INSERT","lineNumber":707,"content":"            }"},{"type":"DELETE","lineNumber":711,"oldContent":""},{"type":"INSERT","lineNumber":734,"content":"                }"},{"type":"DELETE","lineNumber":740,"oldContent":"                }"},{"type":"DELETE","lineNumber":758,"oldContent":"}"},{"type":"INSERT","lineNumber":755,"content":"        }"},{"type":"INSERT","lineNumber":757,"content":""},{"type":"DELETE","lineNumber":763,"oldContent":""},{"type":"INSERT","lineNumber":764,"content":"     */"},{"type":"DELETE","lineNumber":770,"oldContent":"     */"},{"type":"INSERT","lineNumber":775,"content":"            arm()"},{"type":"DELETE","lineNumber":782,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":785,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":793,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":794,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":802,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":813,"oldContent":"                }"},{"type":"INSERT","lineNumber":810,"content":"        return true"},{"type":"DELETE","lineNumber":816,"oldContent":"                    }"},{"type":"INSERT","lineNumber":813,"content":"    /**"},{"type":"DELETE","lineNumber":818,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":820,"oldContent":"            param5 = 0f,"},{"type":"DELETE","lineNumber":822,"oldContent":"            param7 = 0f"},{"type":"DELETE","lineNumber":824,"oldContent":"        )"},{"type":"DELETE","lineNumber":827,"oldContent":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"DELETE","lineNumber":830,"oldContent":"    }"},{"type":"INSERT","lineNumber":825,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":826,"content":"            param5 = 0f,"},{"type":"INSERT","lineNumber":828,"content":"            param7 = 0f"},{"type":"INSERT","lineNumber":829,"content":"        )"},{"type":"INSERT","lineNumber":830,"content":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"INSERT","lineNumber":831,"content":"    }"},{"type":"DELETE","lineNumber":837,"oldContent":"    }"},{"type":"INSERT","lineNumber":843,"content":"    }"}]},{"timestamp":1758190224848,"changes":[{"type":"MODIFY","lineNumber":23,"content":"    const val AUTO: UInt = 3u","oldContent":"    private val gcsComponentId: UByte = 1u"},{"type":"MODIFY","lineNumber":35,"content":"    val state: StateFlow<TelemetryState> = _state.asStateFlow()","oldContent":"    // Connection"},{"type":"DELETE","lineNumber":47,"oldContent":"                } catch (e: Exception) {"},{"type":"DELETE","lineNumber":48,"oldContent":"                    _lastFailure.value = e"},{"type":"INSERT","lineNumber":47,"content":"    // MAVLink command value for MISSION_CLEAR_ALL"},{"type":"INSERT","lineNumber":48,"content":"    private val MISSION_CLEAR_ALL_CMD: UInt = 45u"},{"type":"MODIFY","lineNumber":55,"content":"    fun start() {","oldContent":"    fun start() {"},{"type":"DELETE","lineNumber":239,"oldContent":"                    }"},{"type":"DELETE","lineNumber":241,"oldContent":"                    lastMissionRunning = missionRunning"},{"type":"DELETE","lineNumber":244,"oldContent":"                }"},{"type":"DELETE","lineNumber":246,"oldContent":"        }"},{"type":"DELETE","lineNumber":249,"oldContent":""},{"type":"DELETE","lineNumber":252,"oldContent":"        // BATTERY_STATUS"},{"type":"DELETE","lineNumber":254,"oldContent":"        scope.launch {"},{"type":"DELETE","lineNumber":257,"oldContent":"            mavFrameStream"},{"type":"DELETE","lineNumber":260,"oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":253,"content":"                    }"},{"type":"INSERT","lineNumber":254,"content":"                    lastMissionRunning = missionRunning"},{"type":"INSERT","lineNumber":255,"content":"                }"},{"type":"INSERT","lineNumber":256,"content":"        }"},{"type":"INSERT","lineNumber":257,"content":""},{"type":"INSERT","lineNumber":258,"content":"        // BATTERY_STATUS"},{"type":"INSERT","lineNumber":259,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":260,"content":"            mavFrameStream"},{"type":"INSERT","lineNumber":261,"content":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"MODIFY","lineNumber":283,"content":"                        2u -> \"Alt Hold\"","oldContent":"                        5u -> \"Loiter\""},{"type":"INSERT","lineNumber":284,"content":"                        3u -> \"Auto\""},{"type":"DELETE","lineNumber":286,"oldContent":"                        3u -> \"Auto\""},{"type":"DELETE","lineNumber":321,"oldContent":"                                // Clear mission from FCU"},{"type":"DELETE","lineNumber":323,"oldContent":"                                val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":325,"oldContent":"                                try {"},{"type":"INSERT","lineNumber":324,"content":"                                // Clear mission from FCU"},{"type":"INSERT","lineNumber":325,"content":"                                val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":326,"content":"                                try {"},{"type":"DELETE","lineNumber":335,"oldContent":"                            missionTimerJob = null"},{"type":"MODIFY","lineNumber":337,"content":"                            missionTimerJob = null","oldContent":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":338,"content":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":377,"content":"                .collect { gps ->"},{"type":"INSERT","lineNumber":378,"content":"                    val sats = gps.satellitesVisible.toInt().takeIf { it >= 0 }"},{"type":"INSERT","lineNumber":379,"content":"                    val hdop = if (gps.eph.toUInt() == 0xFFFFu) null else gps.eph.toFloat() / 100f"},{"type":"INSERT","lineNumber":380,"content":"                    _state.update { it.copy(sats = sats, hdop = hdop) }"},{"type":"INSERT","lineNumber":381,"content":"                }"},{"type":"INSERT","lineNumber":382,"content":"        }"},{"type":"INSERT","lineNumber":383,"content":""},{"type":"INSERT","lineNumber":384,"content":"        // Mission progress logging: MISSION_ITEM_REACHED, MISSION_CURRENT, and mode"},{"type":"INSERT","lineNumber":385,"content":""},{"type":"INSERT","lineNumber":386,"content":""},{"type":"DELETE","lineNumber":379,"oldContent":"                .collect { gps ->"},{"type":"DELETE","lineNumber":382,"oldContent":"                    val sats = gps.satellitesVisible.toInt().takeIf { it >= 0 }"},{"type":"DELETE","lineNumber":385,"oldContent":"                    val hdop = if (gps.eph.toUInt() == 0xFFFFu) null else gps.eph.toFloat() / 100f"},{"type":"DELETE","lineNumber":388,"oldContent":"                    _state.update { it.copy(sats = sats, hdop = hdop) }"},{"type":"DELETE","lineNumber":391,"oldContent":"                }"},{"type":"DELETE","lineNumber":394,"oldContent":"        }"},{"type":"DELETE","lineNumber":397,"oldContent":""},{"type":"DELETE","lineNumber":400,"oldContent":"        // Mission progress logging: MISSION_ITEM_REACHED, MISSION_CURRENT, and mode"},{"type":"DELETE","lineNumber":401,"oldContent":""},{"type":"DELETE","lineNumber":402,"oldContent":""},{"type":"DELETE","lineNumber":421,"oldContent":"        val commandLong = CommandLong("},{"type":"DELETE","lineNumber":423,"oldContent":"            targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":424,"content":"        val commandLong = CommandLong("},{"type":"INSERT","lineNumber":425,"content":"            targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":456,"oldContent":"    /**"},{"type":"INSERT","lineNumber":459,"content":"    /**"},{"type":"INSERT","lineNumber":460,"content":"     * Change vehicle mode (ArduPilot: param1=1, param2=customMode)"},{"type":"INSERT","lineNumber":461,"content":"     * Waits for Heartbeat confirmation."},{"type":"DELETE","lineNumber":462,"oldContent":"     * Change vehicle mode (ArduPilot: param1=1, param2=customMode)"},{"type":"DELETE","lineNumber":464,"oldContent":"     * Waits for Heartbeat confirmation."},{"type":"DELETE","lineNumber":506,"oldContent":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":509,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":514,"oldContent":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":516,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":518,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":517,"content":"                    .collect { ack ->"},{"type":"INSERT","lineNumber":518,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":519,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":619,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":622,"content":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"DELETE","lineNumber":624,"oldContent":"                delay(100)"},{"type":"MODIFY","lineNumber":626,"content":"                delay(100)","oldContent":"            }"},{"type":"INSERT","lineNumber":627,"content":"            }"},{"type":"DELETE","lineNumber":635,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":637,"content":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":645,"oldContent":"                    }"},{"type":"INSERT","lineNumber":648,"content":"                    }"},{"type":"DELETE","lineNumber":677,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":681,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"INSERT","lineNumber":680,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":683,"content":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":704,"oldContent":"            }"},{"type":"INSERT","lineNumber":707,"content":"            }"},{"type":"DELETE","lineNumber":731,"oldContent":"                }"},{"type":"INSERT","lineNumber":734,"content":"                }"},{"type":"DELETE","lineNumber":752,"oldContent":"        }"},{"type":"MODIFY","lineNumber":755,"content":"        }","oldContent":""},{"type":"INSERT","lineNumber":757,"content":""},{"type":"DELETE","lineNumber":761,"oldContent":"     */"},{"type":"INSERT","lineNumber":764,"content":"     */"},{"type":"DELETE","lineNumber":772,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":775,"content":"            arm()"},{"type":"DELETE","lineNumber":782,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":785,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":791,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"INSERT","lineNumber":794,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":807,"oldContent":"        return true"},{"type":"DELETE","lineNumber":811,"oldContent":"    /**"},{"type":"INSERT","lineNumber":810,"content":"        return true"},{"type":"INSERT","lineNumber":813,"content":"    /**"},{"type":"DELETE","lineNumber":818,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":820,"oldContent":"            param5 = 0f,"},{"type":"DELETE","lineNumber":822,"oldContent":"            param7 = 0f"},{"type":"DELETE","lineNumber":824,"oldContent":"        )"},{"type":"DELETE","lineNumber":826,"oldContent":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"DELETE","lineNumber":827,"oldContent":"    }"},{"type":"INSERT","lineNumber":825,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":826,"content":"            param5 = 0f,"},{"type":"INSERT","lineNumber":828,"content":"            param7 = 0f"},{"type":"INSERT","lineNumber":829,"content":"        )"},{"type":"INSERT","lineNumber":830,"content":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"INSERT","lineNumber":831,"content":"    }"},{"type":"DELETE","lineNumber":839,"oldContent":"    }"},{"type":"INSERT","lineNumber":843,"content":"    }"}]},{"timestamp":1758259480380,"changes":[{"type":"MODIFY","lineNumber":24,"content":"    const val LAND: UInt = 9u // Add LAND mode for explicit landing","oldContent":"    private val _state = MutableStateFlow(TelemetryState())"},{"type":"MODIFY","lineNumber":49,"content":"","oldContent":"                }"},{"type":"INSERT","lineNumber":54,"content":""},{"type":"DELETE","lineNumber":55,"oldContent":"    fun start() {"},{"type":"MODIFY","lineNumber":74,"content":"            reconnect(this) // Initial connection attempt","oldContent":"                        }"},{"type":"DELETE","lineNumber":247,"oldContent":"                    }"},{"type":"INSERT","lineNumber":248,"content":"                                latitude = lat,"},{"type":"INSERT","lineNumber":249,"content":"                                longitude = lon,"},{"type":"INSERT","lineNumber":250,"content":"                                totalDistanceMeters = if (positionHistory.isNotEmpty()) totalDistanceMeters else null"},{"type":"INSERT","lineNumber":251,"content":"                            )"},{"type":"INSERT","lineNumber":252,"content":"                        }"},{"type":"INSERT","lineNumber":253,"content":"                    }"},{"type":"DELETE","lineNumber":251,"oldContent":"                                latitude = lat,"},{"type":"DELETE","lineNumber":253,"oldContent":"                                longitude = lon,"},{"type":"DELETE","lineNumber":256,"oldContent":"                                totalDistanceMeters = if (positionHistory.isNotEmpty()) totalDistanceMeters else null"},{"type":"DELETE","lineNumber":258,"oldContent":"                            )"},{"type":"DELETE","lineNumber":261,"oldContent":"                        }"},{"type":"DELETE","lineNumber":322,"oldContent":"                                // Clear mission from FCU"},{"type":"INSERT","lineNumber":323,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":324,"content":"                                // Clear mission from FCU"},{"type":"DELETE","lineNumber":326,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":336,"content":"                            missionTimerJob?.cancel()"},{"type":"DELETE","lineNumber":338,"oldContent":"                            missionTimerJob?.cancel()"},{"type":"DELETE","lineNumber":378,"oldContent":"        // Helper to request mission items from FCU and return as list"},{"type":"DELETE","lineNumber":380,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":383,"oldContent":"            val items = mutableListOf<MissionItemInt>()"},{"type":"DELETE","lineNumber":385,"oldContent":"            val expectedCountDeferred = CompletableDeferred<Int?>()"},{"type":"DELETE","lineNumber":388,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":390,"oldContent":"            val job = AppScope.launch {"},{"type":"INSERT","lineNumber":387,"content":"        // Helper to request mission items from FCU and return as list"},{"type":"INSERT","lineNumber":388,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":389,"content":"            val items = mutableListOf<MissionItemInt>()"},{"type":"INSERT","lineNumber":390,"content":"            val expectedCountDeferred = CompletableDeferred<Int?>()"},{"type":"INSERT","lineNumber":391,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":392,"content":"            val job = AppScope.launch {"},{"type":"DELETE","lineNumber":422,"oldContent":"        val commandLong = CommandLong("},{"type":"MODIFY","lineNumber":424,"content":"        val commandLong = CommandLong(","oldContent":"            targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":425,"content":"            targetSystem = fcuSystemId,"},{"type":"MODIFY","lineNumber":459,"content":"    /**","oldContent":"    /**"},{"type":"INSERT","lineNumber":461,"content":"     * Waits for Heartbeat confirmation and checks COMMAND_ACK result."},{"type":"DELETE","lineNumber":462,"oldContent":"     * Waits for Heartbeat confirmation."},{"type":"DELETE","lineNumber":464,"oldContent":"        sendCommand("},{"type":"DELETE","lineNumber":465,"oldContent":"            MavCmd.DO_SET_MODE,"},{"type":"DELETE","lineNumber":466,"oldContent":"            1f,                   // param1: MAV_MODE_FLAG_CUSTOM_MODE_ENABLED (always 1 for ArduPilot)"},{"type":"DELETE","lineNumber":467,"oldContent":"            customMode.toFloat(), // param2: custom mode (e.g., 3u for AUTO)"},{"type":"DELETE","lineNumber":468,"oldContent":"            0f, 0f, 0f, 0f, 0f"},{"type":"DELETE","lineNumber":469,"oldContent":"        )"},{"type":"DELETE","lineNumber":470,"oldContent":"        // Wait for Heartbeat to confirm mode change"},{"type":"DELETE","lineNumber":471,"oldContent":"        val timeoutMs = 5000L"},{"type":"DELETE","lineNumber":472,"oldContent":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":479,"oldContent":"        while (System.currentTimeMillis() - start < timeoutMs) {"},{"type":"DELETE","lineNumber":480,"oldContent":"            if (state.value.mode?.contains(expectedMode, ignoreCase = true) == true) {"},{"type":"DELETE","lineNumber":481,"oldContent":"                Log.i(\"MavlinkRepo\", \"Mode changed to ${state.value.mode}\")"},{"type":"DELETE","lineNumber":482,"oldContent":"                return true"},{"type":"INSERT","lineNumber":470,"content":"        var lastAckResult: Int? = null"},{"type":"INSERT","lineNumber":471,"content":"        var lastAckText: String? = null"},{"type":"INSERT","lineNumber":472,"content":"        for (attempt in 1..2) { // Try twice if failed"},{"type":"INSERT","lineNumber":473,"content":"            sendCommand("},{"type":"INSERT","lineNumber":474,"content":"                MavCmd.DO_SET_MODE,"},{"type":"INSERT","lineNumber":475,"content":"                1f,                   // param1: MAV_MODE_FLAG_CUSTOM_MODE_ENABLED (always 1 for ArduPilot)"},{"type":"INSERT","lineNumber":476,"content":"                customMode.toFloat(), // param2: custom mode (e.g., 3u for AUTO)"},{"type":"INSERT","lineNumber":477,"content":"                0f, 0f, 0f, 0f, 0f"},{"type":"INSERT","lineNumber":478,"content":"            )"},{"type":"INSERT","lineNumber":479,"content":"            // Wait for COMMAND_ACK"},{"type":"INSERT","lineNumber":480,"content":"            val ackDeferred = CompletableDeferred<Boolean>()"},{"type":"INSERT","lineNumber":481,"content":"            val ackJob = AppScope.launch {"},{"type":"INSERT","lineNumber":482,"content":"                connection.mavFrame"},{"type":"INSERT","lineNumber":483,"content":"                    .filter { it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":484,"content":"                    .map { it.message }"},{"type":"INSERT","lineNumber":485,"content":"                    .filterIsInstance<CommandAck>()"},{"type":"INSERT","lineNumber":486,"content":"                    .collect { ack ->"},{"type":"INSERT","lineNumber":487,"content":"                        if (ack.command.value == MavCmd.DO_SET_MODE.value) {"},{"type":"INSERT","lineNumber":488,"content":"                            lastAckResult = ack.result.value"},{"type":"INSERT","lineNumber":489,"content":"                            lastAckText = ack.result.entry.toString()"},{"type":"INSERT","lineNumber":490,"content":"                            if (ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":491,"content":"                                ackDeferred.complete(true)"},{"type":"INSERT","lineNumber":492,"content":"                            } else {"},{"type":"INSERT","lineNumber":493,"content":"                                ackDeferred.complete(false)"},{"type":"INSERT","lineNumber":494,"content":"                            }"},{"type":"INSERT","lineNumber":495,"content":"                        }"},{"type":"INSERT","lineNumber":496,"content":"                    }"},{"type":"DELETE","lineNumber":484,"oldContent":"            delay(200)"},{"type":"INSERT","lineNumber":498,"content":"            val ackSuccess = withTimeoutOrNull(3000L) { ackDeferred.await() } ?: false"},{"type":"INSERT","lineNumber":499,"content":"            ackJob.cancel()"},{"type":"INSERT","lineNumber":500,"content":"            if (ackSuccess) {"},{"type":"INSERT","lineNumber":501,"content":"                Log.i(\"MavlinkRepo\", \"Mode change to $expectedMode accepted by FCU\")"},{"type":"INSERT","lineNumber":502,"content":"                // Wait for Heartbeat to confirm mode change"},{"type":"INSERT","lineNumber":503,"content":"                val timeoutMs = 5000L"},{"type":"INSERT","lineNumber":504,"content":"                val start = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":505,"content":"                while (System.currentTimeMillis() - start < timeoutMs) {"},{"type":"INSERT","lineNumber":506,"content":"                    if (state.value.mode?.contains(expectedMode, ignoreCase = true) == true) {"},{"type":"INSERT","lineNumber":507,"content":"                        Log.i(\"MavlinkRepo\", \"Mode changed to ${state.value.mode}\")"},{"type":"INSERT","lineNumber":508,"content":"                        return true"},{"type":"INSERT","lineNumber":509,"content":"                    }"},{"type":"INSERT","lineNumber":510,"content":"                    delay(200)"},{"type":"INSERT","lineNumber":511,"content":"                }"},{"type":"INSERT","lineNumber":512,"content":"                Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":513,"content":"                return false"},{"type":"INSERT","lineNumber":514,"content":"            } else {"},{"type":"INSERT","lineNumber":515,"content":"                Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode rejected by FCU: result=$lastAckText ($lastAckResult)\")"},{"type":"INSERT","lineNumber":516,"content":"                delay(1000) // Wait before retry"},{"type":"INSERT","lineNumber":517,"content":"            }"},{"type":"DELETE","lineNumber":486,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":519,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode failed after retries. Last result: $lastAckText ($lastAckResult)\")"},{"type":"DELETE","lineNumber":508,"oldContent":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":542,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":515,"oldContent":"                    .collect { ack ->"},{"type":"INSERT","lineNumber":549,"content":"                    .filterIsInstance<CommandAck>()"},{"type":"INSERT","lineNumber":550,"content":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":519,"oldContent":"                    .filterIsInstance<CommandAck>()"},{"type":"DELETE","lineNumber":621,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":655,"content":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":658,"content":"            while (!firstRequestReceived && !ackDeferred.isCompleted && System.currentTimeMillis() - startWait < firstRequestTimeout) {"},{"type":"DELETE","lineNumber":627,"oldContent":"            while (!firstRequestReceived && !ackDeferred.isCompleted && System.currentTimeMillis() - startWait < firstRequestTimeout) {"},{"type":"DELETE","lineNumber":636,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":670,"content":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":647,"oldContent":"                    }"},{"type":"INSERT","lineNumber":681,"content":"                    }"},{"type":"DELETE","lineNumber":679,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":713,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":682,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"INSERT","lineNumber":716,"content":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":706,"oldContent":"            }"},{"type":"DELETE","lineNumber":708,"oldContent":"            param7 = 0f"},{"type":"INSERT","lineNumber":740,"content":"            }"},{"type":"INSERT","lineNumber":741,"content":""},{"type":"DELETE","lineNumber":733,"oldContent":"                }"},{"type":"INSERT","lineNumber":767,"content":"                }"},{"type":"DELETE","lineNumber":744,"oldContent":"            param7 = 0f"},{"type":"INSERT","lineNumber":777,"content":""},{"type":"DELETE","lineNumber":754,"oldContent":"        }"},{"type":"DELETE","lineNumber":756,"oldContent":""},{"type":"INSERT","lineNumber":788,"content":"        }"},{"type":"INSERT","lineNumber":790,"content":""},{"type":"DELETE","lineNumber":763,"oldContent":"     */"},{"type":"INSERT","lineNumber":797,"content":"     */"},{"type":"DELETE","lineNumber":773,"oldContent":"    }"},{"type":"DELETE","lineNumber":774,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":806,"content":"        try {"},{"type":"INSERT","lineNumber":808,"content":"            arm()"},{"type":"DELETE","lineNumber":784,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":818,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":788,"oldContent":"                        // Cache last mission command for LAND detection"},{"type":"DELETE","lineNumber":789,"oldContent":"                    }"},{"type":"INSERT","lineNumber":821,"content":"            delay(500)"},{"type":"INSERT","lineNumber":822,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":793,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"INSERT","lineNumber":827,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":809,"oldContent":"        return true"},{"type":"INSERT","lineNumber":843,"content":"        return true"},{"type":"DELETE","lineNumber":812,"oldContent":"    /**"},{"type":"INSERT","lineNumber":846,"content":"    /**"},{"type":"DELETE","lineNumber":821,"oldContent":"            param4 = 0f,"},{"type":"INSERT","lineNumber":855,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":856,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":857,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":858,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":860,"content":"            param6 = 0f,"},{"type":"DELETE","lineNumber":825,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":827,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":829,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":831,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":842,"oldContent":"    }"},{"type":"INSERT","lineNumber":876,"content":"    }"}]},{"timestamp":1758259559164,"changes":[{"type":"MODIFY","lineNumber":248,"content":"                                latitude = lat,","oldContent":"                                latitude = lat,"},{"type":"DELETE","lineNumber":250,"oldContent":"                    lastMissionRunning = missionRunning"},{"type":"DELETE","lineNumber":252,"oldContent":"                }"},{"type":"DELETE","lineNumber":255,"oldContent":"        }"},{"type":"INSERT","lineNumber":254,"content":"                    lastMissionRunning = missionRunning"},{"type":"INSERT","lineNumber":255,"content":"                }"},{"type":"INSERT","lineNumber":256,"content":"        }"},{"type":"MODIFY","lineNumber":323,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }","oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":383,"oldContent":"        // Helper to request mission items from FCU and return as list"},{"type":"INSERT","lineNumber":384,"content":"        // Mission progress logging: MISSION_ITEM_REACHED, MISSION_CURRENT, and mode"},{"type":"INSERT","lineNumber":385,"content":""},{"type":"INSERT","lineNumber":386,"content":""},{"type":"INSERT","lineNumber":387,"content":"        // Helper to request mission items from FCU and return as list"},{"type":"DELETE","lineNumber":387,"oldContent":"        // Mission progress logging: MISSION_ITEM_REACHED, MISSION_CURRENT, and mode"},{"type":"DELETE","lineNumber":390,"oldContent":""},{"type":"DELETE","lineNumber":392,"oldContent":""},{"type":"INSERT","lineNumber":423,"content":"    suspend fun sendCommand(command: MavCmd, param1: Float = 0f, param2: Float = 0f, param3: Float = 0f, param4: Float = 0f, param5: Float = 0f, param6: Float = 0f, param7: Float = 0f) {"},{"type":"DELETE","lineNumber":425,"oldContent":"    suspend fun sendCommand(command: MavCmd, param1: Float = 0f, param2: Float = 0f, param3: Float = 0f, param4: Float = 0f, param5: Float = 0f, param6: Float = 0f, param7: Float = 0f) {"},{"type":"INSERT","lineNumber":458,"content":""},{"type":"DELETE","lineNumber":459,"oldContent":"    /**"},{"type":"INSERT","lineNumber":464,"content":"        val expectedMode = when (customMode) {"},{"type":"INSERT","lineNumber":465,"content":"            3u -> \"Auto\""},{"type":"INSERT","lineNumber":466,"content":"            0u -> \"Stabilize\""},{"type":"INSERT","lineNumber":467,"content":"            5u -> \"Loiter\""},{"type":"INSERT","lineNumber":468,"content":"            else -> \"Unknown\""},{"type":"INSERT","lineNumber":469,"content":"        }"},{"type":"DELETE","lineNumber":468,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"DELETE","lineNumber":470,"oldContent":"            3u -> \"Auto\""},{"type":"DELETE","lineNumber":472,"oldContent":"            0u -> \"Stabilize\""},{"type":"DELETE","lineNumber":474,"oldContent":"            5u -> \"Loiter\""},{"type":"DELETE","lineNumber":476,"oldContent":"            else -> \"Unknown\""},{"type":"DELETE","lineNumber":478,"oldContent":"        }"},{"type":"DELETE","lineNumber":484,"oldContent":"            }"},{"type":"DELETE","lineNumber":487,"oldContent":"        }"},{"type":"DELETE","lineNumber":490,"oldContent":"        return false"},{"type":"DELETE","lineNumber":491,"oldContent":"                            lastAckResult = ack.result.value"},{"type":"DELETE","lineNumber":492,"oldContent":"    }"},{"type":"INSERT","lineNumber":488,"content":"                            lastAckResult = ack.result.value?.toInt()"},{"type":"DELETE","lineNumber":494,"oldContent":""},{"type":"DELETE","lineNumber":496,"oldContent":"    /**"},{"type":"DELETE","lineNumber":498,"oldContent":"     * Uploads a mission using the MAVLink mission protocol handshake."},{"type":"DELETE","lineNumber":500,"oldContent":"     * Returns true if ACK received, false otherwise."},{"type":"DELETE","lineNumber":502,"oldContent":"     */"},{"type":"DELETE","lineNumber":504,"oldContent":"    @Suppress(\"DEPRECATION\")"},{"type":"DELETE","lineNumber":506,"oldContent":"    suspend fun uploadMissionWithAck(missionItems: List<MissionItemInt>, timeoutMs: Long = 15000): Boolean {"},{"type":"DELETE","lineNumber":508,"oldContent":"        if (!state.value.fcuDetected) {"},{"type":"DELETE","lineNumber":509,"oldContent":"            Log.e(\"MavlinkRepo\", \"FCU not detected, cannot upload mission\")"},{"type":"INSERT","lineNumber":497,"content":"            }"},{"type":"DELETE","lineNumber":511,"oldContent":"            throw IllegalStateException(\"FCU not detected\")"},{"type":"DELETE","lineNumber":513,"oldContent":"        }"},{"type":"DELETE","lineNumber":515,"oldContent":"        if (missionItems.isEmpty()) {"},{"type":"DELETE","lineNumber":517,"oldContent":"            Log.w(\"MavlinkRepo\", \"No mission items to upload\")"},{"type":"DELETE","lineNumber":519,"oldContent":"            return false"},{"type":"DELETE","lineNumber":521,"oldContent":"        }"},{"type":"DELETE","lineNumber":523,"oldContent":""},{"type":"DELETE","lineNumber":525,"oldContent":"        try {"},{"type":"DELETE","lineNumber":527,"oldContent":"            // Step 0: Clear previous mission"},{"type":"DELETE","lineNumber":529,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending MISSION_CLEAR_ALL...\")"},{"type":"DELETE","lineNumber":532,"oldContent":"            val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":534,"oldContent":"            // Wait for COMMAND_ACK for MISSION_CLEAR_ALL"},{"type":"DELETE","lineNumber":536,"oldContent":"            val clearAckDeferred = CompletableDeferred<Boolean>()"},{"type":"DELETE","lineNumber":538,"oldContent":"            val clearJob = AppScope.launch {"},{"type":"DELETE","lineNumber":540,"oldContent":"                connection.mavFrame"},{"type":"DELETE","lineNumber":542,"oldContent":"                    .filter { it.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":545,"oldContent":"                    .map { it.message }"},{"type":"INSERT","lineNumber":518,"content":"        }"},{"type":"INSERT","lineNumber":519,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode failed after retries. Last result: $lastAckText ($lastAckResult)\")"},{"type":"INSERT","lineNumber":520,"content":"        return false"},{"type":"INSERT","lineNumber":521,"content":"    }"},{"type":"INSERT","lineNumber":522,"content":""},{"type":"INSERT","lineNumber":523,"content":"    /**"},{"type":"INSERT","lineNumber":524,"content":"     * Uploads a mission using the MAVLink mission protocol handshake."},{"type":"INSERT","lineNumber":525,"content":"     * Returns true if ACK received, false otherwise."},{"type":"INSERT","lineNumber":526,"content":"     */"},{"type":"INSERT","lineNumber":527,"content":"    @Suppress(\"DEPRECATION\")"},{"type":"INSERT","lineNumber":528,"content":"    suspend fun uploadMissionWithAck(missionItems: List<MissionItemInt>, timeoutMs: Long = 15000): Boolean {"},{"type":"INSERT","lineNumber":529,"content":"        if (!state.value.fcuDetected) {"},{"type":"INSERT","lineNumber":530,"content":"            Log.e(\"MavlinkRepo\", \"FCU not detected, cannot upload mission\")"},{"type":"INSERT","lineNumber":531,"content":"            throw IllegalStateException(\"FCU not detected\")"},{"type":"INSERT","lineNumber":532,"content":"        }"},{"type":"INSERT","lineNumber":533,"content":"        if (missionItems.isEmpty()) {"},{"type":"INSERT","lineNumber":534,"content":"            Log.w(\"MavlinkRepo\", \"No mission items to upload\")"},{"type":"INSERT","lineNumber":535,"content":"            return false"},{"type":"INSERT","lineNumber":536,"content":"        }"},{"type":"INSERT","lineNumber":537,"content":""},{"type":"INSERT","lineNumber":538,"content":"        try {"},{"type":"INSERT","lineNumber":539,"content":"            // Step 0: Clear previous mission"},{"type":"INSERT","lineNumber":540,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending MISSION_CLEAR_ALL...\")"},{"type":"INSERT","lineNumber":541,"content":"            val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":542,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":543,"content":"            // Wait for COMMAND_ACK for MISSION_CLEAR_ALL"},{"type":"INSERT","lineNumber":544,"content":"            val clearAckDeferred = CompletableDeferred<Boolean>()"},{"type":"INSERT","lineNumber":545,"content":"            val clearJob = AppScope.launch {"},{"type":"INSERT","lineNumber":546,"content":"                connection.mavFrame"},{"type":"INSERT","lineNumber":547,"content":"                    .filter { it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":548,"content":"                    .map { it.message }"},{"type":"INSERT","lineNumber":549,"content":"                    .filterIsInstance<CommandAck>()"},{"type":"INSERT","lineNumber":550,"content":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":549,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode failed after retries. Last result: $lastAckText ($lastAckResult)\")"},{"type":"DELETE","lineNumber":572,"oldContent":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":580,"oldContent":"                    .filterIsInstance<CommandAck>()"},{"type":"DELETE","lineNumber":582,"oldContent":"                    .collect { ack ->"},{"type":"INSERT","lineNumber":655,"content":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"INSERT","lineNumber":658,"content":"            while (!firstRequestReceived && !ackDeferred.isCompleted && System.currentTimeMillis() - startWait < firstRequestTimeout) {"},{"type":"INSERT","lineNumber":670,"content":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":681,"content":"                    }"},{"type":"DELETE","lineNumber":684,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"DELETE","lineNumber":688,"oldContent":"            while (!firstRequestReceived && !ackDeferred.isCompleted && System.currentTimeMillis() - startWait < firstRequestTimeout) {"},{"type":"DELETE","lineNumber":701,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":712,"oldContent":"                    }"},{"type":"INSERT","lineNumber":713,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":716,"content":"                connection.mavFrame.collect { frame ->"},{"type":"INSERT","lineNumber":740,"content":"            }"},{"type":"INSERT","lineNumber":741,"content":""},{"type":"DELETE","lineNumber":742,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":746,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":756,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":757,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":758,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":759,"oldContent":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"INSERT","lineNumber":758,"content":"            for (seq in 0 until expectedCount) {"},{"type":"INSERT","lineNumber":759,"content":"                val seqDeferred = CompletableDeferred<Unit>()"},{"type":"INSERT","lineNumber":760,"content":"                perSeqMap[seq] = seqDeferred"},{"type":"INSERT","lineNumber":761,"content":"                try {"},{"type":"INSERT","lineNumber":767,"content":"                }"},{"type":"DELETE","lineNumber":770,"oldContent":"            }"},{"type":"DELETE","lineNumber":772,"oldContent":""},{"type":"INSERT","lineNumber":777,"content":""},{"type":"INSERT","lineNumber":788,"content":"        }"},{"type":"INSERT","lineNumber":790,"content":""},{"type":"DELETE","lineNumber":793,"oldContent":"    }"},{"type":"DELETE","lineNumber":794,"oldContent":"                }"},{"type":"DELETE","lineNumber":795,"oldContent":"                }"},{"type":"DELETE","lineNumber":796,"oldContent":"                    }"},{"type":"DELETE","lineNumber":797,"oldContent":"                        lastMissionCmd = msg.command.value"},{"type":"DELETE","lineNumber":798,"oldContent":"                    is MissionItemInt -> {"},{"type":"DELETE","lineNumber":799,"oldContent":"                        }"},{"type":"DELETE","lineNumber":800,"oldContent":"                                }"},{"type":"DELETE","lineNumber":801,"oldContent":"                                        Log.i(\"MavlinkRepo\", \"Drone disarmed after LAND.\")"},{"type":"INSERT","lineNumber":797,"content":"     */"},{"type":"INSERT","lineNumber":798,"content":"    suspend fun startMission(): Boolean {"},{"type":"INSERT","lineNumber":799,"content":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Initiating mission start workflow...\")"},{"type":"INSERT","lineNumber":800,"content":"        if (!state.value.fcuDetected) {"},{"type":"INSERT","lineNumber":801,"content":"            Log.w(\"MavlinkRepo\", \"[Mission Start] Cannot start mission - FCU not detected\")"},{"type":"INSERT","lineNumber":802,"content":"            return false"},{"type":"INSERT","lineNumber":803,"content":"        }"},{"type":"INSERT","lineNumber":804,"content":""},{"type":"INSERT","lineNumber":805,"content":"        // Step 1: Arm the vehicle"},{"type":"INSERT","lineNumber":806,"content":"        try {"},{"type":"INSERT","lineNumber":808,"content":"            arm()"},{"type":"DELETE","lineNumber":804,"oldContent":""},{"type":"INSERT","lineNumber":818,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":815,"oldContent":"        }"},{"type":"DELETE","lineNumber":816,"oldContent":""},{"type":"INSERT","lineNumber":821,"content":"            delay(500)"},{"type":"INSERT","lineNumber":822,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":827,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":823,"oldContent":"     */"},{"type":"DELETE","lineNumber":833,"oldContent":"        try {"},{"type":"DELETE","lineNumber":836,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":843,"content":"        return true"},{"type":"INSERT","lineNumber":846,"content":"    /**"},{"type":"DELETE","lineNumber":845,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":849,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":850,"oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":855,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":856,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":857,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":858,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":860,"content":"            param6 = 0f,"},{"type":"DELETE","lineNumber":855,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":868,"oldContent":"        return true"},{"type":"DELETE","lineNumber":870,"oldContent":"}"},{"type":"DELETE","lineNumber":872,"oldContent":"    /**"},{"type":"DELETE","lineNumber":873,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":874,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":875,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":876,"oldContent":"            param2 = 0f,"},{"type":"MODIFY","lineNumber":877,"content":"}","oldContent":"            param1 = 0f,"}]},{"timestamp":1758261332465,"changes":[{"type":"MODIFY","lineNumber":22,"content":"    const val LOITER: UInt = 5u","oldContent":"    private val gcsSystemId: UByte = 200u"},{"type":"DELETE","lineNumber":40,"oldContent":"            while (scope.isActive) {"},{"type":"DELETE","lineNumber":41,"oldContent":"                    if (connection.tryConnect(scope)) {"},{"type":"INSERT","lineNumber":40,"content":"    // Diagnostic info"},{"type":"INSERT","lineNumber":41,"content":"    private val _lastFailure = MutableStateFlow<Throwable?>(null)"},{"type":"INSERT","lineNumber":247,"content":"                                altitudeRelative = relAltM,"},{"type":"DELETE","lineNumber":248,"oldContent":"                                latitude = lat,"},{"type":"DELETE","lineNumber":252,"oldContent":"                    lastMissionRunning = missionRunning"},{"type":"INSERT","lineNumber":253,"content":"                    }"},{"type":"INSERT","lineNumber":254,"content":"                    lastMissionRunning = missionRunning"},{"type":"DELETE","lineNumber":256,"oldContent":"                    }"},{"type":"INSERT","lineNumber":322,"content":"                                // Mission ended"},{"type":"DELETE","lineNumber":323,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":383,"content":""},{"type":"INSERT","lineNumber":387,"content":"        // Helper to request mission items from FCU and return as list"},{"type":"DELETE","lineNumber":387,"oldContent":""},{"type":"DELETE","lineNumber":389,"oldContent":"        // Helper to request mission items from FCU and return as list"},{"type":"MODIFY","lineNumber":461,"content":"     * Waits for Heartbeat confirmation.","oldContent":"     * Waits for Heartbeat confirmation and checks COMMAND_ACK result."},{"type":"INSERT","lineNumber":464,"content":"        sendCommand("},{"type":"INSERT","lineNumber":465,"content":"            MavCmd.DO_SET_MODE,"},{"type":"INSERT","lineNumber":466,"content":"            1f,                   // param1: MAV_MODE_FLAG_CUSTOM_MODE_ENABLED (always 1 for ArduPilot)"},{"type":"INSERT","lineNumber":467,"content":"            customMode.toFloat(), // param2: custom mode (e.g., 3u for AUTO)"},{"type":"INSERT","lineNumber":468,"content":"            0f, 0f, 0f, 0f, 0f"},{"type":"INSERT","lineNumber":469,"content":"        )"},{"type":"INSERT","lineNumber":470,"content":"        // Wait for Heartbeat to confirm mode change"},{"type":"INSERT","lineNumber":471,"content":"        val timeoutMs = 5000L"},{"type":"INSERT","lineNumber":472,"content":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":465,"oldContent":"        var lastAckResult: Int? = null"},{"type":"DELETE","lineNumber":467,"oldContent":"        var lastAckText: String? = null"},{"type":"DELETE","lineNumber":469,"oldContent":"        for (attempt in 1..2) { // Try twice if failed"},{"type":"DELETE","lineNumber":471,"oldContent":"            sendCommand("},{"type":"DELETE","lineNumber":474,"oldContent":"                MavCmd.DO_SET_MODE,"},{"type":"DELETE","lineNumber":475,"oldContent":"                1f,                   // param1: MAV_MODE_FLAG_CUSTOM_MODE_ENABLED (always 1 for ArduPilot)"},{"type":"DELETE","lineNumber":476,"oldContent":"                customMode.toFloat(), // param2: custom mode (e.g., 3u for AUTO)"},{"type":"DELETE","lineNumber":477,"oldContent":"                0f, 0f, 0f, 0f, 0f"},{"type":"DELETE","lineNumber":478,"oldContent":"            )"},{"type":"DELETE","lineNumber":479,"oldContent":"            // Wait for COMMAND_ACK"},{"type":"DELETE","lineNumber":480,"oldContent":"            val ackDeferred = CompletableDeferred<Boolean>()"},{"type":"DELETE","lineNumber":481,"oldContent":"            val ackJob = AppScope.launch {"},{"type":"DELETE","lineNumber":482,"oldContent":"                connection.mavFrame"},{"type":"DELETE","lineNumber":483,"oldContent":"                    .filter { it.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":484,"oldContent":"                    .map { it.message }"},{"type":"DELETE","lineNumber":485,"oldContent":"                    .filterIsInstance<CommandAck>()"},{"type":"DELETE","lineNumber":486,"oldContent":"                            lastAckResult = ack.result.value?.toInt()"},{"type":"DELETE","lineNumber":487,"oldContent":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":488,"oldContent":"                        if (ack.command.value == MavCmd.DO_SET_MODE.value) {"},{"type":"DELETE","lineNumber":489,"oldContent":"                            lastAckText = ack.result.entry.toString()"},{"type":"DELETE","lineNumber":490,"oldContent":"                            if (ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":479,"content":"        while (System.currentTimeMillis() - start < timeoutMs) {"},{"type":"INSERT","lineNumber":480,"content":"            if (state.value.mode?.contains(expectedMode, ignoreCase = true) == true) {"},{"type":"INSERT","lineNumber":481,"content":"                Log.i(\"MavlinkRepo\", \"Mode changed to ${state.value.mode}\")"},{"type":"INSERT","lineNumber":482,"content":"                return true"},{"type":"DELETE","lineNumber":492,"oldContent":"                                ackDeferred.complete(true)"},{"type":"DELETE","lineNumber":493,"oldContent":"                            } else {"},{"type":"DELETE","lineNumber":494,"oldContent":"                                ackDeferred.complete(false)"},{"type":"DELETE","lineNumber":495,"oldContent":"                            }"},{"type":"DELETE","lineNumber":496,"oldContent":"                        }"},{"type":"DELETE","lineNumber":497,"oldContent":"                    }"},{"type":"DELETE","lineNumber":498,"oldContent":"            val ackSuccess = withTimeoutOrNull(3000L) { ackDeferred.await() } ?: false"},{"type":"DELETE","lineNumber":499,"oldContent":"            ackJob.cancel()"},{"type":"DELETE","lineNumber":500,"oldContent":"            if (ackSuccess) {"},{"type":"DELETE","lineNumber":501,"oldContent":"                Log.i(\"MavlinkRepo\", \"Mode change to $expectedMode accepted by FCU\")"},{"type":"INSERT","lineNumber":484,"content":"            delay(200)"},{"type":"DELETE","lineNumber":503,"oldContent":"                // Wait for Heartbeat to confirm mode change"},{"type":"DELETE","lineNumber":504,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode failed after retries. Last result: $lastAckText ($lastAckResult)\")"},{"type":"INSERT","lineNumber":486,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":506,"oldContent":"                val timeoutMs = 5000L"},{"type":"DELETE","lineNumber":509,"oldContent":"                val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":512,"oldContent":"                while (System.currentTimeMillis() - start < timeoutMs) {"},{"type":"DELETE","lineNumber":515,"oldContent":"                    if (state.value.mode?.contains(expectedMode, ignoreCase = true) == true) {"},{"type":"DELETE","lineNumber":518,"oldContent":"                        Log.i(\"MavlinkRepo\", \"Mode changed to ${state.value.mode}\")"},{"type":"DELETE","lineNumber":521,"oldContent":"                        return true"},{"type":"DELETE","lineNumber":523,"oldContent":"                    }"},{"type":"DELETE","lineNumber":526,"oldContent":"                    delay(200)"},{"type":"DELETE","lineNumber":529,"oldContent":"                }"},{"type":"DELETE","lineNumber":532,"oldContent":"                Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":535,"oldContent":"                return false"},{"type":"DELETE","lineNumber":538,"oldContent":"            } else {"},{"type":"DELETE","lineNumber":541,"oldContent":"                Log.e(\"MavlinkRepo\", \"Mode change to $expectedMode rejected by FCU: result=$lastAckText ($lastAckResult)\")"},{"type":"DELETE","lineNumber":543,"oldContent":"                delay(1000) // Wait before retry"},{"type":"DELETE","lineNumber":546,"oldContent":"            }"},{"type":"DELETE","lineNumber":548,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":550,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":518,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":519,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":658,"oldContent":"                delay(100)"},{"type":"INSERT","lineNumber":626,"content":"                delay(100)"},{"type":"INSERT","lineNumber":637,"content":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":672,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":648,"content":"                    }"},{"type":"DELETE","lineNumber":684,"oldContent":"                    }"},{"type":"DELETE","lineNumber":716,"oldContent":"                    when (val msg = frame.message) {"},{"type":"INSERT","lineNumber":684,"content":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":740,"oldContent":"            try {"},{"type":"DELETE","lineNumber":741,"oldContent":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":743,"oldContent":"            param7 = 0f"},{"type":"DELETE","lineNumber":745,"oldContent":"            param4 = 0f,"},{"type":"INSERT","lineNumber":709,"content":"            try {"},{"type":"INSERT","lineNumber":710,"content":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":711,"content":"                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, req)"},{"type":"INSERT","lineNumber":712,"content":"                Log.i(\"MavlinkRepo\", \"Sent MISSION_REQUEST_LIST to FCU\")"},{"type":"DELETE","lineNumber":750,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":751,"oldContent":"            confirmation = 0u,"},{"type":"DELETE","lineNumber":752,"oldContent":"            targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":717,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":718,"content":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":719,"content":"                job.cancel()"},{"type":"DELETE","lineNumber":761,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":729,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":734,"content":"                }"},{"type":"DELETE","lineNumber":769,"oldContent":"                }"},{"type":"DELETE","lineNumber":777,"oldContent":"                perSeqMap.remove(seq)"},{"type":"INSERT","lineNumber":745,"content":"                perSeqMap.remove(seq)"},{"type":"DELETE","lineNumber":788,"oldContent":"                }"},{"type":"DELETE","lineNumber":789,"oldContent":"    /**"},{"type":"INSERT","lineNumber":756,"content":"    }"},{"type":"INSERT","lineNumber":757,"content":""},{"type":"INSERT","lineNumber":758,"content":"    /**"},{"type":"DELETE","lineNumber":793,"oldContent":""},{"type":"DELETE","lineNumber":803,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending ARM command...\")"},{"type":"DELETE","lineNumber":805,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"DELETE","lineNumber":808,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":774,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending ARM command...\")"},{"type":"INSERT","lineNumber":775,"content":"            arm()"},{"type":"INSERT","lineNumber":776,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"INSERT","lineNumber":777,"content":"            delay(500)"},{"type":"DELETE","lineNumber":812,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":785,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":788,"content":"            delay(500)"},{"type":"INSERT","lineNumber":789,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":821,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":825,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":794,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":827,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":832,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":843,"oldContent":"            param6 = 0f,"},{"type":"INSERT","lineNumber":810,"content":"        return true"},{"type":"INSERT","lineNumber":812,"content":""},{"type":"INSERT","lineNumber":813,"content":"    /**"},{"type":"DELETE","lineNumber":847,"oldContent":"        return true"},{"type":"DELETE","lineNumber":850,"oldContent":"    /**"},{"type":"INSERT","lineNumber":822,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":823,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":824,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":825,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":827,"content":"            param6 = 0f,"},{"type":"DELETE","lineNumber":858,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":859,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":861,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":863,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":866,"oldContent":"            param6 = 0f,"}]},{"timestamp":1758262136162,"changes":[{"type":"MODIFY","lineNumber":45,"content":"    private val connection = TcpClientMavConnection(host, port, CommonDialect).asCoroutine()","oldContent":"                        return // Exit on successful connection"},{"type":"MODIFY","lineNumber":66,"content":"                    _lastFailure.value = e","oldContent":"                            Log.i(\"MavlinkRepo\", \"Connection Active\")"},{"type":"MODIFY","lineNumber":75,"content":"            connection.streamState.collect { st ->","oldContent":"                        }"},{"type":"DELETE","lineNumber":78,"oldContent":"            }"},{"type":"DELETE","lineNumber":79,"oldContent":"        }"},{"type":"INSERT","lineNumber":78,"content":"                        if (!state.value.connected) {"},{"type":"INSERT","lineNumber":79,"content":"                            Log.i(\"MavlinkRepo\", \"Connection Active\")"},{"type":"MODIFY","lineNumber":109,"content":"                        _lastFailure.value = e","oldContent":"            mavFrameStream.collect {"},{"type":"DELETE","lineNumber":132,"oldContent":"                                    command = MavCmd.SET_MESSAGE_INTERVAL.wrap(),"},{"type":"DELETE","lineNumber":133,"oldContent":"                                    confirmation = 0u,"},{"type":"INSERT","lineNumber":132,"content":"                    if (!state.value.fcuDetected) {"},{"type":"INSERT","lineNumber":133,"content":"                        fcuSystemId = it.systemId"},{"type":"DELETE","lineNumber":143,"oldContent":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"DELETE","lineNumber":144,"oldContent":"                                } catch (e: Exception) {"},{"type":"DELETE","lineNumber":145,"oldContent":"                                    Log.e(\"MavlinkRepo\", \"Failed to send SET_MESSAGE_INTERVAL\", e)"},{"type":"DELETE","lineNumber":146,"oldContent":"                                    _lastFailure.value = e"},{"type":"DELETE","lineNumber":147,"oldContent":"                                }"},{"type":"DELETE","lineNumber":148,"oldContent":"                            }"},{"type":"DELETE","lineNumber":149,"oldContent":""},{"type":"DELETE","lineNumber":150,"oldContent":"                            setMessageRate(1u, 1f)   // SYS_STATUS"},{"type":"DELETE","lineNumber":151,"oldContent":"                            setMessageRate(24u, 1f)  // GPS_RAW_INT"},{"type":"DELETE","lineNumber":152,"oldContent":"                            setMessageRate(33u, 5f)  // GLOBAL_POSITION_INT"},{"type":"INSERT","lineNumber":143,"content":"                                    targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":144,"content":"                                    targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":145,"content":"                                    command = MavCmd.SET_MESSAGE_INTERVAL.wrap(),"},{"type":"INSERT","lineNumber":146,"content":"                                    confirmation = 0u,"},{"type":"INSERT","lineNumber":147,"content":"                                    param1 = messageId.toFloat(),"},{"type":"INSERT","lineNumber":148,"content":"                                    param2 = intervalUsec,"},{"type":"INSERT","lineNumber":149,"content":"                                    param3 = 0f,"},{"type":"INSERT","lineNumber":150,"content":"                                    param4 = 0f,"},{"type":"INSERT","lineNumber":151,"content":"                                    param5 = 0f,"},{"type":"INSERT","lineNumber":152,"content":"                                    param6 = 0f,"},{"type":"MODIFY","lineNumber":159,"content":"                                    _lastFailure.value = e","oldContent":""},{"type":"DELETE","lineNumber":167,"oldContent":"                .collect { hud ->"},{"type":"DELETE","lineNumber":168,"oldContent":"                    _state.update {"},{"type":"DELETE","lineNumber":169,"oldContent":"                        it.copy("},{"type":"DELETE","lineNumber":170,"oldContent":"                            altitudeMsl = hud.alt,"},{"type":"DELETE","lineNumber":171,"oldContent":"                            airspeed = hud.airspeed.takeIf { v -> v > 0f },"},{"type":"DELETE","lineNumber":172,"oldContent":"                            groundspeed = hud.groundspeed.takeIf { v -> v > 0f }"},{"type":"DELETE","lineNumber":173,"oldContent":"                        )"},{"type":"INSERT","lineNumber":167,"content":"                            setMessageRate(147u, 1f) // BATTERY_STATUS"},{"type":"INSERT","lineNumber":168,"content":"                        }"},{"type":"INSERT","lineNumber":169,"content":"                    }"},{"type":"INSERT","lineNumber":170,"content":"                }"},{"type":"INSERT","lineNumber":171,"content":"        }"},{"type":"INSERT","lineNumber":172,"content":""},{"type":"INSERT","lineNumber":173,"content":"        // Collector to log COMMAND_ACK messages for diagnostics"},{"type":"MODIFY","lineNumber":253,"content":"                    }","oldContent":"                    }"},{"type":"INSERT","lineNumber":269,"content":""},{"type":"INSERT","lineNumber":274,"content":"        var missionWasRunning = false // Track if mission was previously running"},{"type":"INSERT","lineNumber":275,"content":""},{"type":"INSERT","lineNumber":313,"content":"                    val currentlyInAutoAndArmed = mode.equals(\"Auto\", ignoreCase = true) && armed"},{"type":"INSERT","lineNumber":314,"content":""},{"type":"DELETE","lineNumber":312,"oldContent":"                        if (mode.equals(\"Auto\", ignoreCase = true) && armed && (lastMode != mode || lastArmed != armed)) {"},{"type":"INSERT","lineNumber":317,"content":"                        // Mission starting: Auto mode + armed + wasn't previously running"},{"type":"INSERT","lineNumber":318,"content":"                        if (currentlyInAutoAndArmed && !missionWasRunning) {"},{"type":"INSERT","lineNumber":323,"content":"                                missionWasRunning = true"},{"type":"INSERT","lineNumber":324,"content":""},{"type":"DELETE","lineNumber":322,"oldContent":"                                // Mission ended"},{"type":"DELETE","lineNumber":323,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":324,"oldContent":"                                // Clear mission from FCU"},{"type":"DELETE","lineNumber":325,"oldContent":"                                val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":326,"oldContent":"                                try {"},{"type":"DELETE","lineNumber":327,"oldContent":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":328,"oldContent":"                                    Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"DELETE","lineNumber":329,"oldContent":"                                } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":330,"content":"","oldContent":"                                    Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"INSERT","lineNumber":331,"content":"                                // Mission ended - check if it completed naturally (disarmed) or was interrupted"},{"type":"INSERT","lineNumber":332,"content":"                                val finalArmed = state.value.armed"},{"type":"INSERT","lineNumber":333,"content":"                                val finalMode = state.value.mode"},{"type":"INSERT","lineNumber":334,"content":""},{"type":"INSERT","lineNumber":335,"content":"                                if (!finalArmed && finalMode?.equals(\"Auto\", ignoreCase = true) == true) {"},{"type":"INSERT","lineNumber":336,"content":"                                    // Mission completed naturally - drone disarmed while still in Auto mode"},{"type":"INSERT","lineNumber":337,"content":"                                    Log.i(\"MavlinkRepo\", \"Mission completed naturally - drone disarmed in Auto mode\")"},{"type":"INSERT","lineNumber":338,"content":"                                    _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":339,"content":""},{"type":"INSERT","lineNumber":340,"content":"                                    // Clear mission from FCU"},{"type":"INSERT","lineNumber":341,"content":"                                    val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":342,"content":"                                    try {"},{"type":"INSERT","lineNumber":343,"content":"                                        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":344,"content":"                                        Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"INSERT","lineNumber":345,"content":"                                    } catch (e: Exception) {"},{"type":"INSERT","lineNumber":346,"content":"                                        Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"INSERT","lineNumber":347,"content":"                                    }"},{"type":"INSERT","lineNumber":348,"content":"                                } else {"},{"type":"INSERT","lineNumber":349,"content":"                                    // Mission was interrupted (mode changed or manually disarmed)"},{"type":"INSERT","lineNumber":350,"content":"                                    Log.i(\"MavlinkRepo\", \"Mission was interrupted - mode: $finalMode, armed: $finalArmed\")"},{"type":"INSERT","lineNumber":351,"content":"                                    _state.update { it.copy(missionElapsedSec = null, missionCompleted = false) }"},{"type":"INSERT","lineNumber":353,"content":""},{"type":"INSERT","lineNumber":354,"content":"                                missionWasRunning = false"},{"type":"DELETE","lineNumber":333,"oldContent":"                        } else if ((lastMode?.equals(\"Auto\", ignoreCase = true) == true && mode != \"Auto\") ||"},{"type":"DELETE","lineNumber":334,"oldContent":"                                   (lastArmed == true && armed == false && mode.equals(\"Auto\", ignoreCase = true))) {"},{"type":"DELETE","lineNumber":335,"oldContent":"                            // Mission ended (either mode changed from Auto, or drone disarmed in Auto)"},{"type":"DELETE","lineNumber":336,"oldContent":"                            missionTimerJob?.cancel()"},{"type":"DELETE","lineNumber":337,"oldContent":"                            missionTimerJob = null"},{"type":"DELETE","lineNumber":338,"oldContent":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":339,"oldContent":"                            // Clear mission from FCU"},{"type":"DELETE","lineNumber":340,"oldContent":"                            val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":341,"oldContent":"                            try {"},{"type":"DELETE","lineNumber":342,"oldContent":"                                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":343,"oldContent":"                                Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"DELETE","lineNumber":344,"oldContent":"                            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":345,"oldContent":"                                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"DELETE","lineNumber":346,"oldContent":"                            }"},{"type":"INSERT","lineNumber":357,"content":""},{"type":"INSERT","lineNumber":363,"content":""},{"type":"DELETE","lineNumber":386,"oldContent":""},{"type":"DELETE","lineNumber":387,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":398,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":457,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"INSERT","lineNumber":467,"content":"    }"},{"type":"DELETE","lineNumber":465,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"DELETE","lineNumber":468,"oldContent":"            3u -> \"Auto\""},{"type":"DELETE","lineNumber":471,"oldContent":"            0u -> \"Stabilize\""},{"type":"DELETE","lineNumber":474,"oldContent":"            5u -> \"Loiter\""},{"type":"INSERT","lineNumber":483,"content":"        val expectedMode = when (customMode) {"},{"type":"INSERT","lineNumber":484,"content":"            3u -> \"Auto\""},{"type":"INSERT","lineNumber":485,"content":"            0u -> \"Stabilize\""},{"type":"INSERT","lineNumber":486,"content":"            5u -> \"Loiter\""},{"type":"DELETE","lineNumber":483,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":484,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":494,"content":"            delay(200)"},{"type":"INSERT","lineNumber":496,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":496,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":497,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":528,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":529,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":593,"oldContent":"                delay(100)"},{"type":"DELETE","lineNumber":605,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":617,"oldContent":"                    }"},{"type":"INSERT","lineNumber":636,"content":"                delay(100)"},{"type":"INSERT","lineNumber":647,"content":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":658,"content":"                    }"},{"type":"DELETE","lineNumber":652,"oldContent":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":677,"oldContent":"            try {"},{"type":"DELETE","lineNumber":679,"oldContent":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":681,"oldContent":"                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, req)"},{"type":"DELETE","lineNumber":683,"oldContent":"                Log.i(\"MavlinkRepo\", \"Sent MISSION_REQUEST_LIST to FCU\")"},{"type":"DELETE","lineNumber":688,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"DELETE","lineNumber":690,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":694,"content":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":692,"oldContent":"                job.cancel()"},{"type":"DELETE","lineNumber":703,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":709,"oldContent":"                }"},{"type":"DELETE","lineNumber":718,"oldContent":"                perSeqMap.remove(seq)"},{"type":"INSERT","lineNumber":719,"content":"            try {"},{"type":"INSERT","lineNumber":720,"content":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":721,"content":"                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, req)"},{"type":"INSERT","lineNumber":722,"content":"                Log.i(\"MavlinkRepo\", \"Sent MISSION_REQUEST_LIST to FCU\")"},{"type":"INSERT","lineNumber":727,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":728,"content":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":729,"content":"                job.cancel()"},{"type":"DELETE","lineNumber":726,"oldContent":"    }"},{"type":"DELETE","lineNumber":729,"oldContent":""},{"type":"DELETE","lineNumber":730,"oldContent":"    /**"},{"type":"INSERT","lineNumber":739,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":744,"content":"                }"},{"type":"DELETE","lineNumber":745,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending ARM command...\")"},{"type":"DELETE","lineNumber":747,"oldContent":"            arm()"},{"type":"DELETE","lineNumber":749,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"DELETE","lineNumber":751,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":755,"content":"                perSeqMap.remove(seq)"},{"type":"DELETE","lineNumber":754,"oldContent":"            }"},{"type":"INSERT","lineNumber":757,"content":""},{"type":"DELETE","lineNumber":759,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":763,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":764,"oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":766,"content":"    }"},{"type":"INSERT","lineNumber":767,"content":""},{"type":"INSERT","lineNumber":768,"content":"    /**"},{"type":"DELETE","lineNumber":768,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":782,"oldContent":"        return true"},{"type":"INSERT","lineNumber":784,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending ARM command...\")"},{"type":"INSERT","lineNumber":785,"content":"            arm()"},{"type":"INSERT","lineNumber":786,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"INSERT","lineNumber":787,"content":"            delay(500)"},{"type":"DELETE","lineNumber":785,"oldContent":""},{"type":"DELETE","lineNumber":786,"oldContent":"    /**"},{"type":"INSERT","lineNumber":795,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":798,"content":"            delay(500)"},{"type":"INSERT","lineNumber":799,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":795,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":797,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":799,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":801,"oldContent":"            param4 = 0f,"},{"type":"INSERT","lineNumber":804,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":803,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":814,"oldContent":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"INSERT","lineNumber":816,"content":"            return false"},{"type":"INSERT","lineNumber":817,"content":"        }"},{"type":"INSERT","lineNumber":818,"content":""},{"type":"INSERT","lineNumber":819,"content":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"INSERT","lineNumber":820,"content":"        return true"},{"type":"DELETE","lineNumber":816,"oldContent":"        sendCommand(MavCmd.COMPONENT_ARM_DISARM, if (arm) 1f else 0f)"},{"type":"DELETE","lineNumber":817,"oldContent":"    suspend fun armDisarm(arm: Boolean) {"},{"type":"INSERT","lineNumber":822,"content":""},{"type":"INSERT","lineNumber":832,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":833,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":834,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":835,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":837,"content":"            param6 = 0f,"}]},{"timestamp":1758262348401,"changes":[{"type":"MODIFY","lineNumber":19,"content":"// MAVLink flight modes (ArduPilot values)","oldContent":"    private val port: Int"},{"type":"DELETE","lineNumber":43,"oldContent":"                try {"},{"type":"DELETE","lineNumber":44,"oldContent":"                        return // Exit on successful connection"},{"type":"INSERT","lineNumber":43,"content":""},{"type":"INSERT","lineNumber":44,"content":"    // Connection"},{"type":"MODIFY","lineNumber":60,"content":"                try {","oldContent":"        scope.launch {"},{"type":"MODIFY","lineNumber":62,"content":"                        return // Exit on successful connection","oldContent":"            connection.streamState.collect { st ->"},{"type":"MODIFY","lineNumber":65,"content":"                    Log.e(\"MavlinkRepo\", \"Connection attempt failed\", e)","oldContent":"                        if (!state.value.connected) {"},{"type":"MODIFY","lineNumber":67,"content":"                }","oldContent":"                            _state.update { it.copy(connected = true) }"},{"type":"MODIFY","lineNumber":70,"content":"        }","oldContent":"                    is StreamState.Inactive -> {"},{"type":"MODIFY","lineNumber":73,"content":"        scope.launch {","oldContent":"                            _state.update { it.copy(connected = false, fcuDetected = false) }"},{"type":"DELETE","lineNumber":76,"oldContent":"                    }"},{"type":"DELETE","lineNumber":77,"oldContent":"                }"},{"type":"INSERT","lineNumber":76,"content":"                when (st) {"},{"type":"INSERT","lineNumber":77,"content":"                    is StreamState.Active -> {"},{"type":"MODIFY","lineNumber":81,"content":"                        }","oldContent":"        // Send GCS heartbeat"},{"type":"DELETE","lineNumber":84,"oldContent":"                type = MavType.GCS.wrap(),"},{"type":"DELETE","lineNumber":85,"oldContent":"                autopilot = MavAutopilot.INVALID.wrap(),"},{"type":"INSERT","lineNumber":84,"content":"                        if (state.value.connected) {"},{"type":"INSERT","lineNumber":85,"content":"                            Log.i(\"MavlinkRepo\", \"Connection Inactive, reconnecting...\")"},{"type":"DELETE","lineNumber":102,"oldContent":""},{"type":"DELETE","lineNumber":103,"oldContent":"        // Shared message stream"},{"type":"INSERT","lineNumber":102,"content":"            )"},{"type":"INSERT","lineNumber":103,"content":"            while (isActive) {"},{"type":"MODIFY","lineNumber":111,"content":"                }","oldContent":"            }"},{"type":"DELETE","lineNumber":128,"oldContent":"                                val intervalUsec = if (hz <= 0f) 0f else (1_000_000f / hz)"},{"type":"DELETE","lineNumber":129,"oldContent":"                                val cmd = CommandLong("},{"type":"DELETE","lineNumber":130,"oldContent":"                                    targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":128,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":129,"content":"            mavFrameStream"},{"type":"INSERT","lineNumber":130,"content":"                .filter { it.message is Heartbeat && (it.message as Heartbeat).type != MavType.GCS.wrap() }"},{"type":"MODIFY","lineNumber":137,"content":"","oldContent":"                                    param4 = 0f,"},{"type":"DELETE","lineNumber":141,"oldContent":"                                )"},{"type":"DELETE","lineNumber":142,"oldContent":"                                try {"},{"type":"INSERT","lineNumber":141,"content":"                                val intervalUsec = if (hz <= 0f) 0f else (1_000_000f / hz)"},{"type":"INSERT","lineNumber":142,"content":"                                val cmd = CommandLong("},{"type":"MODIFY","lineNumber":166,"content":"                            setMessageRate(74u, 5f)  // VFR_HUD","oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"MODIFY","lineNumber":175,"content":"            mavFrameStream","oldContent":"                        )"},{"type":"MODIFY","lineNumber":200,"content":"                            altitudeMsl = hud.alt,","oldContent":""},{"type":"MODIFY","lineNumber":205,"content":"                }","oldContent":"                .map { it.message }"},{"type":"MODIFY","lineNumber":211,"content":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }","oldContent":"        }"},{"type":"DELETE","lineNumber":214,"oldContent":"            mavFrameStream"},{"type":"DELETE","lineNumber":215,"oldContent":"                .filter{ frame-> state.value.fcuDetected && frame.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":216,"oldContent":"                .map{frame -> frame.message}"},{"type":"DELETE","lineNumber":217,"oldContent":"                .filterIsInstance<Heartbeat>()"},{"type":"DELETE","lineNumber":218,"oldContent":"                .collect{ hb->"},{"type":"INSERT","lineNumber":214,"content":"                .collect { gp ->"},{"type":"INSERT","lineNumber":215,"content":"                    val altAMSLm = gp.alt / 1000f"},{"type":"INSERT","lineNumber":216,"content":"                    val relAltM = gp.relativeAlt / 1000f"},{"type":"INSERT","lineNumber":217,"content":"                    val lat = gp.lat.takeIf { it != Int.MIN_VALUE }?.let { it / 10_000_000.0 }"},{"type":"INSERT","lineNumber":218,"content":"                    val lon = gp.lon.takeIf { it != Int.MIN_VALUE }?.let { it / 10_000_000.0 }"},{"type":"INSERT","lineNumber":252,"content":"                        }"},{"type":"DELETE","lineNumber":253,"oldContent":"                    }"},{"type":"DELETE","lineNumber":269,"oldContent":""},{"type":"DELETE","lineNumber":275,"oldContent":"        var missionWasRunning = false // Track if mission was previously running"},{"type":"DELETE","lineNumber":277,"oldContent":""},{"type":"DELETE","lineNumber":290,"oldContent":"                .filterIsInstance<SysStatus>()"},{"type":"DELETE","lineNumber":291,"oldContent":"                .collect { s ->"},{"type":"DELETE","lineNumber":292,"oldContent":"                    val vBatt = if (s.voltageBattery.toUInt() == 0xFFFFu) null else s.voltageBattery.toFloat() / 1000f"},{"type":"DELETE","lineNumber":293,"oldContent":"                    val pct = if (s.batteryRemaining.toInt() == -1) null else s.batteryRemaining.toInt()"},{"type":"DELETE","lineNumber":294,"oldContent":"                    val SENSOR_3D_GYRO = 1u"},{"type":"DELETE","lineNumber":295,"oldContent":"                    val present = (s.onboardControlSensorsPresent.value and SENSOR_3D_GYRO) != 0u"},{"type":"DELETE","lineNumber":296,"oldContent":"                    val enabled = (s.onboardControlSensorsEnabled.value and SENSOR_3D_GYRO) != 0u"},{"type":"DELETE","lineNumber":297,"oldContent":"                    val healthy = (s.onboardControlSensorsHealth.value and SENSOR_3D_GYRO) != 0u"},{"type":"DELETE","lineNumber":298,"oldContent":"                    val armable = present && enabled && healthy"},{"type":"DELETE","lineNumber":299,"oldContent":"                    _state.update { it.copy(voltage = vBatt, batteryPercent = pct , armable = armable) }"},{"type":"INSERT","lineNumber":287,"content":"                        6u -> \"RTL\""},{"type":"INSERT","lineNumber":288,"content":"                        7u -> \"Circle\""},{"type":"INSERT","lineNumber":289,"content":"                        9u -> \"Land\""},{"type":"INSERT","lineNumber":290,"content":"                        11u -> \"Drift\""},{"type":"INSERT","lineNumber":291,"content":"                        13u -> \"Sport\""},{"type":"INSERT","lineNumber":292,"content":"                        14u -> \"Flip\""},{"type":"INSERT","lineNumber":293,"content":"                        15u -> \"AutoTune\""},{"type":"INSERT","lineNumber":294,"content":"                        16u -> \"Pos Hold\""},{"type":"INSERT","lineNumber":295,"content":"                        17u -> \"Brake\""},{"type":"INSERT","lineNumber":296,"content":"                        18u -> \"Throw\""},{"type":"DELETE","lineNumber":315,"oldContent":"                    val currentlyInAutoAndArmed = mode.equals(\"Auto\", ignoreCase = true) && armed"},{"type":"INSERT","lineNumber":312,"content":"                        if (mode.equals(\"Auto\", ignoreCase = true) && armed && (lastMode != mode || lastArmed != armed)) {"},{"type":"DELETE","lineNumber":317,"oldContent":""},{"type":"DELETE","lineNumber":321,"oldContent":"                        // Mission starting: Auto mode + armed + wasn't previously running"},{"type":"DELETE","lineNumber":323,"oldContent":"                        if (currentlyInAutoAndArmed && !missionWasRunning) {"},{"type":"DELETE","lineNumber":328,"oldContent":"                                missionWasRunning = true"},{"type":"DELETE","lineNumber":329,"oldContent":""},{"type":"DELETE","lineNumber":330,"oldContent":""},{"type":"DELETE","lineNumber":331,"oldContent":"                                // Mission ended - check if it completed naturally (disarmed) or was interrupted"},{"type":"INSERT","lineNumber":322,"content":"                                // Mission ended"},{"type":"INSERT","lineNumber":323,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":324,"content":"                                // Clear mission from FCU"},{"type":"INSERT","lineNumber":325,"content":"                                val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":326,"content":"                                try {"},{"type":"INSERT","lineNumber":327,"content":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":328,"content":"                                    Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"INSERT","lineNumber":329,"content":"                                } catch (e: Exception) {"},{"type":"INSERT","lineNumber":330,"content":"                                    Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"DELETE","lineNumber":333,"oldContent":"                                val finalArmed = state.value.armed"},{"type":"DELETE","lineNumber":335,"oldContent":"                                val finalMode = state.value.mode"},{"type":"DELETE","lineNumber":336,"oldContent":""},{"type":"DELETE","lineNumber":337,"oldContent":"                                if (!finalArmed && finalMode?.equals(\"Auto\", ignoreCase = true) == true) {"},{"type":"DELETE","lineNumber":338,"oldContent":"                                    // Mission completed naturally - drone disarmed while still in Auto mode"},{"type":"DELETE","lineNumber":339,"oldContent":"                                    Log.i(\"MavlinkRepo\", \"Mission completed naturally - drone disarmed in Auto mode\")"},{"type":"DELETE","lineNumber":340,"oldContent":"                                    _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":341,"oldContent":""},{"type":"DELETE","lineNumber":342,"oldContent":"                                    // Clear mission from FCU"},{"type":"DELETE","lineNumber":343,"oldContent":"                                    val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":344,"oldContent":"                                    try {"},{"type":"DELETE","lineNumber":345,"oldContent":"                                        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":346,"oldContent":"                                        Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"DELETE","lineNumber":347,"oldContent":"                                    } catch (e: Exception) {"},{"type":"DELETE","lineNumber":348,"oldContent":"                                        Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"DELETE","lineNumber":349,"oldContent":"                                    }"},{"type":"INSERT","lineNumber":333,"content":"                        } else if ((lastMode?.equals(\"Auto\", ignoreCase = true) == true && mode != \"Auto\") ||"},{"type":"INSERT","lineNumber":334,"content":"                                   (lastArmed == true && armed == false && mode.equals(\"Auto\", ignoreCase = true))) {"},{"type":"INSERT","lineNumber":335,"content":"                            // Mission ended (either mode changed from Auto, or drone disarmed in Auto)"},{"type":"INSERT","lineNumber":336,"content":"                            missionTimerJob?.cancel()"},{"type":"INSERT","lineNumber":337,"content":"                            missionTimerJob = null"},{"type":"INSERT","lineNumber":338,"content":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":339,"content":"                            // Clear mission from FCU"},{"type":"INSERT","lineNumber":340,"content":"                            val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":341,"content":"                            try {"},{"type":"INSERT","lineNumber":342,"content":"                                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"INSERT","lineNumber":343,"content":"                                Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"INSERT","lineNumber":344,"content":"                            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":345,"content":"                                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"INSERT","lineNumber":346,"content":"                            }"},{"type":"DELETE","lineNumber":351,"oldContent":"                                } else {"},{"type":"DELETE","lineNumber":353,"oldContent":"                                    // Mission was interrupted (mode changed or manually disarmed)"},{"type":"DELETE","lineNumber":355,"oldContent":"                                    Log.i(\"MavlinkRepo\", \"Mission was interrupted - mode: $finalMode, armed: $finalArmed\")"},{"type":"DELETE","lineNumber":357,"oldContent":"                                    _state.update { it.copy(missionElapsedSec = null, missionCompleted = false) }"},{"type":"DELETE","lineNumber":360,"oldContent":""},{"type":"DELETE","lineNumber":362,"oldContent":"                                missionWasRunning = false"},{"type":"DELETE","lineNumber":366,"oldContent":""},{"type":"DELETE","lineNumber":373,"oldContent":""},{"type":"INSERT","lineNumber":386,"content":""},{"type":"INSERT","lineNumber":388,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":407,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":457,"content":"    }"},{"type":"DELETE","lineNumber":475,"oldContent":"    }"},{"type":"INSERT","lineNumber":473,"content":"        val expectedMode = when (customMode) {"},{"type":"INSERT","lineNumber":474,"content":"            3u -> \"Auto\""},{"type":"INSERT","lineNumber":475,"content":"            0u -> \"Stabilize\""},{"type":"INSERT","lineNumber":476,"content":"            5u -> \"Loiter\""},{"type":"DELETE","lineNumber":489,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"DELETE","lineNumber":490,"oldContent":"            3u -> \"Auto\""},{"type":"DELETE","lineNumber":491,"oldContent":"            0u -> \"Stabilize\""},{"type":"DELETE","lineNumber":493,"oldContent":"            5u -> \"Loiter\""},{"type":"INSERT","lineNumber":484,"content":"            delay(200)"},{"type":"INSERT","lineNumber":486,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":502,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":505,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":518,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":519,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":536,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":538,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":613,"oldContent":"    }"},{"type":"DELETE","lineNumber":614,"oldContent":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"DELETE","lineNumber":615,"oldContent":""},{"type":"DELETE","lineNumber":616,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to set AUTO mode\", e)"},{"type":"DELETE","lineNumber":617,"oldContent":"                Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to switch to AUTO mode\")"},{"type":"DELETE","lineNumber":618,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":619,"oldContent":""},{"type":"DELETE","lineNumber":620,"oldContent":"            return false"},{"type":"INSERT","lineNumber":603,"content":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionItemInt)"},{"type":"INSERT","lineNumber":604,"content":"                                    sentSeqs.add(seq)"},{"type":"INSERT","lineNumber":605,"content":"                                    Log.i(\"MavlinkRepo\", \"Sent MISSION_ITEM_INT seq=$seq to sys=$senderSys comp=$senderComp (responding to MissionRequest)\")"},{"type":"INSERT","lineNumber":606,"content":"                                } catch (e: Exception) {"},{"type":"INSERT","lineNumber":607,"content":"                                    Log.e(\"MavlinkRepo\", \"Failed to send mission item(seq=$seq) as MissionItemInt\", e)"},{"type":"INSERT","lineNumber":608,"content":"                                }"},{"type":"INSERT","lineNumber":609,"content":"                            }"},{"type":"INSERT","lineNumber":610,"content":"                            is MissionAck -> {"},{"type":"DELETE","lineNumber":622,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":623,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":624,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"DELETE","lineNumber":625,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":612,"content":"                                if (!ackDeferred.isCompleted) ackDeferred.complete(true)"},{"type":"INSERT","lineNumber":613,"content":"                                return@collect"},{"type":"INSERT","lineNumber":614,"content":"                            }"},{"type":"INSERT","lineNumber":615,"content":"                            else -> {"},{"type":"INSERT","lineNumber":626,"content":"                delay(100)"},{"type":"DELETE","lineNumber":643,"oldContent":"                delay(100)"},{"type":"INSERT","lineNumber":637,"content":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":655,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":648,"content":"                    }"},{"type":"DELETE","lineNumber":666,"oldContent":"                    }"},{"type":"INSERT","lineNumber":684,"content":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":696,"oldContent":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":720,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":722,"oldContent":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"DELETE","lineNumber":724,"oldContent":"            }"},{"type":"INSERT","lineNumber":713,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":714,"content":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"INSERT","lineNumber":715,"content":"            }"},{"type":"INSERT","lineNumber":717,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":718,"content":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":719,"content":"                job.cancel()"},{"type":"DELETE","lineNumber":730,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"DELETE","lineNumber":732,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"DELETE","lineNumber":734,"oldContent":"                job.cancel()"},{"type":"INSERT","lineNumber":729,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":743,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":734,"content":"                }"},{"type":"DELETE","lineNumber":748,"oldContent":"    }"},{"type":"INSERT","lineNumber":739,"content":"                } ?: false"},{"type":"INSERT","lineNumber":740,"content":""},{"type":"INSERT","lineNumber":741,"content":"                if (!got) {"},{"type":"INSERT","lineNumber":742,"content":"                    Log.w(\"MavlinkRepo\", \"Did not receive item for seq=$seq within timeout\")"},{"type":"DELETE","lineNumber":751,"oldContent":"                    else -> {}"},{"type":"DELETE","lineNumber":752,"oldContent":"                        lastMissionCmd = msg.command.value"},{"type":"DELETE","lineNumber":753,"oldContent":"                    is MissionItemInt -> {"},{"type":"DELETE","lineNumber":754,"oldContent":""},{"type":"DELETE","lineNumber":755,"oldContent":"                                }"},{"type":"INSERT","lineNumber":746,"content":"            }"},{"type":"INSERT","lineNumber":747,"content":""},{"type":"DELETE","lineNumber":760,"oldContent":""},{"type":"DELETE","lineNumber":767,"oldContent":"     * Start the mission after uploading."},{"type":"DELETE","lineNumber":769,"oldContent":"     * Replicates the Dart/Flutter workflow:"},{"type":"INSERT","lineNumber":759,"content":"     * Start the mission after uploading."},{"type":"INSERT","lineNumber":760,"content":"     * Replicates the Dart/Flutter workflow:"},{"type":"DELETE","lineNumber":784,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":786,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"INSERT","lineNumber":778,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":779,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"INSERT","lineNumber":785,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":788,"content":"            delay(500)"},{"type":"INSERT","lineNumber":789,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":798,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":800,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":802,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":804,"oldContent":"        try {"},{"type":"INSERT","lineNumber":795,"content":"        try {"},{"type":"DELETE","lineNumber":812,"oldContent":"    }"},{"type":"DELETE","lineNumber":813,"oldContent":"        sendCommand(MavCmd.COMPONENT_ARM_DISARM, if (arm) 1f else 0f)"},{"type":"DELETE","lineNumber":814,"oldContent":"     */"},{"type":"INSERT","lineNumber":802,"content":"                return false"},{"type":"INSERT","lineNumber":803,"content":"            }"},{"type":"INSERT","lineNumber":804,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":816,"oldContent":"    }"},{"type":"DELETE","lineNumber":820,"oldContent":"                        }"},{"type":"DELETE","lineNumber":822,"oldContent":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"INSERT","lineNumber":811,"content":"    }"},{"type":"INSERT","lineNumber":812,"content":""},{"type":"INSERT","lineNumber":813,"content":"    /**"},{"type":"INSERT","lineNumber":814,"content":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"DELETE","lineNumber":826,"oldContent":""},{"type":"INSERT","lineNumber":822,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":823,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":824,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":825,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":827,"content":"            param6 = 0f,"},{"type":"DELETE","lineNumber":837,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":839,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":841,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":843,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":846,"oldContent":"            param6 = 0f,"}]},{"timestamp":1758274710266,"changes":[{"type":"DELETE","lineNumber":6,"oldContent":"import com.divpundir.mavlink.adapters.coroutines.trySendUnsignedV2"},{"type":"INSERT","lineNumber":8,"content":"import com.divpundir.mavlink.connection.tcp.TcpClientMavConnection"},{"type":"MODIFY","lineNumber":10,"content":"import com.divpundir.mavlink.definitions.minimal.*","oldContent":"import com.divpundir.mavlink.definitions.common.*"},{"type":"MODIFY","lineNumber":27,"content":"","oldContent":"    private var fcuSystemId: UByte = 0u"},{"type":"MODIFY","lineNumber":63,"content":"                    }","oldContent":"                when (st) {"},{"type":"DELETE","lineNumber":89,"oldContent":"            )"},{"type":"DELETE","lineNumber":90,"oldContent":"            while (isActive) {"},{"type":"DELETE","lineNumber":91,"oldContent":"                if (state.value.connected) {"},{"type":"INSERT","lineNumber":89,"content":"                    }"},{"type":"INSERT","lineNumber":90,"content":"                }"},{"type":"INSERT","lineNumber":91,"content":"            }"},{"type":"MODIFY","lineNumber":106,"content":"                        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, heartbeat)","oldContent":""},{"type":"MODIFY","lineNumber":136,"content":"                        _state.update { it.copy(fcuDetected = true) }","oldContent":"                                    param3 = 0f,"},{"type":"MODIFY","lineNumber":140,"content":"                            suspend fun setMessageRate(messageId: UInt, hz: Float) {","oldContent":"                                    param7 = 0f"},{"type":"DELETE","lineNumber":178,"oldContent":""},{"type":"DELETE","lineNumber":179,"oldContent":"        // GLOBAL_POSITION_INT"},{"type":"INSERT","lineNumber":178,"content":"                .filterIsInstance<CommandAck>()"},{"type":"INSERT","lineNumber":179,"content":"                .collect { ack ->"},{"type":"DELETE","lineNumber":208,"oldContent":"                    val currentA = if (b.currentBattery.toInt() == -1) null else b.currentBattery / 100f"},{"type":"DELETE","lineNumber":209,"oldContent":"                    _state.update { it.copy(currentA = currentA) }"},{"type":"DELETE","lineNumber":210,"oldContent":"                }"},{"type":"INSERT","lineNumber":208,"content":"        // GLOBAL_POSITION_INT"},{"type":"INSERT","lineNumber":209,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":210,"content":"            mavFrameStream"},{"type":"DELETE","lineNumber":284,"oldContent":"                        6u -> \"RTL\""},{"type":"DELETE","lineNumber":286,"oldContent":"                        7u -> \"Circle\""},{"type":"MODIFY","lineNumber":287,"content":"                        6u -> \"RTL\"","oldContent":"                        9u -> \"Land\""},{"type":"INSERT","lineNumber":288,"content":"                        7u -> \"Circle\""},{"type":"INSERT","lineNumber":289,"content":"                        9u -> \"Land\""},{"type":"DELETE","lineNumber":309,"oldContent":"                        if (mode.equals(\"Auto\", ignoreCase = true) && armed && (lastMode != mode || lastArmed != armed)) {"},{"type":"INSERT","lineNumber":312,"content":"                        if (mode.equals(\"Auto\", ignoreCase = true) && armed && (lastMode != mode || lastArmed != armed)) {"},{"type":"DELETE","lineNumber":317,"oldContent":"                                // Mission ended"},{"type":"DELETE","lineNumber":319,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":320,"oldContent":"                                // Clear mission from FCU"},{"type":"DELETE","lineNumber":322,"oldContent":"                                val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":324,"oldContent":"                                try {"},{"type":"DELETE","lineNumber":326,"oldContent":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":328,"oldContent":"                                    Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"DELETE","lineNumber":329,"oldContent":"                                } catch (e: Exception) {"},{"type":"DELETE","lineNumber":330,"oldContent":"                                    Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"DELETE","lineNumber":331,"oldContent":"                                }"},{"type":"INSERT","lineNumber":322,"content":"                                // Mission ended"},{"type":"INSERT","lineNumber":323,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":324,"content":"                                // Do NOT clear mission from FCU here"},{"type":"INSERT","lineNumber":325,"content":"                            }"},{"type":"DELETE","lineNumber":334,"oldContent":"                            }"},{"type":"DELETE","lineNumber":339,"oldContent":"                            // Clear mission from FCU"},{"type":"DELETE","lineNumber":340,"oldContent":"                            val clearAll = MissionClearAll(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":341,"oldContent":"                            try {"},{"type":"DELETE","lineNumber":342,"oldContent":"                                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":343,"oldContent":"                                Log.i(\"MavlinkRepo\", \"Sent MISSION_CLEAR_ALL after mission completion\")"},{"type":"DELETE","lineNumber":344,"oldContent":"                            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":345,"oldContent":"                                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_CLEAR_ALL after mission completion\", e)"},{"type":"DELETE","lineNumber":346,"oldContent":"                            }"},{"type":"INSERT","lineNumber":332,"content":"                            // Do NOT clear mission from FCU here"},{"type":"DELETE","lineNumber":375,"oldContent":""},{"type":"DELETE","lineNumber":378,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":372,"content":""},{"type":"INSERT","lineNumber":374,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":447,"oldContent":"    }"},{"type":"DELETE","lineNumber":457,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"INSERT","lineNumber":442,"content":"        }"},{"type":"INSERT","lineNumber":443,"content":"    }"},{"type":"DELETE","lineNumber":464,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"DELETE","lineNumber":466,"oldContent":"            3u -> \"Auto\""},{"type":"DELETE","lineNumber":468,"oldContent":"            0u -> \"Stabilize\""},{"type":"DELETE","lineNumber":469,"oldContent":"            5u -> \"Loiter\""},{"type":"INSERT","lineNumber":459,"content":"        val expectedMode = when (customMode) {"},{"type":"INSERT","lineNumber":460,"content":"            3u -> \"Auto\""},{"type":"INSERT","lineNumber":461,"content":"            0u -> \"Stabilize\""},{"type":"INSERT","lineNumber":462,"content":"            5u -> \"Loiter\""},{"type":"DELETE","lineNumber":478,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":481,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":470,"content":"            delay(200)"},{"type":"INSERT","lineNumber":472,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":508,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":510,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":504,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":505,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":575,"oldContent":"}"},{"type":"DELETE","lineNumber":576,"oldContent":"    }"},{"type":"DELETE","lineNumber":577,"oldContent":""},{"type":"DELETE","lineNumber":578,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to set AUTO mode\", e)"},{"type":"DELETE","lineNumber":579,"oldContent":"            val modeChanged = changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":580,"oldContent":""},{"type":"DELETE","lineNumber":581,"oldContent":"            return false"},{"type":"DELETE","lineNumber":582,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":583,"oldContent":"            arm()"},{"type":"DELETE","lineNumber":584,"oldContent":"        try {"},{"type":"DELETE","lineNumber":585,"oldContent":""},{"type":"DELETE","lineNumber":586,"oldContent":"            return false"},{"type":"DELETE","lineNumber":587,"oldContent":"        if (!state.value.fcuDetected) {"},{"type":"INSERT","lineNumber":561,"content":"                                    targetSystem = senderSys.toUByte(),"},{"type":"INSERT","lineNumber":562,"content":"                                    targetComponent = senderComp.toUByte(),"},{"type":"INSERT","lineNumber":563,"content":"                                    seq = seq.toUShort()"},{"type":"INSERT","lineNumber":564,"content":"                                )"},{"type":"INSERT","lineNumber":565,"content":"                                try {"},{"type":"INSERT","lineNumber":566,"content":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionItem)"},{"type":"INSERT","lineNumber":567,"content":"                                    sentSeqs.add(seq)"},{"type":"INSERT","lineNumber":568,"content":"                                    Log.i(\"MavlinkRepo\", \"Sent MISSION_ITEM_INT seq=$seq to sys=$senderSys comp=$senderComp\")"},{"type":"INSERT","lineNumber":569,"content":"                                } catch (e: Exception) {"},{"type":"INSERT","lineNumber":570,"content":"                                    Log.e(\"MavlinkRepo\", \"Failed to send mission item seq=$seq\", e)"},{"type":"INSERT","lineNumber":571,"content":"                                }"},{"type":"INSERT","lineNumber":572,"content":"                            }"},{"type":"INSERT","lineNumber":573,"content":"                            is MissionRequest -> {"},{"type":"DELETE","lineNumber":589,"oldContent":"    /**"},{"type":"DELETE","lineNumber":590,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":591,"oldContent":""},{"type":"DELETE","lineNumber":592,"oldContent":"                } catch (e: Exception) {"},{"type":"INSERT","lineNumber":575,"content":"                                firstRequestReceived = true"},{"type":"INSERT","lineNumber":576,"content":"                                val seq = msg.seq.toInt()"},{"type":"INSERT","lineNumber":577,"content":"                                if (seq < 0 || seq >= missionItems.size) {"},{"type":"INSERT","lineNumber":578,"content":"                                    Log.w(\"MavlinkRepo\", \"FC requested invalid seq=$seq (MissionRequest)\")"},{"type":"INSERT","lineNumber":579,"content":"                                    return@collect"},{"type":"INSERT","lineNumber":580,"content":"                                }"},{"type":"INSERT","lineNumber":581,"content":"                                val itemInt = missionItems[seq]"},{"type":"INSERT","lineNumber":582,"content":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending waypoint seq=$seq: ${itemInt.command} lat=${itemInt.x / 1e7} lon=${itemInt.y / 1e7} alt=${itemInt.z}\")"},{"type":"INSERT","lineNumber":583,"content":"                                val missionItemInt = itemInt.copy("},{"type":"INSERT","lineNumber":584,"content":"                                    targetSystem = senderSys.toUByte(),"},{"type":"INSERT","lineNumber":585,"content":"                                    targetComponent = senderComp.toUByte(),"},{"type":"INSERT","lineNumber":586,"content":"                                    seq = seq.toUShort()"},{"type":"INSERT","lineNumber":587,"content":"                                )"},{"type":"INSERT","lineNumber":588,"content":"                                try {"},{"type":"DELETE","lineNumber":594,"oldContent":"                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, reqItem)"},{"type":"DELETE","lineNumber":596,"oldContent":"                try {"},{"type":"DELETE","lineNumber":598,"oldContent":"                val seqDeferred = CompletableDeferred<Unit>()"},{"type":"DELETE","lineNumber":600,"oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending waypoint seq=$seq: ${itemInt.command} lat=${itemInt.x / 1e7} lon=${itemInt.y / 1e7} alt=${itemInt.z}\")"},{"type":"DELETE","lineNumber":602,"oldContent":"            Log.i(\"MavlinkRepo\", \"Expecting $expectedCount mission items - requesting each item\")"},{"type":"DELETE","lineNumber":604,"oldContent":"                return"},{"type":"DELETE","lineNumber":606,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"DELETE","lineNumber":608,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"DELETE","lineNumber":609,"oldContent":"                Log.i(\"MavlinkRepo\", \"Sent MISSION_REQUEST_LIST to FCU\")"},{"type":"INSERT","lineNumber":597,"content":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Received MISSION_ACK type=${msg.type}\")"},{"type":"DELETE","lineNumber":611,"oldContent":""},{"type":"DELETE","lineNumber":615,"oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Received MISSION_ACK type=${msg.type}\")"},{"type":"DELETE","lineNumber":616,"oldContent":"                delay(100)"},{"type":"INSERT","lineNumber":612,"content":"                delay(100)"},{"type":"DELETE","lineNumber":628,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":623,"content":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":639,"oldContent":"                    }"},{"type":"INSERT","lineNumber":634,"content":"                    }"},{"type":"DELETE","lineNumber":670,"oldContent":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"DELETE","lineNumber":671,"oldContent":"            targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":672,"oldContent":"    suspend fun sendMissionStartCommand() {"},{"type":"INSERT","lineNumber":656,"content":"    }"},{"type":"INSERT","lineNumber":657,"content":""},{"type":"INSERT","lineNumber":658,"content":"    suspend fun requestMissionAndLog(timeoutMs: Long = 5000) {"},{"type":"DELETE","lineNumber":674,"oldContent":"                    when (val msg = frame.message) {"},{"type":"INSERT","lineNumber":670,"content":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":703,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":705,"oldContent":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"DELETE","lineNumber":707,"oldContent":"            }"},{"type":"DELETE","lineNumber":710,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"DELETE","lineNumber":712,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"DELETE","lineNumber":714,"oldContent":"                job.cancel()"},{"type":"INSERT","lineNumber":699,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":700,"content":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"INSERT","lineNumber":701,"content":"            }"},{"type":"INSERT","lineNumber":703,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":704,"content":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":705,"content":"                job.cancel()"},{"type":"DELETE","lineNumber":722,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":723,"oldContent":"                }"},{"type":"INSERT","lineNumber":708,"content":""},{"type":"DELETE","lineNumber":726,"oldContent":"                }"},{"type":"DELETE","lineNumber":731,"oldContent":"                } ?: false"},{"type":"INSERT","lineNumber":715,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":733,"oldContent":""},{"type":"DELETE","lineNumber":735,"oldContent":"                if (!got) {"},{"type":"DELETE","lineNumber":737,"oldContent":"                    Log.w(\"MavlinkRepo\", \"Did not receive item for seq=$seq within timeout\")"},{"type":"INSERT","lineNumber":720,"content":"                }"},{"type":"DELETE","lineNumber":741,"oldContent":"            }"},{"type":"DELETE","lineNumber":743,"oldContent":""},{"type":"INSERT","lineNumber":725,"content":"                } ?: false"},{"type":"INSERT","lineNumber":726,"content":""},{"type":"INSERT","lineNumber":727,"content":"                if (!got) {"},{"type":"INSERT","lineNumber":728,"content":"                    Log.w(\"MavlinkRepo\", \"Did not receive item for seq=$seq within timeout\")"},{"type":"INSERT","lineNumber":732,"content":"            }"},{"type":"INSERT","lineNumber":733,"content":""},{"type":"DELETE","lineNumber":750,"oldContent":"     * Start the mission after uploading."},{"type":"DELETE","lineNumber":752,"oldContent":"     * Replicates the Dart/Flutter workflow:"},{"type":"INSERT","lineNumber":745,"content":"     * Start the mission after uploading."},{"type":"INSERT","lineNumber":746,"content":"     * Replicates the Dart/Flutter workflow:"},{"type":"DELETE","lineNumber":768,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":770,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"DELETE","lineNumber":776,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":779,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":781,"oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":764,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":765,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"DELETE","lineNumber":788,"oldContent":"        try {"},{"type":"INSERT","lineNumber":771,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":791,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":792,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to set AUTO mode\", e)"},{"type":"DELETE","lineNumber":793,"oldContent":"        }"},{"type":"DELETE","lineNumber":794,"oldContent":"                return false"},{"type":"DELETE","lineNumber":795,"oldContent":"            }"},{"type":"DELETE","lineNumber":796,"oldContent":"    }"},{"type":"INSERT","lineNumber":774,"content":"            delay(500)"},{"type":"INSERT","lineNumber":776,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"INSERT","lineNumber":777,"content":"            return false"},{"type":"INSERT","lineNumber":778,"content":"        }"},{"type":"INSERT","lineNumber":779,"content":""},{"type":"INSERT","lineNumber":781,"content":"        try {"},{"type":"DELETE","lineNumber":800,"oldContent":"     */"},{"type":"INSERT","lineNumber":783,"content":"            val modeChanged = changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":804,"oldContent":"    }"},{"type":"DELETE","lineNumber":806,"oldContent":""},{"type":"DELETE","lineNumber":807,"oldContent":"    /**"},{"type":"DELETE","lineNumber":808,"oldContent":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"INSERT","lineNumber":788,"content":"                return false"},{"type":"INSERT","lineNumber":789,"content":"            }"},{"type":"INSERT","lineNumber":790,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":814,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":815,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":817,"oldContent":"            param3 = 0f,"},{"type":"INSERT","lineNumber":797,"content":"    }"},{"type":"INSERT","lineNumber":798,"content":""},{"type":"INSERT","lineNumber":799,"content":"    /**"},{"type":"INSERT","lineNumber":800,"content":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"DELETE","lineNumber":819,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":821,"oldContent":"            param6 = 0f,"},{"type":"INSERT","lineNumber":808,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":809,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":810,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":811,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":813,"content":"            param6 = 0f,"}]},{"timestamp":1758276970115,"changes":[{"type":"INSERT","lineNumber":6,"content":"import com.divpundir.mavlink.api.wrap"},{"type":"DELETE","lineNumber":8,"oldContent":"import com.divpundir.mavlink.connection.tcp.TcpClientMavConnection"},{"type":"MODIFY","lineNumber":42,"content":"    val lastFailure: StateFlow<Throwable?> = _lastFailure.asStateFlow()","oldContent":"                try {"},{"type":"MODIFY","lineNumber":59,"content":"            while (scope.isActive) {","oldContent":"        // Manage connection state + reconnects"},{"type":"MODIFY","lineNumber":64,"content":"                } catch (e: Exception) {","oldContent":"                    is StreamState.Active -> {"},{"type":"MODIFY","lineNumber":72,"content":"        // Manage connection state + reconnects","oldContent":"                            Log.i(\"MavlinkRepo\", \"Connection Inactive, reconnecting...\")"},{"type":"MODIFY","lineNumber":80,"content":"                            _state.update { it.copy(connected = true) }","oldContent":""},{"type":"MODIFY","lineNumber":88,"content":"                        }","oldContent":"                mavlinkVersion = 3u"},{"type":"DELETE","lineNumber":98,"oldContent":"                }"},{"type":"DELETE","lineNumber":99,"oldContent":"                delay(1000)"},{"type":"DELETE","lineNumber":100,"oldContent":"            }"},{"type":"DELETE","lineNumber":101,"oldContent":"        }"},{"type":"INSERT","lineNumber":98,"content":"                autopilot = MavAutopilot.INVALID.wrap(),"},{"type":"INSERT","lineNumber":99,"content":"                baseMode = emptyList<MavModeFlag>().wrap(),"},{"type":"INSERT","lineNumber":100,"content":"                customMode = 0u,"},{"type":"INSERT","lineNumber":101,"content":"                mavlinkVersion = 3u"},{"type":"MODIFY","lineNumber":104,"content":"                if (state.value.connected) {","oldContent":"        val mavFrameStream = connection.mavFrame"},{"type":"MODIFY","lineNumber":107,"content":"                    } catch (e: Exception) {","oldContent":"        // Log raw messages"},{"type":"MODIFY","lineNumber":118,"content":"            .shareIn(scope, SharingStarted.Eagerly, replay = 0)","oldContent":"                .collect {"},{"type":"MODIFY","lineNumber":127,"content":"        // Detect FCU","oldContent":"                            suspend fun setMessageRate(messageId: UInt, hz: Float) {"},{"type":"MODIFY","lineNumber":131,"content":"                .collect {","oldContent":"                                    targetComponent = fcuComponentId,"},{"type":"MODIFY","lineNumber":139,"content":"                        launch {","oldContent":"                                    param6 = 0f,"},{"type":"DELETE","lineNumber":155,"oldContent":"                        }"},{"type":"DELETE","lineNumber":156,"oldContent":"                    }"},{"type":"INSERT","lineNumber":155,"content":"                                try {"},{"type":"INSERT","lineNumber":156,"content":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"INSERT","lineNumber":161,"content":"                            }"},{"type":"DELETE","lineNumber":162,"oldContent":""},{"type":"MODIFY","lineNumber":165,"content":"                            setMessageRate(33u, 5f)  // GLOBAL_POSITION_INT","oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"MODIFY","lineNumber":174,"content":"        scope.launch {","oldContent":"                        )"},{"type":"MODIFY","lineNumber":176,"content":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }","oldContent":"                }"},{"type":"DELETE","lineNumber":194,"oldContent":"                            latitude = lat,"},{"type":"DELETE","lineNumber":195,"oldContent":"                            longitude = lon"},{"type":"DELETE","lineNumber":196,"oldContent":"                        )"},{"type":"DELETE","lineNumber":197,"oldContent":"                    }"},{"type":"DELETE","lineNumber":198,"oldContent":"                }"},{"type":"INSERT","lineNumber":194,"content":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":195,"content":"                .map { it.message }"},{"type":"INSERT","lineNumber":196,"content":"                .filterIsInstance<VfrHud>()"},{"type":"INSERT","lineNumber":197,"content":"                .collect { hud ->"},{"type":"INSERT","lineNumber":198,"content":"                    _state.update {"},{"type":"MODIFY","lineNumber":201,"content":"                            airspeed = hud.airspeed.takeIf { v -> v > 0f },","oldContent":"        // BATTERY_STATUS"},{"type":"MODIFY","lineNumber":204,"content":"                    }","oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"MODIFY","lineNumber":206,"content":"        }","oldContent":"                .filterIsInstance<BatteryStatus>()"},{"type":"INSERT","lineNumber":285,"content":"                        4u -> \"Guided\""},{"type":"INSERT","lineNumber":286,"content":"                        5u -> \"Loiter\""},{"type":"DELETE","lineNumber":288,"oldContent":"                        9u -> \"Land\""},{"type":"DELETE","lineNumber":289,"oldContent":"                        5u -> \"Loiter\""},{"type":"MODIFY","lineNumber":312,"content":"                        if (mode.equals(\"Auto\", ignoreCase = true) && armed && (lastMode != mode || lastArmed != armed)) {","oldContent":"                        if (mode.equals(\"Auto\", ignoreCase = true) && armed && (lastMode != mode || lastArmed != armed)) {"},{"type":"INSERT","lineNumber":319,"content":"                                    elapsed += 1"},{"type":"INSERT","lineNumber":320,"content":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"INSERT","lineNumber":321,"content":"                                }"},{"type":"DELETE","lineNumber":321,"oldContent":"                                    elapsed += 1"},{"type":"DELETE","lineNumber":324,"oldContent":"                                    _state.update { it.copy(missionElapsedSec = elapsed) }"},{"type":"DELETE","lineNumber":325,"oldContent":"                                }"},{"type":"DELETE","lineNumber":326,"oldContent":"                            // Do NOT clear mission from FCU here"},{"type":"INSERT","lineNumber":332,"content":"                            // Do NOT clear mission from FCU here"},{"type":"DELETE","lineNumber":358,"oldContent":""},{"type":"DELETE","lineNumber":361,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":372,"content":""},{"type":"INSERT","lineNumber":374,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":428,"oldContent":"        }"},{"type":"DELETE","lineNumber":430,"oldContent":"    }"},{"type":"INSERT","lineNumber":442,"content":"        }"},{"type":"INSERT","lineNumber":443,"content":"    }"},{"type":"DELETE","lineNumber":445,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"DELETE","lineNumber":447,"oldContent":"            3u -> \"Auto\""},{"type":"DELETE","lineNumber":449,"oldContent":"            0u -> \"Stabilize\""},{"type":"DELETE","lineNumber":451,"oldContent":"            5u -> \"Loiter\""},{"type":"DELETE","lineNumber":456,"oldContent":"            delay(200)"},{"type":"MODIFY","lineNumber":459,"content":"        val expectedMode = when (customMode) {","oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":460,"content":"            3u -> \"Auto\""},{"type":"INSERT","lineNumber":461,"content":"            0u -> \"Stabilize\""},{"type":"INSERT","lineNumber":462,"content":"            5u -> \"Loiter\""},{"type":"INSERT","lineNumber":470,"content":"            delay(200)"},{"type":"INSERT","lineNumber":472,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":490,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":492,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":504,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"INSERT","lineNumber":505,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":545,"oldContent":"                perSeqMap[seq] = seqDeferred"},{"type":"DELETE","lineNumber":546,"oldContent":"            for (seq in 0 until expectedCount) {"},{"type":"INSERT","lineNumber":545,"content":"                connection.mavFrame"},{"type":"INSERT","lineNumber":546,"content":"                    .collect { frame ->"},{"type":"INSERT","lineNumber":547,"content":"                        val senderSys = frame.systemId"},{"type":"INSERT","lineNumber":548,"content":"                        val senderComp = frame.componentId"},{"type":"INSERT","lineNumber":549,"content":"                        when (val msg = frame.message) {"},{"type":"INSERT","lineNumber":550,"content":"                            is MissionRequestInt -> {"},{"type":"INSERT","lineNumber":551,"content":"                                Log.d(\"MavlinkRepo\", \"[Mission Upload] Received MissionRequestInt seq=${msg.seq}\")"},{"type":"INSERT","lineNumber":552,"content":"                                firstRequestReceived = true"},{"type":"INSERT","lineNumber":553,"content":"                                val seq = msg.seq.toInt()"},{"type":"INSERT","lineNumber":554,"content":"                                if (seq < 0 || seq >= missionItems.size) {"},{"type":"INSERT","lineNumber":555,"content":"                                    Log.w(\"MavlinkRepo\", \"FC requested invalid seq=$seq (MissionRequestInt)\")"},{"type":"INSERT","lineNumber":556,"content":"                                    return@collect"},{"type":"INSERT","lineNumber":557,"content":"                                }"},{"type":"INSERT","lineNumber":558,"content":"                                val item = missionItems[seq]"},{"type":"INSERT","lineNumber":559,"content":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending waypoint seq=$seq: ${item.command} lat=${item.x / 1e7} lon=${item.y / 1e7} alt=${item.z}\")"},{"type":"INSERT","lineNumber":560,"content":"                                val missionItem = item.copy("},{"type":"DELETE","lineNumber":548,"oldContent":"            Log.i(\"MavlinkRepo\", \"Expecting $expectedCount mission items - requesting each item\")"},{"type":"DELETE","lineNumber":550,"oldContent":"                job.cancel()"},{"type":"DELETE","lineNumber":552,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"DELETE","lineNumber":554,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":556,"oldContent":"                                Log.d(\"MavlinkRepo\", \"[Mission Upload] Received MissionRequestInt seq=${msg.seq}\")"},{"type":"DELETE","lineNumber":558,"oldContent":"                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, req)"},{"type":"DELETE","lineNumber":560,"oldContent":""},{"type":"DELETE","lineNumber":562,"oldContent":"            val expectedCountDeferred = CompletableDeferred<Int?>()"},{"type":"DELETE","lineNumber":564,"oldContent":"            val received = mutableListOf<Pair<Int, String>>()"},{"type":"DELETE","lineNumber":566,"oldContent":"        }"},{"type":"DELETE","lineNumber":568,"oldContent":"            return"},{"type":"DELETE","lineNumber":570,"oldContent":"        if (!state.value.fcuDetected) {"},{"type":"DELETE","lineNumber":572,"oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending waypoint seq=$seq: ${item.command} lat=${item.x / 1e7} lon=${item.y / 1e7} alt=${item.z}\")"},{"type":"DELETE","lineNumber":573,"oldContent":"    }"},{"type":"INSERT","lineNumber":574,"content":"                                Log.d(\"MavlinkRepo\", \"[Mission Upload] Received MissionRequest seq=${msg.seq}\")"},{"type":"DELETE","lineNumber":588,"oldContent":"                                Log.d(\"MavlinkRepo\", \"[Mission Upload] Received MissionRequest seq=${msg.seq}\")"},{"type":"DELETE","lineNumber":591,"oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Received MISSION_ACK type=${msg.type}\")"},{"type":"INSERT","lineNumber":597,"content":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Received MISSION_ACK type=${msg.type}\")"},{"type":"DELETE","lineNumber":599,"oldContent":"                delay(100)"},{"type":"DELETE","lineNumber":609,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":612,"content":"                delay(100)"},{"type":"DELETE","lineNumber":620,"oldContent":"                    }"},{"type":"INSERT","lineNumber":623,"content":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":634,"content":"                    }"},{"type":"DELETE","lineNumber":642,"oldContent":"    }"},{"type":"DELETE","lineNumber":644,"oldContent":""},{"type":"DELETE","lineNumber":646,"oldContent":"    suspend fun requestMissionAndLog(timeoutMs: Long = 5000) {"},{"type":"DELETE","lineNumber":659,"oldContent":"                    when (val msg = frame.message) {"},{"type":"INSERT","lineNumber":656,"content":"    }"},{"type":"INSERT","lineNumber":657,"content":""},{"type":"INSERT","lineNumber":658,"content":"    suspend fun requestMissionAndLog(timeoutMs: Long = 5000) {"},{"type":"INSERT","lineNumber":670,"content":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":685,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":687,"oldContent":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"DELETE","lineNumber":689,"oldContent":"            }"},{"type":"DELETE","lineNumber":691,"oldContent":"    }"},{"type":"DELETE","lineNumber":692,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"DELETE","lineNumber":693,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"DELETE","lineNumber":694,"oldContent":"            }"},{"type":"DELETE","lineNumber":695,"oldContent":"                job.cancel()"},{"type":"DELETE","lineNumber":696,"oldContent":"                }"},{"type":"DELETE","lineNumber":697,"oldContent":""},{"type":"DELETE","lineNumber":698,"oldContent":"                    else -> {}"},{"type":"INSERT","lineNumber":688,"content":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ACK type=${msg.type}\")"},{"type":"INSERT","lineNumber":689,"content":"                        }"},{"type":"INSERT","lineNumber":690,"content":"                        else -> {}"},{"type":"INSERT","lineNumber":692,"content":"                }"},{"type":"DELETE","lineNumber":702,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":699,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":700,"content":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"INSERT","lineNumber":701,"content":"            }"},{"type":"DELETE","lineNumber":708,"oldContent":"                }"},{"type":"INSERT","lineNumber":703,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":704,"content":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":705,"content":"                job.cancel()"},{"type":"INSERT","lineNumber":708,"content":""},{"type":"DELETE","lineNumber":712,"oldContent":"                } ?: false"},{"type":"DELETE","lineNumber":714,"oldContent":""},{"type":"DELETE","lineNumber":715,"oldContent":"                if (!got) {"},{"type":"DELETE","lineNumber":717,"oldContent":"                    Log.w(\"MavlinkRepo\", \"Did not receive item for seq=$seq within timeout\")"},{"type":"DELETE","lineNumber":721,"oldContent":"            }"},{"type":"INSERT","lineNumber":715,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":723,"oldContent":""},{"type":"INSERT","lineNumber":720,"content":"                }"},{"type":"DELETE","lineNumber":731,"oldContent":"     * Start the mission after uploading."},{"type":"INSERT","lineNumber":725,"content":"                } ?: false"},{"type":"INSERT","lineNumber":726,"content":""},{"type":"INSERT","lineNumber":727,"content":"                if (!got) {"},{"type":"INSERT","lineNumber":728,"content":"                    Log.w(\"MavlinkRepo\", \"Did not receive item for seq=$seq within timeout\")"},{"type":"DELETE","lineNumber":733,"oldContent":"     * Replicates the Dart/Flutter workflow:"},{"type":"INSERT","lineNumber":732,"content":"            }"},{"type":"INSERT","lineNumber":733,"content":""},{"type":"INSERT","lineNumber":745,"content":"     * Start the mission after uploading."},{"type":"INSERT","lineNumber":746,"content":"     * Replicates the Dart/Flutter workflow:"},{"type":"DELETE","lineNumber":750,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":752,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"DELETE","lineNumber":757,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":761,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":764,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"DELETE","lineNumber":765,"oldContent":"            return false"},{"type":"DELETE","lineNumber":767,"oldContent":"        }"},{"type":"DELETE","lineNumber":769,"oldContent":""},{"type":"DELETE","lineNumber":771,"oldContent":"        try {"},{"type":"DELETE","lineNumber":773,"oldContent":"            val modeChanged = changeMode(MavMode.AUTO)"},{"type":"INSERT","lineNumber":764,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":765,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"DELETE","lineNumber":779,"oldContent":"                return false"},{"type":"DELETE","lineNumber":780,"oldContent":"            }"},{"type":"INSERT","lineNumber":771,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":773,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] MISSION_START command sent\")"},{"type":"INSERT","lineNumber":774,"content":"            delay(500)"},{"type":"DELETE","lineNumber":783,"oldContent":"        sendCommand(MavCmd.COMPONENT_ARM_DISARM, if (arm) 1f else 0f)"},{"type":"DELETE","lineNumber":784,"oldContent":"    }"},{"type":"DELETE","lineNumber":785,"oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":776,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"INSERT","lineNumber":777,"content":"            return false"},{"type":"INSERT","lineNumber":778,"content":"        }"},{"type":"DELETE","lineNumber":788,"oldContent":"    /**"},{"type":"INSERT","lineNumber":781,"content":"        try {"},{"type":"DELETE","lineNumber":790,"oldContent":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"INSERT","lineNumber":783,"content":"            val modeChanged = changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":795,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":796,"oldContent":"            param2 = 0f,"},{"type":"INSERT","lineNumber":788,"content":"                return false"},{"type":"INSERT","lineNumber":789,"content":"            }"},{"type":"INSERT","lineNumber":790,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":798,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":800,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":803,"oldContent":"            param6 = 0f,"},{"type":"INSERT","lineNumber":797,"content":"    }"},{"type":"INSERT","lineNumber":798,"content":""},{"type":"INSERT","lineNumber":799,"content":"    /**"},{"type":"INSERT","lineNumber":800,"content":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"INSERT","lineNumber":808,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":809,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":810,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":811,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":813,"content":"            param6 = 0f,"},{"type":"MODIFY","lineNumber":818,"content":"","oldContent":"            param6 = 0f,"},{"type":"INSERT","lineNumber":819,"content":"    fun closeConnection() {"},{"type":"INSERT","lineNumber":820,"content":"        try {"},{"type":"INSERT","lineNumber":821,"content":"            // Attempt to close the TCP connection gracefully"},{"type":"INSERT","lineNumber":822,"content":"            connection.close()"},{"type":"INSERT","lineNumber":823,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":824,"content":"            Log.e(\"MavlinkRepo\", \"Error closing TCP connection\", e)"},{"type":"INSERT","lineNumber":825,"content":"        }"},{"type":"INSERT","lineNumber":826,"content":"    }"},{"type":"INSERT","lineNumber":827,"content":""},{"type":"INSERT","lineNumber":837,"content":"        return (R * c).toFloat()"},{"type":"DELETE","lineNumber":829,"oldContent":"            param4 = 0f,"},{"type":"INSERT","lineNumber":839,"content":"}"},{"type":"INSERT","lineNumber":840,"content":""},{"type":"INSERT","lineNumber":841,"content":""}]},{"timestamp":1758276991562,"changes":[{"type":"MODIFY","lineNumber":32,"content":"    private val gcsSystemId: UByte = 255u","oldContent":"    val lastFailure: StateFlow<Throwable?> = _lastFailure.asStateFlow()"},{"type":"MODIFY","lineNumber":46,"content":"","oldContent":"                } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":61,"content":"                    if (connection.tryConnect(scope)) {","oldContent":"            reconnect(this) // Initial connection attempt"},{"type":"MODIFY","lineNumber":68,"content":"                delay(1000)","oldContent":"                        }"},{"type":"DELETE","lineNumber":94,"oldContent":"                    } catch (e: Exception) {"},{"type":"DELETE","lineNumber":95,"oldContent":"                        Log.e(\"MavlinkRepo\", \"Failed to send heartbeat\", e)"},{"type":"DELETE","lineNumber":96,"oldContent":"                        _lastFailure.value = e"},{"type":"INSERT","lineNumber":94,"content":"        // Send GCS heartbeat"},{"type":"INSERT","lineNumber":95,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":96,"content":"            val heartbeat = Heartbeat("},{"type":"MODIFY","lineNumber":105,"content":"                    try {","oldContent":"            .shareIn(scope, SharingStarted.Eagerly, replay = 0)"},{"type":"MODIFY","lineNumber":124,"content":"            }","oldContent":""},{"type":"MODIFY","lineNumber":138,"content":"                        // Set message intervals","oldContent":"                                    param5 = 0f,"},{"type":"MODIFY","lineNumber":160,"content":"                                }","oldContent":"        // Collectors"},{"type":"MODIFY","lineNumber":177,"content":"                .map { it.message }","oldContent":"        }"},{"type":"DELETE","lineNumber":186,"oldContent":"                    val altAMSLm = gp.alt / 1000f"},{"type":"DELETE","lineNumber":187,"oldContent":"                    val relAltM = gp.relativeAlt / 1000f"},{"type":"DELETE","lineNumber":188,"oldContent":"                    val lat = gp.lat.takeIf { it != Int.MIN_VALUE }?.let { it / 10_000_000.0 }"},{"type":"DELETE","lineNumber":189,"oldContent":"                    val lon = gp.lon.takeIf { it != Int.MIN_VALUE }?.let { it / 10_000_000.0 }"},{"type":"INSERT","lineNumber":186,"content":"                        Log.i(\"MavlinkRepo\", \"COMMAND_ACK received (unable to stringify fields)\")"},{"type":"INSERT","lineNumber":187,"content":"                    }"},{"type":"INSERT","lineNumber":188,"content":"                }"},{"type":"INSERT","lineNumber":189,"content":"        }"},{"type":"MODIFY","lineNumber":199,"content":"                        it.copy(","oldContent":"        }"},{"type":"MODIFY","lineNumber":207,"content":"","oldContent":"                .collect { b ->"},{"type":"MODIFY","lineNumber":287,"content":"                        6u -> \"RTL\"","oldContent":"                        6u -> \"RTL\""},{"type":"DELETE","lineNumber":299,"oldContent":""},{"type":"DELETE","lineNumber":300,"oldContent":"        // GPS_RAW_INT"},{"type":"DELETE","lineNumber":301,"oldContent":"        scope.launch {"},{"type":"DELETE","lineNumber":302,"oldContent":"            mavFrameStream"},{"type":"INSERT","lineNumber":299,"content":"                        21u -> \"Smart_RTL\""},{"type":"INSERT","lineNumber":300,"content":"                        22u -> \"FlowHold\""},{"type":"INSERT","lineNumber":301,"content":"                        23u -> \"Follow\""},{"type":"INSERT","lineNumber":302,"content":"                        24u -> \"ZigZag\""},{"type":"INSERT","lineNumber":311,"content":"                    if (lastMode != mode || lastArmed != armed) {"},{"type":"DELETE","lineNumber":312,"oldContent":"                        if (mode.equals(\"Auto\", ignoreCase = true) && armed && (lastMode != mode || lastArmed != armed)) {"},{"type":"DELETE","lineNumber":320,"oldContent":"                                // Mission ended"},{"type":"MODIFY","lineNumber":322,"content":"                                // Mission ended","oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"INSERT","lineNumber":323,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"MODIFY","lineNumber":332,"content":"                            // Do NOT clear mission from FCU here","oldContent":"                            // Do NOT clear mission from FCU here"},{"type":"MODIFY","lineNumber":355,"content":"        }","oldContent":"                                )"},{"type":"DELETE","lineNumber":370,"oldContent":""},{"type":"DELETE","lineNumber":373,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":372,"content":""},{"type":"INSERT","lineNumber":374,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":440,"oldContent":"        }"},{"type":"MODIFY","lineNumber":442,"content":"        }","oldContent":"    }"},{"type":"INSERT","lineNumber":443,"content":"    }"},{"type":"DELETE","lineNumber":454,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"DELETE","lineNumber":455,"oldContent":"            3u -> \"Auto\""},{"type":"DELETE","lineNumber":457,"oldContent":"            0u -> \"Stabilize\""},{"type":"MODIFY","lineNumber":459,"content":"        val expectedMode = when (customMode) {","oldContent":"            5u -> \"Loiter\""},{"type":"INSERT","lineNumber":460,"content":"            3u -> \"Auto\""},{"type":"INSERT","lineNumber":461,"content":"            0u -> \"Stabilize\""},{"type":"INSERT","lineNumber":462,"content":"            5u -> \"Loiter\""},{"type":"DELETE","lineNumber":468,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":471,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":470,"content":"            delay(200)"},{"type":"INSERT","lineNumber":472,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":502,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"MODIFY","lineNumber":504,"content":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {","oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":505,"content":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"INSERT","lineNumber":526,"content":"            val ackDeferred = CompletableDeferred<Boolean>()"},{"type":"INSERT","lineNumber":527,"content":"            val sentSeqs = mutableSetOf<Int>()"},{"type":"INSERT","lineNumber":528,"content":"            var firstRequestReceived = false"},{"type":"DELETE","lineNumber":527,"oldContent":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"DELETE","lineNumber":528,"oldContent":"            param7 = 0f"},{"type":"DELETE","lineNumber":529,"oldContent":"    }"},{"type":"INSERT","lineNumber":530,"content":"            // Resend MISSION_COUNT periodically until first request or timeout"},{"type":"INSERT","lineNumber":531,"content":"            val resendJob = AppScope.launch {"},{"type":"INSERT","lineNumber":532,"content":"                while (isActive && !firstRequestReceived && !ackDeferred.isCompleted) {"},{"type":"INSERT","lineNumber":533,"content":"                    try {"},{"type":"INSERT","lineNumber":534,"content":"                        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionCount)"},{"type":"INSERT","lineNumber":535,"content":"                        Log.d(\"MavlinkRepo\", \"Resent MISSION_COUNT\")"},{"type":"INSERT","lineNumber":536,"content":"                    } catch (e: Exception) {"},{"type":"INSERT","lineNumber":537,"content":"                        Log.e(\"MavlinkRepo\", \"Failed to resend MISSION_COUNT\", e)"},{"type":"INSERT","lineNumber":538,"content":"                    }"},{"type":"INSERT","lineNumber":539,"content":"                    delay(700)"},{"type":"INSERT","lineNumber":540,"content":"                }"},{"type":"INSERT","lineNumber":541,"content":"            }"},{"type":"DELETE","lineNumber":531,"oldContent":"                Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to switch to AUTO mode\")"},{"type":"DELETE","lineNumber":532,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":533,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":534,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":535,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"DELETE","lineNumber":536,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending ARM command...\")"},{"type":"DELETE","lineNumber":537,"oldContent":"        // Step 1: Arm the vehicle"},{"type":"DELETE","lineNumber":538,"oldContent":""},{"type":"DELETE","lineNumber":539,"oldContent":"            return false"},{"type":"DELETE","lineNumber":540,"oldContent":"            Log.w(\"MavlinkRepo\", \"[Mission Start] Cannot start mission - FCU not detected\")"},{"type":"DELETE","lineNumber":541,"oldContent":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Initiating mission start workflow...\")"},{"type":"DELETE","lineNumber":542,"oldContent":"    /**"},{"type":"DELETE","lineNumber":543,"oldContent":"    }"},{"type":"DELETE","lineNumber":544,"oldContent":"                perSeqMap.remove(seq)"},{"type":"INSERT","lineNumber":543,"content":"            // Collector job"},{"type":"INSERT","lineNumber":544,"content":"            val job = AppScope.launch {"},{"type":"DELETE","lineNumber":548,"oldContent":"                                    targetSystem = senderSys.toUByte(),"},{"type":"DELETE","lineNumber":551,"oldContent":"                                    targetComponent = senderComp.toUByte(),"},{"type":"DELETE","lineNumber":554,"oldContent":"                                    seq = seq.toUShort()"},{"type":"DELETE","lineNumber":557,"oldContent":"                                )"},{"type":"DELETE","lineNumber":560,"oldContent":"                                try {"},{"type":"DELETE","lineNumber":563,"oldContent":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionItem)"},{"type":"DELETE","lineNumber":566,"oldContent":"                                    sentSeqs.add(seq)"},{"type":"INSERT","lineNumber":561,"content":"                                    targetSystem = senderSys.toUByte(),"},{"type":"INSERT","lineNumber":562,"content":"                                    targetComponent = senderComp.toUByte(),"},{"type":"INSERT","lineNumber":563,"content":"                                    seq = seq.toUShort()"},{"type":"INSERT","lineNumber":564,"content":"                                )"},{"type":"INSERT","lineNumber":565,"content":"                                try {"},{"type":"INSERT","lineNumber":566,"content":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionItem)"},{"type":"INSERT","lineNumber":567,"content":"                                    sentSeqs.add(seq)"},{"type":"MODIFY","lineNumber":597,"content":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Received MISSION_ACK type=${msg.type}\")","oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Received MISSION_ACK type=${msg.type}\")"},{"type":"DELETE","lineNumber":610,"oldContent":"                delay(100)"},{"type":"INSERT","lineNumber":612,"content":"                delay(100)"},{"type":"DELETE","lineNumber":621,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":623,"content":"                        targetComponent = fcuComponentId,"},{"type":"MODIFY","lineNumber":634,"content":"                    }","oldContent":"                    }"},{"type":"DELETE","lineNumber":653,"oldContent":"    }"},{"type":"DELETE","lineNumber":655,"oldContent":""},{"type":"DELETE","lineNumber":657,"oldContent":"    suspend fun requestMissionAndLog(timeoutMs: Long = 5000) {"},{"type":"INSERT","lineNumber":656,"content":"    }"},{"type":"INSERT","lineNumber":657,"content":""},{"type":"INSERT","lineNumber":658,"content":"    suspend fun requestMissionAndLog(timeoutMs: Long = 5000) {"},{"type":"MODIFY","lineNumber":670,"content":"                    when (val msg = frame.message) {","oldContent":"                    when (val msg = frame.message) {"},{"type":"DELETE","lineNumber":673,"oldContent":"                                }"},{"type":"DELETE","lineNumber":674,"oldContent":"                                    }"},{"type":"DELETE","lineNumber":675,"oldContent":"                                    } else {"},{"type":"DELETE","lineNumber":676,"oldContent":"                                        sendCommand(MavCmd.COMPONENT_ARM_DISARM, 0f)"},{"type":"DELETE","lineNumber":677,"oldContent":"                                    if (state.value.armed) {"},{"type":"DELETE","lineNumber":678,"oldContent":"                                    }"},{"type":"DELETE","lineNumber":679,"oldContent":"                                        delay(1000)"},{"type":"DELETE","lineNumber":680,"oldContent":"                                    while (state.value.armed && waitTime < maxWait) {"},{"type":"DELETE","lineNumber":681,"oldContent":"                                    var waitTime = 0L"},{"type":"DELETE","lineNumber":682,"oldContent":"                                    // Wait for disarm (or altitude near zero)"},{"type":"INSERT","lineNumber":673,"content":"                            expectedCountDeferred.complete(msg.count.toInt())"},{"type":"INSERT","lineNumber":674,"content":"                        }"},{"type":"INSERT","lineNumber":675,"content":"                        is MissionItemInt -> {"},{"type":"INSERT","lineNumber":676,"content":"                            val lat = msg.x / 1e7"},{"type":"INSERT","lineNumber":677,"content":"                            val lon = msg.y / 1e7"},{"type":"INSERT","lineNumber":678,"content":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ITEM_INT seq=${msg.seq} lat=$lat lon=$lon alt=${msg.z}\")"},{"type":"INSERT","lineNumber":679,"content":"                            received.add(msg.seq.toInt() to \"INT: lat=$lat lon=$lon alt=${msg.z}\")"},{"type":"INSERT","lineNumber":680,"content":"                            perSeqMap[msg.seq.toInt()]?.let { d -> if (!d.isCompleted) d.complete(Unit) }"},{"type":"INSERT","lineNumber":681,"content":"                        }"},{"type":"INSERT","lineNumber":682,"content":"                        is MissionItem -> {"},{"type":"DELETE","lineNumber":684,"oldContent":"                                launch {"},{"type":"DELETE","lineNumber":685,"oldContent":"                                Log.i(\"MavlinkRepo\", \"Last mission item reached (LAND), switching to LAND mode...\")"},{"type":"INSERT","lineNumber":684,"content":"                            received.add(msg.seq.toInt() to \"FLT: x=${msg.x} y=${msg.y} z=${msg.z}\")"},{"type":"INSERT","lineNumber":685,"content":"                            perSeqMap[msg.seq.toInt()]?.let { d -> if (!d.isCompleted) d.complete(Unit) }"},{"type":"INSERT","lineNumber":686,"content":"                        }"},{"type":"INSERT","lineNumber":687,"content":"                        is MissionAck -> {"},{"type":"DELETE","lineNumber":687,"oldContent":"                            if (lastMissionCmd == null || lastMissionCmd == MavCmd.NAV_LAND.value) {"},{"type":"DELETE","lineNumber":690,"oldContent":"                            // For now, assume last item is LAND if lastMissionCmd == MavCmd.NAV_LAND.value"},{"type":"INSERT","lineNumber":691,"content":"                    }"},{"type":"DELETE","lineNumber":692,"oldContent":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":693,"oldContent":"                        Log.i(\"MavlinkRepo\", \"MISSION_ITEM_REACHED seq=$reachedSeq\")"},{"type":"DELETE","lineNumber":694,"oldContent":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"DELETE","lineNumber":696,"oldContent":"            }"},{"type":"DELETE","lineNumber":698,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"DELETE","lineNumber":700,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"DELETE","lineNumber":702,"oldContent":"                job.cancel()"},{"type":"INSERT","lineNumber":699,"content":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":700,"content":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"INSERT","lineNumber":701,"content":"            }"},{"type":"DELETE","lineNumber":706,"oldContent":""},{"type":"INSERT","lineNumber":703,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":704,"content":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":705,"content":"                job.cancel()"},{"type":"INSERT","lineNumber":708,"content":""},{"type":"DELETE","lineNumber":711,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"MODIFY","lineNumber":715,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())","oldContent":"                }"},{"type":"DELETE","lineNumber":719,"oldContent":"                } ?: false"},{"type":"DELETE","lineNumber":721,"oldContent":""},{"type":"DELETE","lineNumber":723,"oldContent":"                if (!got) {"},{"type":"INSERT","lineNumber":720,"content":"                }"},{"type":"DELETE","lineNumber":725,"oldContent":"                    Log.w(\"MavlinkRepo\", \"Did not receive item for seq=$seq within timeout\")"},{"type":"DELETE","lineNumber":729,"oldContent":"            }"},{"type":"INSERT","lineNumber":725,"content":"                } ?: false"},{"type":"INSERT","lineNumber":726,"content":""},{"type":"INSERT","lineNumber":727,"content":"                if (!got) {"},{"type":"INSERT","lineNumber":728,"content":"                    Log.w(\"MavlinkRepo\", \"Did not receive item for seq=$seq within timeout\")"},{"type":"MODIFY","lineNumber":732,"content":"            }","oldContent":""},{"type":"INSERT","lineNumber":733,"content":""},{"type":"DELETE","lineNumber":737,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to set AUTO mode\", e)"},{"type":"MODIFY","lineNumber":737,"content":"            Log.i(\"MavlinkRepo\", \"Mission readback complete: expected=$expectedCount items=${received.size}\")","oldContent":"                Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to switch to AUTO mode\")"},{"type":"INSERT","lineNumber":738,"content":"            received.sortedBy { it.first }.forEach { (seq, desc) -> Log.i(\"MavlinkRepo\", \"Item #$seq -> $desc\") }"},{"type":"DELETE","lineNumber":743,"oldContent":"     * Start the mission after uploading."},{"type":"MODIFY","lineNumber":745,"content":"     * Start the mission after uploading.","oldContent":"     * Replicates the Dart/Flutter workflow:"},{"type":"INSERT","lineNumber":746,"content":"     * Replicates the Dart/Flutter workflow:"},{"type":"DELETE","lineNumber":760,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":761,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"DELETE","lineNumber":765,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":767,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] MISSION_START command sent\")"},{"type":"DELETE","lineNumber":768,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":769,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":770,"oldContent":"                            Log.i(\"MavlinkRepo\", \"Switched to LAND mode, sending disarm...\")"},{"type":"DELETE","lineNumber":771,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"DELETE","lineNumber":772,"oldContent":"                        val changed = changeMode(MavMode.LAND)"},{"type":"INSERT","lineNumber":764,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":765,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"DELETE","lineNumber":774,"oldContent":"        // Step 2: Send MISSION_START as CommandLong"},{"type":"INSERT","lineNumber":768,"content":""},{"type":"INSERT","lineNumber":769,"content":"        // Step 2: Send MISSION_START as CommandLong"},{"type":"DELETE","lineNumber":777,"oldContent":"        try {"},{"type":"INSERT","lineNumber":771,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":773,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] MISSION_START command sent\")"},{"type":"INSERT","lineNumber":774,"content":"            delay(500)"},{"type":"DELETE","lineNumber":780,"oldContent":"            val modeChanged = changeMode(MavMode.AUTO)"},{"type":"INSERT","lineNumber":776,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"INSERT","lineNumber":777,"content":"            return false"},{"type":"INSERT","lineNumber":778,"content":"        }"},{"type":"DELETE","lineNumber":783,"oldContent":"                return false"},{"type":"DELETE","lineNumber":784,"oldContent":"            }"},{"type":"INSERT","lineNumber":781,"content":"        try {"},{"type":"DELETE","lineNumber":786,"oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":783,"content":"            val modeChanged = changeMode(MavMode.AUTO)"},{"type":"DELETE","lineNumber":791,"oldContent":"    }"},{"type":"INSERT","lineNumber":788,"content":"                return false"},{"type":"INSERT","lineNumber":789,"content":"            }"},{"type":"INSERT","lineNumber":790,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":793,"oldContent":""},{"type":"DELETE","lineNumber":794,"oldContent":"    /**"},{"type":"DELETE","lineNumber":796,"oldContent":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"INSERT","lineNumber":797,"content":"    }"},{"type":"INSERT","lineNumber":798,"content":""},{"type":"INSERT","lineNumber":799,"content":"    /**"},{"type":"INSERT","lineNumber":800,"content":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"DELETE","lineNumber":803,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":805,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":807,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":809,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":812,"oldContent":"            param6 = 0f,"},{"type":"INSERT","lineNumber":808,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":809,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":810,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":811,"content":"            param4 = 0f,"},{"type":"INSERT","lineNumber":813,"content":"            param6 = 0f,"},{"type":"DELETE","lineNumber":819,"oldContent":"    fun closeConnection() {"},{"type":"DELETE","lineNumber":820,"oldContent":"    // Haversine formula for distance in meters"},{"type":"INSERT","lineNumber":819,"content":"    suspend fun closeConnection() {"},{"type":"DELETE","lineNumber":822,"oldContent":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"DELETE","lineNumber":824,"oldContent":"        val R = 6371000.0 // Earth radius in meters"},{"type":"DELETE","lineNumber":826,"oldContent":"        val dLat = Math.toRadians(lat2 - lat1)"},{"type":"DELETE","lineNumber":828,"oldContent":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"DELETE","lineNumber":830,"oldContent":"    }"},{"type":"INSERT","lineNumber":827,"content":""},{"type":"INSERT","lineNumber":828,"content":"    // Haversine formula for distance in meters"},{"type":"INSERT","lineNumber":829,"content":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"INSERT","lineNumber":830,"content":"        val R = 6371000.0 // Earth radius in meters"},{"type":"INSERT","lineNumber":831,"content":"        val dLat = Math.toRadians(lat2 - lat1)"},{"type":"INSERT","lineNumber":832,"content":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"INSERT","lineNumber":833,"content":"        val a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +"},{"type":"INSERT","lineNumber":834,"content":"                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *"},{"type":"INSERT","lineNumber":835,"content":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)"},{"type":"INSERT","lineNumber":836,"content":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"INSERT","lineNumber":837,"content":"        return (R * c).toFloat()"},{"type":"DELETE","lineNumber":834,"oldContent":"            param6 = 0f,"},{"type":"INSERT","lineNumber":839,"content":"}"},{"type":"DELETE","lineNumber":836,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":837,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":839,"oldContent":""},{"type":"DELETE","lineNumber":840,"oldContent":"}"},{"type":"DELETE","lineNumber":841,"oldContent":"        return (R * c).toFloat()"}]},{"timestamp":1758277023556,"changes":[{"type":"MODIFY","lineNumber":83,"content":"                    is StreamState.Inactive -> {","oldContent":"            val heartbeat = Heartbeat("},{"type":"MODIFY","lineNumber":87,"content":"                            reconnect(this)","oldContent":"                customMode = 0u,"},{"type":"MODIFY","lineNumber":93,"content":"","oldContent":"                        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, heartbeat)"},{"type":"MODIFY","lineNumber":110,"content":"                    }","oldContent":"                Log.d(\"MavlinkRepo\", \"Frame: ${it.message.javaClass.simpleName} (sysId=${it.systemId}, compId=${it.componentId})\")"},{"type":"MODIFY","lineNumber":117,"content":"        val mavFrameStream = connection.mavFrame","oldContent":"                .filter { it.message is Heartbeat && (it.message as Heartbeat).type != MavType.GCS.wrap() }"},{"type":"MODIFY","lineNumber":120,"content":"        // Log raw messages","oldContent":"                        fcuSystemId = it.systemId"},{"type":"MODIFY","lineNumber":135,"content":"                        Log.i(\"MavlinkRepo\", \"FCU detected sysId=$fcuSystemId compId=$fcuComponentId\")","oldContent":"                                    param2 = intervalUsec,"},{"type":"MODIFY","lineNumber":154,"content":"                                )","oldContent":"                            setMessageRate(147u, 1f) // BATTERY_STATUS"},{"type":"MODIFY","lineNumber":158,"content":"                                    Log.e(\"MavlinkRepo\", \"Failed to send SET_MESSAGE_INTERVAL\", e)","oldContent":"        }"},{"type":"DELETE","lineNumber":192,"oldContent":"                            altitudeMsl = altAMSLm,"},{"type":"DELETE","lineNumber":193,"oldContent":"                            altitudeRelative = relAltM,"},{"type":"INSERT","lineNumber":192,"content":"        scope.launch {"},{"type":"INSERT","lineNumber":193,"content":"            mavFrameStream"},{"type":"MODIFY","lineNumber":203,"content":"                        )","oldContent":"            mavFrameStream"},{"type":"MODIFY","lineNumber":213,"content":"                .filterIsInstance<GlobalPositionInt>()","oldContent":"        scope.launch {"},{"type":"INSERT","lineNumber":286,"content":"                        5u -> \"Loiter\""},{"type":"DELETE","lineNumber":287,"oldContent":"                        6u -> \"RTL\""},{"type":"MODIFY","lineNumber":298,"content":"                        20u -> \"Guided_NoGPS\"","oldContent":"        }"},{"type":"DELETE","lineNumber":304,"oldContent":"                .map { it.message }"},{"type":"DELETE","lineNumber":305,"oldContent":"                .filterIsInstance<GpsRawInt>()"},{"type":"INSERT","lineNumber":304,"content":"                        26u -> \"AutoRotate\""},{"type":"INSERT","lineNumber":305,"content":"                        27u -> \"Auto_RTL\""},{"type":"INSERT","lineNumber":321,"content":"                                }"},{"type":"DELETE","lineNumber":323,"oldContent":"                                }"},{"type":"INSERT","lineNumber":331,"content":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":332,"oldContent":"                            // Do NOT clear mission from FCU here"},{"type":"MODIFY","lineNumber":354,"content":"                }","oldContent":"                                    missionType = MavMissionType.MISSION.wrap()"},{"type":"MODIFY","lineNumber":374,"content":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {","oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"DELETE","lineNumber":389,"oldContent":"            param5 = param5,"},{"type":"DELETE","lineNumber":390,"oldContent":"            param7 = param7"},{"type":"DELETE","lineNumber":391,"oldContent":"        try {"},{"type":"DELETE","lineNumber":392,"oldContent":"               gcsSystemId,"},{"type":"DELETE","lineNumber":393,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":394,"oldContent":"            _lastFailure.value = e"},{"type":"INSERT","lineNumber":389,"content":"                    }"},{"type":"INSERT","lineNumber":390,"content":"                }"},{"type":"INSERT","lineNumber":391,"content":"            }"},{"type":"INSERT","lineNumber":392,"content":"            val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":393,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, req)"},{"type":"INSERT","lineNumber":394,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: 0"},{"type":"INSERT","lineNumber":441,"content":"            Log.w(\"MavlinkRepo\", \"Arm command rejected, vehicle not armable\")"},{"type":"DELETE","lineNumber":443,"oldContent":"            Log.w(\"MavlinkRepo\", \"Arm command rejected, vehicle not armable\")"},{"type":"INSERT","lineNumber":456,"content":"        // Wait for Heartbeat to confirm mode change"},{"type":"INSERT","lineNumber":457,"content":"        val timeoutMs = 5000L"},{"type":"INSERT","lineNumber":458,"content":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":458,"oldContent":"        // Wait for Heartbeat to confirm mode change"},{"type":"DELETE","lineNumber":460,"oldContent":"        val timeoutMs = 5000L"},{"type":"DELETE","lineNumber":462,"oldContent":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":469,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":471,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":470,"content":"            delay(200)"},{"type":"INSERT","lineNumber":472,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":503,"content":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":505,"oldContent":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":527,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":529,"content":""},{"type":"DELETE","lineNumber":531,"oldContent":"    suspend fun startMission(): Boolean {"},{"type":"INSERT","lineNumber":542,"content":""},{"type":"DELETE","lineNumber":556,"oldContent":"                                    targetSystem = senderSys.toUByte(),"},{"type":"MODIFY","lineNumber":558,"content":"                                val item = missionItems[seq]","oldContent":"                                    targetComponent = senderComp.toUByte(),"},{"type":"INSERT","lineNumber":559,"content":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending waypoint seq=$seq: ${item.command} lat=${item.x / 1e7} lon=${item.y / 1e7} alt=${item.z}\")"},{"type":"INSERT","lineNumber":560,"content":"                                val missionItem = item.copy("},{"type":"INSERT","lineNumber":561,"content":"                                    targetSystem = senderSys.toUByte(),"},{"type":"INSERT","lineNumber":562,"content":"                                    targetComponent = senderComp.toUByte(),"},{"type":"DELETE","lineNumber":562,"oldContent":"                                val item = missionItems[seq]"},{"type":"DELETE","lineNumber":564,"oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending waypoint seq=$seq: ${item.command} lat=${item.x / 1e7} lon=${item.y / 1e7} alt=${item.z}\")"},{"type":"DELETE","lineNumber":567,"oldContent":"                                val missionItem = item.copy("},{"type":"INSERT","lineNumber":596,"content":"                            is MissionAck -> {"},{"type":"DELETE","lineNumber":597,"oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Received MISSION_ACK type=${msg.type}\")"},{"type":"MODIFY","lineNumber":612,"content":"                delay(100)","oldContent":"                delay(100)"},{"type":"MODIFY","lineNumber":623,"content":"                        targetComponent = fcuComponentId,","oldContent":"                        targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":633,"content":"                        Log.e(\"MavlinkRepo\", \"Fallback: Failed to send mission item seq=$seq\", e)"},{"type":"DELETE","lineNumber":634,"oldContent":"                    }"},{"type":"MODIFY","lineNumber":639,"content":"                ackDeferred.await()","oldContent":"                return false"},{"type":"DELETE","lineNumber":642,"oldContent":"            delay(500)"},{"type":"DELETE","lineNumber":643,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Setting mode to AUTO...\")"},{"type":"DELETE","lineNumber":644,"oldContent":"        try {"},{"type":"INSERT","lineNumber":642,"content":"            job.cancel()"},{"type":"INSERT","lineNumber":643,"content":"            resendJob.cancel()"},{"type":"INSERT","lineNumber":644,"content":""},{"type":"MODIFY","lineNumber":646,"content":"                Log.i(\"MavlinkRepo\", \"[Mission Upload] Mission upload acknowledged by FCU\")","oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"INSERT","lineNumber":654,"content":"            return false"},{"type":"INSERT","lineNumber":655,"content":"        }"},{"type":"DELETE","lineNumber":655,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"DELETE","lineNumber":658,"oldContent":"     * Start the mission after uploading."},{"type":"INSERT","lineNumber":669,"content":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":670,"oldContent":"                    when (val msg = frame.message) {"},{"type":"MODIFY","lineNumber":688,"content":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ACK type=${msg.type}\")","oldContent":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ACK type=${msg.type}\")"},{"type":"DELETE","lineNumber":695,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":696,"content":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":697,"content":"                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, req)"},{"type":"INSERT","lineNumber":698,"content":"                Log.i(\"MavlinkRepo\", \"Sent MISSION_REQUEST_LIST to FCU\")"},{"type":"INSERT","lineNumber":699,"content":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":699,"oldContent":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":702,"content":""},{"type":"DELETE","lineNumber":701,"oldContent":"                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, req)"},{"type":"DELETE","lineNumber":703,"oldContent":"                Log.i(\"MavlinkRepo\", \"Sent MISSION_REQUEST_LIST to FCU\")"},{"type":"DELETE","lineNumber":705,"oldContent":"    }"},{"type":"INSERT","lineNumber":707,"content":"            }"},{"type":"DELETE","lineNumber":708,"oldContent":"     * Helper to arm/disarm the vehicle"},{"type":"DELETE","lineNumber":714,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":716,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":717,"oldContent":"                            Log.i(\"MavlinkRepo\", \"Switched to LAND mode, sending disarm...\")"},{"type":"INSERT","lineNumber":715,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":716,"content":"                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, reqItem)"},{"type":"INSERT","lineNumber":717,"content":"                    Log.d(\"MavlinkRepo\", \"Sent MISSION_REQUEST_INT for seq=$seq\")"},{"type":"INSERT","lineNumber":718,"content":"                } catch (e: Exception) {"},{"type":"INSERT","lineNumber":719,"content":"                    Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_INT seq=$seq\", e)"},{"type":"DELETE","lineNumber":719,"oldContent":"                        if (changed) {"},{"type":"DELETE","lineNumber":720,"oldContent":"                        val changed = changeMode(MavMode.LAND)"},{"type":"INSERT","lineNumber":722,"content":"                val got = withTimeoutOrNull(1500L) {"},{"type":"INSERT","lineNumber":723,"content":"                    seqDeferred.await()"},{"type":"INSERT","lineNumber":724,"content":"                    true"},{"type":"DELETE","lineNumber":724,"oldContent":"                val got = withTimeoutOrNull(1500L) {"},{"type":"DELETE","lineNumber":726,"oldContent":"                if (lastMissionSeq != null && currentMsg.seq.toInt() == lastMissionSeq && !landHandled) {"},{"type":"DELETE","lineNumber":728,"oldContent":"            .collect { currentMsg ->"},{"type":"INSERT","lineNumber":731,"content":"                perSeqMap.remove(seq)"},{"type":"DELETE","lineNumber":733,"oldContent":"                perSeqMap.remove(seq)"},{"type":"DELETE","lineNumber":734,"oldContent":"                landHandled = false // reset for new mission"},{"type":"DELETE","lineNumber":735,"oldContent":"                lastMissionSeq = countMsg.count.toInt() - 1"},{"type":"INSERT","lineNumber":734,"content":"            delay(200)"},{"type":"INSERT","lineNumber":735,"content":"            job.cancel()"},{"type":"DELETE","lineNumber":738,"oldContent":"            .map { it.message }"},{"type":"DELETE","lineNumber":739,"oldContent":"            .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":740,"oldContent":"        mavFrameStream"},{"type":"INSERT","lineNumber":738,"content":"            received.sortedBy { it.first }.forEach { (seq, desc) -> Log.i(\"MavlinkRepo\", \"Item #$seq -> $desc\") }"},{"type":"INSERT","lineNumber":739,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":740,"content":"            Log.e(\"MavlinkRepo\", \"Error during mission readback\", e)"},{"type":"INSERT","lineNumber":744,"content":"    /**"},{"type":"DELETE","lineNumber":746,"oldContent":"    /**"},{"type":"DELETE","lineNumber":762,"oldContent":"        } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":764,"content":"        } catch (e: Exception) {","oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"INSERT","lineNumber":765,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"INSERT","lineNumber":766,"content":"            return false"},{"type":"INSERT","lineNumber":767,"content":"        }"},{"type":"INSERT","lineNumber":770,"content":"        try {"},{"type":"INSERT","lineNumber":772,"content":"            sendMissionStartCommand()"},{"type":"DELETE","lineNumber":770,"oldContent":"            return false"},{"type":"DELETE","lineNumber":772,"oldContent":"        }"},{"type":"INSERT","lineNumber":775,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":774,"oldContent":"            param5 = 0f,"},{"type":"DELETE","lineNumber":777,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":778,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":779,"oldContent":"        try {"},{"type":"INSERT","lineNumber":781,"content":"        try {"},{"type":"INSERT","lineNumber":782,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Setting mode to AUTO...\")"},{"type":"DELETE","lineNumber":783,"oldContent":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"MODIFY","lineNumber":784,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Set mode to AUTO, result=$modeChanged\")","oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":785,"content":"            delay(500)"},{"type":"INSERT","lineNumber":786,"content":"            if (!modeChanged) {"},{"type":"INSERT","lineNumber":787,"content":"                Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to switch to AUTO mode\")"},{"type":"DELETE","lineNumber":786,"oldContent":"}"},{"type":"DELETE","lineNumber":788,"oldContent":"        return (R * c).toFloat()"},{"type":"DELETE","lineNumber":790,"oldContent":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"MODIFY","lineNumber":791,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to set AUTO mode\", e)","oldContent":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"DELETE","lineNumber":793,"oldContent":"    }"},{"type":"INSERT","lineNumber":795,"content":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"INSERT","lineNumber":796,"content":"        return true"},{"type":"INSERT","lineNumber":797,"content":"    }"},{"type":"DELETE","lineNumber":798,"oldContent":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"DELETE","lineNumber":800,"oldContent":"        return true"},{"type":"DELETE","lineNumber":805,"oldContent":"            param1 = 0f,"},{"type":"INSERT","lineNumber":806,"content":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"INSERT","lineNumber":807,"content":"            confirmation = 0u,"},{"type":"INSERT","lineNumber":808,"content":"            param1 = 0f,"},{"type":"DELETE","lineNumber":809,"oldContent":"            command = MavCmd.MISSION_START.wrap(),"},{"type":"DELETE","lineNumber":811,"oldContent":"            confirmation = 0u,"},{"type":"MODIFY","lineNumber":813,"content":"            param6 = 0f,","oldContent":"            param6 = 0f,"},{"type":"MODIFY","lineNumber":819,"content":"    fun closeConnection() {","oldContent":"    suspend fun closeConnection() {"},{"type":"DELETE","lineNumber":823,"oldContent":""},{"type":"INSERT","lineNumber":824,"content":"            Log.e(\"MavlinkRepo\", \"Error closing TCP connection\", e)"},{"type":"INSERT","lineNumber":825,"content":"        }"},{"type":"INSERT","lineNumber":826,"content":"    }"},{"type":"INSERT","lineNumber":827,"content":""},{"type":"DELETE","lineNumber":827,"oldContent":"            Log.e(\"MavlinkRepo\", \"Error closing TCP connection\", e)"},{"type":"DELETE","lineNumber":830,"oldContent":"        }"},{"type":"DELETE","lineNumber":832,"oldContent":"    /**"},{"type":"DELETE","lineNumber":834,"oldContent":"    }"},{"type":"DELETE","lineNumber":837,"oldContent":""},{"type":"DELETE","lineNumber":840,"oldContent":"        return (R * c).toFloat()"},{"type":"INSERT","lineNumber":838,"content":"    }"},{"type":"INSERT","lineNumber":840,"content":""},{"type":"INSERT","lineNumber":841,"content":""}]},{"timestamp":1758277026272,"changes":[{"type":"MODIFY","lineNumber":97,"content":"                type = MavType.GCS.wrap(),","oldContent":"                    }"},{"type":"MODIFY","lineNumber":108,"content":"                        Log.e(\"MavlinkRepo\", \"Failed to send heartbeat\", e)","oldContent":"        scope.launch {"},{"type":"MODIFY","lineNumber":119,"content":"","oldContent":"                    if (!state.value.fcuDetected) {"},{"type":"MODIFY","lineNumber":121,"content":"        scope.launch {","oldContent":"                        fcuComponentId = it.componentId"},{"type":"MODIFY","lineNumber":123,"content":"                Log.d(\"MavlinkRepo\", \"Frame: ${it.message.javaClass.simpleName} (sysId=${it.systemId}, compId=${it.componentId})\")","oldContent":"                        _state.update { it.copy(fcuDetected = true) }"},{"type":"MODIFY","lineNumber":185,"content":"                    } catch (t: Throwable) {","oldContent":"                .collect { gp ->"},{"type":"DELETE","lineNumber":190,"oldContent":"                    _state.update {"},{"type":"DELETE","lineNumber":191,"oldContent":"                        it.copy("},{"type":"INSERT","lineNumber":190,"content":""},{"type":"INSERT","lineNumber":191,"content":"        // VFR_HUD"},{"type":"MODIFY","lineNumber":303,"content":"                        25u -> \"SystemID\"","oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":373,"content":"        // Helper to request mission items from FCU and return as list"},{"type":"DELETE","lineNumber":374,"oldContent":"        suspend fun requestMissionItemsFromFcu(timeoutMs: Long = 5000): List<MissionItemInt> {"},{"type":"INSERT","lineNumber":419,"content":"            param5 = param5,"},{"type":"INSERT","lineNumber":420,"content":"            param6 = param6,"},{"type":"INSERT","lineNumber":421,"content":"            param7 = param7"},{"type":"INSERT","lineNumber":422,"content":"        )"},{"type":"INSERT","lineNumber":423,"content":"        try {"},{"type":"INSERT","lineNumber":424,"content":"            connection.trySendUnsignedV2("},{"type":"INSERT","lineNumber":425,"content":"                gcsSystemId,"},{"type":"INSERT","lineNumber":426,"content":"                gcsComponentId, commandLong"},{"type":"INSERT","lineNumber":427,"content":"            )"},{"type":"INSERT","lineNumber":428,"content":"            Log.d(\"MavlinkRepo\", \"Sent COMMAND_LONG: cmd=${command} p1=$param1 p2=$param2 p3=$param3 p4=$param4 p5=$param5 p6=$param6 p7=$param7\")"},{"type":"INSERT","lineNumber":429,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":430,"content":"            Log.e(\"MavlinkRepo\", \"Failed to send command\", e)"},{"type":"INSERT","lineNumber":431,"content":"        }"},{"type":"INSERT","lineNumber":434,"content":"    suspend fun arm() {"},{"type":"INSERT","lineNumber":437,"content":"                MavCmd.COMPONENT_ARM_DISARM,"},{"type":"DELETE","lineNumber":425,"oldContent":"            Log.w(\"MavlinkRepo\", \"Arm command rejected, vehicle not armable\")"},{"type":"DELETE","lineNumber":426,"oldContent":"        }"},{"type":"DELETE","lineNumber":427,"oldContent":""},{"type":"DELETE","lineNumber":428,"oldContent":"    suspend fun disarm() {"},{"type":"DELETE","lineNumber":429,"oldContent":"            MavCmd.COMPONENT_ARM_DISARM,"},{"type":"DELETE","lineNumber":430,"oldContent":"            0f"},{"type":"DELETE","lineNumber":431,"oldContent":"    }"},{"type":"DELETE","lineNumber":432,"oldContent":""},{"type":"DELETE","lineNumber":433,"oldContent":"        sendCommand("},{"type":"DELETE","lineNumber":434,"oldContent":"            MavCmd.DO_SET_MODE,"},{"type":"DELETE","lineNumber":435,"oldContent":"            0f"},{"type":"DELETE","lineNumber":436,"oldContent":"        )"},{"type":"DELETE","lineNumber":437,"oldContent":""},{"type":"DELETE","lineNumber":438,"oldContent":"        sendCommand("},{"type":"DELETE","lineNumber":439,"oldContent":"            )"},{"type":"DELETE","lineNumber":457,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"MODIFY","lineNumber":459,"content":"        val expectedMode = when (customMode) {","oldContent":"            3u -> \"Auto\""},{"type":"INSERT","lineNumber":460,"content":"            3u -> \"Auto\""},{"type":"DELETE","lineNumber":469,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":471,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":470,"content":"            delay(200)"},{"type":"INSERT","lineNumber":472,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"MODIFY","lineNumber":529,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":542,"content":"","oldContent":""},{"type":"INSERT","lineNumber":557,"content":"                                }"},{"type":"DELETE","lineNumber":559,"oldContent":"                                }"},{"type":"DELETE","lineNumber":561,"oldContent":"                                    seq = seq.toUShort()"},{"type":"MODIFY","lineNumber":563,"content":"                                    seq = seq.toUShort()","oldContent":"                                )"},{"type":"INSERT","lineNumber":564,"content":"                                )"},{"type":"MODIFY","lineNumber":607,"content":"","oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":611,"content":"            while (!firstRequestReceived && !ackDeferred.isCompleted && System.currentTimeMillis() - startWait < firstRequestTimeout) {"},{"type":"DELETE","lineNumber":612,"oldContent":"                delay(100)"},{"type":"MODIFY","lineNumber":615,"content":"            if (!firstRequestReceived) {","oldContent":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"INSERT","lineNumber":622,"content":"                        targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":623,"oldContent":"                        targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":635,"oldContent":"                        }"},{"type":"DELETE","lineNumber":636,"oldContent":"                            Log.w(\"MavlinkRepo\", \"Failed to switch to LAND mode after last mission item\")"},{"type":"DELETE","lineNumber":637,"oldContent":"                        } else {"},{"type":"DELETE","lineNumber":638,"oldContent":"                            armDisarm(false)"},{"type":"INSERT","lineNumber":635,"content":"                }"},{"type":"INSERT","lineNumber":636,"content":"            }"},{"type":"INSERT","lineNumber":637,"content":""},{"type":"INSERT","lineNumber":638,"content":"            val ackReceived = withTimeoutOrNull(timeoutMs) {"},{"type":"MODIFY","lineNumber":641,"content":"","oldContent":"                        if (changed) {"},{"type":"DELETE","lineNumber":647,"oldContent":"            .map { it.message }"},{"type":"DELETE","lineNumber":648,"oldContent":"            .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":647,"content":"                return true"},{"type":"INSERT","lineNumber":648,"content":"            } else {"},{"type":"MODIFY","lineNumber":650,"content":"                return false","oldContent":"        mavFrameStream"},{"type":"MODIFY","lineNumber":653,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Upload] Mission upload failed\", e)","oldContent":"    scope.launch {"},{"type":"MODIFY","lineNumber":656,"content":"    }","oldContent":"    }"},{"type":"DELETE","lineNumber":659,"oldContent":"            .filterIsInstance<MissionCount>()"},{"type":"DELETE","lineNumber":660,"oldContent":"            .map { it.message }"},{"type":"DELETE","lineNumber":661,"oldContent":"            .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"DELETE","lineNumber":662,"oldContent":"        mavFrameStream"},{"type":"DELETE","lineNumber":663,"oldContent":"        // Track last mission seq from MissionCount"},{"type":"DELETE","lineNumber":664,"oldContent":"        var landHandled = false"},{"type":"DELETE","lineNumber":665,"oldContent":"        var lastMissionSeq: Int? = null"},{"type":"INSERT","lineNumber":659,"content":"        if (!state.value.fcuDetected) {"},{"type":"INSERT","lineNumber":660,"content":"            Log.w(\"MavlinkRepo\", \"FCU not detected; cannot request mission\")"},{"type":"INSERT","lineNumber":661,"content":"            return"},{"type":"INSERT","lineNumber":662,"content":"        }"},{"type":"INSERT","lineNumber":663,"content":"        try {"},{"type":"INSERT","lineNumber":664,"content":"            val received = mutableListOf<Pair<Int, String>>()"},{"type":"INSERT","lineNumber":665,"content":"            val expectedCountDeferred = CompletableDeferred<Int?>()"},{"type":"DELETE","lineNumber":671,"oldContent":"                Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to switch to AUTO mode\")"},{"type":"DELETE","lineNumber":672,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Setting mode to AUTO...\")"},{"type":"INSERT","lineNumber":671,"content":"                        is MissionCount -> {"},{"type":"INSERT","lineNumber":672,"content":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_COUNT=${msg.count} from sys=${frame.systemId}\")"},{"type":"INSERT","lineNumber":687,"content":"                        is MissionAck -> {"},{"type":"DELETE","lineNumber":688,"oldContent":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ACK type=${msg.type}\")"},{"type":"MODIFY","lineNumber":696,"content":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)","oldContent":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":698,"oldContent":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"DELETE","lineNumber":700,"oldContent":"            }"},{"type":"DELETE","lineNumber":702,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":700,"content":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"INSERT","lineNumber":701,"content":"            }"},{"type":"INSERT","lineNumber":703,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"MODIFY","lineNumber":706,"content":"                return","oldContent":"            param5 = 0f,"},{"type":"MODIFY","lineNumber":709,"content":"            Log.i(\"MavlinkRepo\", \"Expecting $expectedCount mission items - requesting each item\")","oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"MODIFY","lineNumber":715,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())","oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":719,"oldContent":"                }"},{"type":"DELETE","lineNumber":721,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"INSERT","lineNumber":720,"content":"                }"},{"type":"INSERT","lineNumber":721,"content":""},{"type":"DELETE","lineNumber":723,"oldContent":"                } ?: false"},{"type":"MODIFY","lineNumber":725,"content":"                } ?: false","oldContent":""},{"type":"INSERT","lineNumber":726,"content":""},{"type":"DELETE","lineNumber":747,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"DELETE","lineNumber":748,"oldContent":"            arm()"},{"type":"INSERT","lineNumber":747,"content":"     * 1. Arm the vehicle"},{"type":"INSERT","lineNumber":748,"content":"     * 2. Send MISSION_START as CommandLong"},{"type":"INSERT","lineNumber":749,"content":"     * 3. Set mode to AUTO"},{"type":"DELETE","lineNumber":750,"oldContent":"     */"},{"type":"INSERT","lineNumber":763,"content":"            delay(500)"},{"type":"DELETE","lineNumber":765,"oldContent":"            delay(500)"},{"type":"MODIFY","lineNumber":768,"content":"","oldContent":""},{"type":"INSERT","lineNumber":770,"content":"        try {"},{"type":"INSERT","lineNumber":772,"content":"            sendMissionStartCommand()"},{"type":"DELETE","lineNumber":772,"oldContent":"        try {"},{"type":"DELETE","lineNumber":774,"oldContent":"            sendMissionStartCommand()"},{"type":"MODIFY","lineNumber":776,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)","oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"MODIFY","lineNumber":781,"content":"        try {","oldContent":"        try {"},{"type":"DELETE","lineNumber":786,"oldContent":"                return false"},{"type":"INSERT","lineNumber":788,"content":"                return false"},{"type":"MODIFY","lineNumber":795,"content":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")","oldContent":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"MODIFY","lineNumber":798,"content":"","oldContent":""},{"type":"DELETE","lineNumber":801,"oldContent":"        return true"},{"type":"DELETE","lineNumber":802,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":803,"oldContent":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":804,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":801,"content":"     */"},{"type":"INSERT","lineNumber":802,"content":"    suspend fun sendMissionStartCommand() {"},{"type":"INSERT","lineNumber":803,"content":"        val cmd = CommandLong("},{"type":"INSERT","lineNumber":804,"content":"            targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":805,"content":"            targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":806,"oldContent":"            param6 = 0f,"},{"type":"MODIFY","lineNumber":809,"content":"            param2 = 0f,","oldContent":"            param2 = 0f,"},{"type":"INSERT","lineNumber":812,"content":"            param5 = 0f,"},{"type":"DELETE","lineNumber":813,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":814,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":815,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":816,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":817,"oldContent":"            param1 = 0f,"},{"type":"INSERT","lineNumber":814,"content":"            param7 = 0f"},{"type":"INSERT","lineNumber":815,"content":"        )"},{"type":"INSERT","lineNumber":816,"content":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"INSERT","lineNumber":817,"content":"    }"},{"type":"MODIFY","lineNumber":824,"content":"            Log.e(\"MavlinkRepo\", \"Error closing TCP connection\", e)","oldContent":"            Log.e(\"MavlinkRepo\", \"Error closing TCP connection\", e)"},{"type":"DELETE","lineNumber":826,"oldContent":"    // Haversine formula for distance in meters"},{"type":"MODIFY","lineNumber":828,"content":"    // Haversine formula for distance in meters","oldContent":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"INSERT","lineNumber":829,"content":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"MODIFY","lineNumber":835,"content":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)","oldContent":""},{"type":"INSERT","lineNumber":836,"content":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"INSERT","lineNumber":837,"content":"        return (R * c).toFloat()"},{"type":"INSERT","lineNumber":839,"content":"}"}]},{"timestamp":1758277093146,"changes":[{"type":"DELETE","lineNumber":17,"oldContent":"import kotlin.math.absoluteValue"},{"type":"DELETE","lineNumber":82,"oldContent":"        scope.launch {"},{"type":"INSERT","lineNumber":81,"content":"                    }"},{"type":"DELETE","lineNumber":86,"oldContent":"                baseMode = emptyList<MavModeFlag>().wrap(),"},{"type":"INSERT","lineNumber":85,"content":"                            _state.update { it.copy(connected = false, fcuDetected = false) }"},{"type":"DELETE","lineNumber":92,"oldContent":"                    try {"},{"type":"INSERT","lineNumber":91,"content":"        }"},{"type":"MODIFY","lineNumber":115,"content":"        // Shared message stream","oldContent":"            mavFrameStream"},{"type":"DELETE","lineNumber":134,"oldContent":"                                    param1 = messageId.toFloat(),"},{"type":"INSERT","lineNumber":133,"content":"                        fcuComponentId = it.componentId"},{"type":"DELETE","lineNumber":153,"oldContent":"                            setMessageRate(74u, 5f)  // VFR_HUD"},{"type":"INSERT","lineNumber":152,"content":"                                    param7 = 0f"},{"type":"DELETE","lineNumber":157,"oldContent":"                }"},{"type":"INSERT","lineNumber":156,"content":"                                } catch (e: Exception) {"},{"type":"DELETE","lineNumber":202,"oldContent":"        scope.launch {"},{"type":"INSERT","lineNumber":201,"content":"                            groundspeed = hud.groundspeed.takeIf { v -> v > 0f }"},{"type":"DELETE","lineNumber":212,"oldContent":"        //HEARTBEAT for mode, armed, armable"},{"type":"INSERT","lineNumber":211,"content":"                .map { it.message }"},{"type":"DELETE","lineNumber":297,"oldContent":"                }"},{"type":"INSERT","lineNumber":296,"content":"                        19u -> \"Avoid_ADSB\""},{"type":"DELETE","lineNumber":396,"oldContent":"            param2 = param2,"},{"type":"DELETE","lineNumber":397,"oldContent":"            param3 = param3,"},{"type":"DELETE","lineNumber":398,"oldContent":"            param5 = param5,"},{"type":"DELETE","lineNumber":399,"oldContent":"            param7 = param7"},{"type":"DELETE","lineNumber":400,"oldContent":"        try {"},{"type":"DELETE","lineNumber":401,"oldContent":"            connection.trySendUnsignedV2("},{"type":"DELETE","lineNumber":402,"oldContent":"                gcsComponentId, commandLong)"},{"type":"DELETE","lineNumber":403,"oldContent":"            Log.e(\"MavlinkRepo\", \"Failed to send command\", e)"},{"type":"DELETE","lineNumber":404,"oldContent":"            _lastFailure.value = e"},{"type":"DELETE","lineNumber":405,"oldContent":"    }"},{"type":"INSERT","lineNumber":395,"content":"                val seqDeferred = CompletableDeferred<Unit>()"},{"type":"INSERT","lineNumber":396,"content":"                perSeqMap[seq] = seqDeferred"},{"type":"INSERT","lineNumber":397,"content":"                val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":398,"content":"                connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, reqItem)"},{"type":"INSERT","lineNumber":399,"content":"                withTimeoutOrNull(1500L) { seqDeferred.await() }"},{"type":"INSERT","lineNumber":400,"content":"                perSeqMap.remove(seq)"},{"type":"INSERT","lineNumber":401,"content":"            }"},{"type":"INSERT","lineNumber":402,"content":"            delay(200)"},{"type":"INSERT","lineNumber":403,"content":"            job.cancel()"},{"type":"INSERT","lineNumber":404,"content":"            return items.sortedBy { it.seq.toInt() }"},{"type":"DELETE","lineNumber":420,"oldContent":"            Log.w(\"MavlinkRepo\", \"Arm command rejected, vehicle not armable\")"},{"type":"DELETE","lineNumber":422,"oldContent":"        }"},{"type":"DELETE","lineNumber":424,"oldContent":"    }"},{"type":"DELETE","lineNumber":426,"oldContent":""},{"type":"DELETE","lineNumber":428,"oldContent":"    suspend fun disarm() {"},{"type":"DELETE","lineNumber":430,"oldContent":"        sendCommand("},{"type":"INSERT","lineNumber":431,"content":"    }"},{"type":"INSERT","lineNumber":432,"content":""},{"type":"INSERT","lineNumber":434,"content":"        if (state.value.armable) {"},{"type":"INSERT","lineNumber":435,"content":"            sendCommand("},{"type":"DELETE","lineNumber":440,"oldContent":"        sendCommand("},{"type":"INSERT","lineNumber":437,"content":"                1f"},{"type":"INSERT","lineNumber":438,"content":"            )"},{"type":"INSERT","lineNumber":439,"content":"        } else {"},{"type":"INSERT","lineNumber":457,"content":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":460,"oldContent":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":469,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":471,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":469,"content":"            delay(200)"},{"type":"INSERT","lineNumber":471,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":510,"content":"            clearJob.cancel()"},{"type":"INSERT","lineNumber":511,"content":"            if (!clearAck) {"},{"type":"INSERT","lineNumber":512,"content":"                Log.w(\"MavlinkRepo\", \"[Mission Upload] No ACK for MISSION_CLEAR_ALL; proceeding anyway\")"},{"type":"DELETE","lineNumber":512,"oldContent":"            }"},{"type":"DELETE","lineNumber":513,"oldContent":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":514,"oldContent":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_COUNT=${msg.count} from sys=${frame.systemId}\")"},{"type":"DELETE","lineNumber":516,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":517,"oldContent":"            }"},{"type":"DELETE","lineNumber":518,"oldContent":"                }"},{"type":"DELETE","lineNumber":519,"oldContent":"                    val missionItem = item.copy("},{"type":"DELETE","lineNumber":520,"oldContent":"                    if (sentSeqs.contains(seq)) continue"},{"type":"DELETE","lineNumber":521,"oldContent":"                                Log.i(\"MavlinkRepo\", \"[Mission Upload] Sending waypoint seq=$seq: ${item.command} lat=${item.x / 1e7} lon=${item.y / 1e7} alt=${item.z}\")"},{"type":"DELETE","lineNumber":522,"oldContent":"    }"},{"type":"DELETE","lineNumber":523,"oldContent":"        sendCommand(MavCmd.COMPONENT_ARM_DISARM, if (arm) 1f else 0f)"},{"type":"DELETE","lineNumber":524,"oldContent":"    suspend fun armDisarm(arm: Boolean) {"},{"type":"DELETE","lineNumber":525,"oldContent":"     */"},{"type":"INSERT","lineNumber":515,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Upload] Starting upload of ${missionItems.size} items...\")"},{"type":"INSERT","lineNumber":516,"content":"            // Send MissionCount"},{"type":"INSERT","lineNumber":517,"content":"            val missionCount = MissionCount("},{"type":"INSERT","lineNumber":518,"content":"                targetSystem = fcuSystemId,"},{"type":"INSERT","lineNumber":519,"content":"                targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":520,"content":"                count = missionItems.size.toUShort()"},{"type":"INSERT","lineNumber":521,"content":"            )"},{"type":"INSERT","lineNumber":522,"content":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionCount)"},{"type":"INSERT","lineNumber":523,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Upload] Sent MISSION_COUNT=${missionItems.size}\")"},{"type":"INSERT","lineNumber":524,"content":""},{"type":"INSERT","lineNumber":527,"content":"            var firstRequestReceived = false"},{"type":"DELETE","lineNumber":529,"oldContent":""},{"type":"INSERT","lineNumber":540,"content":"            }"},{"type":"DELETE","lineNumber":542,"oldContent":""},{"type":"INSERT","lineNumber":561,"content":"                                    targetComponent = senderComp.toUByte(),"},{"type":"DELETE","lineNumber":564,"oldContent":"                                    targetComponent = senderComp.toUByte(),"},{"type":"DELETE","lineNumber":605,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to set AUTO mode\", e)"},{"type":"DELETE","lineNumber":606,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Set mode to AUTO, result=$modeChanged\")"},{"type":"INSERT","lineNumber":604,"content":"                    }"},{"type":"INSERT","lineNumber":605,"content":"            }"},{"type":"DELETE","lineNumber":609,"oldContent":"        // Step 2: Send MISSION_START as CommandLong"},{"type":"DELETE","lineNumber":610,"oldContent":"                return"},{"type":"INSERT","lineNumber":608,"content":"            val firstRequestTimeout = 5000L"},{"type":"INSERT","lineNumber":609,"content":"            val startWait = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":616,"content":"                for (seq in 0 until missionItems.size) {"},{"type":"INSERT","lineNumber":617,"content":"                    if (sentSeqs.contains(seq)) continue"},{"type":"INSERT","lineNumber":618,"content":"                    val item = missionItems[seq]"},{"type":"DELETE","lineNumber":618,"oldContent":"}"},{"type":"DELETE","lineNumber":619,"oldContent":"    }"},{"type":"DELETE","lineNumber":620,"oldContent":"        )"},{"type":"DELETE","lineNumber":621,"oldContent":"            param7 = 0f"},{"type":"INSERT","lineNumber":620,"content":"                    val missionItem = item.copy("},{"type":"DELETE","lineNumber":624,"oldContent":"            arm()"},{"type":"DELETE","lineNumber":625,"oldContent":"                }"},{"type":"DELETE","lineNumber":626,"oldContent":"                connection.mavFrame.collect { frame ->"},{"type":"DELETE","lineNumber":627,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":628,"oldContent":"                    }"},{"type":"DELETE","lineNumber":629,"oldContent":"            }"},{"type":"DELETE","lineNumber":630,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"DELETE","lineNumber":631,"oldContent":"}"},{"type":"DELETE","lineNumber":632,"oldContent":"        )"},{"type":"INSERT","lineNumber":623,"content":"                        seq = seq.toUShort()"},{"type":"INSERT","lineNumber":624,"content":"                    )"},{"type":"INSERT","lineNumber":625,"content":"                    try {"},{"type":"INSERT","lineNumber":626,"content":"                        Log.d(\"MavlinkRepo\", \"Sending fallback item seq=$seq cmd=${missionItem.command} frame=${missionItem.frame} x=${missionItem.x} y=${missionItem.y} z=${missionItem.z}\")"},{"type":"INSERT","lineNumber":627,"content":"                        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, missionItem)"},{"type":"INSERT","lineNumber":628,"content":"                        sentSeqs.add(seq)"},{"type":"INSERT","lineNumber":629,"content":"                        Log.i(\"MavlinkRepo\", \"Fallback: Sent MISSION_ITEM_INT seq=$seq\")"},{"type":"INSERT","lineNumber":630,"content":"                        delay(300)"},{"type":"INSERT","lineNumber":631,"content":"                    } catch (e: Exception) {"},{"type":"DELETE","lineNumber":640,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":639,"content":"            } ?: false"},{"type":"DELETE","lineNumber":645,"oldContent":"            param2 = 0f,"},{"type":"INSERT","lineNumber":644,"content":"            if (ackReceived) {"},{"type":"DELETE","lineNumber":649,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"INSERT","lineNumber":648,"content":"                Log.e(\"MavlinkRepo\", \"[Mission Upload] Mission upload timed out waiting for ACK\")"},{"type":"DELETE","lineNumber":651,"oldContent":"            arm()"},{"type":"DELETE","lineNumber":652,"oldContent":"                }"},{"type":"INSERT","lineNumber":650,"content":"            }"},{"type":"INSERT","lineNumber":651,"content":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":654,"content":"        }"},{"type":"DELETE","lineNumber":656,"oldContent":"    }"},{"type":"MODIFY","lineNumber":667,"content":"            val job = AppScope.launch {","oldContent":"    // Haversine formula for distance in meters"},{"type":"DELETE","lineNumber":683,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"INSERT","lineNumber":682,"content":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ITEM seq=${msg.seq} x=${msg.x} y=${msg.y} z=${msg.z}\")"},{"type":"INSERT","lineNumber":694,"content":"            try {"},{"type":"DELETE","lineNumber":696,"oldContent":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":698,"content":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":701,"oldContent":"            } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":702,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {","oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":713,"content":"                try {"},{"type":"DELETE","lineNumber":715,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"MODIFY","lineNumber":719,"content":"                }","oldContent":"                }"},{"type":"INSERT","lineNumber":723,"content":"                    true"},{"type":"DELETE","lineNumber":726,"oldContent":"                    true"},{"type":"DELETE","lineNumber":750,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":749,"content":"     */"},{"type":"INSERT","lineNumber":766,"content":"        }"},{"type":"DELETE","lineNumber":768,"oldContent":""},{"type":"MODIFY","lineNumber":772,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] MISSION_START command sent\")","oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] MISSION_START command sent\")"},{"type":"INSERT","lineNumber":774,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":776,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"INSERT","lineNumber":779,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":781,"oldContent":"        try {"},{"type":"MODIFY","lineNumber":787,"content":"                return false","oldContent":"                return false"},{"type":"INSERT","lineNumber":791,"content":"            return false"},{"type":"INSERT","lineNumber":792,"content":"        }"},{"type":"DELETE","lineNumber":793,"oldContent":"}"},{"type":"DELETE","lineNumber":795,"oldContent":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"DELETE","lineNumber":797,"oldContent":"        return (R * c).toFloat()"},{"type":"INSERT","lineNumber":796,"content":"    }"},{"type":"INSERT","lineNumber":807,"content":"            param1 = 0f,"},{"type":"DELETE","lineNumber":809,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":818,"oldContent":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"DELETE","lineNumber":819,"oldContent":"    fun closeConnection() {"},{"type":"DELETE","lineNumber":820,"oldContent":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"DELETE","lineNumber":822,"oldContent":""},{"type":"INSERT","lineNumber":818,"content":"    suspend fun closeConnection() {"},{"type":"INSERT","lineNumber":819,"content":"        try {"},{"type":"INSERT","lineNumber":820,"content":"            // Attempt to close the TCP connection gracefully"},{"type":"INSERT","lineNumber":821,"content":"            connection.close()"},{"type":"INSERT","lineNumber":822,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":824,"oldContent":"            Log.e(\"MavlinkRepo\", \"Error closing TCP connection\", e)"},{"type":"INSERT","lineNumber":826,"content":""},{"type":"MODIFY","lineNumber":829,"content":"        val R = 6371000.0 // Earth radius in meters","oldContent":"        return (R * c).toFloat()"},{"type":"INSERT","lineNumber":830,"content":"        val dLat = Math.toRadians(lat2 - lat1)"},{"type":"INSERT","lineNumber":831,"content":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"INSERT","lineNumber":832,"content":"        val a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +"},{"type":"INSERT","lineNumber":833,"content":"                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *"},{"type":"INSERT","lineNumber":834,"content":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)"},{"type":"INSERT","lineNumber":836,"content":"        return (R * c).toFloat()"},{"type":"INSERT","lineNumber":837,"content":"    }"},{"type":"INSERT","lineNumber":838,"content":"}"}]},{"timestamp":1758606401909,"changes":[{"type":"MODIFY","lineNumber":81,"content":"                    }","oldContent":"                    }"},{"type":"MODIFY","lineNumber":85,"content":"                            _state.update { it.copy(connected = false, fcuDetected = false) }","oldContent":"                            _state.update { it.copy(connected = false, fcuDetected = false) }"},{"type":"MODIFY","lineNumber":91,"content":"        }","oldContent":"        }"},{"type":"INSERT","lineNumber":114,"content":""},{"type":"DELETE","lineNumber":115,"oldContent":"            mavFrameStream"},{"type":"MODIFY","lineNumber":121,"content":"            mavFrameStream.collect {","oldContent":"                        Log.i(\"MavlinkRepo\", \"FCU detected sysId=$fcuSystemId compId=$fcuComponentId\")"},{"type":"MODIFY","lineNumber":133,"content":"                        fcuComponentId = it.componentId","oldContent":"                        fcuComponentId = it.componentId"},{"type":"MODIFY","lineNumber":152,"content":"                                    param7 = 0f","oldContent":"                                    param7 = 0f"},{"type":"MODIFY","lineNumber":156,"content":"                                } catch (e: Exception) {","oldContent":"                                } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":201,"content":"                            groundspeed = hud.groundspeed.takeIf { v -> v > 0f },","oldContent":"                            groundspeed = hud.groundspeed.takeIf { v -> v > 0f }"},{"type":"INSERT","lineNumber":202,"content":"                            formattedAirspeed = formatSpeed(hud.airspeed.takeIf { v -> v > 0f }),"},{"type":"INSERT","lineNumber":203,"content":"                            formattedGroundspeed = formatSpeed(hud.groundspeed.takeIf { v -> v > 0f })"},{"type":"DELETE","lineNumber":210,"oldContent":"                .map { it.message }"},{"type":"INSERT","lineNumber":213,"content":"                .map { it.message }"},{"type":"DELETE","lineNumber":295,"oldContent":"                        19u -> \"Avoid_ADSB\""},{"type":"INSERT","lineNumber":298,"content":"                        19u -> \"Avoid_ADSB\""},{"type":"INSERT","lineNumber":396,"content":"            for (seq in 0 until expectedCount) {"},{"type":"DELETE","lineNumber":395,"oldContent":"            param2 = param2,"},{"type":"DELETE","lineNumber":413,"oldContent":""},{"type":"DELETE","lineNumber":414,"oldContent":"    suspend fun arm() {"},{"type":"DELETE","lineNumber":415,"oldContent":"            sendCommand("},{"type":"DELETE","lineNumber":416,"oldContent":"                MavCmd.COMPONENT_ARM_DISARM,"},{"type":"DELETE","lineNumber":417,"oldContent":"            )"},{"type":"INSERT","lineNumber":415,"content":"            confirmation = 0u,"},{"type":"INSERT","lineNumber":416,"content":"            param1 = param1,"},{"type":"INSERT","lineNumber":417,"content":"            param2 = param2,"},{"type":"INSERT","lineNumber":418,"content":"            param3 = param3,"},{"type":"INSERT","lineNumber":419,"content":"            param4 = param4,"},{"type":"DELETE","lineNumber":424,"oldContent":"    }"},{"type":"DELETE","lineNumber":426,"oldContent":""},{"type":"DELETE","lineNumber":429,"oldContent":"        if (state.value.armable) {"},{"type":"DELETE","lineNumber":431,"oldContent":"            sendCommand("},{"type":"DELETE","lineNumber":434,"oldContent":"                1f"},{"type":"DELETE","lineNumber":436,"oldContent":"            )"},{"type":"INSERT","lineNumber":433,"content":"    }"},{"type":"INSERT","lineNumber":434,"content":""},{"type":"DELETE","lineNumber":438,"oldContent":"        } else {"},{"type":"INSERT","lineNumber":436,"content":"        if (state.value.armable) {"},{"type":"INSERT","lineNumber":437,"content":"            sendCommand("},{"type":"INSERT","lineNumber":439,"content":"                1f"},{"type":"INSERT","lineNumber":440,"content":"            )"},{"type":"INSERT","lineNumber":441,"content":"        } else {"},{"type":"DELETE","lineNumber":456,"oldContent":"        val start = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":459,"content":"        val start = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":468,"oldContent":"            delay(200)"},{"type":"DELETE","lineNumber":470,"oldContent":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"INSERT","lineNumber":471,"content":"            delay(200)"},{"type":"INSERT","lineNumber":473,"content":"        Log.e(\"MavlinkRepo\", \"Mode change to ${customMode} not confirmed in Heartbeat\")"},{"type":"DELETE","lineNumber":509,"oldContent":"            clearJob.cancel()"},{"type":"INSERT","lineNumber":512,"content":"            clearJob.cancel()"},{"type":"DELETE","lineNumber":512,"oldContent":"            .filterIsInstance<MissionCount>()"},{"type":"DELETE","lineNumber":514,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Upload] Starting upload of ${missionItems.size} items...\")"},{"type":"INSERT","lineNumber":515,"content":"            }"},{"type":"INSERT","lineNumber":517,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Upload] Starting upload of ${missionItems.size} items...\")"},{"type":"DELETE","lineNumber":526,"oldContent":"            var firstRequestReceived = false"},{"type":"INSERT","lineNumber":529,"content":"            var firstRequestReceived = false"},{"type":"DELETE","lineNumber":539,"oldContent":"            }"},{"type":"INSERT","lineNumber":542,"content":"            }"},{"type":"DELETE","lineNumber":560,"oldContent":"                                    targetComponent = senderComp.toUByte(),"},{"type":"INSERT","lineNumber":563,"content":"                                    targetComponent = senderComp.toUByte(),"},{"type":"DELETE","lineNumber":601,"oldContent":"            }"},{"type":"DELETE","lineNumber":602,"oldContent":"                delay(100)"},{"type":"INSERT","lineNumber":603,"content":"                                // ignore other messages"},{"type":"INSERT","lineNumber":604,"content":"                            }"},{"type":"INSERT","lineNumber":605,"content":"                        }"},{"type":"DELETE","lineNumber":604,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"DELETE","lineNumber":607,"oldContent":"            val firstRequestTimeout = 5000L"},{"type":"INSERT","lineNumber":610,"content":"            val firstRequestTimeout = 5000L"},{"type":"INSERT","lineNumber":617,"content":"                Log.w(\"MavlinkRepo\", \"[Mission Upload] No MissionRequest received; sending all items directly\")"},{"type":"DELETE","lineNumber":616,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":618,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending MISSION_START command...\")"},{"type":"INSERT","lineNumber":621,"content":"                    Log.i(\"MavlinkRepo\", \"[Mission Upload] Fallback sending waypoint seq=$seq: ${item.command} lat=${item.x / 1e7} lon=${item.y / 1e7} alt=${item.z}\")"},{"type":"DELETE","lineNumber":622,"oldContent":"                        seq = seq.toUShort()"},{"type":"INSERT","lineNumber":625,"content":"                        seq = seq.toUShort()"},{"type":"DELETE","lineNumber":638,"oldContent":"            } ?: false"},{"type":"INSERT","lineNumber":641,"content":"            } ?: false"},{"type":"DELETE","lineNumber":643,"oldContent":"            if (ackReceived) {"},{"type":"INSERT","lineNumber":646,"content":"            if (ackReceived) {"},{"type":"DELETE","lineNumber":647,"oldContent":"                Log.e(\"MavlinkRepo\", \"[Mission Upload] Mission upload timed out waiting for ACK\")"},{"type":"DELETE","lineNumber":649,"oldContent":"            }"},{"type":"INSERT","lineNumber":650,"content":"                Log.e(\"MavlinkRepo\", \"[Mission Upload] Mission upload timed out waiting for ACK\")"},{"type":"INSERT","lineNumber":652,"content":"            }"},{"type":"DELETE","lineNumber":653,"oldContent":"        }"},{"type":"INSERT","lineNumber":656,"content":"        }"},{"type":"INSERT","lineNumber":668,"content":""},{"type":"DELETE","lineNumber":667,"oldContent":"            targetComponent = fcuComponentId,"},{"type":"DELETE","lineNumber":681,"oldContent":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ITEM seq=${msg.seq} x=${msg.x} y=${msg.y} z=${msg.z}\")"},{"type":"INSERT","lineNumber":684,"content":"                            Log.i(\"MavlinkRepo\", \"Readback: MISSION_ITEM seq=${msg.seq} x=${msg.x} y=${msg.y} z=${msg.z}\")"},{"type":"DELETE","lineNumber":693,"oldContent":"            try {"},{"type":"INSERT","lineNumber":696,"content":"            try {"},{"type":"DELETE","lineNumber":697,"oldContent":"            } catch (e: Exception) {"},{"type":"INSERT","lineNumber":700,"content":"            } catch (e: Exception) {"},{"type":"DELETE","lineNumber":701,"oldContent":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"INSERT","lineNumber":704,"content":"            val expectedCount = withTimeoutOrNull(timeoutMs) { expectedCountDeferred.await() } ?: run {"},{"type":"DELETE","lineNumber":712,"oldContent":"                try {"},{"type":"INSERT","lineNumber":715,"content":"                try {"},{"type":"DELETE","lineNumber":718,"oldContent":"                }"},{"type":"INSERT","lineNumber":721,"content":"                }"},{"type":"DELETE","lineNumber":722,"oldContent":"                    true"},{"type":"INSERT","lineNumber":725,"content":"                    true"},{"type":"DELETE","lineNumber":748,"oldContent":"     */"},{"type":"DELETE","lineNumber":750,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":751,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":752,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":753,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":754,"oldContent":"            param1 = 0f,"},{"type":"INSERT","lineNumber":751,"content":"     */"},{"type":"INSERT","lineNumber":752,"content":"    suspend fun startMission(): Boolean {"},{"type":"INSERT","lineNumber":753,"content":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Initiating mission start workflow...\")"},{"type":"INSERT","lineNumber":754,"content":"        if (!state.value.fcuDetected) {"},{"type":"INSERT","lineNumber":755,"content":"            Log.w(\"MavlinkRepo\", \"[Mission Start] Cannot start mission - FCU not detected\")"},{"type":"INSERT","lineNumber":756,"content":"            return false"},{"type":"INSERT","lineNumber":757,"content":"        }"},{"type":"DELETE","lineNumber":756,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":757,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":758,"oldContent":"            param3 = 0f,"},{"type":"INSERT","lineNumber":759,"content":"        // Step 1: Arm the vehicle"},{"type":"INSERT","lineNumber":760,"content":"        try {"},{"type":"DELETE","lineNumber":765,"oldContent":"        }"},{"type":"INSERT","lineNumber":768,"content":"        }"},{"type":"DELETE","lineNumber":771,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] MISSION_START command sent\")"},{"type":"DELETE","lineNumber":773,"oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":774,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] MISSION_START command sent\")"},{"type":"INSERT","lineNumber":776,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":778,"oldContent":"        // Step 3: Set mode to AUTO"},{"type":"INSERT","lineNumber":781,"content":"        // Step 3: Set mode to AUTO"},{"type":"DELETE","lineNumber":786,"oldContent":"                return false"},{"type":"INSERT","lineNumber":789,"content":"                return false"},{"type":"DELETE","lineNumber":790,"oldContent":"            return false"},{"type":"INSERT","lineNumber":793,"content":"            return false"},{"type":"DELETE","lineNumber":793,"oldContent":"    }"},{"type":"INSERT","lineNumber":795,"content":""},{"type":"DELETE","lineNumber":795,"oldContent":"    }"},{"type":"INSERT","lineNumber":798,"content":"    }"},{"type":"DELETE","lineNumber":806,"oldContent":"            param1 = 0f,"},{"type":"INSERT","lineNumber":809,"content":"            param1 = 0f,"},{"type":"INSERT","lineNumber":819,"content":""},{"type":"DELETE","lineNumber":821,"oldContent":""},{"type":"INSERT","lineNumber":827,"content":"    }"},{"type":"DELETE","lineNumber":826,"oldContent":"        return (R * c).toFloat()"},{"type":"DELETE","lineNumber":831,"oldContent":"    }"},{"type":"DELETE","lineNumber":833,"oldContent":"        return (R * c).toFloat()"},{"type":"MODIFY","lineNumber":836,"content":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)","oldContent":"                Math.sin(dLon / 2) * Math.sin(dLon / 2)"},{"type":"INSERT","lineNumber":837,"content":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"INSERT","lineNumber":838,"content":"        return (R * c).toFloat()"},{"type":"INSERT","lineNumber":839,"content":"    }"},{"type":"INSERT","lineNumber":840,"content":""},{"type":"INSERT","lineNumber":841,"content":"    // Format speed for human-readable display"},{"type":"INSERT","lineNumber":842,"content":"    private fun formatSpeed(speed: Float?): String? {"},{"type":"INSERT","lineNumber":843,"content":"        if (speed == null) return null"},{"type":"INSERT","lineNumber":844,"content":"        return when {"},{"type":"INSERT","lineNumber":845,"content":"//            speed >= 1000f -> String.format(\"%.2f km/s\", speed / 1000f)"},{"type":"INSERT","lineNumber":846,"content":"            speed >= 1f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":847,"content":"//            speed >= 0.01f -> String.format(\"%.1f cm/s\", speed * 100f)"},{"type":"INSERT","lineNumber":848,"content":"//            speed > 0f -> String.format(\"%.1f mm/s\", speed * 1000f)"},{"type":"INSERT","lineNumber":849,"content":"            else -> \"0 m/s\""},{"type":"INSERT","lineNumber":850,"content":"        }"},{"type":"INSERT","lineNumber":851,"content":"    }"},{"type":"INSERT","lineNumber":852,"content":""},{"type":"INSERT","lineNumber":853,"content":""},{"type":"INSERT","lineNumber":854,"content":"}"}]},{"timestamp":1758686783541,"changes":[{"type":"INSERT","lineNumber":80,"content":"                        }"},{"type":"DELETE","lineNumber":81,"oldContent":"                    }"},{"type":"INSERT","lineNumber":84,"content":"                            Log.i(\"MavlinkRepo\", \"Connection Inactive, reconnecting...\")"},{"type":"DELETE","lineNumber":85,"oldContent":"                            _state.update { it.copy(connected = false, fcuDetected = false) }"},{"type":"INSERT","lineNumber":90,"content":"            }"},{"type":"DELETE","lineNumber":91,"oldContent":"        }"},{"type":"INSERT","lineNumber":132,"content":"                        fcuSystemId = it.systemId"},{"type":"DELETE","lineNumber":133,"oldContent":"                        fcuComponentId = it.componentId"},{"type":"INSERT","lineNumber":151,"content":"                                    param6 = 0f,"},{"type":"DELETE","lineNumber":152,"oldContent":"                                    param7 = 0f"},{"type":"INSERT","lineNumber":155,"content":"                                    connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"DELETE","lineNumber":156,"oldContent":"                                } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":200,"content":"                            airspeed = hud.airspeed.takeIf { v -> v > 0f },","oldContent":"                            groundspeed = hud.groundspeed.takeIf { v -> v > 0f }"},{"type":"INSERT","lineNumber":203,"content":"                            formattedGroundspeed = formatSpeed(hud.groundspeed.takeIf { v -> v > 0f }),"},{"type":"INSERT","lineNumber":204,"content":"                            heading = hud.heading.toFloat()"},{"type":"DELETE","lineNumber":204,"oldContent":"                            formattedGroundspeed = formatSpeed(hud.groundspeed.takeIf { v -> v > 0f })"},{"type":"DELETE","lineNumber":213,"oldContent":"                .filterIsInstance<GlobalPositionInt>()"},{"type":"INSERT","lineNumber":215,"content":"                .filterIsInstance<GlobalPositionInt>()"},{"type":"DELETE","lineNumber":298,"oldContent":"                        20u -> \"Guided_NoGPS\""},{"type":"INSERT","lineNumber":300,"content":"                        20u -> \"Guided_NoGPS\""},{"type":"DELETE","lineNumber":396,"oldContent":"                val seqDeferred = CompletableDeferred<Unit>()"},{"type":"INSERT","lineNumber":398,"content":"                val seqDeferred = CompletableDeferred<Unit>()"},{"type":"DELETE","lineNumber":407,"oldContent":"        } catch (e: Exception) {"},{"type":"MODIFY","lineNumber":408,"content":"        }","oldContent":"            _lastFailure.value = e"},{"type":"INSERT","lineNumber":410,"content":""},{"type":"DELETE","lineNumber":419,"oldContent":"            param5 = param5,"},{"type":"INSERT","lineNumber":421,"content":"            param5 = param5,"},{"type":"DELETE","lineNumber":431,"oldContent":"    }"},{"type":"DELETE","lineNumber":433,"oldContent":""},{"type":"INSERT","lineNumber":434,"content":"    }"},{"type":"INSERT","lineNumber":435,"content":""},{"type":"INSERT","lineNumber":436,"content":"    suspend fun arm() {"},{"type":"DELETE","lineNumber":437,"oldContent":"    suspend fun arm() {"},{"type":"DELETE","lineNumber":438,"oldContent":"                1f"},{"type":"INSERT","lineNumber":440,"content":"                1f"},{"type":"DELETE","lineNumber":441,"oldContent":"            Log.w(\"MavlinkRepo\", \"Arm command rejected, vehicle not armable\")"},{"type":"INSERT","lineNumber":443,"content":"            Log.w(\"MavlinkRepo\", \"Arm command rejected, vehicle not armable\")"},{"type":"DELETE","lineNumber":459,"oldContent":"        val expectedMode = when (customMode) {"},{"type":"INSERT","lineNumber":461,"content":"        val expectedMode = when (customMode) {"},{"type":"DELETE","lineNumber":473,"oldContent":"        return false"},{"type":"INSERT","lineNumber":475,"content":"        return false"},{"type":"DELETE","lineNumber":507,"oldContent":"            // Wait a short period for first request; if none, fallback to sending all items"},{"type":"DELETE","lineNumber":508,"oldContent":"                            Log.i(\"MavlinkRepo\", \"[Mission Upload] MISSION_CLEAR_ALL acknowledged by FCU\")"},{"type":"DELETE","lineNumber":509,"oldContent":"                        if (ack.command.value == MISSION_CLEAR_ALL_CMD && ack.result.value == MavResult.ACCEPTED.value) {"},{"type":"DELETE","lineNumber":510,"oldContent":"                    .collect { ack ->"},{"type":"DELETE","lineNumber":511,"oldContent":"            connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, clearAll)"},{"type":"DELETE","lineNumber":512,"oldContent":"            if (!clearAck) {"},{"type":"INSERT","lineNumber":508,"content":"                            clearAckDeferred.complete(true)"},{"type":"INSERT","lineNumber":509,"content":"                        }"},{"type":"INSERT","lineNumber":510,"content":"                    }"},{"type":"INSERT","lineNumber":511,"content":"            }"},{"type":"INSERT","lineNumber":512,"content":"            val clearAck = withTimeoutOrNull(3000L) { clearAckDeferred.await() } ?: false"},{"type":"INSERT","lineNumber":514,"content":"            if (!clearAck) {"},{"type":"DELETE","lineNumber":516,"oldContent":"            param4 = 0f,"},{"type":"MODIFY","lineNumber":517,"content":"","oldContent":"            // Send MissionCount"},{"type":"INSERT","lineNumber":519,"content":"            // Send MissionCount"},{"type":"DELETE","lineNumber":529,"oldContent":""},{"type":"INSERT","lineNumber":531,"content":""},{"type":"DELETE","lineNumber":542,"oldContent":""},{"type":"INSERT","lineNumber":544,"content":""},{"type":"DELETE","lineNumber":563,"oldContent":"                                    seq = seq.toUShort()"},{"type":"INSERT","lineNumber":565,"content":"                                    seq = seq.toUShort()"},{"type":"DELETE","lineNumber":604,"oldContent":"                    }"},{"type":"INSERT","lineNumber":607,"content":"                    }"},{"type":"DELETE","lineNumber":610,"oldContent":"            val startWait = System.currentTimeMillis()"},{"type":"INSERT","lineNumber":612,"content":"            val startWait = System.currentTimeMillis()"},{"type":"DELETE","lineNumber":617,"oldContent":"                for (seq in 0 until missionItems.size) {"},{"type":"INSERT","lineNumber":619,"content":"                for (seq in 0 until missionItems.size) {"},{"type":"DELETE","lineNumber":621,"oldContent":"                    val missionItem = item.copy("},{"type":"INSERT","lineNumber":623,"content":"                    val missionItem = item.copy("},{"type":"DELETE","lineNumber":625,"oldContent":"                    )"},{"type":"INSERT","lineNumber":627,"content":"                    )"},{"type":"DELETE","lineNumber":641,"oldContent":""},{"type":"INSERT","lineNumber":643,"content":""},{"type":"DELETE","lineNumber":646,"oldContent":"                Log.i(\"MavlinkRepo\", \"[Mission Upload] Mission upload acknowledged by FCU\")"},{"type":"INSERT","lineNumber":648,"content":"                Log.i(\"MavlinkRepo\", \"[Mission Upload] Mission upload acknowledged by FCU\")"},{"type":"DELETE","lineNumber":652,"oldContent":"        } catch (e: Exception) {"},{"type":"INSERT","lineNumber":654,"content":"        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":656,"oldContent":"    }"},{"type":"INSERT","lineNumber":658,"content":"    }"},{"type":"DELETE","lineNumber":668,"oldContent":"            val job = AppScope.launch {"},{"type":"INSERT","lineNumber":670,"content":"            val job = AppScope.launch {"},{"type":"DELETE","lineNumber":684,"oldContent":"                            received.add(msg.seq.toInt() to \"FLT: x=${msg.x} y=${msg.y} z=${msg.z}\")"},{"type":"INSERT","lineNumber":686,"content":"                            received.add(msg.seq.toInt() to \"FLT: x=${msg.x} y=${msg.y} z=${msg.z}\")"},{"type":"DELETE","lineNumber":696,"oldContent":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"INSERT","lineNumber":698,"content":"                val req = MissionRequestList(targetSystem = fcuSystemId, targetComponent = fcuComponentId)"},{"type":"DELETE","lineNumber":700,"oldContent":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"INSERT","lineNumber":702,"content":"                Log.e(\"MavlinkRepo\", \"Failed to send MISSION_REQUEST_LIST\", e)"},{"type":"DELETE","lineNumber":704,"oldContent":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"INSERT","lineNumber":706,"content":"                Log.w(\"MavlinkRepo\", \"Did not receive MISSION_COUNT from FCU within timeout\")"},{"type":"DELETE","lineNumber":712,"oldContent":"            param4 = 0f,"},{"type":"DELETE","lineNumber":713,"oldContent":"            param3 = 0f,"},{"type":"DELETE","lineNumber":714,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":715,"oldContent":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"INSERT","lineNumber":713,"content":"            for (seq in 0 until expectedCount) {"},{"type":"INSERT","lineNumber":714,"content":"                val seqDeferred = CompletableDeferred<Unit>()"},{"type":"INSERT","lineNumber":715,"content":"                perSeqMap[seq] = seqDeferred"},{"type":"INSERT","lineNumber":717,"content":"                    val reqItem = MissionRequestInt(targetSystem = fcuSystemId, targetComponent = fcuComponentId, seq = seq.toUShort())"},{"type":"DELETE","lineNumber":721,"oldContent":""},{"type":"INSERT","lineNumber":723,"content":""},{"type":"DELETE","lineNumber":725,"oldContent":"                } ?: false"},{"type":"INSERT","lineNumber":727,"content":"                } ?: false"},{"type":"INSERT","lineNumber":743,"content":"        }"},{"type":"DELETE","lineNumber":743,"oldContent":"            param6 = 0f,"},{"type":"DELETE","lineNumber":744,"oldContent":"            param3 = 0f,"},{"type":"INSERT","lineNumber":745,"content":""},{"type":"DELETE","lineNumber":756,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":759,"content":""},{"type":"DELETE","lineNumber":760,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":762,"oldContent":"            param1 = 0f,"},{"type":"DELETE","lineNumber":763,"oldContent":"    /**"},{"type":"INSERT","lineNumber":762,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending ARM command...\")"},{"type":"INSERT","lineNumber":763,"content":"            arm()"},{"type":"INSERT","lineNumber":764,"content":"            Log.i(\"MavlinkRepo\", \"[Mission Start] ARM command sent\")"},{"type":"DELETE","lineNumber":768,"oldContent":""},{"type":"INSERT","lineNumber":770,"content":""},{"type":"DELETE","lineNumber":776,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"INSERT","lineNumber":778,"content":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to send MISSION_START command\", e)"},{"type":"DELETE","lineNumber":780,"oldContent":"            connection.close()"},{"type":"MODIFY","lineNumber":781,"content":"","oldContent":"        try {"},{"type":"INSERT","lineNumber":783,"content":"        try {"},{"type":"DELETE","lineNumber":789,"oldContent":"            }"},{"type":"INSERT","lineNumber":791,"content":"            }"},{"type":"DELETE","lineNumber":793,"oldContent":"        }"},{"type":"MODIFY","lineNumber":795,"content":"        }","oldContent":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"INSERT","lineNumber":797,"content":"        Log.i(\"MavlinkRepo\", \"[Mission Start] Mission start workflow complete. Vehicle should be in AUTO mode.\")"},{"type":"DELETE","lineNumber":798,"oldContent":""},{"type":"INSERT","lineNumber":800,"content":""},{"type":"DELETE","lineNumber":809,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":811,"oldContent":""},{"type":"DELETE","lineNumber":812,"oldContent":"    }"},{"type":"INSERT","lineNumber":811,"content":"            param2 = 0f,"},{"type":"INSERT","lineNumber":812,"content":"            param3 = 0f,"},{"type":"INSERT","lineNumber":813,"content":"            param4 = 0f,"},{"type":"DELETE","lineNumber":814,"oldContent":"    }"},{"type":"INSERT","lineNumber":815,"content":"            param6 = 0f,"},{"type":"INSERT","lineNumber":820,"content":""},{"type":"DELETE","lineNumber":821,"oldContent":""},{"type":"DELETE","lineNumber":825,"oldContent":"                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *"},{"type":"DELETE","lineNumber":826,"oldContent":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"DELETE","lineNumber":827,"oldContent":""},{"type":"INSERT","lineNumber":826,"content":"            Log.e(\"MavlinkRepo\", \"Error closing TCP connection\", e)"},{"type":"INSERT","lineNumber":827,"content":"        }"},{"type":"DELETE","lineNumber":829,"oldContent":"}"},{"type":"DELETE","lineNumber":831,"oldContent":""},{"type":"DELETE","lineNumber":832,"oldContent":"    }"},{"type":"DELETE","lineNumber":833,"oldContent":"            else -> \"0 m/s\""},{"type":"DELETE","lineNumber":834,"oldContent":"//            speed >= 0.01f -> String.format(\"%.1f cm/s\", speed * 100f)"},{"type":"DELETE","lineNumber":835,"oldContent":"            speed >= 1f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":830,"content":"    // Haversine formula for distance in meters"},{"type":"INSERT","lineNumber":831,"content":"    private fun haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Float {"},{"type":"INSERT","lineNumber":832,"content":"        val R = 6371000.0 // Earth radius in meters"},{"type":"INSERT","lineNumber":833,"content":"        val dLat = Math.toRadians(lat2 - lat1)"},{"type":"INSERT","lineNumber":834,"content":"        val dLon = Math.toRadians(lon2 - lon1)"},{"type":"INSERT","lineNumber":835,"content":"        val a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +"},{"type":"INSERT","lineNumber":836,"content":"                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *"},{"type":"DELETE","lineNumber":838,"oldContent":"        return when {"},{"type":"DELETE","lineNumber":840,"oldContent":"        if (speed == null) return null"},{"type":"MODIFY","lineNumber":843,"content":"    private fun formatSpeed(speed: Float?): String? {","oldContent":"    private fun formatSpeed(speed: Float?): String? {"},{"type":"INSERT","lineNumber":844,"content":"        if (speed == null) return null"},{"type":"INSERT","lineNumber":845,"content":"        return when {"},{"type":"INSERT","lineNumber":846,"content":"//            speed >= 1000f -> String.format(\"%.2f km/s\", speed / 1000f)"},{"type":"INSERT","lineNumber":847,"content":"            speed >= 1f -> String.format(\"%.2f m/s\", speed)"},{"type":"INSERT","lineNumber":848,"content":"//            speed >= 0.01f -> String.format(\"%.1f cm/s\", speed * 100f)"},{"type":"INSERT","lineNumber":849,"content":"//            speed > 0f -> String.format(\"%.1f mm/s\", speed * 1000f)"},{"type":"INSERT","lineNumber":850,"content":"            else -> \"0 m/s\""},{"type":"INSERT","lineNumber":851,"content":"        }"},{"type":"INSERT","lineNumber":852,"content":"    }"},{"type":"INSERT","lineNumber":853,"content":""},{"type":"INSERT","lineNumber":854,"content":""},{"type":"INSERT","lineNumber":855,"content":"}"},{"type":"INSERT","lineNumber":856,"content":""},{"type":"INSERT","lineNumber":857,"content":""}]},{"timestamp":1758695399416,"changes":[{"type":"MODIFY","lineNumber":7,"content":"import com.divpundir.mavlink.connection.StreamState","oldContent":"import com.divpundir.mavlink.api.wrap"},{"type":"MODIFY","lineNumber":9,"content":"import com.divpundir.mavlink.definitions.common.*","oldContent":"import com.divpundir.mavlink.connection.tcp.TcpClientMavConnection"},{"type":"MODIFY","lineNumber":11,"content":"import kotlinx.coroutines.CompletableDeferred","oldContent":"import com.google.android.gms.maps.model.LatLng"},{"type":"DELETE","lineNumber":182,"oldContent":"                .map { it.message }"},{"type":"DELETE","lineNumber":183,"oldContent":"                .filterIsInstance<GlobalPositionInt>()"},{"type":"INSERT","lineNumber":182,"content":"                            \"COMMAND_ACK received: command=${ack.command} result=${ack.result} progress=${ack.progress}\""},{"type":"INSERT","lineNumber":183,"content":"                        )"},{"type":"MODIFY","lineNumber":205,"content":"                        )","oldContent":"                        )"},{"type":"MODIFY","lineNumber":318,"content":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false, lastMissionElapsedSec = null) }","oldContent":"                                _state.update { it.copy(missionElapsedSec = 0L, missionCompleted = false) }"},{"type":"DELETE","lineNumber":324,"oldContent":"                                // Mission ended"},{"type":"DELETE","lineNumber":325,"oldContent":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":326,"oldContent":"                                // Do NOT clear mission from FCU here"},{"type":"INSERT","lineNumber":324,"content":"                                // Mission ended: store last elapsed time"},{"type":"INSERT","lineNumber":325,"content":"                                val lastElapsed = state.value.missionElapsedSec"},{"type":"INSERT","lineNumber":326,"content":"                                _state.update { it.copy(missionElapsedSec = null, missionCompleted = true, lastMissionElapsedSec = lastElapsed) }"},{"type":"DELETE","lineNumber":333,"oldContent":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true) }"},{"type":"DELETE","lineNumber":334,"oldContent":"                            // Do NOT clear mission from FCU here"},{"type":"INSERT","lineNumber":333,"content":"                            val lastElapsed = state.value.missionElapsedSec"},{"type":"INSERT","lineNumber":334,"content":"                            _state.update { it.copy(missionElapsedSec = null, missionCompleted = true, lastMissionElapsedSec = lastElapsed) }"},{"type":"MODIFY","lineNumber":358,"content":"","oldContent":"                                    Log.e(\"MavlinkRepo\", \"Failed to send mission item\", e)"},{"type":"MODIFY","lineNumber":409,"content":"    }","oldContent":"            _lastFailure.value = e"},{"type":"DELETE","lineNumber":414,"oldContent":""},{"type":"DELETE","lineNumber":415,"oldContent":"    suspend fun arm() {"},{"type":"INSERT","lineNumber":414,"content":"            targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":415,"content":"            command = command.wrap(),"},{"type":"MODIFY","lineNumber":434,"content":"    }","oldContent":"    }"},{"type":"MODIFY","lineNumber":437,"content":"        if (state.value.armable) {","oldContent":"        if (state.value.armable) {"},{"type":"DELETE","lineNumber":743,"oldContent":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"INSERT","lineNumber":744,"content":"    }"},{"type":"DELETE","lineNumber":819,"oldContent":"}"},{"type":"DELETE","lineNumber":820,"oldContent":"    suspend fun closeConnection() {"},{"type":"INSERT","lineNumber":819,"content":"    }"},{"type":"INSERT","lineNumber":821,"content":"    suspend fun closeConnection() {"},{"type":"INSERT","lineNumber":829,"content":""},{"type":"DELETE","lineNumber":830,"oldContent":"    }"},{"type":"INSERT","lineNumber":842,"content":"    // Format speed for human-readable display"},{"type":"DELETE","lineNumber":844,"oldContent":""},{"type":"DELETE","lineNumber":846,"oldContent":"}"},{"type":"DELETE","lineNumber":848,"oldContent":""},{"type":"DELETE","lineNumber":850,"oldContent":""},{"type":"DELETE","lineNumber":852,"oldContent":"    }"},{"type":"DELETE","lineNumber":854,"oldContent":"        }"},{"type":"INSERT","lineNumber":851,"content":"        }"},{"type":"INSERT","lineNumber":852,"content":"    }"},{"type":"INSERT","lineNumber":853,"content":""},{"type":"INSERT","lineNumber":854,"content":""},{"type":"INSERT","lineNumber":855,"content":"}"},{"type":"INSERT","lineNumber":856,"content":""},{"type":"INSERT","lineNumber":857,"content":""}]},{"timestamp":1758695444659,"changes":[{"type":"INSERT","lineNumber":16,"content":"import kotlinx.coroutines.withTimeoutOrNull"},{"type":"DELETE","lineNumber":17,"oldContent":"    private val host: String,"},{"type":"MODIFY","lineNumber":68,"content":"            }","oldContent":"                    }"},{"type":"INSERT","lineNumber":112,"content":"            }"},{"type":"INSERT","lineNumber":113,"content":"        }"},{"type":"DELETE","lineNumber":113,"oldContent":"        // Detect FCU"},{"type":"DELETE","lineNumber":114,"oldContent":""},{"type":"MODIFY","lineNumber":125,"content":"","oldContent":"                        launch {"},{"type":"DELETE","lineNumber":180,"oldContent":"            mavFrameStream"},{"type":"DELETE","lineNumber":181,"oldContent":"                .filter { state.value.fcuDetected && it.systemId == fcuSystemId }"},{"type":"INSERT","lineNumber":180,"content":"                        Log.i("},{"type":"INSERT","lineNumber":181,"content":"                            \"MavlinkRepo\","},{"type":"INSERT","lineNumber":204,"content":"                            heading = hud.heading.toFloat()"},{"type":"DELETE","lineNumber":205,"oldContent":"                        )"},{"type":"DELETE","lineNumber":311,"oldContent":"        // Mission handling"},{"type":"DELETE","lineNumber":312,"oldContent":"            mavFrameStream"},{"type":"INSERT","lineNumber":311,"content":""},{"type":"INSERT","lineNumber":312,"content":"                    // Mission timer logic"},{"type":"DELETE","lineNumber":328,"oldContent":"                        } else if ((lastMode?.equals(\"Auto\", ignoreCase = true) == true && mode != \"Auto\") ||"},{"type":"MODIFY","lineNumber":328,"content":"                        } else if ((lastMode?.equals(\"Auto\", ignoreCase = true) == true && mode != \"Auto\") || (lastArmed == true && !armed && mode.equals(\"Auto\", ignoreCase = true))) {","oldContent":"                                   (lastArmed == true && armed == false && mode.equals(\"Auto\", ignoreCase = true))) {"},{"type":"INSERT","lineNumber":432,"content":"        }"},{"type":"DELETE","lineNumber":434,"oldContent":"    }"},{"type":"INSERT","lineNumber":435,"content":"    suspend fun arm() {"},{"type":"DELETE","lineNumber":437,"oldContent":"        if (state.value.armable) {"},{"type":"DELETE","lineNumber":616,"oldContent":"            param6 = 0f,"},{"type":"INSERT","lineNumber":615,"content":""},{"type":"DELETE","lineNumber":695,"oldContent":"            param2 = 0f,"},{"type":"DELETE","lineNumber":696,"oldContent":"            param1 = 0f,"},{"type":"INSERT","lineNumber":694,"content":"            }"},{"type":"INSERT","lineNumber":695,"content":""},{"type":"DELETE","lineNumber":712,"oldContent":"            delay(500)"},{"type":"INSERT","lineNumber":711,"content":""},{"type":"DELETE","lineNumber":731,"oldContent":"    /**"},{"type":"INSERT","lineNumber":730,"content":"                }"},{"type":"DELETE","lineNumber":738,"oldContent":"            Log.e(\"MavlinkRepo\", \"[Mission Start] Failed to arm vehicle\", e)"},{"type":"INSERT","lineNumber":737,"content":""},{"type":"MODIFY","lineNumber":743,"content":"    }","oldContent":"    }"},{"type":"DELETE","lineNumber":802,"oldContent":""},{"type":"INSERT","lineNumber":801,"content":"     * Sends MISSION_START as CommandLong (param1=0, param2=0, ...)"},{"type":"DELETE","lineNumber":817,"oldContent":"}"},{"type":"INSERT","lineNumber":816,"content":"        )"},{"type":"INSERT","lineNumber":817,"content":"        connection.trySendUnsignedV2(gcsSystemId, gcsComponentId, cmd)"},{"type":"DELETE","lineNumber":819,"oldContent":"    }"},{"type":"MODIFY","lineNumber":820,"content":"    suspend fun closeConnection() {","oldContent":"    suspend fun closeConnection() {"},{"type":"MODIFY","lineNumber":848,"content":"//            speed > 0f -> String.format(\"%.1f mm/s\", speed * 1000f)","oldContent":"        }"},{"type":"INSERT","lineNumber":849,"content":"            else -> \"0 m/s\""},{"type":"INSERT","lineNumber":850,"content":"        }"},{"type":"DELETE","lineNumber":852,"oldContent":"//            speed > 0f -> String.format(\"%.1f mm/s\", speed * 1000f)"}]},{"timestamp":1758695448852,"changes":[{"type":"MODIFY","lineNumber":111,"content":"                delay(1000)","oldContent":"        }"},{"type":"MODIFY","lineNumber":114,"content":"","oldContent":""},{"type":"MODIFY","lineNumber":162,"content":"                            setMessageRate(1u, 1f)   // SYS_STATUS","oldContent":"        scope.launch {"},{"type":"MODIFY","lineNumber":179,"content":"                    try {","oldContent":"        scope.launch {"},{"type":"DELETE","lineNumber":315,"oldContent":"                    when (message) {"},{"type":"DELETE","lineNumber":316,"oldContent":"                            val seq = message.seq.toInt()"},{"type":"DELETE","lineNumber":317,"oldContent":"                            if (seq < mission.size) {"},{"type":"INSERT","lineNumber":315,"content":"                            missionTimerJob?.cancel()"},{"type":"INSERT","lineNumber":316,"content":"                            missionTimerJob = scope.launch {"},{"type":"INSERT","lineNumber":317,"content":"                                var elapsed = 0L"},{"type":"DELETE","lineNumber":319,"oldContent":"                                    targetSystem = fcuSystemId,"},{"type":"DELETE","lineNumber":320,"oldContent":"                                    targetComponent = fcuComponentId,"},{"type":"INSERT","lineNumber":319,"content":"                                while (isActive && state.value.mode?.equals(\"Auto\", ignoreCase = true) == true && state.value.armed) {"},{"type":"INSERT","lineNumber":320,"content":"                                    delay(1000)"},{"type":"MODIFY","lineNumber":328,"content":"                        } else if ((lastMode?.equals(\"Auto\", ignoreCase = true) == true && mode != \"Auto\") ||","oldContent":"                        } else if ((lastMode?.equals(\"Auto\", ignoreCase = true) == true && mode != \"Auto\") || (lastArmed == true && !armed && mode.equals(\"Auto\", ignoreCase = true))) {"},{"type":"INSERT","lineNumber":329,"content":"                                   (lastArmed == true && armed == false && mode.equals(\"Auto\", ignoreCase = true))) {"},{"type":"DELETE","lineNumber":336,"oldContent":"                        is MissionAck -> {"},{"type":"DELETE","lineNumber":337,"oldContent":"                            Log.i(\"MavlinkRepo\", \"Mission upload acknowledged with result: ${message.type.value}\")"},{"type":"DELETE","lineNumber":338,"oldContent":"                                _state.update { it.copy(missionLoaded = true) }"},{"type":"DELETE","lineNumber":339,"oldContent":"                            }"},{"type":"DELETE","lineNumber":340,"oldContent":"                        }"},{"type":"INSERT","lineNumber":337,"content":"                        lastArmed = armed"},{"type":"INSERT","lineNumber":338,"content":"                    }"},{"type":"INSERT","lineNumber":339,"content":"                }"},{"type":"INSERT","lineNumber":340,"content":"        }"},{"type":"INSERT","lineNumber":341,"content":"        // SYS_STATUS"},{"type":"DELETE","lineNumber":431,"oldContent":"        }"},{"type":"INSERT","lineNumber":433,"content":"        }"},{"type":"DELETE","lineNumber":434,"oldContent":"    suspend fun arm() {"},{"type":"INSERT","lineNumber":436,"content":"    suspend fun arm() {"},{"type":"INSERT","lineNumber":615,"content":"            }"},{"type":"DELETE","lineNumber":615,"oldContent":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":667,"oldContent":"            Log.i(\"MavlinkRepo\", \"[Mission Start] Sending ARM command...\")"},{"type":"INSERT","lineNumber":668,"content":"            val perSeqMap = mutableMapOf<Int, CompletableDeferred<Unit>>()"},{"type":"DELETE","lineNumber":693,"oldContent":"            }"},{"type":"INSERT","lineNumber":695,"content":"            }"},{"type":"DELETE","lineNumber":710,"oldContent":""},{"type":"INSERT","lineNumber":712,"content":""},{"type":"DELETE","lineNumber":729,"oldContent":"                }"},{"type":"INSERT","lineNumber":731,"content":"                }"},{"type":"DELETE","lineNumber":736,"oldContent":""},{"type":"INSERT","lineNumber":738,"content":""},{"type":"DELETE","lineNumber":742,"oldContent":"    }"},{"type":"INSERT","lineNumber":744,"content":"    }"},{"type":"INSERT","lineNumber":801,"content":"    /**"},{"type":"DELETE","lineNumber":801,"oldContent":"    }"},{"type":"DELETE","lineNumber":807,"oldContent":"}"},{"type":"MODIFY","lineNumber":808,"content":"            command = MavCmd.MISSION_START.wrap(),","oldContent":"        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))"},{"type":"INSERT","lineNumber":809,"content":"            confirmation = 0u,"},{"type":"INSERT","lineNumber":816,"content":"            param7 = 0f"},{"type":"DELETE","lineNumber":816,"oldContent":"}"},{"type":"DELETE","lineNumber":818,"oldContent":"        return (R * c).toFloat()"},{"type":"MODIFY","lineNumber":819,"content":"    }","oldContent":"    suspend fun closeConnection() {"},{"type":"INSERT","lineNumber":821,"content":"    suspend fun closeConnection() {"},{"type":"INSERT","lineNumber":840,"content":"    }"},{"type":"DELETE","lineNumber":840,"oldContent":""},{"type":"INSERT","lineNumber":848,"content":"//            speed >= 0.01f -> String.format(\"%.1f cm/s\", speed * 100f)"},{"type":"DELETE","lineNumber":849,"oldContent":"//            speed >= 0.01f -> String.format(\"%.1f cm/s\", speed * 100f)"},{"type":"INSERT","lineNumber":857,"content":""}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/TopNavBar.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uimain/TopNavBar.kt","baseContent":"package com.example.aerogcsclone.uimain\n\nimport androidx.compose.foundation.background\nimport androidx.compose.foundation.clickable\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.shape.CircleShape\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.*\nimport androidx.compose.material3.DropdownMenu\nimport androidx.compose.material3.DropdownMenuItem\nimport androidx.compose.material3.Icon\nimport androidx.compose.material3.Text\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Brush\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.graphics.vector.ImageVector\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.unit.dp\nimport androidx.compose.ui.unit.sp\nimport androidx.compose.ui.window.Popup\nimport androidx.navigation.NavHostController\nimport com.example.aerogcsclone.Telemetry.TelemetryState\nimport com.example.aerogcsclone.authentication.AuthViewModel\nimport com.example.aerogcsclone.navigation.Screen\n\n@Composable\nfun TopNavBar(\n    telemetryState: TelemetryState,\n    authViewModel: AuthViewModel,\n    navController: NavHostController\n) {\n    var menuExpanded by remember { mutableStateOf(false) }\n    var kebabMenuExpanded by remember { mutableStateOf(false) }\n    var selectedMode by remember { mutableStateOf<String?>(null) } // null by default\n\n    Box(\n        modifier = Modifier\n            .fillMaxWidth()\n            .height(70.dp)\n            .background(\n                brush = Brush.horizontalGradient(\n                    colors = listOf(Color(0xFF87CEEB), Color(0xFF4A90E2))\n                )\n            )\n            .padding(horizontal = 12.dp),\n        contentAlignment = Alignment.CenterStart\n    ) {\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            verticalAlignment = Alignment.CenterVertically\n        ) {\n            // Hamburger menu\n            Box {\n                Icon(\n                    Icons.Default.Menu,\n                    contentDescription = \"Menu\",\n                    tint = Color.White,\n                    modifier = Modifier.clickable { menuExpanded = true }\n                )\n                if (menuExpanded) {\n                    Popup(onDismissRequest = { menuExpanded = false }) {\n                        Column(\n                            modifier = Modifier\n                                .background(Color.Black.copy(alpha = 0.5f))\n                                .width(180.dp)\n                                .padding(vertical = 8.dp, horizontal = 16.dp)\n                        ) {\n                            Text(\n                                text = \"Automatic\",\n                                color = Color.White,\n                                fontSize = 22.sp,\n                                modifier = Modifier\n                                    .padding(16.dp)\n                                    .clickable {\n                                        selectedMode = \"Automatic\"\n                                        menuExpanded = false\n                                        navController.navigate(Screen.Plan.route)\n                                    }\n                            )\n                            Text(\n                                text = \"Manual\",\n                                color = Color.White,\n                                fontSize = 22.sp,\n                                modifier = Modifier\n                                    .padding(16.dp)\n                                    .clickable {\n                                        selectedMode = \"Manual\"\n                                        menuExpanded = false\n                                    }\n                            )\n                        }\n                    }\n                }\n            }\n\n            Spacer(modifier = Modifier.width(12.dp))\n\n            // Home icon\n            Icon(\n                Icons.Default.Home,\n                contentDescription = \"Home\",\n                tint = Color.White,\n                modifier = Modifier.clickable {\n                    navController.navigate(Screen.Connection.route)\n                }\n            )\n\n            Spacer(modifier = Modifier.width(16.dp))\n\n            // Title & Mode\n            Column(\n                verticalArrangement = Arrangement.Center,\n                horizontalAlignment = Alignment.Start\n            ) {\n                Spacer(modifier = Modifier.height(10.dp))\n                Text(\n                    text = \"Pavaman Aviation\",\n                    color = Color.White,\n                    fontWeight = FontWeight.Bold,\n                    fontSize = 25.sp\n                )\n                Spacer(modifier = Modifier.height(2.dp))\n                // Show selected mode only if not null\n                selectedMode?.let {\n                    Text(\n                        text = it,\n                        color = Color.White.copy(alpha = 0.7f),\n                        fontSize = 15.sp\n                    )\n                }\n            }\n\n            Spacer(modifier = Modifier.weight(1f))\n\n            // Status & telemetry\n            Row(verticalAlignment = Alignment.CenterVertically) {\n                ConnectionStatusWidget(isConnected = telemetryState.connected)\n                DividerBlock()\n                InfoBlock(Icons.Default.Flight, \"13%\")\n                DividerBlock()\n                InfoBlock(Icons.Default.BatteryFull, \"${telemetryState.batteryPercent ?: \"N/A\"}%\")\n                DividerBlock()\n                InfoBlock(Icons.Default.Gamepad, \"100%\")\n                DividerBlock()\n                InfoBlockGroup(\n                    Icons.Default.Bolt,\n                    listOf(\n                        \"${telemetryState.voltage ?: \"N/A\"} V\",\n                        \"${telemetryState.currentA ?: \"N/A\"} A\"\n                    )\n                )\n                DividerBlock()\n                InfoBlockGroup(\n                    Icons.Default.SatelliteAlt,\n                    listOf(\n                        \"${telemetryState.sats ?: \"N/A\"} sats\",\n                        \"${telemetryState.hdop ?: \"N/A\"} hdop\"\n                    )\n                )\n                DividerBlock()\n                InfoBlockGroup(\n                    Icons.Default.Sync,\n                    listOf(\"${telemetryState.mode}\", if (telemetryState.armed) \"Armed\" else \"Disarmed\")\n                )\n                DividerBlock()\n\n                // Kebab menu\n                Box {\n                    Icon(\n                        Icons.Default.MoreVert,\n                        contentDescription = \"More\",\n                        tint = Color.White,\n                        modifier = Modifier.clickable { kebabMenuExpanded = true }\n                    )\n                    DropdownMenu(\n                        expanded = kebabMenuExpanded,\n                        onDismissRequest = { kebabMenuExpanded = false }\n                    ) {\n                        DropdownMenuItem(\n                            text = { Text(\"Settings\") },\n                            onClick = { kebabMenuExpanded = false }\n                        )\n                        DropdownMenuItem(\n                            text = { Text(\"About App\") },\n                            onClick = { kebabMenuExpanded = false }\n                        )\n                        DropdownMenuItem(\n                            text = { Text(\"Logout\") },\n                            onClick = {\n                                kebabMenuExpanded = false\n                                authViewModel.signout()\n                                navController.navigate(Screen.Login.route) {\n                                    popUpTo(0)\n                                }\n                            }\n                        )\n                    }\n                }\n            }\n        }\n    }\n}\n\n@Composable\nfun ConnectionStatusWidget(isConnected: Boolean) {\n    val statusColor = if (isConnected) Color.Green else Color.Red\n    val statusText = if (isConnected) \"Connected\" else \"Disconnected\"\n\n    Row(verticalAlignment = Alignment.CenterVertically) {\n        Box(\n            modifier = Modifier\n                .size(10.dp)\n                .background(statusColor, shape = CircleShape)\n        )\n        Spacer(modifier = Modifier.width(4.dp))\n        Text(statusText, color = Color.White, fontSize = 12.sp)\n    }\n}\n\n@Composable\nfun DividerBlock() {\n    Box(\n        modifier = Modifier\n            .padding(horizontal = 8.dp)\n            .width(1.dp)\n            .height(30.dp)\n            .background(Color.White.copy(alpha = 0.7f))\n    )\n}\n\n@Composable\nfun InfoBlock(icon: ImageVector, value: String) {\n    Column(\n        modifier = Modifier.padding(horizontal = 6.dp),\n        horizontalAlignment = Alignment.CenterHorizontally\n    ) {\n        Icon(icon, contentDescription = null, tint = Color.White, modifier = Modifier.size(18.dp))\n        Spacer(modifier = Modifier.height(2.dp))\n        Text(value, color = Color.White, fontSize = 12.sp)\n    }\n}\n\n@Composable\nfun InfoBlockGroup(icon: ImageVector, values: List<String>) {\n    Column(\n        modifier = Modifier.padding(horizontal = 6.dp),\n        horizontalAlignment = Alignment.CenterHorizontally\n    ) {\n        Icon(icon, contentDescription = null, tint = Color.White, modifier = Modifier.size(18.dp))\n        Spacer(modifier = Modifier.height(2.dp))\n        values.forEach { value ->\n            Text(value, color = Color.White, fontSize = 12.sp)\n        }\n    }\n}\n","baseTimestamp":1757924404905},"/Dummy.lcf":{"filePath":"/Dummy.lcf","baseContent":"","baseTimestamp":1757915507465,"deltas":[{"timestamp":1758019493931,"changes":[{"type":"MODIFY","lineNumber":0,"content":"MavLinkRepo","oldContent":"map"}]},{"timestamp":1758019614586,"changes":[{"type":"MODIFY","lineNumber":0,"content":"map","oldContent":"MavLinkRepo"}]},{"timestamp":1758084492800,"changes":[{"type":"MODIFY","lineNumber":0,"content":"MavLinkRepo","oldContent":"map"}]},{"timestamp":1758172836250,"changes":[{"type":"MODIFY","lineNumber":0,"content":"","oldContent":"MavLinkRepo"}]},{"timestamp":1758172842819,"changes":[{"type":"MODIFY","lineNumber":0,"content":"MavLinkRepo","oldContent":""}]},{"timestamp":1758172846084,"changes":[{"type":"MODIFY","lineNumber":0,"content":"","oldContent":"MavLinkRepo"}]},{"timestamp":1758177586874,"changes":[{"type":"MODIFY","lineNumber":0,"content":"MavLinkRepo","oldContent":""}]},{"timestamp":1758177595413,"changes":[{"type":"MODIFY","lineNumber":0,"content":"package:mine ","oldContent":"MavLinkRepo"}]},{"timestamp":1758177620537,"changes":[{"type":"MODIFY","lineNumber":0,"content":"mode","oldContent":"package:mine "}]},{"timestamp":1758177629756,"changes":[{"type":"MODIFY","lineNumber":0,"content":"MavLinkRepo","oldContent":"mode"}]},{"timestamp":1758177649007,"changes":[{"type":"MODIFY","lineNumber":0,"content":"package:mine ","oldContent":"MavLinkRepo"}]},{"timestamp":1758177837677,"changes":[{"type":"MODIFY","lineNumber":0,"content":"MavLinkRepo","oldContent":"package:mine "}]},{"timestamp":1758178186764,"changes":[{"type":"MODIFY","lineNumber":0,"content":"package:mine ","oldContent":"MavLinkRepo"}]},{"timestamp":1758188261184,"changes":[{"type":"MODIFY","lineNumber":0,"content":"map","oldContent":"package:mine "}]},{"timestamp":1758608284753,"changes":[{"type":"MODIFY","lineNumber":0,"content":"mode","oldContent":"map"}]},{"timestamp":1758608290386,"changes":[{"type":"MODIFY","lineNumber":0,"content":"package:mine ","oldContent":"mode"}]},{"timestamp":1758608294557,"changes":[{"type":"MODIFY","lineNumber":0,"content":"package:MavlinkRepo","oldContent":"package:mine "}]},{"timestamp":1758608303882,"changes":[{"type":"MODIFY","lineNumber":0,"content":"package:mine ","oldContent":"package:MavlinkRepo"}]},{"timestamp":1758608543337,"changes":[{"type":"MODIFY","lineNumber":0,"content":"","oldContent":"package:mine "}]},{"timestamp":1758608550128,"changes":[{"type":"MODIFY","lineNumber":0,"content":"MavlinkRepo","oldContent":""}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/MavMode.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/MavMode.kt","baseContent":"package com.example.aerogcsclone.Telemetry\n\ndata class MavMode {\n}","baseTimestamp":1758003545093,"deltas":[{"timestamp":1758003550062,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"data class MavMode {"},{"type":"DELETE","lineNumber":3,"oldContent":"}"},{"type":"INSERT","lineNumber":2,"content":"data class MavMode()"}]},{"timestamp":1758003552620,"changes":[{"type":"MODIFY","lineNumber":2,"content":"data class MavMode(val value: UInt)","oldContent":"data class MavMode()"}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/Data.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/Data.kt","baseContent":"package com.example.aerogcsclone.Telemetry\n\ndata class TelemetryState(\n\n    val connected : Boolean = false,\n    val fcuDetected : Boolean = false,\n    //Altitude\n    val altitudeMsl: Float? = null,\n    val altitudeRelative: Float? = null,\n    //Speeds\n    val airspeed: Float? = null,\n    val groundspeed: Float? = null,\n    //Battery\n    val voltage: Float? = null,\n    val batteryPercent: Int? = null,\n    val currentA : Float? = null,\n    //Sat count and HDOP\n    val sats : Int? = null,\n    val hdop : Float? = null,\n    //Latitude and Longitude\n    val latitude : Double?= null,\n    val longitude : Double? = null,\n\n    val mode: String? = null,\n    val armed: Boolean = false,\n    val armable: Boolean = false,\n    // Mission timer (seconds elapsed since mission start, null if not running)\n    val missionElapsedSec: Long? = null,\n)","baseTimestamp":1758183940115,"deltas":[{"timestamp":1758185778268,"changes":[{"type":"INSERT","lineNumber":28,"content":"    val missionCompleted: Boolean = false,"}]},{"timestamp":1758187550384,"changes":[{"type":"INSERT","lineNumber":29,"content":"    val totalDistanceMeters: Float? = null"}]},{"timestamp":1758606402414,"changes":[{"type":"MODIFY","lineNumber":29,"content":"    val totalDistanceMeters: Float? = null,","oldContent":"    val totalDistanceMeters: Float? = null"},{"type":"INSERT","lineNumber":30,"content":"    // Formatted speed values for UI"},{"type":"INSERT","lineNumber":31,"content":"    val formattedAirspeed: String? = null,"},{"type":"INSERT","lineNumber":32,"content":"    val formattedGroundspeed: String? = null"}]},{"timestamp":1758686783465,"changes":[{"type":"DELETE","lineNumber":31,"oldContent":")"},{"type":"MODIFY","lineNumber":32,"content":"    val formattedGroundspeed: String? = null,","oldContent":"    val formattedGroundspeed: String? = null"},{"type":"INSERT","lineNumber":33,"content":"    val heading: Float? = null"},{"type":"INSERT","lineNumber":34,"content":")"}]},{"timestamp":1758695347213,"changes":[{"type":"INSERT","lineNumber":28,"content":"    val lastMissionElapsedSec: Long? = null,"},{"type":"INSERT","lineNumber":32,"content":"    val formattedAirspeed: String? = null,"},{"type":"DELETE","lineNumber":33,"oldContent":"    val formattedGroundspeed: String? = null"}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uiconnection/ConnectionPage.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/uiconnection/ConnectionPage.kt","baseContent":"package com.example.aerogcsclone.uiconnection\n\nimport androidx.compose.foundation.background\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.text.style.TextAlign\nimport androidx.compose.ui.unit.dp\nimport androidx.navigation.NavController\nimport com.example.aerogcsclone.Telemetry.SharedViewModel\nimport com.example.aerogcsclone.navigation.Screen\nimport kotlinx.coroutines.flow.collectLatest\nimport kotlinx.coroutines.launch\n\n@Composable\nfun ConnectionPage(navController: NavController, viewModel: SharedViewModel) {\n    var isConnecting by remember { mutableStateOf(false) }\n    var errorMessage by remember { mutableStateOf(\"\") }\n    val coroutineScope = rememberCoroutineScope()\n\n    LaunchedEffect(viewModel) {\n        viewModel.isConnected.collectLatest { isConnected ->\n            if (isConnected) {\n                navController.navigate(Screen.Main.route) {\n                    popUpTo(Screen.Connection.route) { inclusive = true }\n                }\n            }\n        }\n    }\n\n    Box(\n        modifier = Modifier\n            .fillMaxSize()\n            .background(Color(0xFF535350))\n            .padding(20.dp),\n        contentAlignment = Alignment.Center\n    ) {\n        Column(\n            horizontalAlignment = Alignment.CenterHorizontally,\n            verticalArrangement = Arrangement.Center\n        ) {\n            Text(\n                \"Connect to Drone\",\n                style = MaterialTheme.typography.headlineMedium,\n                color = Color.White\n            )\n\n            Spacer(modifier = Modifier.height(20.dp))\n\n            val ipAddress by viewModel.ipAddress\n            val port by viewModel.port\n\n            OutlinedTextField(\n                value = ipAddress,\n                onValueChange = { viewModel.onIpAddressChange(it) },\n                label = { Text(\"IP Address\", color = Color.White) },\n                modifier = Modifier.fillMaxWidth(),\n                textStyle = LocalTextStyle.current.copy(color = Color.White)\n            )\n\n            Spacer(modifier = Modifier.height(12.dp))\n\n            OutlinedTextField(\n                value = port,\n                onValueChange = { viewModel.onPortChange(it) },\n                label = { Text(\"Port\", color = Color.White) },\n                modifier = Modifier.fillMaxWidth(),\n                textStyle = LocalTextStyle.current.copy(color = Color.White)\n            )\n\n\n            Spacer(modifier = Modifier.height(20.dp))\n\n            Button(\n                onClick = {\n                    isConnecting = true\n                    errorMessage = \"\"\n                    coroutineScope.launch {\n                        try {\n                            viewModel.connect()\n                        } catch (e: Exception) {\n                            errorMessage = e.message ?: \"Connection failed\"\n                            isConnecting = false\n                        }\n                    }\n                },\n                modifier = Modifier.fillMaxWidth(),\n                enabled = !isConnecting\n            ) {\n                Text(if (isConnecting) \"Connecting...\" else \"Connect\")\n            }\n\n            if (errorMessage.isNotEmpty()) {\n                Spacer(modifier = Modifier.height(10.dp))\n                Text(errorMessage, color = MaterialTheme.colorScheme.error)\n            }\n        }\n    }\n}\n","baseTimestamp":1758187312320,"deltas":[{"timestamp":1758276929204,"changes":[{"type":"INSERT","lineNumber":2,"content":"import android.widget.Toast"},{"type":"INSERT","lineNumber":10,"content":"import androidx.compose.ui.platform.LocalContext"},{"type":"INSERT","lineNumber":16,"content":"import kotlinx.coroutines.Job"},{"type":"INSERT","lineNumber":17,"content":"import kotlinx.coroutines.delay"},{"type":"INSERT","lineNumber":26,"content":"    var connectionJob by remember { mutableStateOf<Job?>(null) }"},{"type":"INSERT","lineNumber":27,"content":"    val context = LocalContext.current"},{"type":"INSERT","lineNumber":28,"content":"    var showPopup by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":33,"content":"                isConnecting = false"},{"type":"INSERT","lineNumber":34,"content":"                connectionJob?.cancel()"},{"type":"INSERT","lineNumber":42,"content":"    fun startConnection(autoRetry: Boolean = false) {"},{"type":"INSERT","lineNumber":43,"content":"        isConnecting = true"},{"type":"INSERT","lineNumber":44,"content":"        errorMessage = \"\""},{"type":"INSERT","lineNumber":45,"content":"        connectionJob?.cancel()"},{"type":"INSERT","lineNumber":46,"content":"        connectionJob = coroutineScope.launch {"},{"type":"INSERT","lineNumber":47,"content":"            var attempts = 0"},{"type":"INSERT","lineNumber":48,"content":"            val maxAttempts = if (autoRetry) 3 else 1"},{"type":"INSERT","lineNumber":49,"content":"            while (attempts < maxAttempts && !viewModel.isConnected.value) {"},{"type":"INSERT","lineNumber":50,"content":"                try {"},{"type":"INSERT","lineNumber":51,"content":"                    viewModel.connect()"},{"type":"INSERT","lineNumber":52,"content":"                } catch (e: Exception) {"},{"type":"INSERT","lineNumber":53,"content":"                    errorMessage = e.message ?: \"Connection failed\""},{"type":"INSERT","lineNumber":54,"content":"                }"},{"type":"INSERT","lineNumber":55,"content":"                attempts++"},{"type":"INSERT","lineNumber":56,"content":"                if (!viewModel.isConnected.value && autoRetry && attempts < maxAttempts) {"},{"type":"INSERT","lineNumber":57,"content":"                    delay(5000)"},{"type":"INSERT","lineNumber":58,"content":"                }"},{"type":"INSERT","lineNumber":59,"content":"            }"},{"type":"INSERT","lineNumber":60,"content":"            if (!viewModel.isConnected.value) {"},{"type":"INSERT","lineNumber":61,"content":"                isConnecting = false"},{"type":"INSERT","lineNumber":62,"content":"                showPopup = true"},{"type":"INSERT","lineNumber":63,"content":"            }"},{"type":"INSERT","lineNumber":64,"content":"        }"},{"type":"INSERT","lineNumber":65,"content":"    }"},{"type":"INSERT","lineNumber":66,"content":""},{"type":"INSERT","lineNumber":67,"content":"    fun cancelConnection() {"},{"type":"INSERT","lineNumber":68,"content":"        connectionJob?.cancel()"},{"type":"INSERT","lineNumber":69,"content":"        isConnecting = false"},{"type":"INSERT","lineNumber":70,"content":"        errorMessage = \"\""},{"type":"INSERT","lineNumber":71,"content":"        viewModel.cancelConnection()"},{"type":"INSERT","lineNumber":72,"content":"    }"},{"type":"INSERT","lineNumber":73,"content":""},{"type":"DELETE","lineNumber":73,"oldContent":""},{"type":"INSERT","lineNumber":116,"content":"            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {"},{"type":"INSERT","lineNumber":117,"content":"                Button("},{"type":"INSERT","lineNumber":118,"content":"                    onClick = { startConnection(autoRetry = true) },"},{"type":"INSERT","lineNumber":119,"content":"                    modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":120,"content":"                    enabled = !isConnecting"},{"type":"INSERT","lineNumber":121,"content":"                ) {"},{"type":"INSERT","lineNumber":122,"content":"                    Text(if (isConnecting) \"Connecting...\" else \"Connect\")"},{"type":"INSERT","lineNumber":123,"content":"                }"},{"type":"INSERT","lineNumber":124,"content":"                Spacer(modifier = Modifier.width(12.dp))"},{"type":"INSERT","lineNumber":125,"content":"                Button("},{"type":"INSERT","lineNumber":126,"content":"                    onClick = { startConnection(autoRetry = false) },"},{"type":"INSERT","lineNumber":127,"content":"                    modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":128,"content":"                    enabled = !isConnecting"},{"type":"INSERT","lineNumber":129,"content":"                ) {"},{"type":"INSERT","lineNumber":130,"content":"                    Text(\"Retry\")"},{"type":"INSERT","lineNumber":131,"content":"                }"},{"type":"INSERT","lineNumber":132,"content":"            }"},{"type":"INSERT","lineNumber":133,"content":""},{"type":"INSERT","lineNumber":134,"content":"            Spacer(modifier = Modifier.height(12.dp))"},{"type":"INSERT","lineNumber":135,"content":""},{"type":"DELETE","lineNumber":77,"oldContent":"                onClick = {"},{"type":"DELETE","lineNumber":78,"oldContent":"                    isConnecting = true"},{"type":"DELETE","lineNumber":79,"oldContent":"                    errorMessage = \"\""},{"type":"DELETE","lineNumber":80,"oldContent":"                    coroutineScope.launch {"},{"type":"DELETE","lineNumber":81,"oldContent":"                        try {"},{"type":"DELETE","lineNumber":82,"oldContent":"                            viewModel.connect()"},{"type":"DELETE","lineNumber":83,"oldContent":"                        } catch (e: Exception) {"},{"type":"DELETE","lineNumber":84,"oldContent":"                            errorMessage = e.message ?: \"Connection failed\""},{"type":"DELETE","lineNumber":85,"oldContent":"                            isConnecting = false"},{"type":"DELETE","lineNumber":86,"oldContent":"                        }"},{"type":"DELETE","lineNumber":87,"oldContent":"                    }"},{"type":"DELETE","lineNumber":88,"oldContent":"                },"},{"type":"INSERT","lineNumber":137,"content":"                onClick = { cancelConnection() },"},{"type":"DELETE","lineNumber":90,"oldContent":"                enabled = !isConnecting"},{"type":"INSERT","lineNumber":139,"content":"                enabled = isConnecting"},{"type":"DELETE","lineNumber":92,"oldContent":"                Text(if (isConnecting) \"Connecting...\" else \"Connect\")"},{"type":"INSERT","lineNumber":141,"content":"                Text(\"Cancel\")"},{"type":"INSERT","lineNumber":149,"content":"        if (showPopup) {"},{"type":"INSERT","lineNumber":150,"content":"            AlertDialog("},{"type":"INSERT","lineNumber":151,"content":"                onDismissRequest = { showPopup = false },"},{"type":"INSERT","lineNumber":152,"content":"                title = { Text(\"Connection Failed\") },"},{"type":"INSERT","lineNumber":153,"content":"                text = { Text(\"Unable to connect to the drone after multiple attempts.\") },"},{"type":"INSERT","lineNumber":154,"content":"                confirmButton = {"},{"type":"INSERT","lineNumber":155,"content":"                    Button(onClick = { showPopup = false }) {"},{"type":"INSERT","lineNumber":156,"content":"                        Text(\"OK\")"},{"type":"INSERT","lineNumber":157,"content":"                    }"},{"type":"INSERT","lineNumber":158,"content":"                }"},{"type":"INSERT","lineNumber":159,"content":"            )"},{"type":"INSERT","lineNumber":160,"content":"        }"}]},{"timestamp":1758277050672,"changes":[{"type":"DELETE","lineNumber":2,"oldContent":"import android.widget.Toast"},{"type":"DELETE","lineNumber":10,"oldContent":"import androidx.compose.ui.text.style.TextAlign"},{"type":"INSERT","lineNumber":14,"content":"import kotlinx.coroutines.Job"},{"type":"INSERT","lineNumber":15,"content":"import kotlinx.coroutines.delay"},{"type":"DELETE","lineNumber":18,"oldContent":"import kotlinx.coroutines.Job"},{"type":"DELETE","lineNumber":20,"oldContent":"import kotlinx.coroutines.delay"},{"type":"INSERT","lineNumber":24,"content":"    var connectionJob by remember { mutableStateOf<Job?>(null) }"},{"type":"INSERT","lineNumber":25,"content":"    var showPopup by remember { mutableStateOf(false) }"},{"type":"MODIFY","lineNumber":30,"content":"                isConnecting = false","oldContent":"    var connectionJob by remember { mutableStateOf<Job?>(null) }"},{"type":"INSERT","lineNumber":31,"content":"                connectionJob?.cancel()"},{"type":"DELETE","lineNumber":32,"oldContent":"    val context = LocalContext.current"},{"type":"DELETE","lineNumber":34,"oldContent":"    var showPopup by remember { mutableStateOf(false) }"},{"type":"INSERT","lineNumber":39,"content":"    fun startConnection(autoRetry: Boolean = false) {"},{"type":"INSERT","lineNumber":40,"content":"        isConnecting = true"},{"type":"INSERT","lineNumber":41,"content":"        errorMessage = \"\""},{"type":"INSERT","lineNumber":42,"content":"        connectionJob?.cancel()"},{"type":"INSERT","lineNumber":43,"content":"        connectionJob = coroutineScope.launch {"},{"type":"INSERT","lineNumber":44,"content":"            var attempts = 0"},{"type":"INSERT","lineNumber":45,"content":"            val maxAttempts = if (autoRetry) 3 else 1"},{"type":"INSERT","lineNumber":46,"content":"            while (attempts < maxAttempts && !viewModel.isConnected.value) {"},{"type":"INSERT","lineNumber":47,"content":"                try {"},{"type":"INSERT","lineNumber":48,"content":"                    viewModel.connect()"},{"type":"INSERT","lineNumber":49,"content":"                } catch (e: Exception) {"},{"type":"INSERT","lineNumber":50,"content":"                    errorMessage = e.message ?: \"Connection failed\""},{"type":"INSERT","lineNumber":51,"content":"                }"},{"type":"INSERT","lineNumber":52,"content":"                attempts++"},{"type":"INSERT","lineNumber":53,"content":"                if (!viewModel.isConnected.value && autoRetry && attempts < maxAttempts) {"},{"type":"INSERT","lineNumber":54,"content":"                    delay(5000)"},{"type":"INSERT","lineNumber":55,"content":"                }"},{"type":"INSERT","lineNumber":56,"content":"            }"},{"type":"INSERT","lineNumber":57,"content":"            if (!viewModel.isConnected.value) {"},{"type":"INSERT","lineNumber":59,"content":"                showPopup = true"},{"type":"INSERT","lineNumber":60,"content":"            }"},{"type":"INSERT","lineNumber":61,"content":"        }"},{"type":"INSERT","lineNumber":62,"content":"    }"},{"type":"INSERT","lineNumber":63,"content":""},{"type":"INSERT","lineNumber":64,"content":"    fun cancelConnection() {"},{"type":"INSERT","lineNumber":65,"content":"        connectionJob?.cancel()"},{"type":"INSERT","lineNumber":66,"content":"        isConnecting = false"},{"type":"INSERT","lineNumber":67,"content":"        errorMessage = \"\""},{"type":"INSERT","lineNumber":68,"content":"        coroutineScope.launch {"},{"type":"INSERT","lineNumber":69,"content":"            viewModel.cancelConnection()"},{"type":"INSERT","lineNumber":70,"content":"        }"},{"type":"INSERT","lineNumber":71,"content":"    }"},{"type":"INSERT","lineNumber":72,"content":""},{"type":"DELETE","lineNumber":42,"oldContent":"                connectionJob?.cancel()"},{"type":"DELETE","lineNumber":51,"oldContent":"    fun startConnection(autoRetry: Boolean = false) {"},{"type":"DELETE","lineNumber":53,"oldContent":"        isConnecting = true"},{"type":"DELETE","lineNumber":55,"oldContent":"        errorMessage = \"\""},{"type":"DELETE","lineNumber":57,"oldContent":"        connectionJob?.cancel()"},{"type":"DELETE","lineNumber":59,"oldContent":"        connectionJob = coroutineScope.launch {"},{"type":"DELETE","lineNumber":61,"oldContent":"            var attempts = 0"},{"type":"DELETE","lineNumber":63,"oldContent":"            val maxAttempts = if (autoRetry) 3 else 1"},{"type":"DELETE","lineNumber":65,"oldContent":"            while (attempts < maxAttempts && !viewModel.isConnected.value) {"},{"type":"DELETE","lineNumber":67,"oldContent":"                try {"},{"type":"DELETE","lineNumber":69,"oldContent":"                    viewModel.connect()"},{"type":"DELETE","lineNumber":71,"oldContent":"                } catch (e: Exception) {"},{"type":"DELETE","lineNumber":73,"oldContent":"                    errorMessage = e.message ?: \"Connection failed\""},{"type":"DELETE","lineNumber":75,"oldContent":"                }"},{"type":"DELETE","lineNumber":77,"oldContent":"                attempts++"},{"type":"DELETE","lineNumber":79,"oldContent":"                if (!viewModel.isConnected.value && autoRetry && attempts < maxAttempts) {"},{"type":"DELETE","lineNumber":81,"oldContent":"                    delay(5000)"},{"type":"DELETE","lineNumber":83,"oldContent":"                }"},{"type":"DELETE","lineNumber":85,"oldContent":"            }"},{"type":"DELETE","lineNumber":87,"oldContent":"            if (!viewModel.isConnected.value) {"},{"type":"DELETE","lineNumber":89,"oldContent":"                isConnecting = false"},{"type":"DELETE","lineNumber":91,"oldContent":"                showPopup = true"},{"type":"DELETE","lineNumber":93,"oldContent":"            }"},{"type":"DELETE","lineNumber":95,"oldContent":"        }"},{"type":"DELETE","lineNumber":97,"oldContent":"    }"},{"type":"DELETE","lineNumber":99,"oldContent":""},{"type":"DELETE","lineNumber":101,"oldContent":"    fun cancelConnection() {"},{"type":"DELETE","lineNumber":103,"oldContent":"        connectionJob?.cancel()"},{"type":"DELETE","lineNumber":105,"oldContent":"        isConnecting = false"},{"type":"DELETE","lineNumber":107,"oldContent":"        errorMessage = \"\""},{"type":"DELETE","lineNumber":109,"oldContent":"        viewModel.cancelConnection()"},{"type":"DELETE","lineNumber":111,"oldContent":"    }"},{"type":"DELETE","lineNumber":113,"oldContent":""},{"type":"INSERT","lineNumber":115,"content":"            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {"},{"type":"INSERT","lineNumber":116,"content":"                Button("},{"type":"INSERT","lineNumber":117,"content":"                    onClick = { startConnection(autoRetry = true) },"},{"type":"INSERT","lineNumber":118,"content":"                    modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":119,"content":"                    enabled = !isConnecting"},{"type":"INSERT","lineNumber":120,"content":"                ) {"},{"type":"INSERT","lineNumber":121,"content":"                    Text(if (isConnecting) \"Connecting...\" else \"Connect\")"},{"type":"INSERT","lineNumber":122,"content":"                }"},{"type":"INSERT","lineNumber":123,"content":"                Spacer(modifier = Modifier.width(12.dp))"},{"type":"INSERT","lineNumber":124,"content":"                Button("},{"type":"INSERT","lineNumber":125,"content":"                    onClick = { startConnection(autoRetry = false) },"},{"type":"INSERT","lineNumber":126,"content":"                    modifier = Modifier.weight(1f),"},{"type":"INSERT","lineNumber":127,"content":"                    enabled = !isConnecting"},{"type":"INSERT","lineNumber":128,"content":"                ) {"},{"type":"INSERT","lineNumber":129,"content":"                    Text(\"Retry\")"},{"type":"INSERT","lineNumber":130,"content":"                }"},{"type":"INSERT","lineNumber":131,"content":"            }"},{"type":"INSERT","lineNumber":132,"content":""},{"type":"INSERT","lineNumber":133,"content":"            Spacer(modifier = Modifier.height(12.dp))"},{"type":"INSERT","lineNumber":134,"content":""},{"type":"INSERT","lineNumber":136,"content":"                onClick = { cancelConnection() },"},{"type":"INSERT","lineNumber":138,"content":"                enabled = isConnecting"},{"type":"INSERT","lineNumber":140,"content":"                Text(\"Cancel\")"},{"type":"INSERT","lineNumber":148,"content":"        if (showPopup) {"},{"type":"INSERT","lineNumber":149,"content":"            AlertDialog("},{"type":"INSERT","lineNumber":150,"content":"                onDismissRequest = { showPopup = false },"},{"type":"INSERT","lineNumber":151,"content":"                title = { Text(\"Connection Failed\") },"},{"type":"INSERT","lineNumber":152,"content":"                text = { Text(\"Unable to connect to the drone after multiple attempts.\") },"},{"type":"INSERT","lineNumber":153,"content":"                confirmButton = {"},{"type":"INSERT","lineNumber":154,"content":"                    Button(onClick = { showPopup = false }) {"},{"type":"INSERT","lineNumber":155,"content":"                        Text(\"OK\")"},{"type":"INSERT","lineNumber":156,"content":"                    }"},{"type":"INSERT","lineNumber":157,"content":"                }"},{"type":"INSERT","lineNumber":158,"content":"            )"},{"type":"INSERT","lineNumber":159,"content":"        }"},{"type":"DELETE","lineNumber":129,"oldContent":"        }"},{"type":"DELETE","lineNumber":130,"oldContent":"            )"},{"type":"DELETE","lineNumber":131,"oldContent":"                }"},{"type":"DELETE","lineNumber":132,"oldContent":"                    }"},{"type":"DELETE","lineNumber":133,"oldContent":"                        Text(\"OK\")"},{"type":"DELETE","lineNumber":134,"oldContent":"                    Button(onClick = { showPopup = false }) {"},{"type":"DELETE","lineNumber":135,"oldContent":"                confirmButton = {"},{"type":"DELETE","lineNumber":136,"oldContent":"                text = { Text(\"Unable to connect to the drone after multiple attempts.\") },"},{"type":"DELETE","lineNumber":137,"oldContent":"                title = { Text(\"Connection Failed\") },"},{"type":"DELETE","lineNumber":138,"oldContent":"                onDismissRequest = { showPopup = false },"},{"type":"DELETE","lineNumber":139,"oldContent":"            AlertDialog("},{"type":"DELETE","lineNumber":140,"oldContent":"        if (showPopup) {"},{"type":"DELETE","lineNumber":141,"oldContent":"                Text(\"Cancel\")"},{"type":"DELETE","lineNumber":142,"oldContent":"            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {"},{"type":"DELETE","lineNumber":143,"oldContent":"                enabled = isConnecting"},{"type":"DELETE","lineNumber":144,"oldContent":"                Button("},{"type":"DELETE","lineNumber":145,"oldContent":"                onClick = { cancelConnection() },"},{"type":"DELETE","lineNumber":146,"oldContent":"                    onClick = { startConnection(autoRetry = true) },"},{"type":"DELETE","lineNumber":147,"oldContent":""},{"type":"DELETE","lineNumber":148,"oldContent":"                    modifier = Modifier.weight(1f),"},{"type":"DELETE","lineNumber":149,"oldContent":"            Spacer(modifier = Modifier.height(12.dp))"},{"type":"DELETE","lineNumber":150,"oldContent":"                    enabled = !isConnecting"},{"type":"DELETE","lineNumber":151,"oldContent":""},{"type":"DELETE","lineNumber":152,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":153,"oldContent":"            }"},{"type":"DELETE","lineNumber":154,"oldContent":"                    Text(if (isConnecting) \"Connecting...\" else \"Connect\")"},{"type":"DELETE","lineNumber":155,"oldContent":"                }"},{"type":"DELETE","lineNumber":156,"oldContent":"                }"},{"type":"DELETE","lineNumber":157,"oldContent":"                    Text(\"Retry\")"},{"type":"DELETE","lineNumber":158,"oldContent":"                Spacer(modifier = Modifier.width(12.dp))"},{"type":"DELETE","lineNumber":159,"oldContent":"                ) {"},{"type":"DELETE","lineNumber":160,"oldContent":"                Button("},{"type":"DELETE","lineNumber":161,"oldContent":"                    enabled = !isConnecting"},{"type":"DELETE","lineNumber":162,"oldContent":"                    onClick = { startConnection(autoRetry = false) },"},{"type":"DELETE","lineNumber":163,"oldContent":"                    modifier = Modifier.weight(1f),"}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/.gitignore":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/.gitignore","baseContent":"# Gradle\n.gradle/\nbuild/\ncaptures/\n.externalNativeBuild/\n.cxx/\n\n# Android Studio/IntelliJ\n.idea/\n*.iml\n\n# Local configuration (SDK/keystore, do not share!)\nlocal.properties\n\n# Mac/Windows system files\n.DS_Store\nThumbs.db\n\n# NDK / generated files\nobj/\ngen/\nout/\n","baseTimestamp":1758520711154},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridWaypoint.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridWaypoint.kt","baseContent":"package com.example.aerogcsclone.grid\n\nimport com.google.android.gms.maps.model.LatLng\n\n/**\n * Represents a waypoint in a grid survey mission\n */\ndata class GridWaypoint(\n    val position: LatLng,\n    val altitude: Float,\n    val speed: Float? = null,\n    val isLineStart: Boolean = false,\n    val isLineEnd: Boolean = false,\n    val lineIndex: Int = 0\n)\n\n/**\n * Grid survey parameters\n */\ndata class GridSurveyParams(\n    val lineSpacing: Float = 30f,     // meters\n    val gridAngle: Float = 0f,        // degrees from north\n    val speed: Float = 10f,           // m/s\n    val altitude: Float = 60f,        // meters\n    val includeSpeedCommands: Boolean = true\n)\n\n/**\n * Result of grid generation\n */\ndata class GridSurveyResult(\n    val waypoints: List<GridWaypoint>,\n    val gridLines: List<Pair<LatLng, LatLng>>, // For visualization\n    val totalDistance: Double, // meters\n    val estimatedTime: Double, // seconds\n    val numLines: Int\n)\n","baseTimestamp":1758607115718},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridUtils.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridUtils.kt","baseContent":"package com.example.aerogcsclone.grid\n\nimport com.google.android.gms.maps.model.LatLng\nimport kotlin.math.*\n\n/**\n * Utility functions for grid calculations\n */\nobject GridUtils {\n\n    /**\n     * Calculate distance between two points using Haversine formula\n     * @param a First point\n     * @param b Second point\n     * @return Distance in meters\n     */\n    fun haversineDistance(a: LatLng, b: LatLng): Double {\n        val R = 6371000.0 // Earth radius in meters\n        val dLat = Math.toRadians(b.latitude - a.latitude)\n        val dLng = Math.toRadians(b.longitude - a.longitude)\n        val lat1 = Math.toRadians(a.latitude)\n        val lat2 = Math.toRadians(b.latitude)\n        \n        val aHarv = sin(dLat / 2) * sin(dLat / 2) +\n                cos(lat1) * cos(lat2) *\n                sin(dLng / 2) * sin(dLng / 2)\n        val c = 2 * atan2(sqrt(aHarv), sqrt(1 - aHarv))\n        return R * c\n    }\n\n    /**\n     * Move a point by dx, dy meters (approximate for small distances)\n     * @param point Original point\n     * @param dx Distance to move east (meters)\n     * @param dy Distance to move north (meters)\n     * @return New point\n     */\n    fun moveLatLng(point: LatLng, dx: Double, dy: Double): LatLng {\n        val dLat = dy / 111111.0 // Approximate meters per degree latitude\n        val dLng = dx / (111111.0 * cos(Math.toRadians(point.latitude)))\n        return LatLng(point.latitude + dLat, point.longitude + dLng)\n    }\n\n    /**\n     * Calculate the bearing (angle) from point A to point B\n     * @param from Starting point\n     * @param to Ending point\n     * @return Bearing in degrees (0-360, where 0 = North)\n     */\n    fun calculateBearing(from: LatLng, to: LatLng): Double {\n        val lat1 = Math.toRadians(from.latitude)\n        val lat2 = Math.toRadians(to.latitude)\n        val dLng = Math.toRadians(to.longitude - from.longitude)\n\n        val y = sin(dLng) * cos(lat2)\n        val x = cos(lat1) * sin(lat2) - sin(lat1) * cos(lat2) * cos(dLng)\n\n        val bearing = Math.toDegrees(atan2(y, x))\n        return (bearing + 360) % 360\n    }\n\n    /**\n     * Find the centroid (center) of a polygon\n     * @param polygon List of points defining the polygon\n     * @return Center point\n     */\n    fun calculatePolygonCenter(polygon: List<LatLng>): LatLng {\n        var lat = 0.0\n        var lng = 0.0\n        \n        polygon.forEach { point ->\n            lat += point.latitude\n            lng += point.longitude\n        }\n        \n        return LatLng(lat / polygon.size, lng / polygon.size)\n    }\n\n    /**\n     * Calculate the bounding box of a polygon\n     * @param polygon List of points\n     * @return Pair of (southwest corner, northeast corner)\n     */\n    fun calculateBoundingBox(polygon: List<LatLng>): Pair<LatLng, LatLng> {\n        val minLat = polygon.minOf { it.latitude }\n        val maxLat = polygon.maxOf { it.latitude }\n        val minLng = polygon.minOf { it.longitude }\n        val maxLng = polygon.maxOf { it.longitude }\n        \n        return Pair(\n            LatLng(minLat, minLng), // Southwest\n            LatLng(maxLat, maxLng)  // Northeast\n        )\n    }\n\n    /**\n     * Find the angle of the longest side of a polygon (for auto grid angle)\n     * @param polygon List of points\n     * @return Angle in degrees\n     */\n    fun getAngleOfLongestSide(polygon: List<LatLng>): Double {\n        if (polygon.size < 2) return 0.0\n        \n        var maxDistance = 0.0\n        var longestSideAngle = 0.0\n        \n        for (i in polygon.indices) {\n            val current = polygon[i]\n            val next = polygon[(i + 1) % polygon.size]\n            val distance = haversineDistance(current, next)\n            \n            if (distance > maxDistance) {\n                maxDistance = distance\n                longestSideAngle = calculateBearing(current, next)\n            }\n        }\n        \n        return longestSideAngle\n    }\n\n    /**\n     * Check if a point is inside a polygon using ray casting algorithm\n     * @param point Point to check\n     * @param polygon Polygon vertices\n     * @return True if point is inside polygon\n     */\n    fun isPointInPolygon(point: LatLng, polygon: List<LatLng>): Boolean {\n        if (polygon.size < 3) return false\n        \n        var inside = false\n        var j = polygon.size - 1\n        \n        for (i in polygon.indices) {\n            val xi = polygon[i].longitude\n            val yi = polygon[i].latitude\n            val xj = polygon[j].longitude\n            val yj = polygon[j].latitude\n            \n            if (((yi > point.latitude) != (yj > point.latitude)) &&\n                (point.longitude < (xj - xi) * (point.latitude - yi) / (yj - yi) + xi)) {\n                inside = !inside\n            }\n            j = i\n        }\n        \n        return inside\n    }\n\n    /**\n     * Calculate the area of a polygon in square meters\n     * @param polygon List of points\n     * @return Area in square meters\n     */\n    fun calculatePolygonArea(polygon: List<LatLng>): Double {\n        if (polygon.size < 3) return 0.0\n        \n        var area = 0.0\n        for (i in polygon.indices) {\n            val j = (i + 1) % polygon.size\n            area += polygon[i].longitude * polygon[j].latitude\n            area -= polygon[j].longitude * polygon[i].latitude\n        }\n        area = abs(area) / 2.0\n        \n        // Convert from degrees to square meters (approximate)\n        val metersPerDegree = 111111.0\n        return area * metersPerDegree * metersPerDegree\n    }\n}\n","baseTimestamp":1758607144642,"deltas":[{"timestamp":1758607845294,"changes":[{"type":"MODIFY","lineNumber":22,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":69,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":74,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":88,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":102,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":105,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":110,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":116,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":128,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":131,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":137,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":144,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":155,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":163,"content":"","oldContent":"        "}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridGenerator.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridGenerator.kt","baseContent":"package com.example.aerogcsclone.grid\n\nimport com.google.android.gms.maps.model.LatLng\nimport kotlin.math.*\n\n/**\n * Main grid generator for survey missions\n * Based on MissionPlanner grid algorithm\n */\nclass GridGenerator {\n\n    /**\n     * Generate grid survey waypoints for a given polygon\n     * @param polygon Survey area boundary\n     * @param params Grid parameters (spacing, angle, speed, altitude)\n     * @return GridSurveyResult containing waypoints and metadata\n     */\n    fun generateGridSurvey(\n        polygon: List<LatLng>,\n        params: GridSurveyParams\n    ): GridSurveyResult {\n        if (polygon.size < 3) {\n            return GridSurveyResult(\n                waypoints = emptyList(),\n                gridLines = emptyList(),\n                totalDistance = 0.0,\n                estimatedTime = 0.0,\n                numLines = 0\n            )\n        }\n\n        // Calculate polygon center and bounding box\n        val center = GridUtils.calculatePolygonCenter(polygon)\n        val (southwest, northeast) = GridUtils.calculateBoundingBox(polygon)\n        \n        // Calculate grid dimensions\n        val width = GridUtils.haversineDistance(\n            LatLng(southwest.latitude, southwest.longitude),\n            LatLng(southwest.latitude, northeast.longitude)\n        )\n        val height = GridUtils.haversineDistance(\n            LatLng(southwest.latitude, southwest.longitude),\n            LatLng(northeast.latitude, southwest.longitude)\n        )\n        \n        // Determine grid angle - use user input or auto-calculate from longest side\n        val gridAngleRad = if (params.gridAngle == 0f) {\n            Math.toRadians(GridUtils.getAngleOfLongestSide(polygon))\n        } else {\n            Math.toRadians(params.gridAngle.toDouble())\n        }\n\n        // Calculate the maximum dimension to ensure full coverage\n        val maxDimension = max(width, height) * 1.5 // Add buffer for rotation\n        \n        // Calculate number of lines needed\n        val numLines = ceil(maxDimension / params.lineSpacing).toInt()\n        \n        val gridLines = mutableListOf<Pair<LatLng, LatLng>>()\n        val waypoints = mutableListOf<GridWaypoint>()\n        \n        // Generate grid lines\n        for (i in 0 until numLines) {\n            val offset = (i - numLines / 2.0) * params.lineSpacing\n            \n            // Calculate perpendicular offset based on grid angle\n            val perpOffsetX = offset * cos(gridAngleRad + PI/2)\n            val perpOffsetY = offset * sin(gridAngleRad + PI/2)\n            \n            // Calculate line endpoints\n            val lineLength = maxDimension\n            val lineOffsetX = lineLength/2 * cos(gridAngleRad)\n            val lineOffsetY = lineLength/2 * sin(gridAngleRad)\n            \n            val lineStart = GridUtils.moveLatLng(\n                center,\n                perpOffsetX - lineOffsetX,\n                perpOffsetY - lineOffsetY\n            )\n            val lineEnd = GridUtils.moveLatLng(\n                center,\n                perpOffsetX + lineOffsetX,\n                perpOffsetY + lineOffsetY\n            )\n            \n            // Trim line to polygon intersection\n            val trimmedLine = trimLineToPolygon(lineStart, lineEnd, polygon)\n            \n            if (trimmedLine != null) {\n                val (start, end) = trimmedLine\n                gridLines.add(Pair(start, end))\n                \n                // Alternate direction for boustrophedon pattern (back and forth)\n                val (waypointStart, waypointEnd) = if (i % 2 == 0) {\n                    Pair(start, end)\n                } else {\n                    Pair(end, start)\n                }\n                \n                // Add waypoints for this line\n                waypoints.add(GridWaypoint(\n                    position = waypointStart,\n                    altitude = params.altitude,\n                    speed = if (params.includeSpeedCommands) params.speed else null,\n                    isLineStart = true,\n                    lineIndex = i\n                ))\n                \n                waypoints.add(GridWaypoint(\n                    position = waypointEnd,\n                    altitude = params.altitude,\n                    speed = if (params.includeSpeedCommands) params.speed else null,\n                    isLineEnd = true,\n                    lineIndex = i\n                ))\n            }\n        }\n        \n        // Calculate total distance and time\n        val totalDistance = calculateTotalDistance(waypoints)\n        val estimatedTime = if (params.speed > 0) totalDistance / params.speed else 0.0\n        \n        return GridSurveyResult(\n            waypoints = waypoints,\n            gridLines = gridLines,\n            totalDistance = totalDistance,\n            estimatedTime = estimatedTime,\n            numLines = gridLines.size\n        )\n    }\n\n    /**\n     * Trim a line to intersect with polygon boundaries\n     * Uses a simplified approach - checks multiple points along the line\n     */\n    private fun trimLineToPolygon(\n        lineStart: LatLng,\n        lineEnd: LatLng,\n        polygon: List<LatLng>\n    ): Pair<LatLng, LatLng>? {\n        val numSamples = 100\n        val validPoints = mutableListOf<LatLng>()\n        \n        // Sample points along the line\n        for (i in 0..numSamples) {\n            val t = i.toDouble() / numSamples\n            val lat = lineStart.latitude + t * (lineEnd.latitude - lineStart.latitude)\n            val lng = lineStart.longitude + t * (lineEnd.longitude - lineStart.longitude)\n            val point = LatLng(lat, lng)\n            \n            if (GridUtils.isPointInPolygon(point, polygon)) {\n                validPoints.add(point)\n            }\n        }\n        \n        // Return first and last valid points if any exist\n        return if (validPoints.isNotEmpty()) {\n            Pair(validPoints.first(), validPoints.last())\n        } else {\n            null\n        }\n    }\n\n    /**\n     * Calculate total distance of waypoint path\n     */\n    private fun calculateTotalDistance(waypoints: List<GridWaypoint>): Double {\n        if (waypoints.size < 2) return 0.0\n        \n        var totalDistance = 0.0\n        for (i in 0 until waypoints.size - 1) {\n            totalDistance += GridUtils.haversineDistance(\n                waypoints[i].position,\n                waypoints[i + 1].position\n            )\n        }\n        return totalDistance\n    }\n\n    /**\n     * Generate a simple rectangular survey pattern for testing\n     * @param center Center point of the survey\n     * @param width Width in meters\n     * @param height Height in meters\n     * @param params Grid parameters\n     * @return GridSurveyResult\n     */\n    fun generateRectangularSurvey(\n        center: LatLng,\n        width: Double,\n        height: Double,\n        params: GridSurveyParams\n    ): GridSurveyResult {\n        // Create rectangular polygon\n        val halfWidth = width / 2\n        val halfHeight = height / 2\n        \n        val polygon = listOf(\n            GridUtils.moveLatLng(center, -halfWidth, -halfHeight),\n            GridUtils.moveLatLng(center, halfWidth, -halfHeight),\n            GridUtils.moveLatLng(center, halfWidth, halfHeight),\n            GridUtils.moveLatLng(center, -halfWidth, halfHeight)\n        )\n        \n        return generateGridSurvey(polygon, params)\n    }\n\n    /**\n     * Auto-calculate optimal grid angle based on polygon shape\n     * @param polygon Survey area\n     * @return Optimal angle in degrees\n     */\n    fun calculateOptimalGridAngle(polygon: List<LatLng>): Float {\n        if (polygon.size < 3) return 0f\n        \n        val longestSideAngle = GridUtils.getAngleOfLongestSide(polygon)\n        // Align grid perpendicular to longest side for maximum efficiency\n        return ((longestSideAngle + 90) % 360).toFloat()\n    }\n\n    /**\n     * Estimate coverage area for given parameters\n     * @param polygon Survey area\n     * @param lineSpacing Line spacing in meters\n     * @return Coverage percentage (0-100)\n     */\n    fun estimateCoverage(polygon: List<LatLng>, lineSpacing: Float): Float {\n        val area = GridUtils.calculatePolygonArea(polygon)\n        if (area <= 0) return 0f\n        \n        // Simple estimation based on line spacing\n        // This is a rough approximation - real coverage depends on sensor width\n        val estimatedCoveredArea = area * (1.0 - lineSpacing / 100.0) // Simplified model\n        return (estimatedCoveredArea / area * 100).coerceIn(0.0, 100.0).toFloat()\n    }\n}\n","baseTimestamp":1758607185609,"deltas":[{"timestamp":1758607845272,"changes":[{"type":"MODIFY","lineNumber":34,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":44,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":54,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":57,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":60,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":64,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":68,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":73,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":84,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":87,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":91,"content":"","oldContent":"                "},{"type":"MODIFY","lineNumber":98,"content":"","oldContent":"                "},{"type":"MODIFY","lineNumber":107,"content":"","oldContent":"                "},{"type":"MODIFY","lineNumber":117,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":121,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":142,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":149,"content":"","oldContent":"            "},{"type":"MODIFY","lineNumber":154,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":168,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":196,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":203,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":214,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":229,"content":"","oldContent":"        "}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridMissionConverter.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/grid/GridMissionConverter.kt","baseContent":"package com.example.aerogcsclone.grid\n\nimport com.divpundir.mavlink.api.MavEnumValue\nimport com.divpundir.mavlink.definitions.common.*\nimport com.google.android.gms.maps.model.LatLng\n\n/**\n * Converts grid survey waypoints to MAVLink mission items\n */\nobject GridMissionConverter {\n\n    /**\n     * Convert grid waypoints to MAVLink mission items\n     * @param gridResult Grid survey result from GridGenerator\n     * @param homePosition Home position for mission\n     * @return List of MAVLink MissionItemInt objects\n     */\n    fun convertToMissionItems(\n        gridResult: GridSurveyResult,\n        homePosition: LatLng\n    ): List<MissionItemInt> {\n        val missionItems = mutableListOf<MissionItemInt>()\n\n        // Sequence 0: Home position as NAV_WAYPOINT\n        missionItems.add(\n            MissionItemInt(\n                targetSystem = 0u,\n                targetComponent = 0u,\n                seq = 0u,\n                frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),\n                command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),\n                current = 1u, // True for first item\n                autocontinue = 1u,\n                param1 = 0f,\n                param2 = 0f,\n                param3 = 0f,\n                param4 = 0f,\n                x = (homePosition.latitude * 1E7).toInt(),\n                y = (homePosition.longitude * 1E7).toInt(),\n                z = 10f // Default takeoff altitude\n            )\n        )\n\n        // Sequence 1: Takeoff at home position\n        missionItems.add(\n            MissionItemInt(\n                targetSystem = 0u,\n                targetComponent = 0u,\n                seq = 1u,\n                frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),\n                command = MavEnumValue.of(MavCmd.NAV_TAKEOFF),\n                current = 0u,\n                autocontinue = 1u,\n                param1 = 0f,\n                param2 = 0f,\n                param3 = 0f,\n                param4 = 0f,\n                x = (homePosition.latitude * 1E7).toInt(),\n                y = (homePosition.longitude * 1E7).toInt(),\n                z = 15f // Takeoff altitude\n            )\n        )\n\n        var sequenceNumber = 2\n        var lastLineIndex = -1\n\n        // Convert grid waypoints to mission items\n        gridResult.waypoints.forEach { waypoint ->\n            // Add speed change command at start of each new line\n            if (waypoint.isLineStart && waypoint.speed != null && waypoint.lineIndex != lastLineIndex) {\n                missionItems.add(\n                    MissionItemInt(\n                        targetSystem = 0u,\n                        targetComponent = 0u,\n                        seq = sequenceNumber.toUShort(),\n                        frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),\n                        command = MavEnumValue.of(MavCmd.DO_CHANGE_SPEED),\n                        current = 0u,\n                        autocontinue = 1u,\n                        param1 = 0f, // Speed type: 0 = Airspeed, 1 = Ground Speed\n                        param2 = waypoint.speed,\n                        param3 = -1f, // Throttle (-1 = no change)\n                        param4 = 0f,\n                        x = 0,\n                        y = 0,\n                        z = 0f\n                    )\n                )\n                sequenceNumber++\n                lastLineIndex = waypoint.lineIndex\n            }\n\n            // Add waypoint\n            missionItems.add(\n                MissionItemInt(\n                    targetSystem = 0u,\n                    targetComponent = 0u,\n                    seq = sequenceNumber.toUShort(),\n                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),\n                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),\n                    current = 0u,\n                    autocontinue = 1u,\n                    param1 = 0f, // Hold time\n                    param2 = 0f, // Acceptance radius\n                    param3 = 0f, // Pass radius\n                    param4 = 0f, // Yaw\n                    x = (waypoint.position.latitude * 1E7).toInt(),\n                    y = (waypoint.position.longitude * 1E7).toInt(),\n                    z = waypoint.altitude\n                )\n            )\n            sequenceNumber++\n        }\n\n        // Add RTL (Return to Launch) at the end\n        missionItems.add(\n            MissionItemInt(\n                targetSystem = 0u,\n                targetComponent = 0u,\n                seq = sequenceNumber.toUShort(),\n                frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),\n                command = MavEnumValue.of(MavCmd.NAV_RETURN_TO_LAUNCH),\n                current = 0u,\n                autocontinue = 1u,\n                param1 = 0f,\n                param2 = 0f,\n                param3 = 0f,\n                param4 = 0f,\n                x = 0,\n                y = 0,\n                z = 0f\n            )\n        )\n\n        return missionItems\n    }\n\n    /**\n     * Convert single waypoint to mission item\n     */\n    private fun waypointToMissionItem(\n        waypoint: GridWaypoint,\n        sequence: Int\n    ): MissionItemInt {\n        return MissionItemInt(\n            targetSystem = 0u,\n            targetComponent = 0u,\n            seq = sequence.toUShort(),\n            frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),\n            command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),\n            current = 0u,\n            autocontinue = 1u,\n            param1 = 0f,\n            param2 = 0f,\n            param3 = 0f,\n            param4 = 0f,\n            x = (waypoint.position.latitude * 1E7).toInt(),\n            y = (waypoint.position.longitude * 1E7).toInt(),\n            z = waypoint.altitude\n        )\n    }\n\n    /**\n     * Estimate mission duration\n     * @param gridResult Grid survey result\n     * @param cruiseSpeed Average cruise speed in m/s\n     * @return Estimated time in minutes\n     */\n    fun estimateMissionDuration(gridResult: GridSurveyResult, cruiseSpeed: Float = 10f): Float {\n        val surveyTime = (gridResult.totalDistance / cruiseSpeed) / 60f // Convert to minutes\n        val setupTime = 2f // Minutes for takeoff, positioning, etc.\n        val rtlTime = 1f // Minutes for return to launch\n        \n        return surveyTime + setupTime + rtlTime\n    }\n\n    /**\n     * Calculate total mission items count\n     */\n    fun calculateMissionItemCount(gridResult: GridSurveyResult): Int {\n        var count = 2 // Home + Takeoff\n        count += gridResult.waypoints.size // Survey waypoints\n        \n        // Count speed change commands (one per line)\n        val speedCommands = gridResult.waypoints.count { it.isLineStart && it.speed != null }\n        count += speedCommands\n        \n        count += 1 // RTL\n        \n        return count\n    }\n}\n","baseTimestamp":1758607215004,"deltas":[{"timestamp":1758607845272,"changes":[{"type":"MODIFY","lineNumber":172,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":182,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":186,"content":"","oldContent":"        "},{"type":"MODIFY","lineNumber":188,"content":"","oldContent":"        "}]},{"timestamp":1758608214916,"changes":[{"type":"MODIFY","lineNumber":168,"content":"    fun estimateMissionDuration(gridResult: GridSurveyResult, cruiseSpeed: Float = 10f): Double {","oldContent":"    fun estimateMissionDuration(gridResult: GridSurveyResult, cruiseSpeed: Float = 10f): Float {"}]},{"timestamp":1758608801977,"changes":[{"type":"INSERT","lineNumber":65,"content":"        var isFirstWaypoint = true"},{"type":"DELETE","lineNumber":68,"oldContent":"            // Add speed change command at start of each new line"},{"type":"MODIFY","lineNumber":69,"content":"            // For the first waypoint after takeoff, add speed command BEFORE the waypoint","oldContent":"            if (waypoint.isLineStart && waypoint.speed != null && waypoint.lineIndex != lastLineIndex) {"},{"type":"INSERT","lineNumber":70,"content":"            // This ensures we have NAV_WAYPOINT -> DO_CHANGE_SPEED -> NAV_WAYPOINT sequence"},{"type":"INSERT","lineNumber":71,"content":"            if (isFirstWaypoint && waypoint.speed != null) {"},{"type":"INSERT","lineNumber":91,"content":"                isFirstWaypoint = false"},{"type":"INSERT","lineNumber":92,"content":"            }"},{"type":"INSERT","lineNumber":93,"content":"            // Add speed change command at start of each NEW line (but not the first waypoint)"},{"type":"INSERT","lineNumber":94,"content":"            // This ensures we have NAV_WAYPOINT -> DO_CHANGE_SPEED -> NAV_WAYPOINT sequence"},{"type":"INSERT","lineNumber":95,"content":"            else if (!isFirstWaypoint && waypoint.isLineStart && waypoint.speed != null && waypoint.lineIndex != lastLineIndex) {"},{"type":"INSERT","lineNumber":96,"content":"                missionItems.add("},{"type":"INSERT","lineNumber":97,"content":"                    MissionItemInt("},{"type":"INSERT","lineNumber":98,"content":"                        targetSystem = 0u,"},{"type":"INSERT","lineNumber":99,"content":"                        targetComponent = 0u,"},{"type":"INSERT","lineNumber":100,"content":"                        seq = sequenceNumber.toUShort(),"},{"type":"INSERT","lineNumber":101,"content":"                        frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":102,"content":"                        command = MavEnumValue.of(MavCmd.DO_CHANGE_SPEED),"},{"type":"INSERT","lineNumber":103,"content":"                        current = 0u,"},{"type":"INSERT","lineNumber":104,"content":"                        autocontinue = 1u,"},{"type":"INSERT","lineNumber":105,"content":"                        param1 = 0f, // Speed type: 0 = Airspeed, 1 = Ground Speed"},{"type":"INSERT","lineNumber":106,"content":"                        param2 = waypoint.speed,"},{"type":"INSERT","lineNumber":107,"content":"                        param3 = -1f, // Throttle (-1 = no change)"},{"type":"INSERT","lineNumber":108,"content":"                        param4 = 0f,"},{"type":"INSERT","lineNumber":109,"content":"                        x = 0,"},{"type":"INSERT","lineNumber":110,"content":"                        y = 0,"},{"type":"INSERT","lineNumber":111,"content":"                        z = 0f"},{"type":"INSERT","lineNumber":112,"content":"                    )"},{"type":"INSERT","lineNumber":113,"content":"                )"},{"type":"INSERT","lineNumber":114,"content":"                sequenceNumber++"},{"type":"DELETE","lineNumber":92,"oldContent":"            // Add waypoint"},{"type":"INSERT","lineNumber":118,"content":"            // Add the actual waypoint"},{"type":"INSERT","lineNumber":138,"content":"            "},{"type":"INSERT","lineNumber":139,"content":"            if (isFirstWaypoint) {"},{"type":"INSERT","lineNumber":140,"content":"                isFirstWaypoint = false"},{"type":"INSERT","lineNumber":141,"content":"            }"}]},{"timestamp":1758608834041,"changes":[{"type":"MODIFY","lineNumber":72,"content":"                missionItems.add(","oldContent":"                missionItems.add("},{"type":"DELETE","lineNumber":91,"oldContent":"                lastLineIndex = waypoint.lineIndex"},{"type":"DELETE","lineNumber":92,"oldContent":"            }"},{"type":"DELETE","lineNumber":94,"oldContent":""},{"type":"DELETE","lineNumber":97,"oldContent":"            missionItems.add("},{"type":"DELETE","lineNumber":99,"oldContent":"                MissionItemInt("},{"type":"DELETE","lineNumber":101,"oldContent":"                    targetSystem = 0u,"},{"type":"DELETE","lineNumber":103,"oldContent":"                    targetComponent = 0u,"},{"type":"DELETE","lineNumber":105,"oldContent":"                    seq = sequenceNumber.toUShort(),"},{"type":"DELETE","lineNumber":107,"oldContent":"                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"DELETE","lineNumber":109,"oldContent":"                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"DELETE","lineNumber":111,"oldContent":"                    current = 0u,"},{"type":"DELETE","lineNumber":113,"oldContent":"                    autocontinue = 1u,"},{"type":"DELETE","lineNumber":115,"oldContent":"                    param1 = 0f, // Hold time"},{"type":"DELETE","lineNumber":117,"oldContent":"                    param2 = 0f, // Acceptance radius"},{"type":"DELETE","lineNumber":119,"oldContent":"                    param3 = 0f, // Pass radius"},{"type":"DELETE","lineNumber":121,"oldContent":"                    param4 = 0f, // Yaw"},{"type":"DELETE","lineNumber":123,"oldContent":"                    x = (waypoint.position.latitude * 1E7).toInt(),"},{"type":"DELETE","lineNumber":125,"oldContent":"                    y = (waypoint.position.longitude * 1E7).toInt(),"},{"type":"DELETE","lineNumber":127,"oldContent":"                    z = waypoint.altitude"},{"type":"DELETE","lineNumber":129,"oldContent":"                )"},{"type":"DELETE","lineNumber":131,"oldContent":"            )"},{"type":"DELETE","lineNumber":133,"oldContent":"            sequenceNumber++"},{"type":"DELETE","lineNumber":135,"oldContent":"        }"},{"type":"DELETE","lineNumber":137,"oldContent":""},{"type":"INSERT","lineNumber":115,"content":"                lastLineIndex = waypoint.lineIndex"},{"type":"INSERT","lineNumber":116,"content":"            }"},{"type":"INSERT","lineNumber":117,"content":""},{"type":"INSERT","lineNumber":118,"content":"            // Add the actual waypoint"},{"type":"INSERT","lineNumber":119,"content":"            missionItems.add("},{"type":"INSERT","lineNumber":120,"content":"                MissionItemInt("},{"type":"INSERT","lineNumber":121,"content":"                    targetSystem = 0u,"},{"type":"INSERT","lineNumber":122,"content":"                    targetComponent = 0u,"},{"type":"INSERT","lineNumber":123,"content":"                    seq = sequenceNumber.toUShort(),"},{"type":"INSERT","lineNumber":124,"content":"                    frame = MavEnumValue.of(MavFrame.GLOBAL_RELATIVE_ALT_INT),"},{"type":"INSERT","lineNumber":125,"content":"                    command = MavEnumValue.of(MavCmd.NAV_WAYPOINT),"},{"type":"INSERT","lineNumber":126,"content":"                    current = 0u,"},{"type":"INSERT","lineNumber":127,"content":"                    autocontinue = 1u,"},{"type":"INSERT","lineNumber":128,"content":"                    param1 = 0f, // Hold time"},{"type":"INSERT","lineNumber":129,"content":"                    param2 = 0f, // Acceptance radius"},{"type":"INSERT","lineNumber":130,"content":"                    param3 = 0f, // Pass radius"},{"type":"INSERT","lineNumber":131,"content":"                    param4 = 0f, // Yaw"},{"type":"INSERT","lineNumber":132,"content":"                    x = (waypoint.position.latitude * 1E7).toInt(),"},{"type":"INSERT","lineNumber":133,"content":"                    y = (waypoint.position.longitude * 1E7).toInt(),"},{"type":"INSERT","lineNumber":134,"content":"                    z = waypoint.altitude"},{"type":"INSERT","lineNumber":135,"content":"                )"},{"type":"INSERT","lineNumber":136,"content":"            )"},{"type":"INSERT","lineNumber":137,"content":"            sequenceNumber++"},{"type":"INSERT","lineNumber":138,"content":""},{"type":"INSERT","lineNumber":139,"content":"            if (isFirstWaypoint) {"},{"type":"INSERT","lineNumber":140,"content":"                isFirstWaypoint = false"},{"type":"INSERT","lineNumber":141,"content":"            }"},{"type":"INSERT","lineNumber":142,"content":"        }"},{"type":"INSERT","lineNumber":143,"content":""},{"type":"DELETE","lineNumber":143,"oldContent":"            // Add the actual waypoint"},{"type":"DELETE","lineNumber":164,"oldContent":"            "},{"type":"DELETE","lineNumber":166,"oldContent":"            if (isFirstWaypoint) {"},{"type":"DELETE","lineNumber":168,"oldContent":"                isFirstWaypoint = false"},{"type":"DELETE","lineNumber":170,"oldContent":"            }"}]},{"timestamp":1758609916076,"changes":[{"type":"INSERT","lineNumber":71,"content":"            if (isFirstWaypoint && waypoint.speed != null) {"},{"type":"DELETE","lineNumber":72,"oldContent":"                missionItems.add("},{"type":"INSERT","lineNumber":103,"content":"                        current = 0u,"},{"type":"INSERT","lineNumber":104,"content":"                        autocontinue = 1u,"},{"type":"INSERT","lineNumber":105,"content":"                        param1 = 0f, // Speed type: 0 = Airspeed, 1 = Ground Speed"},{"type":"INSERT","lineNumber":106,"content":"                        param2 = waypoint.speed,"},{"type":"INSERT","lineNumber":107,"content":"                        param3 = -1f, // Throttle (-1 = no change)"},{"type":"INSERT","lineNumber":108,"content":"                        param4 = 0f,"},{"type":"INSERT","lineNumber":109,"content":"                        x = 0,"},{"type":"INSERT","lineNumber":110,"content":"                        y = 0,"},{"type":"INSERT","lineNumber":111,"content":"                        z = 0f"},{"type":"INSERT","lineNumber":112,"content":"                    )"},{"type":"INSERT","lineNumber":113,"content":"                )"},{"type":"INSERT","lineNumber":114,"content":"                sequenceNumber++"},{"type":"DELETE","lineNumber":105,"oldContent":"                        current = 0u,"},{"type":"DELETE","lineNumber":108,"oldContent":"                        autocontinue = 1u,"},{"type":"DELETE","lineNumber":111,"oldContent":"                        param1 = 0f, // Speed type: 0 = Airspeed, 1 = Ground Speed"},{"type":"DELETE","lineNumber":114,"oldContent":"                        param2 = waypoint.speed,"},{"type":"DELETE","lineNumber":117,"oldContent":"                        param3 = -1f, // Throttle (-1 = no change)"},{"type":"DELETE","lineNumber":120,"oldContent":"                        param4 = 0f,"},{"type":"DELETE","lineNumber":123,"oldContent":"                        x = 0,"},{"type":"DELETE","lineNumber":126,"oldContent":"                        y = 0,"},{"type":"DELETE","lineNumber":129,"oldContent":"                        z = 0f"},{"type":"DELETE","lineNumber":132,"oldContent":"                    )"},{"type":"DELETE","lineNumber":135,"oldContent":"                )"},{"type":"DELETE","lineNumber":138,"oldContent":"                sequenceNumber++"},{"type":"DELETE","lineNumber":140,"oldContent":"        // Add RTL (Return to Launch) at the end"},{"type":"DELETE","lineNumber":142,"oldContent":"        missionItems.add("},{"type":"DELETE","lineNumber":144,"oldContent":"            MissionItemInt("},{"type":"DELETE","lineNumber":146,"oldContent":"                targetSystem = 0u,"},{"type":"INSERT","lineNumber":144,"content":"        // Add RTL (Return to Launch) at the end"},{"type":"INSERT","lineNumber":145,"content":"        missionItems.add("},{"type":"INSERT","lineNumber":146,"content":"            MissionItemInt("},{"type":"INSERT","lineNumber":147,"content":"                targetSystem = 0u,"}]}]},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/AppScope.kt":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/app/src/main/java/com/example/aerogcsclone/Telemetry/AppScope.kt","baseContent":"package com.example.aerogcsclone.Telemetry\n\nimport kotlinx.coroutines.CoroutineScope\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.SupervisorJob\n\n/**\n * Application-level coroutine scope for background operations\n * Used by TelemetryRepository and other long-running operations\n */\nobject AppScope : CoroutineScope {\n    override val coroutineContext = SupervisorJob() + Dispatchers.IO\n}\n","baseTimestamp":1758607644536},"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/settings.gradle.kts":{"filePath":"C:/Users/Hrushikesh/AndroidStudioProjects/SampleGCS/settings.gradle.kts","baseContent":"pluginManagement {\n    repositories {\n        google {\n            content {\n                includeGroupByRegex(\"com\\\\.android.*\")\n                includeGroupByRegex(\"com\\\\.google.*\")\n                includeGroupByRegex(\"androidx.*\")\n            }\n        }\n        mavenCentral()\n        gradlePluginPortal()\n    }\n}\ndependencyResolutionManagement {\n    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\n    repositories {\n        google()\n        mavenCentral()\n    }\n}\n\nrootProject.name = \"aerogcsclone\"\ninclude(\":app\")\n","baseTimestamp":1758691141007}}}